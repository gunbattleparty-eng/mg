
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/TTRewardedVideo.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '7259fgxt65KXakDIVqxIEOg', 'TTRewardedVideo');
// game_script/scripts/TTRewardedVideo.js

"use strict";

var o;
exports.TTRewardedVideo = void 0;

var $audioPlayer = require("./AudioPlayer");

var $baseAd = require("./BaseAd");

var a = window.tt;

var l = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.videoEndCallback = null;
    e.lastTime = 0;
    e.tryCount = 0;
    return e;
  }

  __extends(e, t);

  e.prototype.loadAd = function () {
    if (this.adUnitId) {
      if (a && a.createRewardedVideoAd) {
        var t = {
          adUnitId: this.adUnitId
        };
        console.log("创建激励视频", t);
        this.adIns = a.createRewardedVideoAd(t);

        if (this.adIns.onLoad) {
          this.adIns.onLoad(this.onLoad);
        }

        if (this.adIns.onClose) {
          this.adIns.onClose(this.onClose);
        }

        if (this.adIns.onError) {
          this.adIns.onError(this.onError);
        }

        this.adIns.load();
      } else {
        console.warn("当前平台不支持创建激励视频");
      }
    } else {
      console.error("头条激励视频ID为空");
    }
  };

  e.prototype.showRewardedVideo = function (t, e, i) {
    this.tryCount = 0;
    this.show(t, e, i);
  };

  e.prototype.show = function (t, e, i) {
    var o = this;
    this.showCallback = t;
    this.closeCallback = e;
    this.videoEndCallback = i;
    this.musicVolume = $audioPlayer["default"].musicVolume;
    this.effectsVolume = $audioPlayer["default"].effectVolume;

    if (this.isCanShow) {
      if (!this.adIns) {
        console.warn(this.adUnitId, ":未创建，执行创建");
        this.isAutoShow = !0;
        return this.loadAd();
      }

      if (this.isConsume) {
        this.reCreateAd(!0);
      } else {
        {
          if (!this.isLoaded) {
            console.warn(this.adUnitId, ":未加载完成，稍等");
            return void (this.isAutoShow = !0);
          }

          if (this.showing) {
            console.warn(this.adUnitId, "广告正在显示中");
          } else {
            this.showing = !1;

            if (this.adIns.show) {
              var n = this.adIns.show();
              n && n.then ? n.then(function () {
                o.tryCount = 0;
                o.isConsume = !0;
                o.showing = !0;

                if (o.showCallback) {
                  o.showCallback();
                }

                o.showCallback = null;
                o.pause();
              })["catch"](function (t) {
                console.warn(o.adUnitId, ":show错误，重新加载", t);
                o.reCreateAd(!0);
                o.resume();
              }) : (console.warn(this.adUnitId, ":show显示失败，重新加载"), this.reCreateAd(!0), this.resume());
            } else {
              this.resume();
              console.error(this.adUnitId, ":未知错误");
            }
          }
        }
      }
    } else {
      console.warn(this.adUnitId, ":当前广告禁止显示");
    }
  };

  e.prototype.reCreateAd = function (t) {
    this.tryCount++;
    this.tryCount >= 4 ? this.isAutoShow = !1 : (this.destroyAd(), this.isAutoShow = t, this.loadAd());
  };

  e.prototype.autoShow = function () {
    if (this.isAutoShow) {
      this.isAutoShow = !1;
      this.showRewardedVideo(this.showCallback, this.closeCallback, this.videoEndCallback);
    }
  };

  e.prototype.onAdLoad = function () {
    console.log(this.adUnitId, ":===onAdload===");
    this.isConsume = !1;
    this.isLoaded = !0;
    this.autoShow();
  };

  e.prototype.onAdError = function (t) {
    console.log("激励视频onAdError", this.adUnitId, t);
    this.showing = !1;
    this.resume();
    this.destroyAd();
  };

  e.prototype.onAdClose = function (t) {
    console.log(":===onAdClose===");
    this.showing = !1;
    t && t.isEnded ? this.videoEndCallback && this.videoEndCallback() : this.closeCallback && this.closeCallback();
    this.isOpenPreLoad ? this.adIns.load() : this.destroyAd();
    this.resume();
  };

  e.prototype.destroyAd = function () {
    this.isLoaded = !1;
    this.isAutoShow = !1;
    this.isConsume = !1;
    this.showCallback = null;
    this.closeCallback = null;
    this.videoEndCallback = null;
    this.showing = !1;

    if (this.adIns) {
      if (this.adIns.offLoad) {
        this.adIns.offLoad(this.onLoad);
      }

      if (this.adIns.offClose) {
        this.adIns.offClose(this.onClose);
      }

      if (this.adIns.offError) {
        this.adIns.offError(this.onError);
      }

      if (this.adIns.destroy) {
        this.adIns.destroy();
      }

      this.adIns = null;
    }
  };

  return e;
}($baseAd.BaseAd);

exports.TTRewardedVideo = l;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXFRUUmV3YXJkZWRWaWRlby5qcyJdLCJuYW1lcyI6WyJvIiwiZXhwb3J0cyIsIlRUUmV3YXJkZWRWaWRlbyIsIiRhdWRpb1BsYXllciIsInJlcXVpcmUiLCIkYmFzZUFkIiwiYSIsIndpbmRvdyIsInR0IiwibCIsInQiLCJlIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJ2aWRlb0VuZENhbGxiYWNrIiwibGFzdFRpbWUiLCJ0cnlDb3VudCIsIl9fZXh0ZW5kcyIsInByb3RvdHlwZSIsImxvYWRBZCIsImFkVW5pdElkIiwiY3JlYXRlUmV3YXJkZWRWaWRlb0FkIiwiY29uc29sZSIsImxvZyIsImFkSW5zIiwib25Mb2FkIiwib25DbG9zZSIsIm9uRXJyb3IiLCJsb2FkIiwid2FybiIsImVycm9yIiwic2hvd1Jld2FyZGVkVmlkZW8iLCJpIiwic2hvdyIsInNob3dDYWxsYmFjayIsImNsb3NlQ2FsbGJhY2siLCJtdXNpY1ZvbHVtZSIsImVmZmVjdHNWb2x1bWUiLCJlZmZlY3RWb2x1bWUiLCJpc0NhblNob3ciLCJpc0F1dG9TaG93IiwiaXNDb25zdW1lIiwicmVDcmVhdGVBZCIsImlzTG9hZGVkIiwic2hvd2luZyIsIm4iLCJ0aGVuIiwicGF1c2UiLCJyZXN1bWUiLCJkZXN0cm95QWQiLCJhdXRvU2hvdyIsIm9uQWRMb2FkIiwib25BZEVycm9yIiwib25BZENsb3NlIiwiaXNFbmRlZCIsImlzT3BlblByZUxvYWQiLCJvZmZMb2FkIiwib2ZmQ2xvc2UiLCJvZmZFcnJvciIsImRlc3Ryb3kiLCJCYXNlQWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsQ0FBSjtBQUNBQyxPQUFPLENBQUNDLGVBQVIsR0FBMEIsS0FBSyxDQUEvQjs7QUFDQSxJQUFJQyxZQUFZLEdBQUdDLE9BQU8sQ0FBQyxlQUFELENBQTFCOztBQUNBLElBQUlDLE9BQU8sR0FBR0QsT0FBTyxDQUFDLFVBQUQsQ0FBckI7O0FBQ0EsSUFBSUUsQ0FBQyxHQUFHQyxNQUFNLENBQUNDLEVBQWY7O0FBQ0EsSUFBSUMsQ0FBQyxHQUFJLFVBQVVDLENBQVYsRUFBYTtFQUNsQixTQUFTQyxDQUFULEdBQWE7SUFDVCxJQUFJQSxDQUFDLEdBQUksU0FBU0QsQ0FBVCxJQUFjQSxDQUFDLENBQUNFLEtBQUYsQ0FBUSxJQUFSLEVBQWNDLFNBQWQsQ0FBZixJQUE0QyxJQUFwRDtJQUNBRixDQUFDLENBQUNHLGdCQUFGLEdBQXFCLElBQXJCO0lBQ0FILENBQUMsQ0FBQ0ksUUFBRixHQUFhLENBQWI7SUFDQUosQ0FBQyxDQUFDSyxRQUFGLEdBQWEsQ0FBYjtJQUNBLE9BQU9MLENBQVA7RUFDSDs7RUFDRE0sU0FBUyxDQUFDTixDQUFELEVBQUlELENBQUosQ0FBVDs7RUFDQUMsQ0FBQyxDQUFDTyxTQUFGLENBQVlDLE1BQVosR0FBcUIsWUFBWTtJQUM3QixJQUFJLEtBQUtDLFFBQVQsRUFBbUI7TUFDZixJQUFJZCxDQUFDLElBQUlBLENBQUMsQ0FBQ2UscUJBQVgsRUFBa0M7UUFDOUIsSUFBSVgsQ0FBQyxHQUFHO1VBQ0pVLFFBQVEsRUFBRSxLQUFLQTtRQURYLENBQVI7UUFHQUUsT0FBTyxDQUFDQyxHQUFSLENBQVksUUFBWixFQUFzQmIsQ0FBdEI7UUFDQSxLQUFLYyxLQUFMLEdBQWFsQixDQUFDLENBQUNlLHFCQUFGLENBQXdCWCxDQUF4QixDQUFiOztRQUNBLElBQUksS0FBS2MsS0FBTCxDQUFXQyxNQUFmLEVBQXVCO1VBQ25CLEtBQUtELEtBQUwsQ0FBV0MsTUFBWCxDQUFrQixLQUFLQSxNQUF2QjtRQUNIOztRQUNELElBQUksS0FBS0QsS0FBTCxDQUFXRSxPQUFmLEVBQXdCO1VBQ3BCLEtBQUtGLEtBQUwsQ0FBV0UsT0FBWCxDQUFtQixLQUFLQSxPQUF4QjtRQUNIOztRQUNELElBQUksS0FBS0YsS0FBTCxDQUFXRyxPQUFmLEVBQXdCO1VBQ3BCLEtBQUtILEtBQUwsQ0FBV0csT0FBWCxDQUFtQixLQUFLQSxPQUF4QjtRQUNIOztRQUNELEtBQUtILEtBQUwsQ0FBV0ksSUFBWDtNQUNILENBaEJELE1BZ0JPO1FBQ0hOLE9BQU8sQ0FBQ08sSUFBUixDQUFhLGVBQWI7TUFDSDtJQUNKLENBcEJELE1Bb0JPO01BQ0hQLE9BQU8sQ0FBQ1EsS0FBUixDQUFjLFlBQWQ7SUFDSDtFQUNKLENBeEJEOztFQXlCQW5CLENBQUMsQ0FBQ08sU0FBRixDQUFZYSxpQkFBWixHQUFnQyxVQUFVckIsQ0FBVixFQUFhQyxDQUFiLEVBQWdCcUIsQ0FBaEIsRUFBbUI7SUFDL0MsS0FBS2hCLFFBQUwsR0FBZ0IsQ0FBaEI7SUFDQSxLQUFLaUIsSUFBTCxDQUFVdkIsQ0FBVixFQUFhQyxDQUFiLEVBQWdCcUIsQ0FBaEI7RUFDSCxDQUhEOztFQUlBckIsQ0FBQyxDQUFDTyxTQUFGLENBQVllLElBQVosR0FBbUIsVUFBVXZCLENBQVYsRUFBYUMsQ0FBYixFQUFnQnFCLENBQWhCLEVBQW1CO0lBQ2xDLElBQUloQyxDQUFDLEdBQUcsSUFBUjtJQUNBLEtBQUtrQyxZQUFMLEdBQW9CeEIsQ0FBcEI7SUFDQSxLQUFLeUIsYUFBTCxHQUFxQnhCLENBQXJCO0lBQ0EsS0FBS0csZ0JBQUwsR0FBd0JrQixDQUF4QjtJQUNBLEtBQUtJLFdBQUwsR0FBbUJqQyxZQUFZLFdBQVosQ0FBcUJpQyxXQUF4QztJQUNBLEtBQUtDLGFBQUwsR0FBcUJsQyxZQUFZLFdBQVosQ0FBcUJtQyxZQUExQzs7SUFDQSxJQUFJLEtBQUtDLFNBQVQsRUFBb0I7TUFDaEIsSUFBSSxDQUFDLEtBQUtmLEtBQVYsRUFBaUI7UUFDYkYsT0FBTyxDQUFDTyxJQUFSLENBQWEsS0FBS1QsUUFBbEIsRUFBNEIsV0FBNUI7UUFDQSxLQUFLb0IsVUFBTCxHQUFrQixDQUFDLENBQW5CO1FBQ0EsT0FBTyxLQUFLckIsTUFBTCxFQUFQO01BQ0g7O01BQ0QsSUFBSSxLQUFLc0IsU0FBVCxFQUFvQjtRQUNoQixLQUFLQyxVQUFMLENBQWdCLENBQUMsQ0FBakI7TUFDSCxDQUZELE1BRU87UUFDSDtVQUNJLElBQUksQ0FBQyxLQUFLQyxRQUFWLEVBQW9CO1lBQ2hCckIsT0FBTyxDQUFDTyxJQUFSLENBQWEsS0FBS1QsUUFBbEIsRUFBNEIsV0FBNUI7WUFDQSxPQUFPLE1BQU0sS0FBS29CLFVBQUwsR0FBa0IsQ0FBQyxDQUF6QixDQUFQO1VBQ0g7O1VBQ0QsSUFBSSxLQUFLSSxPQUFULEVBQWtCO1lBQ2R0QixPQUFPLENBQUNPLElBQVIsQ0FBYSxLQUFLVCxRQUFsQixFQUE0QixTQUE1QjtVQUNILENBRkQsTUFFTztZQUNILEtBQUt3QixPQUFMLEdBQWUsQ0FBQyxDQUFoQjs7WUFDQSxJQUFJLEtBQUtwQixLQUFMLENBQVdTLElBQWYsRUFBcUI7Y0FDakIsSUFBSVksQ0FBQyxHQUFHLEtBQUtyQixLQUFMLENBQVdTLElBQVgsRUFBUjtjQUNBWSxDQUFDLElBQUlBLENBQUMsQ0FBQ0MsSUFBUCxHQUNNRCxDQUFDLENBQ0lDLElBREwsQ0FDVSxZQUFZO2dCQUNkOUMsQ0FBQyxDQUFDZ0IsUUFBRixHQUFhLENBQWI7Z0JBQ0FoQixDQUFDLENBQUN5QyxTQUFGLEdBQWMsQ0FBQyxDQUFmO2dCQUNBekMsQ0FBQyxDQUFDNEMsT0FBRixHQUFZLENBQUMsQ0FBYjs7Z0JBQ0EsSUFBSTVDLENBQUMsQ0FBQ2tDLFlBQU4sRUFBb0I7a0JBQ2hCbEMsQ0FBQyxDQUFDa0MsWUFBRjtnQkFDSDs7Z0JBQ0RsQyxDQUFDLENBQUNrQyxZQUFGLEdBQWlCLElBQWpCO2dCQUNBbEMsQ0FBQyxDQUFDK0MsS0FBRjtjQUNILENBVkwsV0FXVyxVQUFVckMsQ0FBVixFQUFhO2dCQUNoQlksT0FBTyxDQUFDTyxJQUFSLENBQWE3QixDQUFDLENBQUNvQixRQUFmLEVBQXlCLGNBQXpCLEVBQXlDVixDQUF6QztnQkFDQVYsQ0FBQyxDQUFDMEMsVUFBRixDQUFhLENBQUMsQ0FBZDtnQkFDQTFDLENBQUMsQ0FBQ2dELE1BQUY7Y0FDSCxDQWZMLENBRE4sSUFpQk8xQixPQUFPLENBQUNPLElBQVIsQ0FBYSxLQUFLVCxRQUFsQixFQUE0QixnQkFBNUIsR0FDRCxLQUFLc0IsVUFBTCxDQUFnQixDQUFDLENBQWpCLENBREMsRUFFRCxLQUFLTSxNQUFMLEVBbkJOO1lBb0JILENBdEJELE1Bc0JPO2NBQ0gsS0FBS0EsTUFBTDtjQUNBMUIsT0FBTyxDQUFDUSxLQUFSLENBQWMsS0FBS1YsUUFBbkIsRUFBNkIsT0FBN0I7WUFDSDtVQUNKO1FBQ0o7TUFDSjtJQUNKLENBL0NELE1BK0NPO01BQ0hFLE9BQU8sQ0FBQ08sSUFBUixDQUFhLEtBQUtULFFBQWxCLEVBQTRCLFdBQTVCO0lBQ0g7RUFDSixDQXpERDs7RUEwREFULENBQUMsQ0FBQ08sU0FBRixDQUFZd0IsVUFBWixHQUF5QixVQUFVaEMsQ0FBVixFQUFhO0lBQ2xDLEtBQUtNLFFBQUw7SUFDQSxLQUFLQSxRQUFMLElBQWlCLENBQWpCLEdBQXNCLEtBQUt3QixVQUFMLEdBQWtCLENBQUMsQ0FBekMsSUFBK0MsS0FBS1MsU0FBTCxJQUFtQixLQUFLVCxVQUFMLEdBQWtCOUIsQ0FBckMsRUFBeUMsS0FBS1MsTUFBTCxFQUF4RjtFQUNILENBSEQ7O0VBSUFSLENBQUMsQ0FBQ08sU0FBRixDQUFZZ0MsUUFBWixHQUF1QixZQUFZO0lBQy9CLElBQUksS0FBS1YsVUFBVCxFQUFxQjtNQUNqQixLQUFLQSxVQUFMLEdBQWtCLENBQUMsQ0FBbkI7TUFDQSxLQUFLVCxpQkFBTCxDQUF1QixLQUFLRyxZQUE1QixFQUEwQyxLQUFLQyxhQUEvQyxFQUE4RCxLQUFLckIsZ0JBQW5FO0lBQ0g7RUFDSixDQUxEOztFQU1BSCxDQUFDLENBQUNPLFNBQUYsQ0FBWWlDLFFBQVosR0FBdUIsWUFBWTtJQUMvQjdCLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLEtBQUtILFFBQWpCLEVBQTJCLGlCQUEzQjtJQUNBLEtBQUtxQixTQUFMLEdBQWlCLENBQUMsQ0FBbEI7SUFDQSxLQUFLRSxRQUFMLEdBQWdCLENBQUMsQ0FBakI7SUFDQSxLQUFLTyxRQUFMO0VBQ0gsQ0FMRDs7RUFNQXZDLENBQUMsQ0FBQ08sU0FBRixDQUFZa0MsU0FBWixHQUF3QixVQUFVMUMsQ0FBVixFQUFhO0lBQ2pDWSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxlQUFaLEVBQTZCLEtBQUtILFFBQWxDLEVBQTRDVixDQUE1QztJQUNBLEtBQUtrQyxPQUFMLEdBQWUsQ0FBQyxDQUFoQjtJQUNBLEtBQUtJLE1BQUw7SUFDQSxLQUFLQyxTQUFMO0VBQ0gsQ0FMRDs7RUFNQXRDLENBQUMsQ0FBQ08sU0FBRixDQUFZbUMsU0FBWixHQUF3QixVQUFVM0MsQ0FBVixFQUFhO0lBQ2pDWSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxrQkFBWjtJQUNBLEtBQUtxQixPQUFMLEdBQWUsQ0FBQyxDQUFoQjtJQUNBbEMsQ0FBQyxJQUFJQSxDQUFDLENBQUM0QyxPQUFQLEdBQWlCLEtBQUt4QyxnQkFBTCxJQUF5QixLQUFLQSxnQkFBTCxFQUExQyxHQUFvRSxLQUFLcUIsYUFBTCxJQUFzQixLQUFLQSxhQUFMLEVBQTFGO0lBQ0EsS0FBS29CLGFBQUwsR0FBcUIsS0FBSy9CLEtBQUwsQ0FBV0ksSUFBWCxFQUFyQixHQUF5QyxLQUFLcUIsU0FBTCxFQUF6QztJQUNBLEtBQUtELE1BQUw7RUFDSCxDQU5EOztFQU9BckMsQ0FBQyxDQUFDTyxTQUFGLENBQVkrQixTQUFaLEdBQXdCLFlBQVk7SUFDaEMsS0FBS04sUUFBTCxHQUFnQixDQUFDLENBQWpCO0lBQ0EsS0FBS0gsVUFBTCxHQUFrQixDQUFDLENBQW5CO0lBQ0EsS0FBS0MsU0FBTCxHQUFpQixDQUFDLENBQWxCO0lBQ0EsS0FBS1AsWUFBTCxHQUFvQixJQUFwQjtJQUNBLEtBQUtDLGFBQUwsR0FBcUIsSUFBckI7SUFDQSxLQUFLckIsZ0JBQUwsR0FBd0IsSUFBeEI7SUFDQSxLQUFLOEIsT0FBTCxHQUFlLENBQUMsQ0FBaEI7O0lBQ0EsSUFBSSxLQUFLcEIsS0FBVCxFQUFnQjtNQUNaLElBQUksS0FBS0EsS0FBTCxDQUFXZ0MsT0FBZixFQUF3QjtRQUNwQixLQUFLaEMsS0FBTCxDQUFXZ0MsT0FBWCxDQUFtQixLQUFLL0IsTUFBeEI7TUFDSDs7TUFDRCxJQUFJLEtBQUtELEtBQUwsQ0FBV2lDLFFBQWYsRUFBeUI7UUFDckIsS0FBS2pDLEtBQUwsQ0FBV2lDLFFBQVgsQ0FBb0IsS0FBSy9CLE9BQXpCO01BQ0g7O01BQ0QsSUFBSSxLQUFLRixLQUFMLENBQVdrQyxRQUFmLEVBQXlCO1FBQ3JCLEtBQUtsQyxLQUFMLENBQVdrQyxRQUFYLENBQW9CLEtBQUsvQixPQUF6QjtNQUNIOztNQUNELElBQUksS0FBS0gsS0FBTCxDQUFXbUMsT0FBZixFQUF3QjtRQUNwQixLQUFLbkMsS0FBTCxDQUFXbUMsT0FBWDtNQUNIOztNQUNELEtBQUtuQyxLQUFMLEdBQWEsSUFBYjtJQUNIO0VBQ0osQ0F2QkQ7O0VBd0JBLE9BQU9iLENBQVA7QUFDSCxDQXRKTyxDQXNKTE4sT0FBTyxDQUFDdUQsTUF0SkgsQ0FBUjs7QUF1SkEzRCxPQUFPLENBQUNDLGVBQVIsR0FBMEJPLENBQTFCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbztcclxuZXhwb3J0cy5UVFJld2FyZGVkVmlkZW8gPSB2b2lkIDA7XHJcbnZhciAkYXVkaW9QbGF5ZXIgPSByZXF1aXJlKFwiLi9BdWRpb1BsYXllclwiKTtcclxudmFyICRiYXNlQWQgPSByZXF1aXJlKFwiLi9CYXNlQWRcIik7XHJcbnZhciBhID0gd2luZG93LnR0O1xyXG52YXIgbCA9IChmdW5jdGlvbiAodCkge1xyXG4gICAgZnVuY3Rpb24gZSgpIHtcclxuICAgICAgICB2YXIgZSA9IChudWxsICE9PSB0ICYmIHQuYXBwbHkodGhpcywgYXJndW1lbnRzKSkgfHwgdGhpcztcclxuICAgICAgICBlLnZpZGVvRW5kQ2FsbGJhY2sgPSBudWxsO1xyXG4gICAgICAgIGUubGFzdFRpbWUgPSAwO1xyXG4gICAgICAgIGUudHJ5Q291bnQgPSAwO1xyXG4gICAgICAgIHJldHVybiBlO1xyXG4gICAgfVxyXG4gICAgX19leHRlbmRzKGUsIHQpO1xyXG4gICAgZS5wcm90b3R5cGUubG9hZEFkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmFkVW5pdElkKSB7XHJcbiAgICAgICAgICAgIGlmIChhICYmIGEuY3JlYXRlUmV3YXJkZWRWaWRlb0FkKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICBhZFVuaXRJZDogdGhpcy5hZFVuaXRJZFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi5Yib5bu65r+A5Yqx6KeG6aKRXCIsIHQpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucyA9IGEuY3JlYXRlUmV3YXJkZWRWaWRlb0FkKHQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMub25Mb2FkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZElucy5vbkxvYWQodGhpcy5vbkxvYWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMub25DbG9zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMub25DbG9zZSh0aGlzLm9uQ2xvc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMub25FcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMub25FcnJvcih0aGlzLm9uRXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucy5sb2FkKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCLlvZPliY3lubPlj7DkuI3mlK/mjIHliJvlu7rmv4DlirHop4bpopFcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwi5aS05p2h5r+A5Yqx6KeG6aKRSUTkuLrnqbpcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnNob3dSZXdhcmRlZFZpZGVvID0gZnVuY3Rpb24gKHQsIGUsIGkpIHtcclxuICAgICAgICB0aGlzLnRyeUNvdW50ID0gMDtcclxuICAgICAgICB0aGlzLnNob3codCwgZSwgaSk7XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICh0LCBlLCBpKSB7XHJcbiAgICAgICAgdmFyIG8gPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuc2hvd0NhbGxiYWNrID0gdDtcclxuICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2sgPSBlO1xyXG4gICAgICAgIHRoaXMudmlkZW9FbmRDYWxsYmFjayA9IGk7XHJcbiAgICAgICAgdGhpcy5tdXNpY1ZvbHVtZSA9ICRhdWRpb1BsYXllci5kZWZhdWx0Lm11c2ljVm9sdW1lO1xyXG4gICAgICAgIHRoaXMuZWZmZWN0c1ZvbHVtZSA9ICRhdWRpb1BsYXllci5kZWZhdWx0LmVmZmVjdFZvbHVtZTtcclxuICAgICAgICBpZiAodGhpcy5pc0NhblNob3cpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmFkSW5zKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4odGhpcy5hZFVuaXRJZCwgXCI65pyq5Yib5bu677yM5omn6KGM5Yib5bu6XCIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc0F1dG9TaG93ID0gITA7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sb2FkQWQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5pc0NvbnN1bWUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVDcmVhdGVBZCghMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzTG9hZGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2Fybih0aGlzLmFkVW5pdElkLCBcIjrmnKrliqDovb3lrozmiJDvvIznqI3nrYlcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkICh0aGlzLmlzQXV0b1Nob3cgPSAhMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNob3dpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKHRoaXMuYWRVbml0SWQsIFwi5bm/5ZGK5q2j5Zyo5pi+56S65LitXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd2luZyA9ICExO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hZElucy5zaG93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IHRoaXMuYWRJbnMuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbiAmJiBuLnRoZW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8udHJ5Q291bnQgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLmlzQ29uc3VtZSA9ICEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLnNob3dpbmcgPSAhMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG8uc2hvd0NhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLnNob3dDYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uc2hvd0NhbGxiYWNrID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5wYXVzZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihvLmFkVW5pdElkLCBcIjpzaG936ZSZ6K+v77yM6YeN5paw5Yqg6L29XCIsIHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLnJlQ3JlYXRlQWQoITApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLnJlc3VtZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAoY29uc29sZS53YXJuKHRoaXMuYWRVbml0SWQsIFwiOnNob3fmmL7npLrlpLHotKXvvIzph43mlrDliqDovb1cIiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlQ3JlYXRlQWQoITApLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN1bWUoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3VtZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcih0aGlzLmFkVW5pdElkLCBcIjrmnKrnn6XplJnor69cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4odGhpcy5hZFVuaXRJZCwgXCI65b2T5YmN5bm/5ZGK56aB5q2i5pi+56S6XCIpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5yZUNyZWF0ZUFkID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICB0aGlzLnRyeUNvdW50Kys7XHJcbiAgICAgICAgdGhpcy50cnlDb3VudCA+PSA0ID8gKHRoaXMuaXNBdXRvU2hvdyA9ICExKSA6ICh0aGlzLmRlc3Ryb3lBZCgpLCAodGhpcy5pc0F1dG9TaG93ID0gdCksIHRoaXMubG9hZEFkKCkpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLmF1dG9TaG93ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQXV0b1Nob3cpIHtcclxuICAgICAgICAgICAgdGhpcy5pc0F1dG9TaG93ID0gITE7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1Jld2FyZGVkVmlkZW8odGhpcy5zaG93Q2FsbGJhY2ssIHRoaXMuY2xvc2VDYWxsYmFjaywgdGhpcy52aWRlb0VuZENhbGxiYWNrKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUub25BZExvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5hZFVuaXRJZCwgXCI6PT09b25BZGxvYWQ9PT1cIik7XHJcbiAgICAgICAgdGhpcy5pc0NvbnN1bWUgPSAhMTtcclxuICAgICAgICB0aGlzLmlzTG9hZGVkID0gITA7XHJcbiAgICAgICAgdGhpcy5hdXRvU2hvdygpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLm9uQWRFcnJvciA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCLmv4DlirHop4bpopFvbkFkRXJyb3JcIiwgdGhpcy5hZFVuaXRJZCwgdCk7XHJcbiAgICAgICAgdGhpcy5zaG93aW5nID0gITE7XHJcbiAgICAgICAgdGhpcy5yZXN1bWUoKTtcclxuICAgICAgICB0aGlzLmRlc3Ryb3lBZCgpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLm9uQWRDbG9zZSA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCI6PT09b25BZENsb3NlPT09XCIpO1xyXG4gICAgICAgIHRoaXMuc2hvd2luZyA9ICExO1xyXG4gICAgICAgIHQgJiYgdC5pc0VuZGVkID8gdGhpcy52aWRlb0VuZENhbGxiYWNrICYmIHRoaXMudmlkZW9FbmRDYWxsYmFjaygpIDogdGhpcy5jbG9zZUNhbGxiYWNrICYmIHRoaXMuY2xvc2VDYWxsYmFjaygpO1xyXG4gICAgICAgIHRoaXMuaXNPcGVuUHJlTG9hZCA/IHRoaXMuYWRJbnMubG9hZCgpIDogdGhpcy5kZXN0cm95QWQoKTtcclxuICAgICAgICB0aGlzLnJlc3VtZSgpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLmRlc3Ryb3lBZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmlzTG9hZGVkID0gITE7XHJcbiAgICAgICAgdGhpcy5pc0F1dG9TaG93ID0gITE7XHJcbiAgICAgICAgdGhpcy5pc0NvbnN1bWUgPSAhMTtcclxuICAgICAgICB0aGlzLnNob3dDYWxsYmFjayA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gbnVsbDtcclxuICAgICAgICB0aGlzLnZpZGVvRW5kQ2FsbGJhY2sgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuc2hvd2luZyA9ICExO1xyXG4gICAgICAgIGlmICh0aGlzLmFkSW5zKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFkSW5zLm9mZkxvYWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMub2ZmTG9hZCh0aGlzLm9uTG9hZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMub2ZmQ2xvc2UpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMub2ZmQ2xvc2UodGhpcy5vbkNsb3NlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5hZElucy5vZmZFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucy5vZmZFcnJvcih0aGlzLm9uRXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFkSW5zLmRlc3Ryb3kpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuYWRJbnMgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gZTtcclxufSkoJGJhc2VBZC5CYXNlQWQpO1xyXG5leHBvcnRzLlRUUmV3YXJkZWRWaWRlbyA9IGw7XHJcbiJdfQ==