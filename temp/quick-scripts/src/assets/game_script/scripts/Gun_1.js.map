{"version":3,"sources":["assets\\game_script\\scripts\\Gun_1.js"],"names":["o","$assetsLoader","require","$assetsMap","$resUtil","$eventManager","$seedUtil","$util","$configContext","$localEventName","$baseBullet","$gameContext","$gameGemInfo","$gameSkillInfo","_","cc","_decorator","k","ccclass","v","property","b","t","e","apply","arguments","point","residueChangeTime","residueButtleCount","isShoot","isAttacking","schedules","count","skillId","__extends","prototype","start","skillParam","ins","skillInfo","getSkillById","bulletCount","skillCD","Skill4Param","FINAL","send","RENDER_SKILL_CD_INFO","notifyChangeReloadAnimStart","CHANGE_RELOAD_ANIM","notifyChangeReloadAnimEnd","sendButtle","i","bulletSpeed","n","bulletComboCount","GameGemInfo","hasGem","GemType","AddSkill","probability","get1","s","schedulesOnce2","createButtle","dirConverAngle","bulletParallelCount","angleConverDir","push","cb","sec","getButtlePool","BulletType","normal_bullet","instance","getRes","BundleNames","Game","AssetsMap","GameBundles","prefabs","assetsList","Bullet_1","ResUtil","instantiate","buttleLayer","parent","getComponent","skillSpecialitys","basicSkillConfigMap","get","skill_tpye","convertToNodeSpaceAR","convertToWorldSpaceAR","Vec3","ZERO","setPosition","initButtle","insert","updateF","length","shift","__decorate","Node","Component","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var o;\r\nvar $assetsLoader = require(\"./AssetsLoader\");\r\nvar $assetsMap = require(\"./AssetsMap\");\r\nvar $resUtil = require(\"./ResUtil\");\r\nvar $eventManager = require(\"./EventManager\");\r\nvar $seedUtil = require(\"./SeedUtil\");\r\nvar $util = require(\"./Util\");\r\nvar $configContext = require(\"./ConfigContext\");\r\nvar $localEventName = require(\"./LocalEventName\");\r\nvar $baseBullet = require(\"./BaseBullet\");\r\nvar $gameContext = require(\"./GameContext\");\r\nvar $gameGemInfo = require(\"./GameGemInfo\");\r\nvar $gameSkillInfo = require(\"./GameSkillInfo\");\r\nvar _ = cc._decorator;\r\nvar k = _.ccclass;\r\nvar v = _.property;\r\nvar b = (function (t) {\r\n    function e() {\r\n        var e = (null !== t && t.apply(this, arguments)) || this;\r\n        e.point = null;\r\n        e.residueChangeTime = 0;\r\n        e.residueButtleCount = 0;\r\n        e.isShoot = !1;\r\n        e.isAttacking = !1;\r\n        e.schedules = [];\r\n        e.count = 0;\r\n        e.skillId = 1;\r\n        return e;\r\n    }\r\n    __extends(e, t);\r\n    e.prototype.start = function () {\r\n        this.skillParam = $gameContext.default.ins.skillInfo.getSkillById(this.skillId);\r\n        this.residueButtleCount = this.skillParam.bulletCount;\r\n        this.residueChangeTime = this.skillParam.skillCD[$gameSkillInfo.Skill4Param.FINAL];\r\n        $eventManager.default.send(\r\n            $localEventName.default.RENDER_SKILL_CD_INFO,\r\n            this.skillId,\r\n            -1,\r\n            this.residueButtleCount\r\n        );\r\n    };\r\n    e.prototype.notifyChangeReloadAnimStart = function () {\r\n        this.isShoot = !0;\r\n        $eventManager.default.send($localEventName.default.CHANGE_RELOAD_ANIM, !0);\r\n    };\r\n    e.prototype.notifyChangeReloadAnimEnd = function () {\r\n        this.isShoot = !1;\r\n        $eventManager.default.send($localEventName.default.CHANGE_RELOAD_ANIM, !1);\r\n    };\r\n    e.prototype.sendButtle = function (t) {\r\n        var e = this;\r\n        this.isAttacking = !0;\r\n        --this.residueButtleCount;\r\n        $eventManager.default.send(\r\n            $localEventName.default.RENDER_SKILL_CD_INFO,\r\n            this.skillId,\r\n            -1,\r\n            this.residueButtleCount\r\n        );\r\n        if (this.residueButtleCount <= 0) {\r\n            this.notifyChangeReloadAnimStart();\r\n        }\r\n        var i = 150 / this.skillParam.bulletSpeed;\r\n        var o = 0;\r\n        var n = this.skillParam.bulletComboCount + 1;\r\n        if (\r\n            $gameGemInfo.GameGemInfo.ins.hasGem($gameGemInfo.GemType.AddSkill) &&\r\n            $seedUtil.default.probability(100 * $gameGemInfo.GameGemInfo.ins.get1($gameGemInfo.GemType.AddSkill))\r\n        ) {\r\n            n *= 2;\r\n        }\r\n        for (var s = 0; s < n; s++) {\r\n            this.schedulesOnce2(function () {\r\n                e.createButtle(t);\r\n                var i = $util.default.dirConverAngle(t);\r\n                if (e.skillParam.bulletParallelCount >= 1) {\r\n                    e.createButtle($util.default.angleConverDir(i + 5));\r\n                }\r\n                if (e.skillParam.bulletParallelCount >= 2) {\r\n                    e.createButtle($util.default.angleConverDir(i - 5));\r\n                }\r\n                if (++o === n) {\r\n                    e.isAttacking = !1;\r\n                }\r\n            }, i * s);\r\n        }\r\n    };\r\n    e.prototype.schedulesOnce2 = function (t, e) {\r\n        this.schedules.push({\r\n            cb: t,\r\n            sec: e\r\n        });\r\n    };\r\n    e.prototype.createButtle = function (t) {\r\n        var e = $gameContext.default.ins.getButtlePool($baseBullet.BulletType.normal_bullet);\r\n        if (!e) {\r\n            var i = $assetsLoader.default.instance.getRes(\r\n                $assetsMap.BundleNames.Game,\r\n                $assetsMap.AssetsMap.GameBundles.prefabs.assetsList.Bullet_1\r\n            );\r\n            (e = $resUtil.ResUtil.instantiate(i, $gameContext.default.ins.buttleLayer.parent).getComponent(\r\n                $baseBullet.default\r\n            )).skillSpecialitys = $configContext.default.instance.basicSkillConfigMap.get(this.skillId).skill_tpye;\r\n        }\r\n        var o = $gameContext.default.ins.buttleLayer.convertToNodeSpaceAR(\r\n            this.point.convertToWorldSpaceAR(cc.Vec3.ZERO)\r\n        );\r\n        e.setPosition(o);\r\n        e.initButtle(t, this.skillId);\r\n        e.insert($gameContext.default.ins.buttleLayer);\r\n    };\r\n    e.prototype.updateF = function (t) {\r\n        this.count = this.schedules.length;\r\n        for (var e = 0; e < this.count; e++) {\r\n            var i = this.schedules.shift();\r\n            i.sec = i.sec - t;\r\n            i.sec <= 0 ? i.cb() : this.schedules.push(i);\r\n        }\r\n        if (!this.isAttacking) {\r\n            this.isShoot\r\n                ? ((this.residueChangeTime -= t),\r\n                  $eventManager.default.send(\r\n                      $localEventName.default.RENDER_SKILL_CD_INFO,\r\n                      this.skillId,\r\n                      this.residueChangeTime / this.skillParam.skillCD[$gameSkillInfo.Skill4Param.FINAL],\r\n                      -1\r\n                  ),\r\n                  this.residueChangeTime <= 0 &&\r\n                      ((this.isShoot = !1),\r\n                      (this.residueChangeTime = this.skillParam.skillCD[$gameSkillInfo.Skill4Param.FINAL]),\r\n                      (this.residueButtleCount = this.skillParam.bulletCount),\r\n                      $eventManager.default.send($localEventName.default.RENDER_SKILL_CD_INFO, this.skillId, 0, -1),\r\n                      this.notifyChangeReloadAnimEnd()))\r\n                : this.residueButtleCount <= 0 && ((this.isShoot = !0), this.notifyChangeReloadAnimStart());\r\n        }\r\n    };\r\n    __decorate([v(cc.Node)], e.prototype, \"point\", void 0);\r\n    return __decorate([k], e);\r\n})(cc.Component);\r\nexports.default = b;\r\n"]}