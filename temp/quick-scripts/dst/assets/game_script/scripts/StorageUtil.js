
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/StorageUtil.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '05d96fkdotOTZ1aIZnJjeC9', 'StorageUtil');
// game_script/scripts/StorageUtil.js

"use strict";

exports.StorageUtil = void 0;

var $globalParam = require("./GlobalParam");

var $localName = require("./LocalName");

var $crypto_ts = require("./crypto-ts");

var l = function () {
  function t() {}

  t.init = function () {
    var e;
    var i;

    if (!t.getItem("isEnc", !1, !1)) {
      t.setItem("isEnc", !0, !1);

      try {
        var l = __values(Object.entries($localName["default"]));

        for (var c = l.next(); !c.done; c = l.next()) {
          var u = __read(c.value, 2);

          var d = (u[0], u[1]);
          var p = cc.sys.localStorage.getItem(d);

          if (p) {
            if (!t.Filters.includes(d)) {
              p = $crypto_ts.AES.encrypt(p, $globalParam["default"].keyWord).toString();
            }

            cc.sys.localStorage.setItem(d, p);
          }
        }
      } catch (t) {
        e = {
          error: t
        };
      } finally {
        try {
          if (c && !c.done && (i = l["return"])) {
            i.call(l);
          }
        } finally {
          if (e) {
            throw e.error;
          }
        }
      }
    }
  };

  t.getItem = function (e, i, o) {
    if (void 0 === o) {
      o = !0;
    }

    var n = cc.sys.localStorage.getItem(e);

    if (!(n = n || "")) {
      return i;
    }

    if (o && !t.Filters.includes(e)) {
      n = $crypto_ts.AES.decrypt(n, $globalParam["default"].keyWord).toString($crypto_ts.enc.Utf8);
    }

    if (i instanceof String) {
      return n;
    }

    if (i instanceof Number) {
      return parseInt(n);
    }

    if (i instanceof Boolean) {
      return "true" === n;
    }

    if (i instanceof Map) {
      return t.jsonToMap(n);
    }

    try {
      return JSON.parse(n);
    } catch (t) {
      console.error(e, t);
      return i;
    }
  };

  t.setItem = function (e, i, o) {
    if (void 0 === o) {
      o = !0;
    }

    var n = "";
    n = i instanceof Map ? t.mapToJson(i) : JSON.stringify(i);

    if (o && !t.Filters.includes(e)) {
      n = $crypto_ts.AES.encrypt(n, $globalParam["default"].keyWord).toString();
    }

    cc.sys.localStorage.setItem(e, n);
  };

  t.removeItem = function (t) {
    cc.sys.localStorage.removeItem(t);
  };

  t.mapToJson = function (t) {
    var e = [];
    t.forEach(function (t, i) {
      e.push([i, t]);
    });
    return JSON.stringify(e);
  };

  t.jsonToMap = function (t) {
    var e = JSON.parse(t);
    var i = new Map();

    for (var o = 0; o < e.length; o++) {
      i.set(e[o][0], e[o][1]);
    }

    return i;
  };

  t.Filters = [$localName["default"].ONLINE_RECORD, $localName["default"].MEDIAS, $localName["default"].MEDIAS_VOL, $localName["default"].PACK_INFO];
  return t;
}();

exports.StorageUtil = l;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXFN0b3JhZ2VVdGlsLmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJTdG9yYWdlVXRpbCIsIiRnbG9iYWxQYXJhbSIsInJlcXVpcmUiLCIkbG9jYWxOYW1lIiwiJGNyeXB0b190cyIsImwiLCJ0IiwiaW5pdCIsImUiLCJpIiwiZ2V0SXRlbSIsInNldEl0ZW0iLCJfX3ZhbHVlcyIsIk9iamVjdCIsImVudHJpZXMiLCJjIiwibmV4dCIsImRvbmUiLCJ1IiwiX19yZWFkIiwidmFsdWUiLCJkIiwicCIsImNjIiwic3lzIiwibG9jYWxTdG9yYWdlIiwiRmlsdGVycyIsImluY2x1ZGVzIiwiQUVTIiwiZW5jcnlwdCIsImtleVdvcmQiLCJ0b1N0cmluZyIsImVycm9yIiwiY2FsbCIsIm8iLCJuIiwiZGVjcnlwdCIsImVuYyIsIlV0ZjgiLCJTdHJpbmciLCJOdW1iZXIiLCJwYXJzZUludCIsIkJvb2xlYW4iLCJNYXAiLCJqc29uVG9NYXAiLCJKU09OIiwicGFyc2UiLCJjb25zb2xlIiwibWFwVG9Kc29uIiwic3RyaW5naWZ5IiwicmVtb3ZlSXRlbSIsImZvckVhY2giLCJwdXNoIiwibGVuZ3RoIiwic2V0IiwiT05MSU5FX1JFQ09SRCIsIk1FRElBUyIsIk1FRElBU19WT0wiLCJQQUNLX0lORk8iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLE9BQU8sQ0FBQ0MsV0FBUixHQUFzQixLQUFLLENBQTNCOztBQUNBLElBQUlDLFlBQVksR0FBR0MsT0FBTyxDQUFDLGVBQUQsQ0FBMUI7O0FBQ0EsSUFBSUMsVUFBVSxHQUFHRCxPQUFPLENBQUMsYUFBRCxDQUF4Qjs7QUFDQSxJQUFJRSxVQUFVLEdBQUdGLE9BQU8sQ0FBQyxhQUFELENBQXhCOztBQUNBLElBQUlHLENBQUMsR0FBSSxZQUFZO0VBQ2pCLFNBQVNDLENBQVQsR0FBYSxDQUFFOztFQUNmQSxDQUFDLENBQUNDLElBQUYsR0FBUyxZQUFZO0lBQ2pC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UnBELFVBQVUsV0FBVixDQUFtQnFELE1BRlgsRUFHUnJELFVBQVUsV0FBVixDQUFtQnNELFVBSFgsRUFJUnRELFVBQVUsV0FBVixDQUFtQnVELFNBSlgsQ0FBWjtFQU1BLE9BQU9wRCxDQUFQO0FBQ0gsQ0F2R08sRUFBUjs7QUF3R0FQLE9BQU8sQ0FBQ0MsV0FBUixHQUFzQkssQ0FBdEIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydHMuU3RvcmFnZVV0aWwgPSB2b2lkIDA7XHJcbnZhciAkZ2xvYmFsUGFyYW0gPSByZXF1aXJlKFwiLi9HbG9iYWxQYXJhbVwiKTtcclxudmFyICRsb2NhbE5hbWUgPSByZXF1aXJlKFwiLi9Mb2NhbE5hbWVcIik7XHJcbnZhciAkY3J5cHRvX3RzID0gcmVxdWlyZShcIi4vY3J5cHRvLXRzXCIpO1xyXG52YXIgbCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiB0KCkge31cclxuICAgIHQuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZTtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICBpZiAoIXQuZ2V0SXRlbShcImlzRW5jXCIsICExLCAhMSkpIHtcclxuICAgICAgICAgICAgdC5zZXRJdGVtKFwiaXNFbmNcIiwgITAsICExKTtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHZhciBsID0gX192YWx1ZXMoT2JqZWN0LmVudHJpZXMoJGxvY2FsTmFtZS5kZWZhdWx0KSk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBjID0gbC5uZXh0KCk7ICFjLmRvbmU7IGMgPSBsLm5leHQoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB1ID0gX19yZWFkKGMudmFsdWUsIDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gKHVbMF0sIHVbMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwID0gY2Muc3lzLmxvY2FsU3RvcmFnZS5nZXRJdGVtKGQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdC5GaWx0ZXJzLmluY2x1ZGVzKGQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwID0gJGNyeXB0b190cy5BRVMuZW5jcnlwdChwLCAkZ2xvYmFsUGFyYW0uZGVmYXVsdC5rZXlXb3JkKS50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLnN5cy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShkLCBwKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHtcclxuICAgICAgICAgICAgICAgIGUgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHRcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZmluYWxseSB7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjICYmICFjLmRvbmUgJiYgKGkgPSBsLnJldHVybikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaS5jYWxsKGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZmluYWxseSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZS5lcnJvcjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgdC5nZXRJdGVtID0gZnVuY3Rpb24gKGUsIGksIG8pIHtcclxuICAgICAgICBpZiAodm9pZCAwID09PSBvKSB7XHJcbiAgICAgICAgICAgIG8gPSAhMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG4gPSBjYy5zeXMubG9jYWxTdG9yYWdlLmdldEl0ZW0oZSk7XHJcbiAgICAgICAgaWYgKCEobiA9IG4gfHwgXCJcIikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvICYmICF0LkZpbHRlcnMuaW5jbHVkZXMoZSkpIHtcclxuICAgICAgICAgICAgbiA9ICRjcnlwdG9fdHMuQUVTLmRlY3J5cHQobiwgJGdsb2JhbFBhcmFtLmRlZmF1bHQua2V5V29yZCkudG9TdHJpbmcoJGNyeXB0b190cy5lbmMuVXRmOCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpIGluc3RhbmNlb2YgU3RyaW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaSBpbnN0YW5jZW9mIE51bWJlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQobik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpIGluc3RhbmNlb2YgQm9vbGVhbikge1xyXG4gICAgICAgICAgICByZXR1cm4gXCJ0cnVlXCIgPT09IG47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpIGluc3RhbmNlb2YgTWFwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0Lmpzb25Ub01hcChuKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2Uobik7XHJcbiAgICAgICAgfSBjYXRjaCAodCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUsIHQpO1xyXG4gICAgICAgICAgICByZXR1cm4gaTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgdC5zZXRJdGVtID0gZnVuY3Rpb24gKGUsIGksIG8pIHtcclxuICAgICAgICBpZiAodm9pZCAwID09PSBvKSB7XHJcbiAgICAgICAgICAgIG8gPSAhMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG4gPSBcIlwiO1xyXG4gICAgICAgIG4gPSBpIGluc3RhbmNlb2YgTWFwID8gdC5tYXBUb0pzb24oaSkgOiBKU09OLnN0cmluZ2lmeShpKTtcclxuICAgICAgICBpZiAobyAmJiAhdC5GaWx0ZXJzLmluY2x1ZGVzKGUpKSB7XHJcbiAgICAgICAgICAgIG4gPSAkY3J5cHRvX3RzLkFFUy5lbmNyeXB0KG4sICRnbG9iYWxQYXJhbS5kZWZhdWx0LmtleVdvcmQpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNjLnN5cy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShlLCBuKTtcclxuICAgIH07XHJcbiAgICB0LnJlbW92ZUl0ZW0gPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIGNjLnN5cy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0KTtcclxuICAgIH07XHJcbiAgICB0Lm1hcFRvSnNvbiA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgdmFyIGUgPSBbXTtcclxuICAgICAgICB0LmZvckVhY2goZnVuY3Rpb24gKHQsIGkpIHtcclxuICAgICAgICAgICAgZS5wdXNoKFtpLCB0XSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGUpO1xyXG4gICAgfTtcclxuICAgIHQuanNvblRvTWFwID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICB2YXIgZSA9IEpTT04ucGFyc2UodCk7XHJcbiAgICAgICAgdmFyIGkgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgZm9yICh2YXIgbyA9IDA7IG8gPCBlLmxlbmd0aDsgbysrKSB7XHJcbiAgICAgICAgICAgIGkuc2V0KGVbb11bMF0sIGVbb11bMV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaTtcclxuICAgIH07XHJcbiAgICB0LkZpbHRlcnMgPSBbXHJcbiAgICAgICAgJGxvY2FsTmFtZS5kZWZhdWx0Lk9OTElORV9SRUNPUkQsXHJcbiAgICAgICAgJGxvY2FsTmFtZS5kZWZhdWx0Lk1FRElBUyxcclxuICAgICAgICAkbG9jYWxOYW1lLmRlZmF1bHQuTUVESUFTX1ZPTCxcclxuICAgICAgICAkbG9jYWxOYW1lLmRlZmF1bHQuUEFDS19JTkZPXHJcbiAgICBdO1xyXG4gICAgcmV0dXJuIHQ7XHJcbn0pKCk7XHJcbmV4cG9ydHMuU3RvcmFnZVV0aWwgPSBsO1xyXG4iXX0=