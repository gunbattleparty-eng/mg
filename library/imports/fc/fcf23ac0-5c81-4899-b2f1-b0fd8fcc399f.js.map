{"version":3,"sources":["assets\\scripts\\auth\\LoginView.js"],"names":["Auth","require","cc","Class","Component","properties","edtEmail","EditBox","edtPass","btnLogin","Node","btnRegister","lblTips","Label","onLoad","_busy","string","on","onLogin","onRegister","_setBusy","b","email","trim","pass","_toast","login","password","me","director","loadScene","message","register","msg","log"],"mappings":"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","sourceRoot":"/","sourcesContent":["// assets/scripts/auth/LoginView.js\nconst Auth = require('./AuthService');\ncc.Class({\n  extends: cc.Component,\n  properties:{\n    edtEmail:   cc.EditBox,\n    edtPass:    cc.EditBox,\n    btnLogin:   cc.Node,\n    btnRegister:cc.Node,\n    lblTips:    cc.Label,\n  },\n  onLoad(){\n    this._busy = false;\n    this.lblTips && (this.lblTips.string = '');\n    this.btnLogin && this.btnLogin.on('click', ()=>this.onLogin(), this);\n    this.btnRegister && this.btnRegister.on('click', ()=>this.onRegister(), this);\n  },\n  _setBusy(b){ this._busy = !!b; if(this.lblTips) this.lblTips.string = b ? '处理中...' : ''; },\n  async onLogin(){\n    if(this._busy) return;\n    const email = (this.edtEmail && this.edtEmail.string || '').trim();\n    const pass  = (this.edtPass  && this.edtPass.string  || '').trim();\n    if(!email || !pass){ this._toast('请输入邮箱与密码'); return; }\n    try{\n      this._setBusy(true);\n      await Auth.login({email, password: pass});\n      await Auth.me();\n      this._toast('登录成功，正在进入游戏...');\n      cc.director.loadScene('Main'); // 你的主场景名\n    }catch(e){\n      this._toast('登录失败：'+ (e && e.message || ''));\n    }finally{ this._setBusy(false); }\n  },\n  async onRegister(){\n    if(this._busy) return;\n    const email = (this.edtEmail && this.edtEmail.string || '').trim();\n    const pass  = (this.edtPass  && this.edtPass.string  || '').trim();\n    if(!email || !pass){ this._toast('请输入邮箱与密码'); return; }\n    try{\n      this._setBusy(true);\n      await Auth.register({email, password: pass});\n      this._toast('注册成功，请登录');\n    }catch(e){\n      this._toast('注册失败：'+ (e && e.message || ''));\n    }finally{ this._setBusy(false); }\n  },\n  _toast(msg){ if(this.lblTips) this.lblTips.string = msg; cc.log('[Login]', msg); }\n});\n"]}