
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/ResManager.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'e6a4fEPpEhER6LoGgHDNZXq', 'ResManager');
// game_script/scripts/ResManager.js

"use strict";

exports.ResManager = void 0;

var $assetsLoader = require("./AssetsLoader");

var l = function () {
  function t() {
    this.assetsMap = new Map();
    this.bundleCacheRecord = new Map();
  }

  t.prototype.getAssets = function (t) {
    return this.hasAssest(t) ? this.assetsMap.get(t) : (console.log("资源不存在", t), null);
  };

  t.prototype.hasAssest = function (t) {
    return this.assetsMap.has(t);
  };

  t.prototype.hasBundleLoadedAssets = function (t) {
    var e = !0;

    if (!this.bundleCacheRecord.has(t)) {
      console.warn("Bundle 不存在", t);
      return !0;
    }

    var i = this.bundleCacheRecord.get(t);

    for (var o = 0; o < i.length; o++) {
      if (!i[o].isLoaded) {
        e = !1;
        break;
      }
    }

    return e;
  };

  t.prototype.putAssets = function (t, e, i) {
    if (this.hasAssest(i)) {
      return console.error("资源名称重复，请勿重复使用名称,", i);
    }

    var o = {
      bundle: t,
      assetsType: e,
      path: i,
      isLoaded: !1
    };
    this.assetsMap.set(i, o);

    if (!this.bundleCacheRecord.has(t)) {
      this.bundleCacheRecord.set(t, []);
    }

    this.bundleCacheRecord.get(t).push(o);
  };

  t.prototype.get = function (t) {
    var e = this.getAssets(t);
    return e ? $assetsLoader["default"].instance.getRes(e.bundle, t, e.assetsType) : null;
  };

  t.prototype.isBundleLoaded = function (t) {
    return !!cc.assetManager.getBundle(t);
  };

  t.prototype.isResLoaded = function (t) {
    return !!this.assetsMap.has(t) && this.assetsMap.get(t).isLoaded;
  };

  t.prototype.releaseBundle = function (t) {
    if (this.isBundleLoaded(t)) {
      cc.assetManager.getBundle(t).releaseAll();
      this.assetsMap.forEach(function (e) {
        if (e.bundle === t) {
          e.isLoaded = !1;
        }
      });
    }
  };

  t.prototype.loadBundles = function (t, e, i) {
    return __awaiter(this, void 0, void 0, function () {
      var o;
      var s;
      var r;
      var l;
      var c;
      return __generator(this, function (u) {
        switch (u.label) {
          case 0:
            for (o = [], c = 0; c < t.length; c++) {
              if (!cc.assetManager.getBundle(t[c])) {
                o.push(t[c]);
              }
            }

            if (0 === o.length) {
              if (i) {
                i();
              }

              return [2];
            }

            s = o.length;
            r = 0;

            l = function l(t) {
              return __generator(this, function (n) {
                switch (n.label) {
                  case 0:
                    return [4, $assetsLoader["default"].instance.loadBundleSync(o[t], function (i) {
                      e((t + i) / s);
                    }, function () {
                      if (++r >= s) {
                        console.log(o, "bundle加载完成");

                        if (i) {
                          i();
                        }
                      }
                    })];

                  case 1:
                    n.sent();
                    return [2];
                }
              });
            };

            c = 0;
            u.label = 1;

          case 1:
            return c < o.length ? [5, l(c)] : [3, 4];

          case 2:
            u.sent();
            u.label = 3;

          case 3:
            c++;
            return [3, 1];

          case 4:
            return [2];
        }
      });
    });
  };

  t.prototype.loadArray = function (t, e, i, l, c) {
    if (void 0 === l) {
      l = !1;
    }

    if (void 0 === c) {
      c = this.assetsMap;
    }

    return __awaiter(this, void 0, void 0, function () {
      var o;
      var u;
      var d;
      var p;
      var f;
      return __generator(this, function () {
        o = new Map();
        u = new Map();
        d = 0;
        c.forEach(function (e) {
          if (t.includes(e.bundle)) {
            if (!o.has(e.bundle)) {
              o.set(e.bundle, new Map());
            }

            var i = o.get(e.bundle);

            if (!i.has(e.assetsType)) {
              i.set(e.assetsType, []);
              var n = e.bundle + e.assetsType.toString();
              u.set(n, 0);
              d++;
            }

            i.get(e.assetsType).push(e.path);
          }
        });
        p = u.size;
        f = 0;
        o.forEach(function (o, n) {
          o.forEach(function (o, h) {
            l ? $assetsLoader["default"].instance.preLoadRes(n, o, h, function (t, i) {
              var o;
              var a;
              var l = n + h.toString();
              u.set(l, t / i);
              var c = 0;

              try {
                var d = __values(u);

                for (var f = d.next(); !f.done; f = d.next()) {
                  var m = __read(f.value, 2);

                  m[0];
                  c += m[1];
                }
              } catch (t) {
                o = {
                  error: t
                };
              } finally {
                try {
                  if (f && !f.done && (a = d["return"])) {
                    a.call(d);
                  }
                } finally {
                  if (o) {
                    throw o.error;
                  }
                }
              }

              if (e) {
                e(c / p);
              }
            }, function () {
              if (++f >= d) {
                console.log(t, "bundle资源预加载完成");

                if (i) {
                  i();
                }
              }
            }) : $assetsLoader["default"].instance.loadResSync(n, o, h, function (t, i) {
              var o;
              var a;
              var l = n + h.toString();
              u.set(l, t / i);
              var c = 0;

              try {
                var d = __values(u);

                for (var f = d.next(); !f.done; f = d.next()) {
                  var m = __read(f.value, 2);

                  m[0];
                  c += m[1];
                }
              } catch (t) {
                o = {
                  error: t
                };
              } finally {
                try {
                  if (f && !f.done && (a = d["return"])) {
                    a.call(d);
                  }
                } finally {
                  if (o) {
                    throw o.error;
                  }
                }
              }

              if (e) {
                e(c / p);
              }
            }, function () {
              if (++f >= d) {
                o.forEach(function (t) {
                  if (c.has(t)) {
                    c.get(t).isLoaded = !0;
                  }
                });
                console.log(t, "bundle资源加载完成");

                if (i) {
                  i();
                }
              }
            });
          });
        });
        return [2];
      });
    });
  };

  t.instance = new t();
  return t;
}();

exports.ResManager = l;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXFJlc01hbmFnZXIuanMiXSwibmFtZXMiOlsiZXhwb3J0cyIsIlJlc01hbmFnZXIiLCIkYXNzZXRzTG9hZGVyIiwicmVxdWlyZSIsImwiLCJ0IiwiYXNzZXRzTWFwIiwiTWFwIiwiYnVuZGxlQ2FjaGVSZWNvcmQiLCJwcm90b3R5cGUiLCJnZXRBc3NldHMiLCJoYXNBc3Nlc3QiLCJnZXQiLCJjb25zb2xlIiwibG9nIiwiaGFzIiwiaGFzQnVuZGxlTG9hZGVkQXNzZXRzIiwiZSIsIndhcm4iLCJpIiwibyIsImxlbmd0aCIsImlzTG9hZGVkIiwicHV0QXNzZXRzIiwiZXJyb3IiLCJidW5kbGUiLCJhc3NldHNUeXBlIiwicGF0aCIsInNldCIsInB1c2giLCJpbnN0YW5jZSIsImdldFJlcyIsImlzQnVuZGxlTG9hZGVkIiwiY2MiLCJhc3NldE1hbmFnZXIiLCJnZXRCdW5kbGUiLCJpc1Jlc0xvYWRlZCIsInJlbGVhc2VCdW5kbGUiLCJyZWxlYXNlQWxsIiwiZm9yRWFjaCIsImxvYWRCdW5kbGVzIiwiX19hd2FpdGVyIiwicyIsInIiLCJjIiwiX19nZW5lcmF0b3IiLCJ1IiwibGFiZWwiLCJuIiwibG9hZEJ1bmRsZVN5bmMiLCJzZW50IiwibG9hZEFycmF5IiwiZCIsInAiLCJmIiwiaW5jbHVkZXMiLCJ0b1N0cmluZyIsInNpemUiLCJoIiwicHJlTG9hZFJlcyIsImEiLCJfX3ZhbHVlcyIsIm5leHQiLCJkb25lIiwibSIsIl9fcmVhZCIsInZhbHVlIiwiY2FsbCIsImxvYWRSZXNTeW5jIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBQSxPQUFPLENBQUNDLFVBQVIsR0FBcUIsS0FBSyxDQUExQjs7QUFDQSxJQUFJQyxhQUFhLEdBQUdDLE9BQU8sQ0FBQyxnQkFBRCxDQUEzQjs7QUFDQSxJQUFJQyxDQUFDLEdBQUksWUFBWTtFQUNqQixTQUFTQyxDQUFULEdBQWE7SUFDVCxLQUFLQyxTQUFMLEdB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SUEySEgsQ0FqSWUsQ0FBaEI7RUFrSUgsQ0F6SUQ7O0VBMElBZCxDQUFDLENBQUN5QixRQUFGLEdBQWEsSUFBSXpCLENBQUosRUFBYjtFQUNBLE9BQU9BLENBQVA7QUFDSCxDQTVRTyxFQUFSOztBQTZRQUwsT0FBTyxDQUFDQyxVQUFSLEdBQXFCRyxDQUFyQiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0cy5SZXNNYW5hZ2VyID0gdm9pZCAwO1xyXG52YXIgJGFzc2V0c0xvYWRlciA9IHJlcXVpcmUoXCIuL0Fzc2V0c0xvYWRlclwiKTtcclxudmFyIGwgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gdCgpIHtcclxuICAgICAgICB0aGlzLmFzc2V0c01hcCA9IG5ldyBNYXAoKTtcclxuICAgICAgICB0aGlzLmJ1bmRsZUNhY2hlUmVjb3JkID0gbmV3IE1hcCgpO1xyXG4gICAgfVxyXG4gICAgdC5wcm90b3R5cGUuZ2V0QXNzZXRzID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5oYXNBc3Nlc3QodCkgPyB0aGlzLmFzc2V0c01hcC5nZXQodCkgOiAoY29uc29sZS5sb2coXCLotYTmupDkuI3lrZjlnKhcIiwgdCksIG51bGwpO1xyXG4gICAgfTtcclxuICAgIHQucHJvdG90eXBlLmhhc0Fzc2VzdCA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYXNzZXRzTWFwLmhhcyh0KTtcclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5oYXNCdW5kbGVMb2FkZWRBc3NldHMgPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciBlID0gITA7XHJcbiAgICAgICAgaWYgKCF0aGlzLmJ1bmRsZUNhY2hlUmVjb3JkLmhhcyh0KSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJCdW5kbGUg5LiN5a2Y5ZyoXCIsIHQpO1xyXG4gICAgICAgICAgICByZXR1cm4gITA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBpID0gdGhpcy5idW5kbGVDYWNoZVJlY29yZC5nZXQodCk7XHJcbiAgICAgICAgZm9yICh2YXIgbyA9IDA7IG8gPCBpLmxlbmd0aDsgbysrKSB7XHJcbiAgICAgICAgICAgIGlmICghaVtvXS5pc0xvYWRlZCkge1xyXG4gICAgICAgICAgICAgICAgZSA9ICExO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGU7XHJcbiAgICB9O1xyXG4gICAgdC5wcm90b3R5cGUucHV0QXNzZXRzID0gZnVuY3Rpb24gKHQsIGUsIGkpIHtcclxuICAgICAgICBpZiAodGhpcy5oYXNBc3Nlc3QoaSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoXCLotYTmupDlkI3np7Dph43lpI3vvIzor7fli7/ph43lpI3kvb/nlKjlkI3np7AsXCIsIGkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgbyA9IHtcclxuICAgICAgICAgICAgYnVuZGxlOiB0LFxyXG4gICAgICAgICAgICBhc3NldHNUeXBlOiBlLFxyXG4gICAgICAgICAgICBwYXRoOiBpLFxyXG4gICAgICAgICAgICBpc0xvYWRlZDogITFcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuYXNzZXRzTWFwLnNldChpLCBvKTtcclxuICAgICAgICBpZiAoIXRoaXMuYnVuZGxlQ2FjaGVSZWNvcmQuaGFzKHQpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYnVuZGxlQ2FjaGVSZWNvcmQuc2V0KHQsIFtdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5idW5kbGVDYWNoZVJlY29yZC5nZXQodCkucHVzaChvKTtcclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciBlID0gdGhpcy5nZXRBc3NldHModCk7XHJcbiAgICAgICAgcmV0dXJuIGUgPyAkYXNzZXRzTG9hZGVyLmRlZmF1bHQuaW5zdGFuY2UuZ2V0UmVzKGUuYnVuZGxlLCB0LCBlLmFzc2V0c1R5cGUpIDogbnVsbDtcclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5pc0J1bmRsZUxvYWRlZCA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgcmV0dXJuICEhY2MuYXNzZXRNYW5hZ2VyLmdldEJ1bmRsZSh0KTtcclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5pc1Jlc0xvYWRlZCA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgcmV0dXJuICEhdGhpcy5hc3NldHNNYXAuaGFzKHQpICYmIHRoaXMuYXNzZXRzTWFwLmdldCh0KS5pc0xvYWRlZDtcclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5yZWxlYXNlQnVuZGxlID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0J1bmRsZUxvYWRlZCh0KSkge1xyXG4gICAgICAgICAgICBjYy5hc3NldE1hbmFnZXIuZ2V0QnVuZGxlKHQpLnJlbGVhc2VBbGwoKTtcclxuICAgICAgICAgICAgdGhpcy5hc3NldHNNYXAuZm9yRWFjaChmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUuYnVuZGxlID09PSB0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5pc0xvYWRlZCA9ICExO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgdC5wcm90b3R5cGUubG9hZEJ1bmRsZXMgPSBmdW5jdGlvbiAodCwgZSwgaSkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIG87XHJcbiAgICAgICAgICAgIHZhciBzO1xyXG4gICAgICAgICAgICB2YXIgcjtcclxuICAgICAgICAgICAgdmFyIGw7XHJcbiAgICAgICAgICAgIHZhciBjO1xyXG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKHUpIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAodS5sYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChvID0gW10sIGMgPSAwOyBjIDwgdC5sZW5ndGg7IGMrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjYy5hc3NldE1hbmFnZXIuZ2V0QnVuZGxlKHRbY10pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5wdXNoKHRbY10pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgwID09PSBvLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzJdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHMgPSBvLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgciA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChuLmxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgNCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXNzZXRzTG9hZGVyLmRlZmF1bHQuaW5zdGFuY2UubG9hZEJ1bmRsZVN5bmMoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9bdF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlKCh0ICsgaSkgLyBzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCsrciA+PSBzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cobywgXCJidW5kbGXliqDovb3lrozmiJBcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYyA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHUubGFiZWwgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMgPCBvLmxlbmd0aCA/IFs1LCBsKGMpXSA6IFszLCA0XTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHUuc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1LmxhYmVsID0gMztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGMrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszLCAxXTtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMl07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHQucHJvdG90eXBlLmxvYWRBcnJheSA9IGZ1bmN0aW9uICh0LCBlLCBpLCBsLCBjKSB7XHJcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gbCkge1xyXG4gICAgICAgICAgICBsID0gITE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh2b2lkIDAgPT09IGMpIHtcclxuICAgICAgICAgICAgYyA9IHRoaXMuYXNzZXRzTWFwO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBvO1xyXG4gICAgICAgICAgICB2YXIgdTtcclxuICAgICAgICAgICAgdmFyIGQ7XHJcbiAgICAgICAgICAgIHZhciBwO1xyXG4gICAgICAgICAgICB2YXIgZjtcclxuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIG8gPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgICAgICAgICB1ID0gbmV3IE1hcCgpO1xyXG4gICAgICAgICAgICAgICAgZCA9IDA7XHJcbiAgICAgICAgICAgICAgICBjLmZvckVhY2goZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodC5pbmNsdWRlcyhlLmJ1bmRsZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvLmhhcyhlLmJ1bmRsZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uc2V0KGUuYnVuZGxlLCBuZXcgTWFwKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gby5nZXQoZS5idW5kbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWkuaGFzKGUuYXNzZXRzVHlwZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuc2V0KGUuYXNzZXRzVHlwZSwgW10pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBlLmJ1bmRsZSArIGUuYXNzZXRzVHlwZS50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5zZXQobiwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaS5nZXQoZS5hc3NldHNUeXBlKS5wdXNoKGUucGF0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBwID0gdS5zaXplO1xyXG4gICAgICAgICAgICAgICAgZiA9IDA7XHJcbiAgICAgICAgICAgICAgICBvLmZvckVhY2goZnVuY3Rpb24gKG8sIG4pIHtcclxuICAgICAgICAgICAgICAgICAgICBvLmZvckVhY2goZnVuY3Rpb24gKG8sIGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAkYXNzZXRzTG9hZGVyLmRlZmF1bHQuaW5zdGFuY2UucHJlTG9hZFJlcyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICh0LCBpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG87XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSBuICsgaC50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUuc2V0KGwsIHQgLyBpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBfX3ZhbHVlcyh1KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZiA9IGQubmV4dCgpOyAhZi5kb25lOyBmID0gZC5uZXh0KCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0gX19yZWFkKGYudmFsdWUsIDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgKz0gbVsxXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiB0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmICYmICFmLmRvbmUgJiYgKGEgPSBkLnJldHVybikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNhbGwoZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZmluYWxseSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG8uZXJyb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZShjIC8gcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKytmID49IGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codCwgXCJidW5kbGXotYTmupDpooTliqDovb3lrozmiJBcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogJGFzc2V0c0xvYWRlci5kZWZhdWx0Lmluc3RhbmNlLmxvYWRSZXNTeW5jKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHQsIGkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbCA9IG4gKyBoLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdS5zZXQobCwgdCAvIGkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IF9fdmFsdWVzKHUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBmID0gZC5uZXh0KCk7ICFmLmRvbmU7IGYgPSBkLm5leHQoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG0gPSBfX3JlYWQoZi52YWx1ZSwgMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyArPSBtWzFdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAodCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGZpbmFsbHkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYgJiYgIWYuZG9uZSAmJiAoYSA9IGQucmV0dXJuKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuY2FsbChkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgby5lcnJvcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlKGMgLyBwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgrK2YgPj0gZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLmZvckVhY2goZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjLmhhcyh0KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuZ2V0KHQpLmlzTG9hZGVkID0gITA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0LCBcImJ1bmRsZei1hOa6kOWKoOi9veWujOaIkFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyXTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgdC5pbnN0YW5jZSA9IG5ldyB0KCk7XHJcbiAgICByZXR1cm4gdDtcclxufSkoKTtcclxuZXhwb3J0cy5SZXNNYW5hZ2VyID0gbDtcclxuIl19