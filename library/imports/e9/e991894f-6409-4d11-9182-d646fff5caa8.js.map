{"version":3,"sources":["assets\\game_script\\scripts\\Collider.js"],"names":["exports","cCollider","$agent","require","$body","$object","$shape","a","t","id","pools","axis","frameID","bodys","isDirty","pairs","Map","Object","defineProperty","get","_inst","enumerable","configurable","prototype","create","e","pop","object","cBody","insert","inCollider","push","isRemove","isRetrieve","Dirty","RTS","remove","reset","length","i","clear","update","reBuild","triggers","Agent","inst","process","n","s","l","c","u","d","aabb","p","f","h","mask","m","group","y","upper","g","_","lower","k","v","b","w","isAgent","A","priority","check","S","shape","type","C","ShapeSupport","onTrigger","endTrigger","o","r","Trigger","stay","state","enter","set","trigger","size","values","next","value","exit","preBuildAxis","sort","updateBound","I"],"mappings":"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","sourceRoot":"/","sourcesContent":["exports.cCollider = void 0;\r\nvar $agent = require(\"./Agent\");\r\nvar $body = require(\"./Body\");\r\nvar $object = require(\"./Object\");\r\nvar $shape = require(\"./Shape\");\r\nvar a = (function () {\r\n    function t() {\r\n        this.id = 0;\r\n        this.pools = [];\r\n        this.axis = -1;\r\n        this.frameID = 0;\r\n        this.bodys = [];\r\n        this.isDirty = !1;\r\n        this.pairs = new Map();\r\n    }\r\n    Object.defineProperty(t, \"inst\", {\r\n        get: function () {\r\n            if (null == this._inst) {\r\n                this._inst = new t();\r\n            }\r\n            return this._inst;\r\n        },\r\n        enumerable: !1,\r\n        configurable: !0\r\n    });\r\n    t.prototype.create = function (t) {\r\n        var e = this.pools.pop();\r\n        return e ? ((e.object = t), e) : (((e = new $body.cBody(t)).id = this.id++), e);\r\n    };\r\n    t.prototype.insert = function (t, e) {\r\n        if (void 0 === e) {\r\n            e = !1;\r\n        }\r\n        if (t) {\r\n            if (!t.inCollider) {\r\n                this.bodys.push(t);\r\n                t.inCollider = !0;\r\n            }\r\n            t.isRemove = !1;\r\n            t.isRetrieve = !1;\r\n            if (e && t.object) {\r\n                t.object.isDirty = $object.Dirty.RTS;\r\n            }\r\n        }\r\n    };\r\n    t.prototype.remove = function (t, e) {\r\n        if (void 0 === e) {\r\n            e = !1;\r\n        }\r\n        if (t) {\r\n            t.isRemove = !0;\r\n            t.isRetrieve = e;\r\n        }\r\n    };\r\n    t.prototype.reset = function () {\r\n        this.axis = -1;\r\n        this.frameID = 0;\r\n        this.isDirty = !0;\r\n        var t = this.bodys;\r\n        for (var e = t.length - 1; e >= 0; e--) {\r\n            var i = t[e];\r\n            this.pools.push(i);\r\n            i.clear();\r\n        }\r\n        t.length = 0;\r\n    };\r\n    t.prototype.clear = function () {\r\n        this.id = 0;\r\n        this.axis = -1;\r\n        this.frameID = 0;\r\n        this.isDirty = !0;\r\n        this.pools.length = 0;\r\n        var t = this.bodys;\r\n        for (var e = t.length - 1; e >= 0; e--) {\r\n            t[e].clear();\r\n        }\r\n        t.length = 0;\r\n    };\r\n    t.prototype.update = function () {\r\n        this.reBuild();\r\n        this.triggers();\r\n        $agent.Agent.inst.process(this.bodys);\r\n    };\r\n    t.prototype.triggers = function () {\r\n        ++this.frameID;\r\n        var t = this.axis;\r\n        var e = (t >> 2) & 3;\r\n        var i = (t >> 4) & 3;\r\n        var n = this.bodys;\r\n        var s = $agent.Agent.inst;\r\n        var a = 0;\r\n        var l = 0;\r\n        var c = n.length;\r\n        for (a = 0; a < c; a++) {\r\n            var u = n[a];\r\n            if (!u.isRemove) {\r\n                var d = u.aabb;\r\n                var p = d[e];\r\n                var f = d[i];\r\n                var h = u.mask;\r\n                var m = u.group;\r\n                var y = u.upper;\r\n                var g = u.object;\r\n                for (l = a + 1; l < c; l++) {\r\n                    var _ = n[l];\r\n                    if (!_.isRemove) {\r\n                        if (y <= _.lower) {\r\n                            break;\r\n                        }\r\n                        var k = _.aabb;\r\n                        var v = _.object;\r\n                        var b = h & _.group;\r\n                        var w = _.mask & m;\r\n                        if (!(p > k[e + 3] || k[e] > d[e + 3] || f > k[i + 3] || k[i] > d[i + 3])) {\r\n                            if (u.isAgent && _.isAgent) {\r\n                                var A = u.priority - _.priority;\r\n                                if (A <= 0) {\r\n                                    s.check(u, _);\r\n                                }\r\n                                if (A >= 0) {\r\n                                    s.check(_, u);\r\n                                }\r\n                            }\r\n                            if (b || w) {\r\n                                var S = g.shape.type;\r\n                                var C = v.shape.type;\r\n                                if (S > C) {\r\n                                    if (!$shape.ShapeSupport[C | S](_, u)) {\r\n                                        continue;\r\n                                    }\r\n                                } else {\r\n                                    if (!$shape.ShapeSupport[S | C](u, _)) {\r\n                                        continue;\r\n                                    }\r\n                                }\r\n                                this.onTrigger(u, _, (b ? 1 : 0) | (w ? 2 : 0));\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.endTrigger();\r\n    };\r\n    t.prototype.onTrigger = function (t, e, i) {\r\n        var o = 0;\r\n        var n = 0;\r\n        var r = t.id;\r\n        var a = e.id;\r\n        if (r < a) {\r\n            n = r;\r\n            r = a;\r\n            a = n;\r\n        }\r\n        n = ((r * (r + 1)) >> 1) + a - 1;\r\n        var l = this.pairs;\r\n        var c = l.get(n);\r\n        void 0 !== c\r\n            ? ((o = $object.Trigger.stay), (c.frameID = this.frameID), (c.state = i))\r\n            : ((o = $object.Trigger.enter),\r\n              l.set(n, {\r\n                  id: n,\r\n                  a: t,\r\n                  b: e,\r\n                  frameID: this.frameID,\r\n                  state: i\r\n              }));\r\n        var u = t.object;\r\n        if (1 & i && u && u.trigger && !t.isRemove) {\r\n            u.onTrigger(e, o);\r\n        }\r\n        var d = e.object;\r\n        if (2 & i && d && d.trigger && !e.isRemove) {\r\n            d.onTrigger(t, o);\r\n        }\r\n    };\r\n    t.prototype.endTrigger = function () {\r\n        var t = [];\r\n        var e = this.pairs;\r\n        var i = e.size;\r\n        var o = this.frameID;\r\n        var n = e.values();\r\n        for (var r = 0; r < i; r++) {\r\n            var a = n.next().value;\r\n            var l = a.a;\r\n            var c = a.b;\r\n            if (a.frameID != o || l.isRemove || l.isRemove) {\r\n                var u = l.object;\r\n                if (u && u.trigger && !l.isRemove) {\r\n                    u.onTrigger(c, $object.Trigger.exit);\r\n                }\r\n                var d = c.object;\r\n                if (d && d.trigger && !c.isRemove) {\r\n                    d.onTrigger(l, $object.Trigger.exit);\r\n                }\r\n                t.push(a.id);\r\n            }\r\n        }\r\n        for (i = t.length - 1; i >= 0; ) {\r\n            e.delete(t[i--]);\r\n        }\r\n        t.length = 0;\r\n    };\r\n    t.prototype.reBuild = function () {\r\n        var t = !1;\r\n        var e = this.preBuildAxis();\r\n        if ((3 & e) != (3 & this.axis) || this.axis < 0) {\r\n            this.axis = e;\r\n            t = !0;\r\n        }\r\n        if (t || this.isDirty) {\r\n            this.isDirty = !1;\r\n            var i = this.bodys;\r\n            e = 3 & this.axis;\r\n            var o = 0;\r\n            for (var n = i.length; o !== n; o++) {\r\n                var s = i[o];\r\n                var r = s.aabb;\r\n                s.lower = r[e];\r\n                s.upper = r[e + 3];\r\n            }\r\n            t\r\n                ? i.sort(function (t, e) {\r\n                      return t.lower - e.lower;\r\n                  })\r\n                : this.sort(i);\r\n        }\r\n    };\r\n    t.prototype.sort = function (t) {\r\n        var e;\r\n        var i = 0;\r\n        var o = 0;\r\n        i = 1;\r\n        for (e = t.length; i < e; i++) {\r\n            var n = t[i];\r\n            var s = n.lower;\r\n            for (o = i - 1; o >= 0; o--) {\r\n                var r = t[o];\r\n                if (r.lower <= s) {\r\n                    break;\r\n                }\r\n                t[o + 1] = r;\r\n            }\r\n            if (o + 1 != i) {\r\n                t[o + 1] = n;\r\n            }\r\n        }\r\n    };\r\n    t.prototype.preBuildAxis = function () {\r\n        var t = 0;\r\n        var e = 0;\r\n        var i = 0;\r\n        var o = 0;\r\n        var n = 0;\r\n        var s = 0;\r\n        var r = 0;\r\n        var a = 0;\r\n        var l = 0;\r\n        var c = 0;\r\n        var u = this.bodys;\r\n        var d = u.length;\r\n        var p = 0;\r\n        var f = !1;\r\n        for (var h = 0; h < d; h++) {\r\n            var m = u[h];\r\n            if (m.isRemove) {\r\n                m.isRetrieve && (this.pools.push(m), m.clear());\r\n                m.inCollider = !1;\r\n            } else {\r\n                {\r\n                    if (++p <= h) {\r\n                        u[p - 1] = m;\r\n                    }\r\n                    if (m.updateBound()) {\r\n                        f = !0;\r\n                    }\r\n                    var y = m.aabb;\r\n                    var g = y[3] - y[0];\r\n                    var _ = y[4] - y[1];\r\n                    var k = y[5] - y[2];\r\n                    a += g * g;\r\n                    l += _ * _;\r\n                    c += k * k;\r\n                    var v = 0.5 * (y[3] + y[0]);\r\n                    e += v;\r\n                    i += v * v;\r\n                    var b = 0.5 * (y[4] + y[1]);\r\n                    o += b;\r\n                    n += b * b;\r\n                    var w = 0.5 * (y[5] + y[2]);\r\n                    s += w;\r\n                    r += w * w;\r\n                }\r\n            }\r\n        }\r\n        this.bodys.length = p;\r\n        this.isDirty = f;\r\n        var A = 1 / p;\r\n        var S = (i - e * e * A) * (a = a > 0 ? p / a : 0);\r\n        var C = (n - o * o * A) * (l = l > 0 ? p / l : 0);\r\n        var I = (r - s * s * A) * (c = c > 0 ? p / c : 0);\r\n        if (0 == S) {\r\n            S = a;\r\n        }\r\n        if (0 == C) {\r\n            C = l;\r\n        }\r\n        if (0 == I) {\r\n            I = c;\r\n        }\r\n        S > C\r\n            ? S > I\r\n                ? ((t = 0), (t |= C > I ? 36 : 24))\r\n                : ((t = 2), (t |= S > C ? 16 : 4))\r\n            : C > I\r\n            ? ((t = 1), (t |= S > I ? 32 : 8))\r\n            : ((t = 2), (t |= S > C ? 16 : 4));\r\n        return t;\r\n    };\r\n    t._inst = null;\r\n    return t;\r\n})();\r\nexports.cCollider = a;\r\n"]}