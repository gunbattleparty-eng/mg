
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/WeChatInterstitial.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '155b6L77N1CRrXMAhbpiTuz', 'WeChatInterstitial');
// game_script/scripts/WeChatInterstitial.js

"use strict";

var o;

var $baseAd = require("./BaseAd");

var r = window.wx;

var a = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.isOpenPreLoad = !0;
    return e;
  }

  __extends(e, t);

  e.prototype.loadAd = function () {
    if (this.adUnitId) {
      if (r && r.createInterstitialAd) {
        var t = {
          adUnitId: this.adUnitId
        };
        this.adIns = r.createInterstitialAd(t);
        this.isConsume = !1;
        this.isLoaded = !1;

        if (this.adIns.onLoad) {
          this.adIns.onLoad(this.onLoad);
        }

        if (this.adIns.onClose) {
          this.adIns.onClose(this.onClose);
        }

        if (this.adIns.onErro) {
          this.adIns.onError(this.onError);
        }
      } else {
        console.warn("当前平台不支持创建插屏");
      }
    } else {
      console.error("微信插屏 ID为空");
    }
  };

  e.prototype.showInterstitial = function (t, e, i) {
    var o = this;
    this.showCallback = t;
    this.closeCallback = e;
    this.errorCallback = i;
    return this.adIns ? this.isConsume ? this.reCreateAd(!0) : this.isLoaded ? void (this.showing ? console.warn(this.adUnitId, ":正在显示中，不给显示") : this.adIns ? this.adIns.show && this.adIns.show().then(function () {
      o.showing = !0;

      if (o.showCallback) {
        o.showCallback();
      }

      o.showCallback = null;
      o.noRespondCount = 0;
    })["catch"](function (t) {
      o.showing = !1;
      console.warn("interstitial show error:", t);
      o.destroyAd();
    }) : (console.warn("interstitial对象未创建,将在创建完成后自动显示"), this.reCreateAd(!0))) : (this.noRespondCount++, console.warn(this.adUnitId, ":未加载完成，稍等，重复：", this.noRespondCount), this.isAutoShow = !0, void (this.noRespondCount >= 3 && (this.noRespondCount = 0, this.reCreateAd(!0)))) : (console.warn(this.adUnitId, ":未创建，执行创建"), this.isAutoShow = !0, this.loadAd());
  };

  e.prototype.reCreateAd = function (t) {
    this.destroyAd();
    this.isAutoShow = t;
    this.loadAd();
  };

  e.prototype.destroyAd = function () {
    console.log(this.adUnitId, ":===destroyAd===");
    this.isLoaded = !1;
    this.isAutoShow = !1;
    this.isConsume = !1;
    this.showCallback = null;
    this.errorCallback = null;

    if (this.adIns) {
      if (this.adIns.offLoad) {
        this.adIns.offLoad(this.onLoad);
      }

      if (this.adIns.offClose) {
        this.adIns.offClose(this.onClose);
      }

      if (this.adIns.offError) {
        this.adIns.offError(this.onError);
      }

      if (this.adIns.destroy) {
        this.adIns.destroy();
      }

      this.adIns = null;
    }
  };

  e.prototype.onAdLoad = function () {
    t.prototype.onAdLoad.call(this);
    this.isConsume = !1;
    this.isLoaded = !0;
    this.autoShow();
  };

  e.prototype.onAdError = function (e) {
    t.prototype.onAdError.call(this, e);
    this.showing = !1;

    if (this.errorCallback) {
      this.errorCallback();
    }

    this.destroyAd();
  };

  e.prototype.onAdClose = function () {
    t.prototype.onAdClose.call(this);
    this.showing = !1;

    if (this.closeCallback) {
      this.closeCallback();
    }

    if (this.isOpenPreLoad) {
      this.reCreateAd(!1);
    }
  };

  e.prototype.autoShow = function () {
    if (this.isAutoShow) {
      this.isAutoShow = !1;
      this.showInterstitial(this.showCallback, this.closeCallback, this.errorCallback);
    }
  };

  return e;
}($baseAd.BaseAd);

exports["default"] = a;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXFdlQ2hhdEludGVyc3RpdGlhbC5qcyJdLCJuYW1lcyI6WyJvIiwiJGJhc2VBZCIsInJlcXVpcmUiLCJyIiwid2luZG93Iiwid3giLCJhIiwidCIsImUiLCJhcHBseSIsImFyZ3VtZW50cyIsImlzT3BlblByZUxvYWQiLCJfX2V4dGVuZHMiLCJwcm90b3R5cGUiLCJsb2FkQWQiLCJhZFVuaXRJZCIsImNyZWF0ZUludGVyc3RpdGlhbEFkIiwiYWRJbnMiLCJpc0NvbnN1bWUiLCJpc0xvYWRlZCIsIm9uTG9hZCIsIm9uQ2xvc2UiLCJvbkVycm8iLCJvbkVycm9yIiwiY29uc29sZSIsIndhcm4iLCJlcnJvciIsInNob3dJbnRlcnN0aXRpYWwiLCJpIiwic2hvd0NhbGxiYWNrIiwiY2xvc2VDYWxsYmFjayIsImVycm9yQ2FsbGJhY2siLCJyZUNyZWF0ZUFkIiwic2hvd2luZyIsInNob3ciLCJ0aGVuIiwibm9SZXNwb25kQ291bnQiLCJkZXN0cm95QWQiLCJpc0F1dG9TaG93IiwibG9nIiwib2ZmTG9hZCIsIm9mZkNsb3NlIiwib2ZmRXJyb3IiLCJkZXN0cm95Iiwib25BZExvYWQiLCJjYWxsIiwiYXV0b1Nob3ciLCJvbkFkRXJyb3IiLCJvbkFkQ2xvc2UiLCJCYXNlQWQiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLENBQUo7O0FBQ0EsSUFBSUMsT0FBTyxHQUFHQyxPQUFPLENBQUMsVUFBRCxDQUFyQjs7QUFDQSxJQUFJQyxDQUFDLEdBQUdDLE1BQU0sQ0FBQ0MsRUFBZjs7QUFDQSxJQUFJQyxDQUFDLEdBQUksVUFBVUMsQ0FBVixFQUFhO0VBQ2xCLFNBQVNDLENBQVQsR0FBYTtJQUNULElBQUlBLENBQUMsR0FBSSxTQUFTRCxDQUFULElBQWNBLENBQUMsQ0FBQ0UsS0FBRixDQUFRLElBQVIsRUFBY0MsU0FBZCxDQUFmLElBQTRDLElBQXBEO0lBQ0FGLENBQUMs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QUF1QixZQUFZO0lBQy9CLElBQUksS0FBS1IsVUFBVCxFQUFxQjtNQUNqQixLQUFLQSxVQUFMLEdBQWtCLENBQUMsQ0FBbkI7TUFDQSxLQUFLWCxnQkFBTCxDQUFzQixLQUFLRSxZQUEzQixFQUF5QyxLQUFLQyxhQUE5QyxFQUE2RCxLQUFLQyxhQUFsRTtJQUNIO0VBQ0osQ0FMRDs7RUFNQSxPQUFPdkIsQ0FBUDtBQUNILENBOUhPLENBOEhMUCxPQUFPLENBQUNnRCxNQTlISCxDQUFSOztBQStIQUMsT0FBTyxXQUFQLEdBQWtCNUMsQ0FBbEIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBvO1xyXG52YXIgJGJhc2VBZCA9IHJlcXVpcmUoXCIuL0Jhc2VBZFwiKTtcclxudmFyIHIgPSB3aW5kb3cud3g7XHJcbnZhciBhID0gKGZ1bmN0aW9uICh0KSB7XHJcbiAgICBmdW5jdGlvbiBlKCkge1xyXG4gICAgICAgIHZhciBlID0gKG51bGwgIT09IHQgJiYgdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSB8fCB0aGlzO1xyXG4gICAgICAgIGUuaXNPcGVuUHJlTG9hZCA9ICEwO1xyXG4gICAgICAgIHJldHVybiBlO1xyXG4gICAgfVxyXG4gICAgX19leHRlbmRzKGUsIHQpO1xyXG4gICAgZS5wcm90b3R5cGUubG9hZEFkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmFkVW5pdElkKSB7XHJcbiAgICAgICAgICAgIGlmIChyICYmIHIuY3JlYXRlSW50ZXJzdGl0aWFsQWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGFkVW5pdElkOiB0aGlzLmFkVW5pdElkXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucyA9IHIuY3JlYXRlSW50ZXJzdGl0aWFsQWQodCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzQ29uc3VtZSA9ICExO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc0xvYWRlZCA9ICExO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMub25Mb2FkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZElucy5vbkxvYWQodGhpcy5vbkxvYWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMub25DbG9zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMub25DbG9zZSh0aGlzLm9uQ2xvc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMub25FcnJvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZElucy5vbkVycm9yKHRoaXMub25FcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCLlvZPliY3lubPlj7DkuI3mlK/mjIHliJvlu7rmj5LlsY9cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwi5b6u5L+h5o+S5bGPIElE5Li656m6XCIpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5zaG93SW50ZXJzdGl0aWFsID0gZnVuY3Rpb24gKHQsIGUsIGkpIHtcclxuICAgICAgICB2YXIgbyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5zaG93Q2FsbGJhY2sgPSB0O1xyXG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IGU7XHJcbiAgICAgICAgdGhpcy5lcnJvckNhbGxiYWNrID0gaTtcclxuICAgICAgICByZXR1cm4gdGhpcy5hZEluc1xyXG4gICAgICAgICAgICA/IHRoaXMuaXNDb25zdW1lXHJcbiAgICAgICAgICAgICAgICA/IHRoaXMucmVDcmVhdGVBZCghMClcclxuICAgICAgICAgICAgICAgIDogdGhpcy5pc0xvYWRlZFxyXG4gICAgICAgICAgICAgICAgPyB2b2lkICh0aGlzLnNob3dpbmdcclxuICAgICAgICAgICAgICAgICAgICAgID8gY29uc29sZS53YXJuKHRoaXMuYWRVbml0SWQsIFwiOuato+WcqOaYvuekuuS4re+8jOS4jee7meaYvuekulwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgOiB0aGlzLmFkSW5zXHJcbiAgICAgICAgICAgICAgICAgICAgICA/IHRoaXMuYWRJbnMuc2hvdyAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkSW5zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2hvdygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5zaG93aW5nID0gITA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG8uc2hvd0NhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uc2hvd0NhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uc2hvd0NhbGxiYWNrID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLm5vUmVzcG9uZENvdW50ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLnNob3dpbmcgPSAhMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJpbnRlcnN0aXRpYWwgc2hvdyBlcnJvcjpcIiwgdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5kZXN0cm95QWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICA6IChjb25zb2xlLndhcm4oXCJpbnRlcnN0aXRpYWzlr7nosaHmnKrliJvlu7os5bCG5Zyo5Yib5bu65a6M5oiQ5ZCO6Ieq5Yqo5pi+56S6XCIpLCB0aGlzLnJlQ3JlYXRlQWQoITApKSlcclxuICAgICAgICAgICAgICAgIDogKHRoaXMubm9SZXNwb25kQ291bnQrKyxcclxuICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKHRoaXMuYWRVbml0SWQsIFwiOuacquWKoOi9veWujOaIkO+8jOeojeetie+8jOmHjeWkje+8mlwiLCB0aGlzLm5vUmVzcG9uZENvdW50KSxcclxuICAgICAgICAgICAgICAgICAgKHRoaXMuaXNBdXRvU2hvdyA9ICEwKSxcclxuICAgICAgICAgICAgICAgICAgdm9pZCAodGhpcy5ub1Jlc3BvbmRDb3VudCA+PSAzICYmICgodGhpcy5ub1Jlc3BvbmRDb3VudCA9IDApLCB0aGlzLnJlQ3JlYXRlQWQoITApKSkpXHJcbiAgICAgICAgICAgIDogKGNvbnNvbGUud2Fybih0aGlzLmFkVW5pdElkLCBcIjrmnKrliJvlu7rvvIzmiafooYzliJvlu7pcIiksICh0aGlzLmlzQXV0b1Nob3cgPSAhMCksIHRoaXMubG9hZEFkKCkpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnJlQ3JlYXRlQWQgPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHRoaXMuZGVzdHJveUFkKCk7XHJcbiAgICAgICAgdGhpcy5pc0F1dG9TaG93ID0gdDtcclxuICAgICAgICB0aGlzLmxvYWRBZCgpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLmRlc3Ryb3lBZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmFkVW5pdElkLCBcIjo9PT1kZXN0cm95QWQ9PT1cIik7XHJcbiAgICAgICAgdGhpcy5pc0xvYWRlZCA9ICExO1xyXG4gICAgICAgIHRoaXMuaXNBdXRvU2hvdyA9ICExO1xyXG4gICAgICAgIHRoaXMuaXNDb25zdW1lID0gITE7XHJcbiAgICAgICAgdGhpcy5zaG93Q2FsbGJhY2sgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZXJyb3JDYWxsYmFjayA9IG51bGw7XHJcbiAgICAgICAgaWYgKHRoaXMuYWRJbnMpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMub2ZmTG9hZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucy5vZmZMb2FkKHRoaXMub25Mb2FkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5hZElucy5vZmZDbG9zZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucy5vZmZDbG9zZSh0aGlzLm9uQ2xvc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFkSW5zLm9mZkVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkSW5zLm9mZkVycm9yKHRoaXMub25FcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMuZGVzdHJveSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucy5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5hZElucyA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLm9uQWRMb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHQucHJvdG90eXBlLm9uQWRMb2FkLmNhbGwodGhpcyk7XHJcbiAgICAgICAgdGhpcy5pc0NvbnN1bWUgPSAhMTtcclxuICAgICAgICB0aGlzLmlzTG9hZGVkID0gITA7XHJcbiAgICAgICAgdGhpcy5hdXRvU2hvdygpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLm9uQWRFcnJvciA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgdC5wcm90b3R5cGUub25BZEVycm9yLmNhbGwodGhpcywgZSk7XHJcbiAgICAgICAgdGhpcy5zaG93aW5nID0gITE7XHJcbiAgICAgICAgaWYgKHRoaXMuZXJyb3JDYWxsYmFjaykge1xyXG4gICAgICAgICAgICB0aGlzLmVycm9yQ2FsbGJhY2soKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5kZXN0cm95QWQoKTtcclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5vbkFkQ2xvc2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdC5wcm90b3R5cGUub25BZENsb3NlLmNhbGwodGhpcyk7XHJcbiAgICAgICAgdGhpcy5zaG93aW5nID0gITE7XHJcbiAgICAgICAgaWYgKHRoaXMuY2xvc2VDYWxsYmFjaykge1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlQ2FsbGJhY2soKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuaXNPcGVuUHJlTG9hZCkge1xyXG4gICAgICAgICAgICB0aGlzLnJlQ3JlYXRlQWQoITEpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5hdXRvU2hvdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0F1dG9TaG93KSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNBdXRvU2hvdyA9ICExO1xyXG4gICAgICAgICAgICB0aGlzLnNob3dJbnRlcnN0aXRpYWwodGhpcy5zaG93Q2FsbGJhY2ssIHRoaXMuY2xvc2VDYWxsYmFjaywgdGhpcy5lcnJvckNhbGxiYWNrKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGU7XHJcbn0pKCRiYXNlQWQuQmFzZUFkKTtcclxuZXhwb3J0cy5kZWZhdWx0ID0gYTtcclxuIl19