{"version":3,"sources":["assets\\game_script\\scripts\\Gun_2.js"],"names":["o","$assetsLoader","require","$assetsMap","$resUtil","$eventManager","$remoteAudio","$seedUtil","$configContext","$globalParam","$localEventName","$roleContext","$baseBullet","$gameContext","$gameGemInfo","$gameSkillInfo","$baseGun","v","cc","Vec3","ZERO","b","t","e","i","call","skin2AtkLeftCd","skin2AtkCurrCount","skillId","skillParam","ins","skillInfo","getSkillById","__extends","prototype","updateF","isAttacking","isGamePuase","timeLeft","currSkinInfo","skin","skinAtkTargetCount","sendSkin2Bullet","skillCD","Skill4Param","FINAL","send","RENDER_SKILL_CD_INFO","starGun","getRangeRankEnemy","pointNode","skillAtkRange","node","position","subtract","normalize","GameGemInfo","hasGem","GemType","AddSkill","probability","get1","thermobaricSpeed","n","schedulesOnce","instance","playEffectMusic","sendButtle","getNearbyN2","thermobaricComboCount","s","r","sub","createButtle","length","a","getButtlePool","BulletType","thermobaric_bullet","getRes","BundleNames","Game","AssetsMap","GameBundles","prefabs","assetsList","Bullet_4","ResUtil","instantiate","buttleLayer","parent","getComponent","skillSpecialitys","basicSkillConfigMap","get","skill_tpye","convertToNodeSpaceAR","convertToWorldSpaceAR","setPosition","initButtle","insert","s_bullet_2","SBullet_2","lowBulletLayer","x","y","clone","skinAtkCd","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var o;\r\nvar $assetsLoader = require(\"./AssetsLoader\");\r\nvar $assetsMap = require(\"./AssetsMap\");\r\nvar $resUtil = require(\"./ResUtil\");\r\nvar $eventManager = require(\"./EventManager\");\r\nvar $remoteAudio = require(\"./RemoteAudio\");\r\nvar $seedUtil = require(\"./SeedUtil\");\r\nvar $configContext = require(\"./ConfigContext\");\r\nvar $globalParam = require(\"./GlobalParam\");\r\nvar $localEventName = require(\"./LocalEventName\");\r\nvar $roleContext = require(\"./RoleContext\");\r\nvar $baseBullet = require(\"./BaseBullet\");\r\nvar $gameContext = require(\"./GameContext\");\r\nvar $gameGemInfo = require(\"./GameGemInfo\");\r\nvar $gameSkillInfo = require(\"./GameSkillInfo\");\r\nvar $baseGun = require(\"./BaseGun\");\r\nvar v = cc.Vec3.ZERO;\r\nvar b = (function (t) {\r\n    function e(e) {\r\n        var i = t.call(this, e) || this;\r\n        i.skin2AtkLeftCd = 0;\r\n        i.skin2AtkCurrCount = 0;\r\n        i.skillId = 23;\r\n        i.skillParam = $gameContext.default.ins.skillInfo.getSkillById(i.skillId);\r\n        return i;\r\n    }\r\n    __extends(e, t);\r\n    e.prototype.updateF = function (e) {\r\n        t.prototype.updateF.call(this, e);\r\n        if (!(this.isAttacking || $globalParam.default.isGamePuase)) {\r\n            this.timeLeft -= e;\r\n            if (\r\n                2 === $roleContext.default.ins.currSkinInfo.skin &&\r\n                this.skin2AtkCurrCount >= $gameContext.default.ins.skillInfo.skinAtkTargetCount\r\n            ) {\r\n                this.skin2AtkLeftCd -= e;\r\n                if (this.skin2AtkLeftCd <= 0) {\r\n                    this.sendSkin2Bullet();\r\n                }\r\n            }\r\n            this.timeLeft <= 0\r\n                ? ((this.isAttacking = !0),\r\n                  (this.timeLeft = this.skillParam.skillCD[$gameSkillInfo.Skill4Param.FINAL]),\r\n                  $eventManager.default.send($localEventName.default.RENDER_SKILL_CD_INFO, 23, 0, -1),\r\n                  this.starGun() || ((this.isAttacking = !1), (this.timeLeft = 0)))\r\n                : $eventManager.default.send(\r\n                      $localEventName.default.RENDER_SKILL_CD_INFO,\r\n                      23,\r\n                      this.timeLeft / this.skillParam.skillCD[$gameSkillInfo.Skill4Param.FINAL],\r\n                      -1\r\n                  );\r\n        }\r\n    };\r\n    e.prototype.starGun = function () {\r\n        var t = this;\r\n        var e = $gameContext.default.ins.getRangeRankEnemy(\r\n            this.pointNode,\r\n            this.skillParam.skillAtkRange[$gameSkillInfo.Skill4Param.FINAL]\r\n        );\r\n        if (!e) {\r\n            return !1;\r\n        }\r\n        var i = e.node.position.subtract(this.pointNode.position).normalize();\r\n        if (\r\n            $gameGemInfo.GameGemInfo.ins.hasGem($gameGemInfo.GemType.AddSkill) &&\r\n            $seedUtil.default.probability(100 * $gameGemInfo.GameGemInfo.ins.get1($gameGemInfo.GemType.AddSkill))\r\n        ) {\r\n            var o = 150 / this.skillParam.thermobaricSpeed[$gameSkillInfo.Skill4Param.FINAL];\r\n            for (var n = 0; n < 2; n++) {\r\n                this.schedulesOnce(function () {\r\n                    $remoteAudio.default.instance.playEffectMusic(\"firebullet\");\r\n                    t.sendButtle(i);\r\n                }, o * n);\r\n            }\r\n        } else {\r\n            this.sendButtle(i);\r\n        }\r\n        this.isAttacking = !1;\r\n        return !0;\r\n    };\r\n    e.prototype.sendButtle = function (t) {\r\n        var e = this;\r\n        this.skin2AtkCurrCount++;\r\n        var i = $gameContext.default.ins.getNearbyN2(this.pointNode, this.skillParam.thermobaricComboCount + 1);\r\n        var o = 150 / this.skillParam.thermobaricSpeed[$gameSkillInfo.Skill4Param.FINAL];\r\n        var n = 0;\r\n        var s = function (s) {\r\n            r.schedulesOnce(function () {\r\n                if (0 !== s) {\r\n                    t = i[s].node.position.sub(e.pointNode.position).normalize();\r\n                }\r\n                e.createButtle(t);\r\n                if (++n >= i.length + 1) {\r\n                    e.isAttacking = !1;\r\n                }\r\n            }, o * s);\r\n        };\r\n        var r = this;\r\n        for (var a = 0; a < i.length; a++) {\r\n            s(a);\r\n        }\r\n    };\r\n    e.prototype.createButtle = function (t) {\r\n        var e = $gameContext.default.ins.getButtlePool($baseBullet.BulletType.thermobaric_bullet);\r\n        if (!e) {\r\n            var i = $assetsLoader.default.instance.getRes(\r\n                $assetsMap.BundleNames.Game,\r\n                $assetsMap.AssetsMap.GameBundles.prefabs.assetsList.Bullet_4\r\n            );\r\n            (e = $resUtil.ResUtil.instantiate(i, $gameContext.default.ins.buttleLayer.parent).getComponent(\r\n                $baseBullet.default\r\n            )).skillSpecialitys = $configContext.default.instance.basicSkillConfigMap.get(this.skillId).skill_tpye;\r\n        }\r\n        var o = $gameContext.default.ins.buttleLayer.convertToNodeSpaceAR(\r\n            this.pointNode.convertToWorldSpaceAR(cc.Vec3.ZERO)\r\n        );\r\n        e.setPosition(o);\r\n        e.initButtle(t, this.skillId);\r\n        e.insert($gameContext.default.ins.buttleLayer);\r\n    };\r\n    e.prototype.sendSkin2Bullet = function () {\r\n        if (\r\n            !$gameContext.default.ins.getRangeRankEnemy(\r\n                this.pointNode,\r\n                this.skillParam.skillAtkRange[$gameSkillInfo.Skill4Param.FINAL]\r\n            )\r\n        ) {\r\n            this.skin2AtkLeftCd = 2;\r\n            return !1;\r\n        }\r\n        for (var t = 0; t < 3; t++) {\r\n            var e = $gameContext.default.ins.getButtlePool($baseBullet.BulletType.s_bullet_2);\r\n            if (!e) {\r\n                var i = $assetsLoader.default.instance.getRes(\r\n                    $assetsMap.BundleNames.Game,\r\n                    $assetsMap.AssetsMap.GameBundles.prefabs.assetsList.SBullet_2\r\n                );\r\n                e = $resUtil.ResUtil.instantiate(i, $gameContext.default.ins.lowBulletLayer.parent).getComponent(\r\n                    $baseBullet.default\r\n                );\r\n            }\r\n            v.x = 200 * t - 200;\r\n            v.y = -350;\r\n            e.setPosition(v.clone());\r\n            v.x = 0;\r\n            v.y = 1;\r\n            e.initButtle(v, this.skillId);\r\n            e.insert($gameContext.default.ins.lowBulletLayer);\r\n        }\r\n        this.skin2AtkCurrCount = 0;\r\n        this.skin2AtkLeftCd = $gameContext.default.ins.skillInfo.skinAtkCd;\r\n    };\r\n    return e;\r\n})($baseGun.default);\r\nexports.default = b;\r\n"]}