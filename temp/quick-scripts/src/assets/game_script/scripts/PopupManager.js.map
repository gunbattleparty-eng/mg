{"version":3,"sources":["assets\\game_script\\scripts\\PopupManager.js"],"names":["exports","PopupManager","$assetsLoader","require","$resManager","$resUtil","$popupView","$uICache","$uIManager","$uIParam","$waitingManager","d","t","uiManager","UIManager","instance","uiCache","UICache","prototype","openConfrim","e","getBaseUI","LayerType","DIALOG","registerCallback","isMaskBg","maskNode","getPopBg","uiAddScene","layerConfirm","addChild","node","open","i","a","l","getCacheView","ResUtil","getResKeeper","uuid","viewPath","param","rooNode","layerPop","p","getComponent","PopupView","uiCallback","uiParam","POPUP","console","error","warn","WaitingManager","show","f","ResManager","getAssets","loadResSync","bundle","path","cc","Prefab","close","isValid","playCloseAnim","uiType","setPopBg","uiRemoveScene","closeAll","getCurrView","length"],"mappings":"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","sourceRoot":"/","sourcesContent":["exports.PopupManager = void 0;\r\nvar $assetsLoader = require(\"./AssetsLoader\");\r\nvar $resManager = require(\"./ResManager\");\r\nvar $resUtil = require(\"./ResUtil\");\r\nvar $popupView = require(\"./PopupView\");\r\nvar $uICache = require(\"./UICache\");\r\nvar $uIManager = require(\"./UIManager\");\r\nvar $uIParam = require(\"./UIParam\");\r\nvar $waitingManager = require(\"./WaitingManager\");\r\nvar d = (function () {\r\n    function t() {\r\n        this.uiManager = $uIManager.UIManager.instance;\r\n        this.uiCache = $uICache.UICache.instance;\r\n    }\r\n    t.prototype.openConfrim = function (t) {\r\n        var e = this.uiCache.getBaseUI($uIParam.LayerType.DIALOG);\r\n        e.registerCallback(t);\r\n        if (e.isMaskBg) {\r\n            e.maskNode = this.uiCache.getPopBg();\r\n        }\r\n        this.uiManager.uiAddScene($uIParam.LayerType.DIALOG, e);\r\n        this.uiManager.layerConfirm.addChild(e.node);\r\n    };\r\n    t.prototype.open = function (t, e, i) {\r\n        var a = this;\r\n        if (void 0 === e) {\r\n            e = null;\r\n        }\r\n        if (void 0 === i) {\r\n            i = null;\r\n        }\r\n        var l = this.uiCache.getCacheView(t);\r\n        if (l) {\r\n            $resUtil.ResUtil.getResKeeper(l, !0);\r\n            var d = {\r\n                uuid: l.uuid,\r\n                viewPath: t,\r\n                param: e,\r\n                rooNode: this.uiManager.layerPop\r\n            };\r\n            var p = l.getComponent($popupView.PopupView);\r\n            p\r\n                ? (p.isMaskBg && (p.maskNode = this.uiCache.getPopBg()),\r\n                  (p.uiCallback = i),\r\n                  (p.uiParam = d),\r\n                  this.uiManager.uiAddScene($uIParam.LayerType.POPUP, p),\r\n                  this.uiManager.layerPop.addChild(p.node))\r\n                : console.error(\"当前UI不存在，或者没有绑定脚本\");\r\n        } else {\r\n            console.warn(\"资源未被加载,自动加载\");\r\n            $waitingManager.WaitingManager.instance.show(10, null, 0.5);\r\n            var f = $resManager.ResManager.instance.getAssets(t);\r\n            $assetsLoader.default.instance.loadResSync(f.bundle, [f.path], cc.Prefab, null, function () {\r\n                console.warn(\"资源未被加载,自动加载完成\");\r\n                $waitingManager.WaitingManager.instance.close();\r\n                a.open(t, e, i);\r\n            });\r\n        }\r\n    };\r\n    t.prototype.close = function (t) {\r\n        var e = this;\r\n        if (cc.isValid(t)) {\r\n            t.playCloseAnim(function () {\r\n                if (t.uiType === $uIParam.LayerType.DIALOG) {\r\n                    e.uiCache.setPopBg(t.maskNode);\r\n                    return void e.uiManager.uiRemoveScene($uIParam.LayerType.DIALOG, t);\r\n                }\r\n                if (cc.isValid(t.maskNode)) {\r\n                    e.uiCache.setPopBg(t.maskNode);\r\n                }\r\n                e.uiManager.uiRemoveScene($uIParam.LayerType.POPUP, t);\r\n            });\r\n        }\r\n    };\r\n    t.prototype.closeAll = function () {\r\n        var t = this.uiCache.getCurrView($uIParam.LayerType.POPUP);\r\n        for (var e = 0; e < t.length; e++) {\r\n            this.close(t[e]);\r\n        }\r\n    };\r\n    t.instance = new t();\r\n    return t;\r\n})();\r\nexports.PopupManager = d;\r\n"]}