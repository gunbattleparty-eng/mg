
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/QQBanner.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '392b16aJA9Jwp0bhmkvomfB', 'QQBanner');
// game_script/scripts/QQBanner.js

"use strict";

var o;
exports.QQBanner = void 0;

var $baseAd = require("./BaseAd");

var r = window.qq;

var a = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.isOpenPreLoad = !1;
    e.style = null;
    return e;
  }

  __extends(e, t);

  e.prototype.loadAd = function () {
    if (this.adUnitId) {
      if (r && r.createBannerAd) {
        var t = r.getSystemInfoSync().windowWidth;
        var e = this.style || {};
        var i = {
          adUnitId: this.adUnitId,
          style: {
            left: e.left || 0,
            top: e.top || 0,
            width: t
          }
        };
        this.adIns = r.createBannerAd(i);

        if (this.adIns.onLoad) {
          this.adIns.onLoad(this.onLoad);
        }

        if (this.adIns.onResize) {
          this.adIns.onResize(this.onResize);
        }

        if (this.adIns.onError) {
          this.adIns.onError(this.onError);
        }
      } else {
        console.warn("当前平台不支持创建banner");
      }
    } else {
      console.error("QQ Banner ID为空");
    }
  };

  e.prototype.showBanner = function (t, e, i) {
    var o = this;
    this.showCallback = e;
    this.errorCallback = i;

    if (this.isCanShow) {
      if (!this.adIns) {
        console.warn(this.adUnitId, ":未创建，执行创建");
        this.isAutoShow = !0;
        return this.loadAd();
      }

      if (this.isConsume) {
        this.reCreateAd(!0);
      } else {
        {
          if (!this.isLoaded) {
            console.warn(this.adUnitId, ":未加载完成，稍等");
            return void (this.isAutoShow = !0);
          }

          if (this.adIns && t) {
            if (void 0 !== t.top) {
              this.adIns.style.top = t.top;
            }

            if (void 0 !== t.left) {
              this.adIns.style.left = t.left;
            }

            if (void 0 !== t.width) {
              this.adIns.style.width = t.width;
            }
          }

          this.isConsume = !1;

          if (this.adIns.show) {
            var n = this.adIns.show();
            n && n.then ? n.then(function () {
              o.isConsume = !0;

              if (o.showCallback) {
                o.showCallback();
              }

              o.showCallback = null;
            })["catch"](function (t) {
              console.warn(o.adUnitId, ":show错误，重新加载", t);
              o.reCreateAd(!0);
            }) : (console.warn(this.adUnitId, ":show显示失败，重新加载"), this.reCreateAd(!0));
          }
        }
      }
    } else {
      console.warn(this.adUnitId, ":当前广告禁止显示");
    }
  };

  e.prototype.forbiddenBanner = function (t) {
    this.isCanShow = !t;

    if (t && this.isConsume) {
      this.hideBanner(!1);
    }
  };

  e.prototype.hideBanner = function (t) {
    t && this.isConsume ? (this.destroyAd(), this.reCreateAd(!1)) : this.adIns && this.adIns.hide && this.adIns.hide();
  };

  e.prototype.onAdResize = function (t) {
    console.warn("onBannerResize", t);
    var e = r.getSystemInfoSync();
    var i = e.windowWidth;
    var o = e.windowHeight;
    var n = this.style || {};
    null != n.top ? this.adIns.style.top = n.top : this.adIns.style.top = Math.round(o - t.height + 0.1);
    null != n.left ? this.adIns.style.left = n.left : this.adIns.style.left = Math.round((i - t.width) / 2 + 0.1);
  };

  e.prototype.reCreateAd = function (t) {
    var e = this;
    this.destroyAd();
    this.isAutoShow = t;
    setTimeout(function () {
      e.loadAd();
    }, 100);
  };

  e.prototype.destroyAd = function () {
    t.prototype.destroyAd.call(this);

    if (this.adIns) {
      if (this.adIns.offLoad) {
        this.adIns.offLoad(this.onLoad);
      }

      if (this.adIns.offResize) {
        this.adIns.offResize(this.onResize);
      }

      if (this.adIns.offError) {
        this.adIns.offError(this.onError);
      }

      if (this.adIns.destroy) {
        this.adIns.destroy();
      }

      this.adIns = null;
    }
  };

  e.prototype.autoShow = function () {
    if (this.isAutoShow) {
      this.isAutoShow = !1;
      this.showBanner(this.style, this.showCallback, this.errorCallback);
    }
  };

  e.prototype.onAdLoad = function () {
    console.log(this.adUnitId, ":===onAdload===");
    this.isConsume = !1;
    this.isLoaded = !0;
    this.autoShow();
  };

  e.prototype.onAdError = function (t) {
    console.warn("onAdError", this.adUnitId, t);

    if (this.errorCallback) {
      this.errorCallback();
    }

    this.destroyAd();
  };

  return e;
}($baseAd.BaseAd);

exports.QQBanner = a;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXFFRQmFubmVyLmpzIl0sIm5hbWVzIjpbIm8iLCJleHBvcnRzIiwiUVFCYW5uZXIiLCIkYmFzZUFkIiwicmVxdWlyZSIsInIiLCJ3aW5kb3ciLCJxcSIsImEiLCJ0IiwiZSIsImFwcGx5IiwiYXJndW1lbnRzIiwiaXNPcGVuUHJlTG9hZCIsInN0eWxlIiwiX19leHRlbmRzIiwicHJvdG90eXBlIiwibG9hZEFkIiwiYWRVbml0SWQiLCJjcmVhdGVCYW5uZXJBZCIsImdldFN5c3RlbUluZm9TeW5jIiwid2luZG93V2lkdGgiLCJpIiwibGVmdCIsInRvcCIsIndpZHRoIiwiYWRJbnMiLCJvbkxvYWQiLCJvblJlc2l6ZSIsIm9uRXJyb3IiLCJjb25zb2xlIiwid2FybiIsImVycm9yIiwic2hvd0Jhbm5lciIsInNob3dDYWxsYmFjayIsImVycm9yQ2FsbGJhY2siLCJpc0NhblNob3ciLCJpc0F1dG9TaG93IiwiaXNDb25zdW1lIiwicmVDcmVhdGVBZCIsImlzTG9hZGVkIiwic2hvdyIsIm4iLCJ0aGVuIiwiZm9yYmlkZGVuQmFubmVyIiwiaGlkZUJhbm5lciIsImRlc3Ryb3lBZCIsImhpZGUiLCJvbkFkUmVzaXplIiwid2luZG93SGVpZ2h0IiwiTWF0aCIsInJvdW5kIiwiaGVpZ2h0Iiwic2V0VGltZW91dCIsImNhbGwiLCJvZmZMb2FkIiwib2ZmUmVzaXplIiwib2ZmRXJyb3IiLCJkZXN0cm95IiwiYXV0b1Nob3ciLCJvbkFkTG9hZCIsImxvZyIsIm9uQWRFcnJvciIsIkJhc2VBZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxDQUFKO0FBQ0FDLE9BQU8sQ0FBQ0MsUUFBUixHQUFtQixLQUFLLENBQXhCOztBQUNBLElBQUlDLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFVBQUQsQ0FBckI7O0FBQ0EsSUFBSUMsQ0FBQyxHQUFHQyxNQUFNLENBQUNDLEVBQWY7O0FBQ0EsSUFBSUMsQ0FB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InZhciBvO1xyXG5leHBvcnRzLlFRQmFubmVyID0gdm9pZCAwO1xyXG52YXIgJGJhc2VBZCA9IHJlcXVpcmUoXCIuL0Jhc2VBZFwiKTtcclxudmFyIHIgPSB3aW5kb3cucXE7XHJcbnZhciBhID0gKGZ1bmN0aW9uICh0KSB7XHJcbiAgICBmdW5jdGlvbiBlKCkge1xyXG4gICAgICAgIHZhciBlID0gKG51bGwgIT09IHQgJiYgdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSB8fCB0aGlzO1xyXG4gICAgICAgIGUuaXNPcGVuUHJlTG9hZCA9ICExO1xyXG4gICAgICAgIGUuc3R5bGUgPSBudWxsO1xyXG4gICAgICAgIHJldHVybiBlO1xyXG4gICAgfVxyXG4gICAgX19leHRlbmRzKGUsIHQpO1xyXG4gICAgZS5wcm90b3R5cGUubG9hZEFkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmFkVW5pdElkKSB7XHJcbiAgICAgICAgICAgIGlmIChyICYmIHIuY3JlYXRlQmFubmVyQWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0ID0gci5nZXRTeXN0ZW1JbmZvU3luYygpLndpbmRvd1dpZHRoO1xyXG4gICAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLnN0eWxlIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgdmFyIGkgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWRVbml0SWQ6IHRoaXMuYWRVbml0SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogZS5sZWZ0IHx8IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogZS50b3AgfHwgMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucyA9IHIuY3JlYXRlQmFubmVyQWQoaSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hZElucy5vbkxvYWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkSW5zLm9uTG9hZCh0aGlzLm9uTG9hZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hZElucy5vblJlc2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMub25SZXNpemUodGhpcy5vblJlc2l6ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hZElucy5vbkVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZElucy5vbkVycm9yKHRoaXMub25FcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCLlvZPliY3lubPlj7DkuI3mlK/mjIHliJvlu7piYW5uZXJcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiUVEgQmFubmVyIElE5Li656m6XCIpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5zaG93QmFubmVyID0gZnVuY3Rpb24gKHQsIGUsIGkpIHtcclxuICAgICAgICB2YXIgbyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5zaG93Q2FsbGJhY2sgPSBlO1xyXG4gICAgICAgIHRoaXMuZXJyb3JDYWxsYmFjayA9IGk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNDYW5TaG93KSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5hZElucykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKHRoaXMuYWRVbml0SWQsIFwiOuacquWIm+W7uu+8jOaJp+ihjOWIm+W7ulwiKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNBdXRvU2hvdyA9ICEwO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9hZEFkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNDb25zdW1lKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlQ3JlYXRlQWQoITApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0xvYWRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4odGhpcy5hZFVuaXRJZCwgXCI65pyq5Yqg6L295a6M5oiQ77yM56iN562JXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAodGhpcy5pc0F1dG9TaG93ID0gITApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hZElucyAmJiB0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IHQudG9wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkSW5zLnN0eWxlLnRvcCA9IHQudG9wO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IHQubGVmdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZElucy5zdHlsZS5sZWZ0ID0gdC5sZWZ0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IHQud2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMuc3R5bGUud2lkdGggPSB0LndpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNDb25zdW1lID0gITE7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMuc2hvdykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IHRoaXMuYWRJbnMuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuICYmIG4udGhlblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5pc0NvbnN1bWUgPSAhMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoby5zaG93Q2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5zaG93Q2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5zaG93Q2FsbGJhY2sgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAodCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihvLmFkVW5pdElkLCBcIjpzaG936ZSZ6K+v77yM6YeN5paw5Yqg6L29XCIsIHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8ucmVDcmVhdGVBZCghMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAoY29uc29sZS53YXJuKHRoaXMuYWRVbml0SWQsIFwiOnNob3fmmL7npLrlpLHotKXvvIzph43mlrDliqDovb1cIiksIHRoaXMucmVDcmVhdGVBZCghMCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2Fybih0aGlzLmFkVW5pdElkLCBcIjrlvZPliY3lub/lkYrnpoHmraLmmL7npLpcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLmZvcmJpZGRlbkJhbm5lciA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgdGhpcy5pc0NhblNob3cgPSAhdDtcclxuICAgICAgICBpZiAodCAmJiB0aGlzLmlzQ29uc3VtZSkge1xyXG4gICAgICAgICAgICB0aGlzLmhpZGVCYW5uZXIoITEpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5oaWRlQmFubmVyID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICB0ICYmIHRoaXMuaXNDb25zdW1lXHJcbiAgICAgICAgICAgID8gKHRoaXMuZGVzdHJveUFkKCksIHRoaXMucmVDcmVhdGVBZCghMSkpXHJcbiAgICAgICAgICAgIDogdGhpcy5hZElucyAmJiB0aGlzLmFkSW5zLmhpZGUgJiYgdGhpcy5hZElucy5oaWRlKCk7XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUub25BZFJlc2l6ZSA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKFwib25CYW5uZXJSZXNpemVcIiwgdCk7XHJcbiAgICAgICAgdmFyIGUgPSByLmdldFN5c3RlbUluZm9TeW5jKCk7XHJcbiAgICAgICAgdmFyIGkgPSBlLndpbmRvd1dpZHRoO1xyXG4gICAgICAgIHZhciBvID0gZS53aW5kb3dIZWlnaHQ7XHJcbiAgICAgICAgdmFyIG4gPSB0aGlzLnN0eWxlIHx8IHt9O1xyXG4gICAgICAgIG51bGwgIT0gbi50b3AgPyAodGhpcy5hZElucy5zdHlsZS50b3AgPSBuLnRvcCkgOiAodGhpcy5hZElucy5zdHlsZS50b3AgPSBNYXRoLnJvdW5kKG8gLSB0LmhlaWdodCArIDAuMSkpO1xyXG4gICAgICAgIG51bGwgIT0gbi5sZWZ0XHJcbiAgICAgICAgICAgID8gKHRoaXMuYWRJbnMuc3R5bGUubGVmdCA9IG4ubGVmdClcclxuICAgICAgICAgICAgOiAodGhpcy5hZElucy5zdHlsZS5sZWZ0ID0gTWF0aC5yb3VuZCgoaSAtIHQud2lkdGgpIC8gMiArIDAuMSkpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnJlQ3JlYXRlQWQgPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciBlID0gdGhpcztcclxuICAgICAgICB0aGlzLmRlc3Ryb3lBZCgpO1xyXG4gICAgICAgIHRoaXMuaXNBdXRvU2hvdyA9IHQ7XHJcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGUubG9hZEFkKCk7XHJcbiAgICAgICAgfSwgMTAwKTtcclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5kZXN0cm95QWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdC5wcm90b3R5cGUuZGVzdHJveUFkLmNhbGwodGhpcyk7XHJcbiAgICAgICAgaWYgKHRoaXMuYWRJbnMpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMub2ZmTG9hZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucy5vZmZMb2FkKHRoaXMub25Mb2FkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5hZElucy5vZmZSZXNpemUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMub2ZmUmVzaXplKHRoaXMub25SZXNpemUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFkSW5zLm9mZkVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkSW5zLm9mZkVycm9yKHRoaXMub25FcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMuZGVzdHJveSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucy5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5hZElucyA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLmF1dG9TaG93ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQXV0b1Nob3cpIHtcclxuICAgICAgICAgICAgdGhpcy5pc0F1dG9TaG93ID0gITE7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd0Jhbm5lcih0aGlzLnN0eWxlLCB0aGlzLnNob3dDYWxsYmFjaywgdGhpcy5lcnJvckNhbGxiYWNrKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUub25BZExvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5hZFVuaXRJZCwgXCI6PT09b25BZGxvYWQ9PT1cIik7XHJcbiAgICAgICAgdGhpcy5pc0NvbnN1bWUgPSAhMTtcclxuICAgICAgICB0aGlzLmlzTG9hZGVkID0gITA7XHJcbiAgICAgICAgdGhpcy5hdXRvU2hvdygpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLm9uQWRFcnJvciA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKFwib25BZEVycm9yXCIsIHRoaXMuYWRVbml0SWQsIHQpO1xyXG4gICAgICAgIGlmICh0aGlzLmVycm9yQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgdGhpcy5lcnJvckNhbGxiYWNrKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZGVzdHJveUFkKCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGU7XHJcbn0pKCRiYXNlQWQuQmFzZUFkKTtcclxuZXhwb3J0cy5RUUJhbm5lciA9IGE7XHJcbiJdfQ==