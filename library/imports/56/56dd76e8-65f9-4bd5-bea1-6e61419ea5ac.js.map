{"version":3,"sources":["assets\\game_script\\scripts\\EquipmentItem.js"],"names":["o","$assetsLoader","require","$assetsMap","$resUtil","$eventManager","$popupManager","$remoteAudio","$configContext","$equipmentContext","$localEventName","$gameGemInfo","$startView","g","cc","_decorator","_","ccclass","k","property","v","t","e","apply","arguments","equipmentGem","equipmentIcon","equipmentLevel","equipmentDot","equipmentAnims","__extends","prototype","start","render","on","RENDER_GEM","RENDER_DOT","renderDot","EQUIP_UPGRADE","upgradeAnim","children","Node","EventType","TOUCH_END","touchItem","onDestroy","off","isValid","i","n","getComponent","dragonBones","ArmatureDisplay","active","playAnimation","once","EventObject","COMPLETE","length","instance","playEffectMusic","indexOf","target","PopupManager","open","AssetsMap","PopUpBundles","prefabs","assetsList","EquipmentInfoView","part","MenuType","Role","Ins","checkPartEquipUpgrade","getGrade","Sprite","loadRes","BundleNames","Public","SpriteFrame","spriteFrame","ResUtil","assignWith","node","s","equipmentMap","get","Label","string","c","getGemList","u","gemConfigs","find","id","color","GameGemInfo","gemColor","Grade","d","__decorate","Component","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var o;\r\nvar $assetsLoader = require(\"./AssetsLoader\");\r\nvar $assetsMap = require(\"./AssetsMap\");\r\nvar $resUtil = require(\"./ResUtil\");\r\nvar $eventManager = require(\"./EventManager\");\r\nvar $popupManager = require(\"./PopupManager\");\r\nvar $remoteAudio = require(\"./RemoteAudio\");\r\nvar $configContext = require(\"./ConfigContext\");\r\nvar $equipmentContext = require(\"./EquipmentContext\");\r\nvar $localEventName = require(\"./LocalEventName\");\r\nvar $gameGemInfo = require(\"./GameGemInfo\");\r\nvar $startView = require(\"./StartView\");\r\nvar g = cc._decorator;\r\nvar _ = g.ccclass;\r\nvar k = g.property;\r\nvar v = (function (t) {\r\n    function e() {\r\n        var e = (null !== t && t.apply(this, arguments)) || this;\r\n        e.equipmentGem = null;\r\n        e.equipmentIcon = null;\r\n        e.equipmentLevel = null;\r\n        e.equipmentDot = null;\r\n        e.equipmentAnims = null;\r\n        return e;\r\n    }\r\n    __extends(e, t);\r\n    e.prototype.start = function () {\r\n        this.render();\r\n        $eventManager.default.on($localEventName.default.RENDER_GEM, this.render, this);\r\n        $eventManager.default.on($localEventName.default.RENDER_DOT, this.renderDot, this);\r\n        $eventManager.default.on($localEventName.default.EQUIP_UPGRADE, this.upgradeAnim, this);\r\n        for (var t = 0; t < 6; t++) {\r\n            this.equipmentGem.children[t].on(cc.Node.EventType.TOUCH_END, this.touchItem, this);\r\n        }\r\n    };\r\n    e.prototype.onDestroy = function () {\r\n        $eventManager.default.off($localEventName.default.RENDER_GEM, this.render, this);\r\n        $eventManager.default.off($localEventName.default.RENDER_DOT, this.renderDot, this);\r\n        $eventManager.default.off($localEventName.default.EQUIP_UPGRADE, this.upgradeAnim, this);\r\n        for (var t = 0; t < 6; t++) {\r\n            if (cc.isValid(this.equipmentGem)) {\r\n                this.equipmentGem.children[t].off(cc.Node.EventType.TOUCH_END, this.touchItem, this);\r\n            }\r\n        }\r\n    };\r\n    e.prototype.upgradeAnim = function (t) {\r\n        var e = function (e) {\r\n            var o = i.equipmentAnims.children[t[e] - 1];\r\n            var n = o.getComponent(dragonBones.ArmatureDisplay);\r\n            o.active = !0;\r\n            n.playAnimation(\"stand\", 1);\r\n            n.once(\r\n                dragonBones.EventObject.COMPLETE,\r\n                function () {\r\n                    o.active = !1;\r\n                },\r\n                i\r\n            );\r\n        };\r\n        var i = this;\r\n        for (var o = 0; o < t.length; o++) {\r\n            e(o);\r\n        }\r\n    };\r\n    e.prototype.touchItem = function (t) {\r\n        $remoteAudio.default.instance.playEffectMusic(\"Click\");\r\n        var e = this.equipmentGem.children.indexOf(t.target);\r\n        $popupManager.PopupManager.instance.open(\r\n            $assetsMap.AssetsMap.PopUpBundles.prefabs.assetsList.EquipmentInfoView,\r\n            {\r\n                part: e + 1\r\n            }\r\n        );\r\n    };\r\n    e.prototype.renderDot = function (t) {\r\n        if (t === $startView.MenuType.Role) {\r\n            for (var e = 0; e < 6; e++) {\r\n                this.equipmentDot.children[e].active = $equipmentContext.default.Ins.checkPartEquipUpgrade(e + 1);\r\n            }\r\n        }\r\n    };\r\n    e.prototype.render = function () {\r\n        var t = this;\r\n        var e = function (e) {\r\n            var o = $equipmentContext.default.Ins.getGrade(e);\r\n            var n = i.equipmentIcon.children[e - 1].getComponent(cc.Sprite);\r\n            $assetsLoader.default.instance.loadRes(\r\n                $assetsMap.BundleNames.Public,\r\n                [\"/textures/gem/e_\" + e + \"_\" + o, \"/textures/gem/k\" + o],\r\n                cc.SpriteFrame,\r\n                null,\r\n                function (e, i) {\r\n                    if (i[0] && cc.isValid(n)) {\r\n                        n.spriteFrame = $resUtil.ResUtil.assignWith(i[1], t.node);\r\n                        n.node.children[0].getComponent(cc.Sprite).spriteFrame = $resUtil.ResUtil.assignWith(\r\n                            i[0],\r\n                            t.node\r\n                        );\r\n                    }\r\n                }\r\n            );\r\n            var s = $equipmentContext.default.Ins.equipmentMap.get(e);\r\n            i.equipmentLevel.children[e - 1].getComponent(cc.Label).string = \"等级:\" + s;\r\n            for (\r\n                var c = $equipmentContext.default.Ins.getGemList(e),\r\n                    u = function (t) {\r\n                        var o = i.equipmentGem.children[e - 1].children[0].children[t];\r\n                        if (c[t] && 0 !== c[t]) {\r\n                            o.active = !0;\r\n                            var n = $configContext.default.instance.gemConfigs.find(function (e) {\r\n                                return e.id === c[t];\r\n                            });\r\n                            o.color = $gameGemInfo.GameGemInfo.gemColor[n.Grade - 1];\r\n                        } else {\r\n                            o.active = !1;\r\n                        }\r\n                    },\r\n                    d = 0;\r\n                d < 5;\r\n                d++\r\n            )\r\n                u(d);\r\n        };\r\n        var i = this;\r\n        for (var o = 1; o <= 6; o++) {\r\n            e(o);\r\n        }\r\n    };\r\n    __decorate([k(cc.Node)], e.prototype, \"equipmentGem\", void 0);\r\n    __decorate([k(cc.Node)], e.prototype, \"equipmentIcon\", void 0);\r\n    __decorate([k(cc.Node)], e.prototype, \"equipmentLevel\", void 0);\r\n    __decorate([k(cc.Node)], e.prototype, \"equipmentDot\", void 0);\r\n    __decorate([k(cc.Node)], e.prototype, \"equipmentAnims\", void 0);\r\n    return __decorate([_], e);\r\n})(cc.Component);\r\nexports.default = v;\r\n"]}