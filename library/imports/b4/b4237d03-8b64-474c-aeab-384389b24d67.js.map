{"version":3,"sources":["assets\\game_script\\scripts\\Gun_4.js"],"names":["o","$assetsLoader","require","$assetsMap","$resUtil","$eventManager","$remoteAudio","$seedUtil","$util","$configContext","$globalParam","$localEventName","$roleContext","$baseBullet","$gameContext","$gameGemInfo","$gameSkillInfo","$baseGun","b","cc","Vec3","ZERO","w","t","e","i","call","skin4AtkLeftCd","skin4AtkCurrCount","skillId","skillParam","ins","skillInfo","getSkillById","__extends","prototype","updateF","isAttacking","isGamePuase","timeLeft","currSkinInfo","skin","skinAtkTargetCount","sendSkin4Bullet","skillCD","Skill4Param","FINAL","send","RENDER_SKILL_CD_INFO","starGun","getRangeRankEnemy","pointNode","skinAtkRange","SEND_SKILL_ANIM","getButtlePool","BulletType","s_bullet_4","instance","getRes","BundleNames","Game","AssetsMap","GameBundles","prefabs","assetsList","SBullet_4","ResUtil","instantiate","buttleLayer","parent","getComponent","x","getPosition","y","setPosition","clone","initButtle","insert","skinAtkCd","skillAtkRange","GameGemInfo","hasGem","GemType","AddSkill","probability","get1","schedulesOnce","sendButtle","getRangeRandomEnemyLayer","isValid","node","createButtle","n","thunderComboCount","thunder_bullet","Bullet_9","skillSpecialitys","basicSkillConfigMap","get","skill_tpye","position","playEffectMusicRestrict","targetEnemy","targetPos","isExtra","setAnimation","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var o;\r\nvar $assetsLoader = require(\"./AssetsLoader\");\r\nvar $assetsMap = require(\"./AssetsMap\");\r\nvar $resUtil = require(\"./ResUtil\");\r\nvar $eventManager = require(\"./EventManager\");\r\nvar $remoteAudio = require(\"./RemoteAudio\");\r\nvar $seedUtil = require(\"./SeedUtil\");\r\nvar $util = require(\"./Util\");\r\nvar $configContext = require(\"./ConfigContext\");\r\nvar $globalParam = require(\"./GlobalParam\");\r\nvar $localEventName = require(\"./LocalEventName\");\r\nvar $roleContext = require(\"./RoleContext\");\r\nvar $baseBullet = require(\"./BaseBullet\");\r\nvar $gameContext = require(\"./GameContext\");\r\nvar $gameGemInfo = require(\"./GameGemInfo\");\r\nvar $gameSkillInfo = require(\"./GameSkillInfo\");\r\nvar $baseGun = require(\"./BaseGun\");\r\nvar b = cc.Vec3.ZERO;\r\nvar w = (function (t) {\r\n    function e(e) {\r\n        var i = t.call(this, e) || this;\r\n        i.skin4AtkLeftCd = 0;\r\n        i.skin4AtkCurrCount = 0;\r\n        i.skillId = 61;\r\n        i.skillParam = $gameContext.default.ins.skillInfo.getSkillById(i.skillId);\r\n        return i;\r\n    }\r\n    __extends(e, t);\r\n    e.prototype.updateF = function (e) {\r\n        t.prototype.updateF.call(this, e);\r\n        if (!(this.isAttacking || $globalParam.default.isGamePuase)) {\r\n            this.timeLeft -= e;\r\n            if (\r\n                4 === $roleContext.default.ins.currSkinInfo.skin &&\r\n                this.skin4AtkCurrCount >= $gameContext.default.ins.skillInfo.skinAtkTargetCount\r\n            ) {\r\n                this.skin4AtkLeftCd -= e;\r\n                if (this.skin4AtkLeftCd <= 0) {\r\n                    this.sendSkin4Bullet();\r\n                }\r\n            }\r\n            this.timeLeft <= 0\r\n                ? ((this.isAttacking = !0),\r\n                  (this.timeLeft = this.skillParam.skillCD[$gameSkillInfo.Skill4Param.FINAL]),\r\n                  $eventManager.default.send($localEventName.default.RENDER_SKILL_CD_INFO, this.skillId, 0, -1),\r\n                  this.starGun() || ((this.isAttacking = !1), (this.timeLeft = 0)))\r\n                : $eventManager.default.send(\r\n                      $localEventName.default.RENDER_SKILL_CD_INFO,\r\n                      this.skillId,\r\n                      this.timeLeft / this.skillParam.skillCD[$gameSkillInfo.Skill4Param.FINAL],\r\n                      -1\r\n                  );\r\n        }\r\n    };\r\n    e.prototype.sendSkin4Bullet = function () {\r\n        var t = $gameContext.default.ins.getRangeRankEnemy(\r\n            this.pointNode,\r\n            $gameContext.default.ins.skillInfo.skinAtkRange\r\n        );\r\n        if (!t) {\r\n            this.skin4AtkLeftCd = 2;\r\n            return !1;\r\n        }\r\n        $eventManager.default.send($localEventName.default.SEND_SKILL_ANIM);\r\n        var e = $gameContext.default.ins.getButtlePool($baseBullet.BulletType.s_bullet_4);\r\n        if (!e) {\r\n            var i = $assetsLoader.default.instance.getRes(\r\n                $assetsMap.BundleNames.Game,\r\n                $assetsMap.AssetsMap.GameBundles.prefabs.assetsList.SBullet_4\r\n            );\r\n            e = $resUtil.ResUtil.instantiate(i, $gameContext.default.ins.buttleLayer.parent).getComponent(\r\n                $baseBullet.default\r\n            );\r\n        }\r\n        b.x = t.getPosition().x;\r\n        b.y = -350;\r\n        e.setPosition(b.clone());\r\n        e.initButtle(null, this.skillId);\r\n        e.insert($gameContext.default.ins.buttleLayer);\r\n        this.skin4AtkCurrCount = 0;\r\n        this.skin4AtkLeftCd = $gameContext.default.ins.skillInfo.skinAtkCd;\r\n    };\r\n    e.prototype.starGun = function () {\r\n        var t = this;\r\n        var e = $gameContext.default.ins.getRangeRankEnemy(\r\n            this.pointNode,\r\n            this.skillParam.skillAtkRange[$gameSkillInfo.Skill4Param.FINAL]\r\n        );\r\n        if (\r\n            $gameGemInfo.GameGemInfo.ins.hasGem($gameGemInfo.GemType.AddSkill) &&\r\n            $seedUtil.default.probability(100 * $gameGemInfo.GameGemInfo.ins.get1($gameGemInfo.GemType.AddSkill))\r\n        ) {\r\n            for (var i = 0; i < 2; i++) {\r\n                this.schedulesOnce(function () {\r\n                    if (!e) {\r\n                        return !1;\r\n                    }\r\n                    t.sendButtle(e);\r\n                }, 0.2 * i);\r\n            }\r\n        } else {\r\n            {\r\n                if (!e) {\r\n                    return !1;\r\n                }\r\n                this.sendButtle(e);\r\n            }\r\n        }\r\n        this.isAttacking = !1;\r\n        return !0;\r\n    };\r\n    e.prototype.sendButtle = function (t) {\r\n        var e = this;\r\n        var i = function (i) {\r\n            o.schedulesOnce(function () {\r\n                if (i > 0) {\r\n                    t = $gameContext.default.ins.getRangeRandomEnemyLayer(e.pointNode);\r\n                }\r\n                if (t && $util.default.isValid(t.node)) {\r\n                    e.createButtle(t);\r\n                }\r\n            }, 0.3 * i);\r\n        };\r\n        var o = this;\r\n        for (var n = 0; n < this.skillParam.thunderComboCount + 1; n++) {\r\n            i(n);\r\n        }\r\n        this.isAttacking = !1;\r\n    };\r\n    e.prototype.createButtle = function (t) {\r\n        var e = $gameContext.default.ins.getButtlePool($baseBullet.BulletType.thunder_bullet);\r\n        if (!e) {\r\n            var i = $assetsLoader.default.instance.getRes(\r\n                $assetsMap.BundleNames.Game,\r\n                $assetsMap.AssetsMap.GameBundles.prefabs.assetsList.Bullet_9\r\n            );\r\n            (e = $resUtil.ResUtil.instantiate(i, $gameContext.default.ins.buttleLayer.parent).getComponent(\r\n                $baseBullet.default\r\n            )).skillSpecialitys = $configContext.default.instance.basicSkillConfigMap.get(this.skillId).skill_tpye;\r\n        }\r\n        e.setPosition(t.node.position.clone());\r\n        $remoteAudio.default.instance.playEffectMusicRestrict(\"Lightningstrike\", 0.3);\r\n        e.targetEnemy = t;\r\n        e.targetPos = t.getPosition().clone();\r\n        e.isExtra = !1;\r\n        e.initButtle(null, this.skillId);\r\n        e.insert($gameContext.default.ins.buttleLayer);\r\n        e.setAnimation(\"\");\r\n        this.skin4AtkCurrCount++;\r\n    };\r\n    return e;\r\n})($baseGun.default);\r\nexports.default = w;\r\n"]}