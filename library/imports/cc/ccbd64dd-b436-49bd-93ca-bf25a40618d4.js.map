{"version":3,"sources":["assets\\game_script\\scripts\\core\\ApiClient.js"],"names":["Config","require","Storage","withTimeout","promise","ms","Promise","resolve","reject","t","setTimeout","Error","then","v","clearTimeout","e","request","path","method","data","headers","url","API_BASE","replace","token","getToken","opts","Object","assign","body","JSON","stringify","fetch","REQ_TIMEOUT","res","ok","text","status","json","module","exports","get","p","post","d"],"mappings":";;;;;;+CACA;;;;;;;;AADA;AACA,IAAMA,MAAM,GAAIC,OAAO,CAAC,UAAD,CAAvB;;AACA,IAAMC,OAAO,GAAGD,OAAO,CAAC,WAAD,CAAvB;;AAEA,SAASE,WAAT,CAAqBC,OAArB,EAA8BC,EAA9B,EAAiC;EAC/B,OAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAASC,MAAT,EAAkB;IACnC,IAAMC,CAAC,GAAGC,UAAU,CAAC;MAAA,OAAIF,MAAM,CAAC,IAAIG,KAAJ,CAAU,SAAV,CAAD,CAAV;IAAA,CAAD,EAAmCN,EAAnC,CAApB;IACAD,OAAO,CAACQ,IAAR,CAAa,UAAAC,CAAC,EAAE;MAACC,YAAY,CAACL,CAAD,CAAZ;MAAgBF,OAAO,CAACM,CAAD,CAAP;IAAY,CAA7C,EAA8C,UAAAE,CAAC,EAAE;MAACD,YAAY,CAACL,CAAD,CAAZ;MAAgBD,MAAM,CAACO,CAAD,CAAN;IAAW,CAA7E;EACD,CAHM,CAAP;AAID;;SAEcC;;;;;wEAAf,iBAAuBC,IAAvB;IAAA;;IAAA;MAAA;QAAA;UAAA;YAAA,0BAAqE,EAArE,6BAA8BC,MAA9B,EAA8BA,MAA9B,4BAAqC,KAArC,iCAA4CC,IAA5C,EAA4CA,IAA5C,0BAAiD,IAAjD,kCAAuDC,OAAvD,EAAuDA,OAAvD,6BAA+D,EAA/D;YACQC,GADR,GACcrB,MAAM,CAACsB,QAAP,GAAkBL,IAAI,CAACM,OAAL,CAAa,MAAb,EAAoB,EAApB,CADhC;YAEQC,KAFR,GAEgBtB,OAAO,CAACuB,QAAR,EAFhB;YAGQC,IAHR,GAGe;cACXR,MAAM,EAANA,MADW;cAEXE,OAAO,EAAEO,MAAM,CAACC,MAAP;gBACP,gBAAgB,kBADT;gBAEP,UAAU;cAFH,GAGHJ,KAAK,GAAG;gBAAC,iBAAiB,YAAUA;cAA5B,CAAH,GAAwC,EAH1C,GAINJ,OAJM;YAFE,CAHf;YAWE,IAAGD,IAAH,EAASO,IAAI,CAACG,IAAL,GAAYC,IAAI,CAACC,SAAL,CAAeZ,IAAf,CAAZ;YAXX;YAAA,OAYoBhB,WAAW,CAAC6B,KAAK,CAACX,GAAD,EAAMK,IAAN,CAAN,EAAmB1B,MAAM,CAACiC,WAA1B,CAZ/B;;UAAA;YAYQC,GAZR;;YAAA,IAaMA,GAAG,CAACC,EAbV;cAAA;cAAA;YAAA;;YAAA;YAAA,OAcuBD,GAAG,CAACE,IAAJ,YAAiB;cAAA,OAAK,EAAL;YAAA,CAAjB,CAdvB;;UAAA;YAcUA,IAdV;YAAA,MAeU,IAAIzB,KAAJ,WAAkBuB,GAAG,CAACG,MAAtB,UAAiCD,IAAjC,CAfV;;UAAA;YAAA,iCAiBSF,GAAG,CAACI,IAAJ,EAjBT;;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA;;;;AAoBAC,MAAM,CAACC,OAAP,GAAiB;EACfC,GAAG,EAAE,aAACC,CAAD;IAAA,OAAK1B,OAAO,CAAC0B,CAAD,EAAG;MAACxB,MAAM,EAAC;IAAR,CAAH,CAAZ;EAAA,CADU;EAEfyB,IAAI,EAAC,cAACD,CAAD,EAAGE,CAAH;IAAA,OAAO5B,OAAO,CAAC0B,CAAD,EAAG;MAACxB,MAAM,EAAC,MAAR;MAAgBC,IAAI,EAACyB;IAArB,CAAH,CAAd;EAAA;AAFU,CAAjB","sourceRoot":"/","sourcesContent":["// assets/scripts/core/ApiClient.js\nconst Config  = require('./Config');\nconst Storage = require('./Storage');\n\nfunction withTimeout(promise, ms){\n  return new Promise((resolve,reject)=>{\n    const t = setTimeout(()=>reject(new Error('timeout')), ms);\n    promise.then(v=>{clearTimeout(t);resolve(v);},e=>{clearTimeout(t);reject(e);});\n  });\n}\n\nasync function request(path, {method='GET', data=null, headers={}} = {}){\n  const url = Config.API_BASE + path.replace(/^\\/+/,'');\n  const token = Storage.getToken();\n  const opts = {\n    method,\n    headers: Object.assign({\n      'Content-Type': 'application/json',\n      'Accept': 'application/json',\n      ...(token ? {'Authorization': 'Bearer '+token} : {})\n    }, headers)\n  };\n  if(data) opts.body = JSON.stringify(data);\n  const res = await withTimeout(fetch(url, opts), Config.REQ_TIMEOUT);\n  if(!res.ok){\n    const text = await res.text().catch(()=> '');\n    throw new Error(`HTTP ${res.status}: ${text}`);\n  }\n  return res.json();\n}\n\nmodule.exports = {\n  get: (p)=>request(p,{method:'GET'}),\n  post:(p,d)=>request(p,{method:'POST', data:d}),\n};\n"]}