
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/ChooseSkillView.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'a05746qtj9FbrLbiFZrBoke', 'ChooseSkillView');
// game_script/scripts/ChooseSkillView.js

"use strict";

var o;

var $assetsLoader = require("./AssetsLoader");

var $assetsMap = require("./AssetsMap");

var $resUtil = require("./ResUtil");

var $eventManager = require("./EventManager");

var $uIManager = require("./UIManager");

var $popupView = require("./PopupView");

var $platform = require("./Platform");

var $remoteAudio = require("./RemoteAudio");

var $aD = require("./AD");

var $adService = require("./AdService");

var $configContext = require("./ConfigContext");

var $localEventName = require("./LocalEventName");

var $userDataContext = require("./UserDataContext");

var $gameContext = require("./GameContext");

var v = cc._decorator;
var b = v.ccclass;
var w = v.property;

var A = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.tempNode = null;
    e.contentLayer = null;
    e.btnAgin = null;
    e.tipLabel = null;
    e.btnRefresh = null;
    e.coinAdLable = null;
    e.chooseNode = [];
    e.isChoosed = !1;
    e.isChooseAgin = !1;
    e.count = 3;
    e.chooseCount = 0;
    return e;
  }

  __extends(e, t);

  e.prototype.onResetView = function () {
    $remoteAudio["default"].instance.playEffectMusic("levelup");
    var t = this.uiParam.param.ids;
    this.createChooseItem(t);
    this.renderBtn();
    this.renderAdCoin();
  };

  e.prototype.createChooseItem = function (t) {
    for (var e = 0; e < t.length; e++) {
      var i = t[e];
      var o = cc.instantiate(this.tempNode);
      o.skill_id = i;
      o.parent = this.contentLayer;
      o.active = !0;
      o.on("click", this.clickItem, this);
      this.chooseNode.push(o);
      this.renderItem(i, o);
    }

    this.renderAgin();
  };

  e.prototype.renderAgin = function () {
    this.isChooseAgin || $gameContext["default"].ins.aginChooseSkillCount >= this.count ? (this.btnAgin.active = !1, this.tipLabel.node.active = !1) : this.tipLabel.string = "当局剩余观看次数" + (this.count - $gameContext["default"].ins.aginChooseSkillCount) + "/" + this.count;
  };

  e.prototype.renderBtn = function () {
    var t = $userDataContext["default"].Ins.checkAdCoin(-1);
    this.btnRefresh.children[0].active = !t;
    this.btnAgin.children[0].active = !t;
    this.btnRefresh.children[1].active = t;
    this.btnAgin.children[1].active = t;
  };

  e.prototype.addEvent = function () {
    this.btnAgin.on("click", this.clickAgin, this);
    this.btnRefresh.on("click", this.clickRefresh, this);
  };

  e.prototype.removeEvent = function () {
    this.btnAgin.off("click", this.clickAgin, this);
    this.btnRefresh.off("click", this.clickRefresh, this);
  };

  e.prototype.clickRefresh = function () {
    var e = this;

    if ($userDataContext["default"].Ins.opearAdCoin(-1)) {
      var i = $gameContext["default"].ins.createNextSkills();

      if (0 === i.length) {
        $uIManager.UIManager.instance.showToast("没有技能可选了");
        return void t.prototype.onClickClose.call(this);
      }

      this.contentLayer.destroyAllChildren();
      this.createChooseItem(i);
      this.renderBtn();
      this.renderAdCoin();
    } else {
      $adService["default"].Ins.showRewardedVideo(function () {
        if ($platform.Platform.currPlatForm === $platform.PlatformEnum.TOU_TIAO) {
          $aD["default"].toutiao.report("Skill_Refresh");
        }

        var i = $gameContext["default"].ins.createNextSkills();

        if (0 === i.length) {
          $uIManager.UIManager.instance.showToast("没有技能可选了");
          return void t.prototype.onClickClose.call(e);
        }

        e.contentLayer.destroyAllChildren();
        e.createChooseItem(i);
        e.renderBtn();
      });
    }
  };

  e.prototype.clickAgin = function () {
    var t = this;
    $userDataContext["default"].Ins.opearAdCoin(-1) ? ($gameContext["default"].ins.aginChooseSkillCount++, this.isChooseAgin = !0, this.renderAgin(), this.renderBtn(), this.renderAdCoin()) : $adService["default"].Ins.showRewardedVideo(function () {
      if ($platform.Platform.currPlatForm === $platform.PlatformEnum.TOU_TIAO) {
        $aD["default"].toutiao.report("Skill_again");
      }

      $gameContext["default"].ins.aginChooseSkillCount++;
      t.isChooseAgin = !0;
      t.renderAgin();
      t.renderBtn();
    });
  };

  e.prototype.renderItem = function (t, e) {
    var i = this;
    var o = $configContext["default"].instance.skillConfigsMap.get(t);
    var n = e.children[0].getComponent(cc.Sprite);
    $assetsLoader["default"].instance.loadRes($assetsMap.BundleNames.Public_Res, ["/skills/" + o.icon], cc.SpriteFrame, null, function (t, e) {
      var o = e[0];

      if (o && cc.isValid(n)) {
        n.spriteFrame = $resUtil.ResUtil.assignWith(o, i.node);
      }
    });
    var s = o.skill_text;

    if (o.skill_changetext.length > 0 && !$gameContext["default"].ins.chooseSkillRecord.has(o.skill_changetext[0])) {
      s = o.skill_text + o.skill_changetext[1];
    }

    e.children[1].getComponent(cc.Label).string = o.name;
    e.children[2].getComponent(cc.Label).string = s;
  };

  e.prototype.clickItem = function (e) {
    if (!this.isChoosed) {
      $remoteAudio["default"].instance.playEffectMusic("Click");
      $gameContext["default"].ins.skillInfo.skillCount++;
      this.isChoosed = !0;
      var i = e.node.skill_id;
      $eventManager["default"].send($localEventName["default"].CHOOSE_SKILL, i);

      if (this.isChooseAgin && 0 === this.chooseCount) {
        var o = $gameContext["default"].ins.createNextSkills();

        if (0 === o.length) {
          $uIManager.UIManager.instance.showToast("没有技能可选了");
          return void t.prototype.onClickClose.call(this);
        }

        this.contentLayer.destroyAllChildren();
        this.createChooseItem(o);
        this.isChoosed = !1;
        this.renderAgin();
      }

      this.chooseCount++;

      if (1 === this.chooseCount && !this.isChooseAgin || 2 === this.chooseCount) {
        t.prototype.onClickClose.call(this);
      }
    }
  };

  e.prototype.renderAdCoin = function () {
    this.coinAdLable.string = $userDataContext["default"].Ins.adCoin.toString();
  };

  __decorate([w(cc.Node)], e.prototype, "tempNode", void 0);

  __decorate([w(cc.Node)], e.prototype, "contentLayer", void 0);

  __decorate([w(cc.Node)], e.prototype, "btnAgin", void 0);

  __decorate([w(cc.Label)], e.prototype, "tipLabel", void 0);

  __decorate([w(cc.Node)], e.prototype, "btnRefresh", void 0);

  __decorate([w(cc.Label)], e.prototype, "coinAdLable", void 0);

  return __decorate([b], e);
}($popupView.PopupView);

exports["default"] = A;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXENob29zZVNraWxsVmlldy5qcyJdLCJuYW1lcyI6WyJvIiwiJGFzc2V0c0xvYWRlciIsInJlcXVpcmUiLCIkYXNzZXRzTWFwIiwiJHJlc1V0aWwiLCIkZXZlbnRNYW5hZ2VyIiwiJHVJTWFuYWdlciIsIiRwb3B1cFZpZXciLCIkcGxhdGZvcm0iLCIkcmVtb3RlQXVkaW8iLCIkYUQiLCIkYWRTZXJ2aWNlIiwiJGNvbmZpZ0NvbnRleHQiLCIkbG9jYWxFdmVudE5hbWUiLCIkdXNlckRhdGFDb250ZXh0IiwiJGdhbWVDb250ZXh0IiwidiIsImNjIiwiX2RlY29yYXRvciIsImIiLCJjY2NsYXNzIiwidyIsInByb3BlcnR5IiwiQSIsInQiLCJlIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJ0ZW1wTm9kZSIsImNvbnRlbnRMYXllciIsImJ0bkFnaW4iLCJ0aXBMYWJlbCIsImJ0blJlZnJlc2giLCJjb2luQWRMYWJsZSIsImNob29zZU5vZGUiLCJpc0Nob29zZWQiLCJpc0Nob29zZUFnaW4iLCJjb3VudCIsImNob29zZUNvdW50IiwiX19leHRlbmRzIiwicHJvdG90eXBlIiwib25SZXNldFZpZXciLCJpbnN0YW5jZSIsInBsYXlFZmZlY3RNdXNpYyIsInVpUGFyYW0iLCJwYXJhbSIsImlkcyIsImNyZWF0ZUNob29zZUl0ZW0iLCJyZW5kZXJCdG4iLCJyZW5kZXJBZENvaW4iLCJsZW5ndGgiLCJpIiwiaW5zdGFudGlhdGUiLCJza2lsbF9pZCIsInBhcmVudCIsImFjdGl2ZSIsIm9uIiwiY2xpY2tJdGVtIiwicHVzaCIsInJlbmRlckl0ZW0iLCJyZW5kZXJBZ2luIiwiaW5zIiwiYWdpbkNob29zZVNraWxsQ291bnQiLCJub2RlIiwic3RyaW5nIiwiSW5zIiwiY2hlY2tBZENvaW4iLCJjaGlsZHJlbiIsImFkZEV2ZW50IiwiY2xpY2tBZ2luIiwiY2xpY2tSZWZyZXNoIiwicmVtb3ZlRXZlbnQiLCJvZmYiLCJvcGVhckFkQ29pbiIsImNyZWF0ZU5leHRTa2lsbHMiLCJVSU1hbmFnZXIiLCJzaG93VG9hc3QiLCJvbkNsaWNrQ2xvc2UiLCJjYWxsIiwiZGVzdHJveUFsbENoaWxkcmVuIiwic2hvd1Jld2FyZGVkVmlkZW8iLCJQbGF0Zm9ybSIsImN1cnJQbGF0Rm9ybSIsIlBsYXRmb3JtRW51bSIsIlRPVV9USUFPIiwidG91dGlhbyIsInJlcG9ydCIsInNraWxsQ29uZmlnc01hcCIsImdldCIsIm4iLCJnZXRDb21wb25lbnQiLCJTcHJpdGUiLCJsb2FkUmVzIiwiQnVuZGxlTmFtZXMiLCJQdWJsaWNfUmVzIiwiaWNvbiIsIlNwcml0ZUZyYW1lIiwiaXNWYWxpZCIsInNwcml0ZUZyYW1lIiwiUmVzVXRpbCIsImFzc2lnbldpdGgiLCJzIiwic2tpbGxfdGV4dCIsInNraWxsX2NoYW5nZXRleHQiLCJjaG9vc2VTa2lsbFJlY29yZCIsImhhcyIsIkxhYmVsIiwibmFtZSIsInNraWxsSW5mbyIsInNraWxsQ291bnQiLCJzZW5kIiwiQ0hPT1NFX1NLSUxMIiwiYWRDb2luIiwidG9TdHJpbmciLCJfX2RlY29yYXRlIiwiTm9kZSIsIlBvcHVwVmlldyIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsQ0FBSjs7QUFDQSxJQUFJQyxhQUFhLEdBQUdDLE9BQU8sQ0FBQyxnQkFBRCxDQUEzQjs7QUFDQSxJQUFJQyxVQUFVLEdBQUdELE9BQU8sQ0FBQyxhQUFELENBQXhCOztBQUNBLElBQUlFLFFBQVEsR0FBR0YsT0FBTyxDQUFDLFdBQUQsQ0FBdEI7O0FBQ0EsSUFBSUcsYUFBYSxHQUFHSCxPQUFPLENBQUMsZ0JBQUQsQ0FBM0I7O0FBQ0EsSUFBSUksVUFBVSxHQUFHSixPQUFPLENBQUMsYUFBRCxDQUF4Qjs7QUFDQSxJQUFJSyxVQUFVLEdBQUdMLE9BQU8sQ0FBQyxhQUFELENBQXhCOztBQUNBLElBQUlNLFNBQVMsR0FBR04sT0FBTyxDQUFDLFlBQUQsQ0FBdkI7O0FBQ0EsSUFBSU8sWUFBWSxHQUFHUCxPQUFPLENBQUMsZUFBRCxDQUExQjs7QUFDQSxJQUFJUSxHQUFHLEdBQUdSLE9BQU8sQ0FBQyxNQUFELENBQWpCOztBQUNBLElBQUlTLFVBQVUsR0FBR1QsT0FBTyxDQUFDLGFBQUQsQ0FBeEI7O0FBQ0EsSUFBSVUsY0FBYyxHQUFHVixPQUFPLENBQUMsaUJBQUQsQ0FBNUI7O0FBQ0EsSUFBSVcsZUFBZSxHQUFHWCxPQUFPLENBQUMsa0JBQUQsQ0FBN0I7O0FBQ0EsSUFBSVksZ0JBQWdCLEdBQUdaLE9BQU8sQ0FBQyxtQkFBRCxDQUE5Qjs7QUFDQSxJQUFJYSxZQUFZLEdBQUdiLE9BQU8sQ0FBQyxlQUFELENBQTFCOztBQUNBLElBQUljLENBQUMsR0FBR0MsRUFBRSxDQUFDQyxVQUFYO0FBQ0EsSUFBSUMsQ0FBQyxHQUFHSCxDQUFDLENBQUNJLE9BQVY7QUFDQSxJQUFJQyxDQUFDLEdBQUdMLENBQUMsQ0FBQ00sUUFBVjs7QUFDQSxJQUFJQyxDQUFDLEdBQUksVUFBVUMsQ0FBVixFQUFhO0VBQ2xCLFNBQVNDLENBQVQsR0FBYTtJQUNULElBQUlBLENBQUMsR0FBSSxTQUFTRCxDQUFULElBQWNBLENBQUMsQ0FBQ0UsS0FBRixDQUFRLElBQVIsRUFBY0MsU0FBZCxDQUFmLElBQTRDLElBQXBEO0lBQ0FGLENBQUMsQ0FBQ0csUUFBRixHQUFhLElBQWI7SUFDQUgsQ0FBQyxDQUFDSSxZQUFGLEdBQWlCLElBQWpCO0lBQ0FKLENBQUMsQ0FBQ0ssT0FBRixHQUFZLElBQVo7SUFDQUwsQ0FBQyxDQUFDTSxRQUFGLEdBQWEsSUFBYjtJQUNBTixDQUFDLENBQUNPLFVBQUYsR0FBZSxJQUFmO0lBQ0FQLENBQUMsQ0FBQ1EsV0FBRixHQUFnQixJQUFoQjtJQUNBUixDQUFDLENBQUNTLFVBQUYsR0FBZSxFQUFmO0lBQ0FULENBQUMsQ0FBQ1UsU0FBRixHQUFjLENBQUMsQ0FBZjtJQUNBVixDQUFDLENBQUNXLFlBQUYsR0FBaUIsQ0FBQyxDQUFsQjtJQUNBWCxDQUFDLENBQUNZLEtBQUYsR0FBVSxDQUFWO0lBQ0FaLENBQUMsQ0FBQ2EsV0FBRixHQUFnQixDQUFoQjtJQUNBLE9BQU9iLENBQVA7RUFDSDs7RUFDRGMsU0FBUyxDQUFDZCxDQUFELEVBQUlELENBQUosQ0FBVDs7RUFDQUMsQ0FBQyxDQUFDZSxTQUFGLENBQVlDLFdBQVosR0FBMEIsWUFBWTtJQUNsQ2hDLFlBQVksV0FBWixDQUFxQmlDLFFBQXJCLENBQThCQyxlQUE5QixDQUE4QyxTQUE5QztJQUNBLElBQUluQixDQUFDLEdBQUcsS0FBS29CLE9BQUwsQ0FBYUMsS0FBYixDQUFtQkMsR0FBM0I7SUFDQSxLQUFLQyxnQkFBTCxDQUFzQnZCLENBQXRCO0lBQ0EsS0FBS3dCLFNBQUw7SUFDQSxLQUFLQyxZQUFMO0VBQ0gsQ0FORDs7RUFPQXhCLENBQUMsQ0FBQ2UsU0FBRixDQUFZTyxnQkFBWixHQUErQixVQUFVdkIsQ0FBVixFQUFhO0lBQ3hDLEtBQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0QsQ0FBQyxDQUFDMEIsTUFBdEIsRUFBOEJ6QixDQUFDLEVBQS9CLEVBQW1DO01BQy9CLElBQUkwQixDQUFDLEdBQUczQixDQUFDLENBQUNDLENBQUQsQ0FBVDtNQUNBLElBQUl6QixDQUFDLEdBQUdpQixFQUFFLENBQUNtQyxXQUFILENBQWUsS0FBS3hCLFFBQXBCLENBQVI7TUFDQTVCLENBQUMsQ0FBQ3FELFFBQUYsR0FBYUYsQ0FBYjtNQUNBbkQsQ0FBQyxDQUFDc0QsTUFBRixHQUFXLEtBQUt6QixZQUFoQjtNQUNBN0IsQ0FBQyxDQUFDdUQsTUFBRixHQUFXLENBQUMsQ0FBWjtNQUNBdkQsQ0FBQyxDQUFDd0QsRUFBRixDQUFLLE9BQUwsRUFBYyxLQUFLQyxTQUFuQixFQUE4QixJQUE5QjtNQUNBLEtBQUt2QixVQUFMLENBQWdCd0IsSUFBaEIsQ0FBcUIxRCxDQUFyQjtNQUNBLEtBQUsyRCxVQUFMLENBQWdCUixDQUFoQixFQUFtQm5ELENBQW5CO0lBQ0g7O0lBQ0QsS0FBSzRELFVBQUw7RUFDSCxDQVpEOztFQWFBbkMsQ0FBQyxDQUFDZSxTQUFGLENBQVlvQixVQUFaLEdBQXlCLFlBQVk7SUFDakMsS0FBS3hCLFlBQUwsSUFBcUJyQixZQUFZLFdBQVosQ0FBcUI4QyxHQUFyQixDQUF5QkMsb0JBQXpCLElBQWlELEtBQUt6QixLQUEzRSxJQUNRLEtBQUtQLE9BQUwsQ0FBYXlCLE1BQWIsR0FBc0IsQ0FBQyxDQUF4QixFQUE2QixLQUFLeEIsUUFBTCxDQUFjZ0MsSUFBZCxDQUFtQlIsTUFBbkIsR0FBNEIsQ0FBQyxDQURqRSxJQUVPLEtBQUt4QixRQUFMLENBQWNpQyxNQUFkLEdBQ0csY0FBYyxLQUFLM0IsS0FBTCxHQUFhdEIsWUFBWSxXQUFaLENBQXFCOEMsR0FBckIsQ0FBeUJDLG9CQUFwRCxJQUE0RSxHQUE1RSxHQUFrRixLQUFLekIsS0FIakc7RUFJSCxDQUxEOztFQU1BWixDQUFDLENBQUNlLFNBQUYsQ0FBWVEsU0FBWixHQUF3QixZQUFZO0lBQ2hDLElBQUl4QixDQUFDLEdBQUdWLGdCQUFnQixXQUFoQixDQUF5Qm1ELEdBQXpCLENBQTZCQyxXQUE3QixDQUF5QyxDQUFDLENBQTFDLENBQVI7SUFDQSxLQUFLbEMsVUFBTCxDQUFnQm1DLFFBQWhCLENBQXlCLENBQXpCLEVBQTRCWixNQUE1QixHQUFxQyxDQUFDL0IsQ0FBdEM7SUFDQSxLQUFLTSxPQUFMLENBQWFxQyxRQUFiLENBQXNCLENBQXRCLEVBQXlCWixNQUF6QixHQUFrQyxDQUFDL0IsQ0FBbkM7SUFDQSxLQUFLUSxVQUFMLENBQWdCbUMsUUFBaEIsQ0FBeUIsQ0FBekIsRUFBNEJaLE1BQTVCLEdBQXFDL0IsQ0FBckM7SUFDQSxLQUFLTSxPQUFMLENBQWFxQyxRQUFiLENBQXNCLENBQXRCLEVBQXlCWixNQUF6QixHQUFrQy9CLENBQWxDO0VBQ0gsQ0FORDs7RUFPQUMsQ0FBQyxDQUFDZSxTQUFGLENBQVk0QixRQUFaLEdBQXVCLFlBQVk7SUFDL0IsS0FBS3RDLE9BQUwsQ0FBYTBCLEVBQWIsQ0FBZ0IsT0FBaEIsRUFBeUIsS0FBS2EsU0FBOUIsRUFBeUMsSUFBekM7SUFDQSxLQUFLckMsVUFBTCxDQUFnQndCLEVBQWhCLENBQW1CLE9BQW5CLEVBQTRCLEtBQUtjLFlBQWpDLEVBQStDLElBQS9DO0VBQ0gsQ0FIRDs7RUFJQTdDLENBQUMsQ0FBQ2UsU0FBRixDQUFZK0IsV0FBWixHQUEwQixZQUFZO0lBQ2xDLEtBQUt6QyxPQUFMLENBQWEwQyxHQUFiLENBQWlCLE9BQWpCLEVBQTBCLEtBQUtILFNBQS9CLEVBQTBDLElBQTFDO0lBQ0EsS0FBS3JDLFVBQUwsQ0FBZ0J3QyxHQUFoQixDQUFvQixPQUFwQixFQUE2QixLQUFLRixZQUFsQyxFQUFnRCxJQUFoRDtFQUNILENBSEQ7O0VBSUE3QyxDQUFDLENBQUNlLFNBQUYsQ0FBWThCLFlBQVosR0FBMkIsWUFBWTtJQUNuQyxJQUFJN0MsQ0FBQyxHQUFHLElBQVI7O0lBQ0EsSUFBSVgsZ0JBQWdCLFdBQWhCLENBQXlCbUQsR0FBekIsQ0FBNkJRLFdBQTdCLENBQXlDLENBQUMsQ0FBMUMsQ0FBSixFQUFrRDtNQUM5QyxJQUFJdEIsQ0FBQyxHQUFHcEMsWUFBWSxXQUFaLENBQXFCOEMsR0FBckIsQ0FBeUJhLGdCQUF6QixFQUFSOztNQUNBLElBQUksTUFBTXZCLENBQUMsQ0FBQ0QsTUFBWixFQUFvQjtRQUNoQjVDLFVBQVUsQ0FBQ3FFLFNBQVgsQ0FBcUJqQyxRQUFyQixDQUE4QmtDLFNBQTlCLENBQXdDLFNBQXhDO1FBQ0EsT0FBTyxLQUFLcEQsQ0FBQyxDQUFDZ0IsU0FBRixDQUFZcUMsWUFBWixDQUF5QkMsSUFBekIsQ0FBOEIsSUFBOUIsQ0FBWjtNQUNIOztNQUNELEtBQUtqRCxZQUFMLENBQWtCa0Qsa0JBQWxCO01BQ0EsS0FBS2hDLGdCQUFMLENBQXNCSSxDQUF0QjtNQUNBLEtBQUtILFNBQUw7TUFDQSxLQUFLQyxZQUFMO0lBQ0gsQ0FWRCxNQVVPO01BQ0h0QyxVQUFVLFdBQVYsQ0FBbUJzRCxHQUFuQixDQUF1QmUsaUJBQXZCLENBQXlDLFlBQVk7UUFDakQsSUFBSXhFLFNBQVMsQ0FBQ3lFLFFBQVYsQ0FBbUJDLFlBQW5CLEtBQW9DMUUsU0FBUyxDQUFDMkUsWUFBVixDQUF1QkMsUUFBL0QsRUFBeUU7VUFDckUxRSxHQUFHLFdBQUgsQ0FBWTJFLE9BQVosQ0FBb0JDLE1BQXBCLENBQTJCLGVBQTNCO1FBQ0g7O1FBQ0QsSUFBSW5DLENBQUMsR0FBR3BDLFlBQVksV0FBWixDQUFxQjhDLEdBQXJCLENBQXlCYSxnQkFBekIsRUFBUjs7UUFDQSxJQUFJLE1BQU12QixDQUFDLENBQUNELE1BQVosRUFBb0I7VUFDaEI1QyxVQUFVLENBQUNxRSxTQUFYLENBQXFCakMsUUFBckIsQ0FBOEJrQyxTQUE5QixDQUF3QyxTQUF4QztVQUNBLE9BQU8sS0FBS3BELENBQUMsQ0FBQ2dCLFNBQUYsQ0FBWXFDLFlBQVosQ0FBeUJDLElBQXpCLENBQThCckQsQ0FBOUIsQ0FBWjtRQUNIOztRQUNEQSxDQUFDLENBQUNJLFlBQUYsQ0FBZWtELGtCQUFmO1FBQ0F0RCxDQUFDLENBQUNzQixnQkFBRixDQUFtQkksQ0FBbkI7UUFDQTFCLENBQUMsQ0FBQ3VCLFNBQUY7TUFDSCxDQVpEO0lBYUg7RUFDSixDQTNCRDs7RUE0QkF2QixDQUFDLENBQUNlLFNBQUYsQ0FBWTZCLFNBQVosR0FBd0IsWUFBWTtJQUNoQyxJQUFJN0MsQ0FBQyxHQUFHLElBQVI7SUFDQVYsZ0JBQWdCLFdBQWhCLENBQXlCbUQsR0FBekIsQ0FBNkJRLFdBQTdCLENBQXlDLENBQUMsQ0FBMUMsS0FDTzFELFlBQVksV0FBWixDQUFxQjhDLEdBQXJCLENBQXlCQyxvQkFBekIsSUFDQSxLQUFLMUIsWUFBTCxHQUFvQixDQUFDLENBRHJCLEVBRUQsS0FBS3dCLFVBQUwsRUFGQyxFQUdELEtBQUtaLFNBQUwsRUFIQyxFQUlELEtBQUtDLFlBQUwsRUFMTixJQU1NdEMsVUFBVSxXQUFWLENBQW1Cc0QsR0FBbkIsQ0FBdUJlLGlCQUF2QixDQUF5QyxZQUFZO01BQ2pELElBQUl4RSxTQUFTLENBQUN5RSxRQUFWLENBQW1CQyxZQUFuQixLQUFvQzFFLFNBQVMsQ0FBQzJFLFlBQVYsQ0FBdUJDLFFBQS9ELEVBQXlFO1FBQ3JFMUUsR0FBRyxXQUFILENBQVkyRSxPQUFaLENBQW9CQyxNQUFwQixDQUEyQixhQUEzQjtNQUNIOztNQUNEdkUsWUFBWSxXQUFaLENBQXFCOEMsR0FBckIsQ0FBeUJDLG9CQUF6QjtNQUNBdEMsQ0FBQyxDQUFDWSxZQUFGLEdBQWlCLENBQUMsQ0FBbEI7TUFDQVosQ0FBQyxDQUFDb0MsVUFBRjtNQUNBcEMsQ0FBQyxDQUFDd0IsU0FBRjtJQUNILENBUkQsQ0FOTjtFQWVILENBakJEOztFQWtCQXZCLENBQUMsQ0FBQ2UsU0FBRixDQUFZbUIsVUFBWixHQUF5QixVQUFVbkMsQ0FBVixFQUFhQyxDQUFiLEVBQWdCO0lBQ3JDLElBQUkwQixDQUFDLEdBQUcsSUFBUjtJQUNBLElBQUluRCxDQUFDLEdBQUdZLGNBQWMsV0FBZCxDQUF1QjhCLFFBQXZCLENBQWdDNkMsZUFBaEMsQ0FBZ0RDLEdBQWhELENBQW9EaEUsQ0FBcEQsQ0FBUjtJQUNBLElBQUlpRSxDQUFDLEdBQUdoRSxDQUFDLENBQUMwQyxRQUFGLENBQVcsQ0FBWCxFQUFjdUIsWUFBZCxDQUEyQnpFLEVBQUUsQ0FBQzBFLE1BQTlCLENBQVI7SUFDQTFGLGFBQWEsV0FBYixDQUFzQnlDLFFBQXRCLENBQStCa0QsT0FBL0IsQ0FDSXpGLFVBQVUsQ0FBQzBGLFdBQVgsQ0FBdUJDLFVBRDNCLEVBRUksQ0FBQyxhQUFhOUYsQ0FBQyxDQUFDK0YsSUFBaEIsQ0FGSixFQUdJOUUsRUFBRSxDQUFDK0UsV0FIUCxFQUlJLElBSkosRUFLSSxVQUFVeEUsQ0FBVixFQUFhQyxDQUFiLEVBQWdCO01BQ1osSUFBSXpCLENBQUMsR0FBR3lCLENBQUMsQ0FBQyxDQUFELENBQVQ7O01BQ0EsSUFBSXpCLENBQUMsSUFBSWlCLEVBQUUsQ0FBQ2dGLE9BQUgsQ0FBV1IsQ0FBWCxDQUFULEVBQXdCO1FBQ3BCQSxDQUFDLENBQUNTLFdBQUYsR0FBZ0I5RixRQUFRLENBQUMrRixPQUFULENBQWlCQyxVQUFqQixDQUE0QnBHLENBQTVCLEVBQStCbUQsQ0FBQyxDQUFDWSxJQUFqQyxDQUFoQjtNQUNIO0lBQ0osQ0FWTDtJQVlBLElBQUlzQyxDQUFDLEdBQUdyRyxDQUFDLENBQUNzRyxVQUFWOztJQUNBLElBQUl0RyxDQUFDLENBQUN1RyxnQkFBRixDQUFtQnJELE1BQW5CLEdBQTRCLENBQTVCLElBQWlDLENBQUNuQyxZQUFZLFdBQVosQ0FBcUI4QyxHQUFyQixDQUF5QjJDLGlCQUF6QixDQUEyQ0MsR0FBM0MsQ0FBK0N6RyxDQUFDLENBQUN1RyxnQkFBRixDQUFtQixDQUFuQixDQUEvQyxDQUF0QyxFQUE2RztNQUN6R0YsQ0FBQyxHQUFHckcsQ0FBQyxDQUFDc0csVUFBRixHQUFldEcsQ0FBQyxDQUFDdUcsZ0JBQUYsQ0FBbUIsQ0FBbkIsQ0FBbkI7SUFDSDs7SUFDRDlFLENBQUMsQ0FBQzBDLFFBQUYsQ0FBVyxDQUFYLEVBQWN1QixZQUFkLENBQTJCekUsRUFBRSxDQUFDeUYsS0FBOUIsRUFBcUMxQyxNQUFyQyxHQUE4Q2hFLENBQUMsQ0FBQzJHLElBQWhEO0lBQ0FsRixDQUFDLENBQUMwQyxRQUFGLENBQVcsQ0FBWCxFQUFjdUIsWUFBZCxDQUEyQnpFLEVBQUUsQ0FBQ3lGLEtBQTlCLEVBQXFDMUMsTUFBckMsR0FBOENxQyxDQUE5QztFQUNILENBdEJEOztFQXVCQTVFLENBQUMsQ0FBQ2UsU0FBRixDQUFZaUIsU0FBWixHQUF3QixVQUFVaEMsQ0FBVixFQUFhO0lBQ2pDLElBQUksQ0FBQyxLQUFLVSxTQUFWLEVBQXFCO01BQ2pCMUIsWUFBWSxXQUFaLENBQXFCaUMsUUFBckIsQ0FBOEJDLGVBQTlCLENBQThDLE9BQTlDO01BQ0E1QixZQUFZLFdBQVosQ0FBcUI4QyxHQUFyQixDQUF5QitDLFNBQXpCLENBQW1DQyxVQUFuQztNQUNBLEtBQUsxRSxTQUFMLEdBQWlCLENBQUMsQ0FBbEI7TUFDQSxJQUFJZ0IsQ0FBQyxHQUFHMUIsQ0FBQyxDQUFDc0MsSUFBRixDQUFPVixRQUFmO01BQ0FoRCxhQUFhLFdBQWIsQ0FBc0J5RyxJQUF0QixDQUEyQmpHLGVBQWUsV0FBZixDQUF3QmtHLFlBQW5ELEVBQWlFNUQsQ0FBakU7O01BQ0EsSUFBSSxLQUFLZixZQUFMLElBQXFCLE1BQU0sS0FBS0UsV0FBcEMsRUFBaUQ7UUFDN0MsSUFBSXRDLENBQUMsR0FBR2UsWUFBWSxXQUFaLENBQXFCOEMsR0FBckIsQ0FBeUJhLGdCQUF6QixFQUFSOztRQUNBLElBQUksTUFBTTFFLENBQUMsQ0FBQ2tELE1BQVosRUFBb0I7VUFDaEI1QyxVQUFVLENBQUNxRSxTQUFYLENBQXFCakMsUUFBckIsQ0FBOEJrQyxTQUE5QixDQUF3QyxTQUF4QztVQUNBLE9BQU8sS0FBS3BELENBQUMsQ0FBQ2dCLFNBQUYsQ0FBWXFDLFlBQVosQ0FBeUJDLElBQXpCLENBQThCLElBQTlCLENBQVo7UUFDSDs7UUFDRCxLQUFLakQsWUFBTCxDQUFrQmtELGtCQUFsQjtRQUNBLEtBQUtoQyxnQkFBTCxDQUFzQi9DLENBQXRCO1FBQ0EsS0FBS21DLFNBQUwsR0FBaUIsQ0FBQyxDQUFsQjtRQUNBLEtBQUt5QixVQUFMO01BQ0g7O01BQ0QsS0FBS3RCLFdBQUw7O01BQ0EsSUFBSyxNQUFNLEtBQUtBLFdBQVgsSUFBMEIsQ0FBQyxLQUFLRixZQUFqQyxJQUFrRCxNQUFNLEtBQUtFLFdBQWpFLEVBQThFO1FBQzFFZCxDQUFDLENBQUNnQixTQUFGLENBQVlxQyxZQUFaLENBQXlCQyxJQUF6QixDQUE4QixJQUE5QjtNQUNIO0lBQ0o7RUFDSixDQXZCRDs7RUF3QkFyRCxDQUFDLENBQUNlLFNBQUYsQ0FBWVMsWUFBWixHQUEyQixZQUFZO0lBQ25DLEtBQUtoQixXQUFMLENBQWlCK0IsTUFBakIsR0FBMEJsRCxnQkFBZ0IsV0FBaEIsQ0FBeUJtRCxHQUF6QixDQUE2QitDLE1BQTdCLENBQW9DQyxRQUFwQyxFQUExQjtFQUNILENBRkQ7O0VBR0FDLFVBQVUsQ0FBQyxDQUFDN0YsQ0FBQyxDQUFDSixFQUFFLENBQUNrRyxJQUFKLENBQUYsQ0FBRCxFQUFlMUYsQ0FBQyxDQUFDZSxTQUFqQixFQUE0QixVQUE1QixFQUF3QyxLQUFLLENBQTdDLENBQVY7O0VBQ0EwRSxVQUFVLENBQUMsQ0FBQzdGLENBQUMsQ0FBQ0osRUFBRSxDQUFDa0csSUFBSixDQUFGLENBQUQsRUFBZTFGLENBQUMsQ0FBQ2UsU0FBakIsRUFBNEIsY0FBNUIsRUFBNEMsS0FBSyxDQUFqRCxDQUFWOztFQUNBMEUsVUFBVSxDQUFDLENBQUM3RixDQUFDLENBQUNKLEVBQUUsQ0FBQ2tHLElBQUosQ0FBRixDQUFELEVBQWUxRixDQUFDLENBQUNlLFNBQWpCLEVBQTRCLFNBQTVCLEVBQXVDLEtBQUssQ0FBNUMsQ0FBVjs7RUFDQTBFLFVBQVUsQ0FBQyxDQUFDN0YsQ0FBQyxDQUFDSixFQUFFLENBQUN5RixLQUFKLENBQUYsQ0FBRCxFQUFnQmpGLENBQUMsQ0FBQ2UsU0FBbEIsRUFBNkIsVUFBN0IsRUFBeUMsS0FBSyxDQUE5QyxDQUFWOztFQUNBMEUsVUFBVSxDQUFDLENBQUM3RixDQUFDLENBQUNKLEVBQUUsQ0FBQ2tHLElBQUosQ0FBRixDQUFELEVBQWUxRixDQUFDLENBQUNlLFNBQWpCLEVBQTRCLFlBQTVCLEVBQTBDLEtBQUssQ0FBL0MsQ0FBVjs7RUFDQTBFLFVBQVUsQ0FBQyxDQUFDN0YsQ0FBQyxDQUFDSixFQUFFLENBQUN5RixLQUFKLENBQUYsQ0FBRCxFQUFnQmpGLENBQUMsQ0FBQ2UsU0FBbEIsRUFBNkIsYUFBN0IsRUFBNEMsS0FBSyxDQUFqRCxDQUFWOztFQUNBLE9BQU8wRSxVQUFVLENBQUMsQ0FBQy9GLENBQUQsQ0FBRCxFQUFNTSxDQUFOLENBQWpCO0FBQ0gsQ0FqS08sQ0FpS0xsQixVQUFVLENBQUM2RyxTQWpLTixDQUFSOztBQWtLQUMsT0FBTyxXQUFQLEdBQWtCOUYsQ0FBbEIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBvO1xyXG52YXIgJGFzc2V0c0xvYWRlciA9IHJlcXVpcmUoXCIuL0Fzc2V0c0xvYWRlclwiKTtcclxudmFyICRhc3NldHNNYXAgPSByZXF1aXJlKFwiLi9Bc3NldHNNYXBcIik7XHJcbnZhciAkcmVzVXRpbCA9IHJlcXVpcmUoXCIuL1Jlc1V0aWxcIik7XHJcbnZhciAkZXZlbnRNYW5hZ2VyID0gcmVxdWlyZShcIi4vRXZlbnRNYW5hZ2VyXCIpO1xyXG52YXIgJHVJTWFuYWdlciA9IHJlcXVpcmUoXCIuL1VJTWFuYWdlclwiKTtcclxudmFyICRwb3B1cFZpZXcgPSByZXF1aXJlKFwiLi9Qb3B1cFZpZXdcIik7XHJcbnZhciAkcGxhdGZvcm0gPSByZXF1aXJlKFwiLi9QbGF0Zm9ybVwiKTtcclxudmFyICRyZW1vdGVBdWRpbyA9IHJlcXVpcmUoXCIuL1JlbW90ZUF1ZGlvXCIpO1xyXG52YXIgJGFEID0gcmVxdWlyZShcIi4vQURcIik7XHJcbnZhciAkYWRTZXJ2aWNlID0gcmVxdWlyZShcIi4vQWRTZXJ2aWNlXCIpO1xyXG52YXIgJGNvbmZpZ0NvbnRleHQgPSByZXF1aXJlKFwiLi9Db25maWdDb250ZXh0XCIpO1xyXG52YXIgJGxvY2FsRXZlbnROYW1lID0gcmVxdWlyZShcIi4vTG9jYWxFdmVudE5hbWVcIik7XHJcbnZhciAkdXNlckRhdGFDb250ZXh0ID0gcmVxdWlyZShcIi4vVXNlckRhdGFDb250ZXh0XCIpO1xyXG52YXIgJGdhbWVDb250ZXh0ID0gcmVxdWlyZShcIi4vR2FtZUNvbnRleHRcIik7XHJcbnZhciB2ID0gY2MuX2RlY29yYXRvcjtcclxudmFyIGIgPSB2LmNjY2xhc3M7XHJcbnZhciB3ID0gdi5wcm9wZXJ0eTtcclxudmFyIEEgPSAoZnVuY3Rpb24gKHQpIHtcclxuICAgIGZ1bmN0aW9uIGUoKSB7XHJcbiAgICAgICAgdmFyIGUgPSAobnVsbCAhPT0gdCAmJiB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIHx8IHRoaXM7XHJcbiAgICAgICAgZS50ZW1wTm9kZSA9IG51bGw7XHJcbiAgICAgICAgZS5jb250ZW50TGF5ZXIgPSBudWxsO1xyXG4gICAgICAgIGUuYnRuQWdpbiA9IG51bGw7XHJcbiAgICAgICAgZS50aXBMYWJlbCA9IG51bGw7XHJcbiAgICAgICAgZS5idG5SZWZyZXNoID0gbnVsbDtcclxuICAgICAgICBlLmNvaW5BZExhYmxlID0gbnVsbDtcclxuICAgICAgICBlLmNob29zZU5vZGUgPSBbXTtcclxuICAgICAgICBlLmlzQ2hvb3NlZCA9ICExO1xyXG4gICAgICAgIGUuaXNDaG9vc2VBZ2luID0gITE7XHJcbiAgICAgICAgZS5jb3VudCA9IDM7XHJcbiAgICAgICAgZS5jaG9vc2VDb3VudCA9IDA7XHJcbiAgICAgICAgcmV0dXJuIGU7XHJcbiAgICB9XHJcbiAgICBfX2V4dGVuZHMoZSwgdCk7XHJcbiAgICBlLnByb3RvdHlwZS5vblJlc2V0VmlldyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkcmVtb3RlQXVkaW8uZGVmYXVsdC5pbnN0YW5jZS5wbGF5RWZmZWN0TXVzaWMoXCJsZXZlbHVwXCIpO1xyXG4gICAgICAgIHZhciB0ID0gdGhpcy51aVBhcmFtLnBhcmFtLmlkcztcclxuICAgICAgICB0aGlzLmNyZWF0ZUNob29zZUl0ZW0odCk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJCdG4oKTtcclxuICAgICAgICB0aGlzLnJlbmRlckFkQ29pbigpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLmNyZWF0ZUNob29zZUl0ZW0gPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgdC5sZW5ndGg7IGUrKykge1xyXG4gICAgICAgICAgICB2YXIgaSA9IHRbZV07XHJcbiAgICAgICAgICAgIHZhciBvID0gY2MuaW5zdGFudGlhdGUodGhpcy50ZW1wTm9kZSk7XHJcbiAgICAgICAgICAgIG8uc2tpbGxfaWQgPSBpO1xyXG4gICAgICAgICAgICBvLnBhcmVudCA9IHRoaXMuY29udGVudExheWVyO1xyXG4gICAgICAgICAgICBvLmFjdGl2ZSA9ICEwO1xyXG4gICAgICAgICAgICBvLm9uKFwiY2xpY2tcIiwgdGhpcy5jbGlja0l0ZW0sIHRoaXMpO1xyXG4gICAgICAgICAgICB0aGlzLmNob29zZU5vZGUucHVzaChvKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJJdGVtKGksIG8pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJlbmRlckFnaW4oKTtcclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5yZW5kZXJBZ2luID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuaXNDaG9vc2VBZ2luIHx8ICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5hZ2luQ2hvb3NlU2tpbGxDb3VudCA+PSB0aGlzLmNvdW50XHJcbiAgICAgICAgICAgID8gKCh0aGlzLmJ0bkFnaW4uYWN0aXZlID0gITEpLCAodGhpcy50aXBMYWJlbC5ub2RlLmFjdGl2ZSA9ICExKSlcclxuICAgICAgICAgICAgOiAodGhpcy50aXBMYWJlbC5zdHJpbmcgPVxyXG4gICAgICAgICAgICAgICAgICBcIuW9k+WxgOWJqeS9meingueci+asoeaVsFwiICsgKHRoaXMuY291bnQgLSAkZ2FtZUNvbnRleHQuZGVmYXVsdC5pbnMuYWdpbkNob29zZVNraWxsQ291bnQpICsgXCIvXCIgKyB0aGlzLmNvdW50KTtcclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5yZW5kZXJCdG4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHQgPSAkdXNlckRhdGFDb250ZXh0LmRlZmF1bHQuSW5zLmNoZWNrQWRDb2luKC0xKTtcclxuICAgICAgICB0aGlzLmJ0blJlZnJlc2guY2hpbGRyZW5bMF0uYWN0aXZlID0gIXQ7XHJcbiAgICAgICAgdGhpcy5idG5BZ2luLmNoaWxkcmVuWzBdLmFjdGl2ZSA9ICF0O1xyXG4gICAgICAgIHRoaXMuYnRuUmVmcmVzaC5jaGlsZHJlblsxXS5hY3RpdmUgPSB0O1xyXG4gICAgICAgIHRoaXMuYnRuQWdpbi5jaGlsZHJlblsxXS5hY3RpdmUgPSB0O1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLmFkZEV2ZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuYnRuQWdpbi5vbihcImNsaWNrXCIsIHRoaXMuY2xpY2tBZ2luLCB0aGlzKTtcclxuICAgICAgICB0aGlzLmJ0blJlZnJlc2gub24oXCJjbGlja1wiLCB0aGlzLmNsaWNrUmVmcmVzaCwgdGhpcyk7XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUucmVtb3ZlRXZlbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5idG5BZ2luLm9mZihcImNsaWNrXCIsIHRoaXMuY2xpY2tBZ2luLCB0aGlzKTtcclxuICAgICAgICB0aGlzLmJ0blJlZnJlc2gub2ZmKFwiY2xpY2tcIiwgdGhpcy5jbGlja1JlZnJlc2gsIHRoaXMpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLmNsaWNrUmVmcmVzaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZSA9IHRoaXM7XHJcbiAgICAgICAgaWYgKCR1c2VyRGF0YUNvbnRleHQuZGVmYXVsdC5JbnMub3BlYXJBZENvaW4oLTEpKSB7XHJcbiAgICAgICAgICAgIHZhciBpID0gJGdhbWVDb250ZXh0LmRlZmF1bHQuaW5zLmNyZWF0ZU5leHRTa2lsbHMoKTtcclxuICAgICAgICAgICAgaWYgKDAgPT09IGkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAkdUlNYW5hZ2VyLlVJTWFuYWdlci5pbnN0YW5jZS5zaG93VG9hc3QoXCLmsqHmnInmioDog73lj6/pgInkuoZcIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCB0LnByb3RvdHlwZS5vbkNsaWNrQ2xvc2UuY2FsbCh0aGlzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRMYXllci5kZXN0cm95QWxsQ2hpbGRyZW4oKTtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVDaG9vc2VJdGVtKGkpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlckJ0bigpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlckFkQ29pbigpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICRhZFNlcnZpY2UuZGVmYXVsdC5JbnMuc2hvd1Jld2FyZGVkVmlkZW8oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRwbGF0Zm9ybS5QbGF0Zm9ybS5jdXJyUGxhdEZvcm0gPT09ICRwbGF0Zm9ybS5QbGF0Zm9ybUVudW0uVE9VX1RJQU8pIHtcclxuICAgICAgICAgICAgICAgICAgICAkYUQuZGVmYXVsdC50b3V0aWFvLnJlcG9ydChcIlNraWxsX1JlZnJlc2hcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgaSA9ICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5jcmVhdGVOZXh0U2tpbGxzKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoMCA9PT0gaS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkdUlNYW5hZ2VyLlVJTWFuYWdlci5pbnN0YW5jZS5zaG93VG9hc3QoXCLmsqHmnInmioDog73lj6/pgInkuoZcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdC5wcm90b3R5cGUub25DbGlja0Nsb3NlLmNhbGwoZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlLmNvbnRlbnRMYXllci5kZXN0cm95QWxsQ2hpbGRyZW4oKTtcclxuICAgICAgICAgICAgICAgIGUuY3JlYXRlQ2hvb3NlSXRlbShpKTtcclxuICAgICAgICAgICAgICAgIGUucmVuZGVyQnRuKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5jbGlja0FnaW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHQgPSB0aGlzO1xyXG4gICAgICAgICR1c2VyRGF0YUNvbnRleHQuZGVmYXVsdC5JbnMub3BlYXJBZENvaW4oLTEpXHJcbiAgICAgICAgICAgID8gKCRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5hZ2luQ2hvb3NlU2tpbGxDb3VudCsrLFxyXG4gICAgICAgICAgICAgICh0aGlzLmlzQ2hvb3NlQWdpbiA9ICEwKSxcclxuICAgICAgICAgICAgICB0aGlzLnJlbmRlckFnaW4oKSxcclxuICAgICAgICAgICAgICB0aGlzLnJlbmRlckJ0bigpLFxyXG4gICAgICAgICAgICAgIHRoaXMucmVuZGVyQWRDb2luKCkpXHJcbiAgICAgICAgICAgIDogJGFkU2VydmljZS5kZWZhdWx0Lklucy5zaG93UmV3YXJkZWRWaWRlbyhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmICgkcGxhdGZvcm0uUGxhdGZvcm0uY3VyclBsYXRGb3JtID09PSAkcGxhdGZvcm0uUGxhdGZvcm1FbnVtLlRPVV9USUFPKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAkYUQuZGVmYXVsdC50b3V0aWFvLnJlcG9ydChcIlNraWxsX2FnYWluXCIpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5hZ2luQ2hvb3NlU2tpbGxDb3VudCsrO1xyXG4gICAgICAgICAgICAgICAgICB0LmlzQ2hvb3NlQWdpbiA9ICEwO1xyXG4gICAgICAgICAgICAgICAgICB0LnJlbmRlckFnaW4oKTtcclxuICAgICAgICAgICAgICAgICAgdC5yZW5kZXJCdG4oKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5yZW5kZXJJdGVtID0gZnVuY3Rpb24gKHQsIGUpIHtcclxuICAgICAgICB2YXIgaSA9IHRoaXM7XHJcbiAgICAgICAgdmFyIG8gPSAkY29uZmlnQ29udGV4dC5kZWZhdWx0Lmluc3RhbmNlLnNraWxsQ29uZmlnc01hcC5nZXQodCk7XHJcbiAgICAgICAgdmFyIG4gPSBlLmNoaWxkcmVuWzBdLmdldENvbXBvbmVudChjYy5TcHJpdGUpO1xyXG4gICAgICAgICRhc3NldHNMb2FkZXIuZGVmYXVsdC5pbnN0YW5jZS5sb2FkUmVzKFxyXG4gICAgICAgICAgICAkYXNzZXRzTWFwLkJ1bmRsZU5hbWVzLlB1YmxpY19SZXMsXHJcbiAgICAgICAgICAgIFtcIi9za2lsbHMvXCIgKyBvLmljb25dLFxyXG4gICAgICAgICAgICBjYy5TcHJpdGVGcmFtZSxcclxuICAgICAgICAgICAgbnVsbCxcclxuICAgICAgICAgICAgZnVuY3Rpb24gKHQsIGUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBvID0gZVswXTtcclxuICAgICAgICAgICAgICAgIGlmIChvICYmIGNjLmlzVmFsaWQobikpIHtcclxuICAgICAgICAgICAgICAgICAgICBuLnNwcml0ZUZyYW1lID0gJHJlc1V0aWwuUmVzVXRpbC5hc3NpZ25XaXRoKG8sIGkubm9kZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApO1xyXG4gICAgICAgIHZhciBzID0gby5za2lsbF90ZXh0O1xyXG4gICAgICAgIGlmIChvLnNraWxsX2NoYW5nZXRleHQubGVuZ3RoID4gMCAmJiAhJGdhbWVDb250ZXh0LmRlZmF1bHQuaW5zLmNob29zZVNraWxsUmVjb3JkLmhhcyhvLnNraWxsX2NoYW5nZXRleHRbMF0pKSB7XHJcbiAgICAgICAgICAgIHMgPSBvLnNraWxsX3RleHQgKyBvLnNraWxsX2NoYW5nZXRleHRbMV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGUuY2hpbGRyZW5bMV0uZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBvLm5hbWU7XHJcbiAgICAgICAgZS5jaGlsZHJlblsyXS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IHM7XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUuY2xpY2tJdGVtID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNDaG9vc2VkKSB7XHJcbiAgICAgICAgICAgICRyZW1vdGVBdWRpby5kZWZhdWx0Lmluc3RhbmNlLnBsYXlFZmZlY3RNdXNpYyhcIkNsaWNrXCIpO1xyXG4gICAgICAgICAgICAkZ2FtZUNvbnRleHQuZGVmYXVsdC5pbnMuc2tpbGxJbmZvLnNraWxsQ291bnQrKztcclxuICAgICAgICAgICAgdGhpcy5pc0Nob29zZWQgPSAhMDtcclxuICAgICAgICAgICAgdmFyIGkgPSBlLm5vZGUuc2tpbGxfaWQ7XHJcbiAgICAgICAgICAgICRldmVudE1hbmFnZXIuZGVmYXVsdC5zZW5kKCRsb2NhbEV2ZW50TmFtZS5kZWZhdWx0LkNIT09TRV9TS0lMTCwgaSk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2hvb3NlQWdpbiAmJiAwID09PSB0aGlzLmNob29zZUNvdW50KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbyA9ICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5jcmVhdGVOZXh0U2tpbGxzKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoMCA9PT0gby5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkdUlNYW5hZ2VyLlVJTWFuYWdlci5pbnN0YW5jZS5zaG93VG9hc3QoXCLmsqHmnInmioDog73lj6/pgInkuoZcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdC5wcm90b3R5cGUub25DbGlja0Nsb3NlLmNhbGwodGhpcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnRMYXllci5kZXN0cm95QWxsQ2hpbGRyZW4oKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlQ2hvb3NlSXRlbShvKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNDaG9vc2VkID0gITE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckFnaW4oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmNob29zZUNvdW50Kys7XHJcbiAgICAgICAgICAgIGlmICgoMSA9PT0gdGhpcy5jaG9vc2VDb3VudCAmJiAhdGhpcy5pc0Nob29zZUFnaW4pIHx8IDIgPT09IHRoaXMuY2hvb3NlQ291bnQpIHtcclxuICAgICAgICAgICAgICAgIHQucHJvdG90eXBlLm9uQ2xpY2tDbG9zZS5jYWxsKHRoaXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnJlbmRlckFkQ29pbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmNvaW5BZExhYmxlLnN0cmluZyA9ICR1c2VyRGF0YUNvbnRleHQuZGVmYXVsdC5JbnMuYWRDb2luLnRvU3RyaW5nKCk7XHJcbiAgICB9O1xyXG4gICAgX19kZWNvcmF0ZShbdyhjYy5Ob2RlKV0sIGUucHJvdG90eXBlLCBcInRlbXBOb2RlXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFt3KGNjLk5vZGUpXSwgZS5wcm90b3R5cGUsIFwiY29udGVudExheWVyXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFt3KGNjLk5vZGUpXSwgZS5wcm90b3R5cGUsIFwiYnRuQWdpblwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbdyhjYy5MYWJlbCldLCBlLnByb3RvdHlwZSwgXCJ0aXBMYWJlbFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbdyhjYy5Ob2RlKV0sIGUucHJvdG90eXBlLCBcImJ0blJlZnJlc2hcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW3coY2MuTGFiZWwpXSwgZS5wcm90b3R5cGUsIFwiY29pbkFkTGFibGVcIiwgdm9pZCAwKTtcclxuICAgIHJldHVybiBfX2RlY29yYXRlKFtiXSwgZSk7XHJcbn0pKCRwb3B1cFZpZXcuUG9wdXBWaWV3KTtcclxuZXhwb3J0cy5kZWZhdWx0ID0gQTtcclxuIl19