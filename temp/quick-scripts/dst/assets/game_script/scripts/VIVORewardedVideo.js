
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/VIVORewardedVideo.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '30a2datSipIyYNmeICHheDE', 'VIVORewardedVideo');
// game_script/scripts/VIVORewardedVideo.js

"use strict";

var o;
exports.VIVORewardedVideo = void 0;

var $baseAd = require("./BaseAd");

var r = window.qg;

var a = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.videoEndCallback = null;
    return e;
  }

  __extends(e, t);

  e.prototype.loadAd = function () {
    if (this.adUnitId) {
      var t = {
        adUnitId: this.adUnitId
      };
      this.adIns = r.createRewardedVideoAd(t);

      if (this.adIns.onLoad) {
        this.adIns.onLoad(this.onLoad);
      }

      if (this.adIns.onClose) {
        this.adIns.onClose(this.onClose);
      }

      if (this.adIns.onError) {
        this.adIns.onError(this.onError);
      }

      this.adIns.load();
    } else {
      console.error("激励视频ID为空");
    }
  };

  e.prototype.showRewardedVideo = function (t, e, i) {
    var o = this;
    this.showCallback = t;
    this.closeCallback = e;
    this.videoEndCallback = i;
    this.musicVolume = cc.audioEngine.getMusicVolume();
    this.effectsVolume = cc.audioEngine.getEffectsVolume();

    if (!this.adIns) {
      this.isAutoShow = !0;
      console.warn(this.adUnitId, ":未创建，执行创建");
      this.loadAd();
    }

    if (this.isConsume) {
      this.reCreateAd(!0);
    } else {
      {
        if (!this.isLoaded) {
          this.isAutoShow = !0;
          return void console.warn(this.adUnitId, ":未加载完成，稍等");
        }

        if (this.showing) {
          console.warn(this.adUnitId, "广告正在显示中");
        } else {
          this.showing = !1;

          if (this.adIns.show) {
            this.pause();
            var n = this.adIns.show();
            n && n.then ? n.then(function () {
              o.isConsume = !0;
              o.showing = !0;

              if (o.showCallback) {
                o.showCallback();
              }

              o.showCallback = null;
            })["catch"](function (t) {
              console.warn(o.adUnitId, ":show错误，重新加载", t);
              o.reCreateAd(!0);
            }) : (console.warn(this.adUnitId, ":show显示失败，重新加载"), this.reCreateAd(!0));
          } else {
            this.resume();
            console.error(this.adUnitId, ":未知错误");
          }
        }
      }
    }
  };

  e.prototype.reCreateAd = function (e) {
    t.prototype.reCreateAd.call(this, e);
    this.resume();
  };

  e.prototype.autoShow = function () {
    if (this.isAutoShow) {
      this.isAutoShow = !1;
      this.showRewardedVideo(this.showCallback, this.closeCallback, this.videoEndCallback);
    }
  };

  e.prototype.onAdLoad = function () {
    t.prototype.onAdLoad.call(this);
    this.isConsume = !1;
    this.isLoaded = !0;
    this.showing = !1;
    this.autoShow();
  };

  e.prototype.onAdError = function (e) {
    t.prototype.onAdError.call(this, e);
    this.showing = !1;
    this.resume();
    this.destroyAd();
  };

  e.prototype.onAdClose = function (e) {
    t.prototype.onAdClose.call(this, e);
    this.showing = !1;
    e && e.isEnded ? this.videoEndCallback && this.videoEndCallback() : this.closeCallback && this.closeCallback();
    this.isOpenPreLoad ? this.adIns.load() : this.destroyAd();
    this.resume();
  };

  e.prototype.destroyAd = function () {
    t.prototype.destroyAd.call(this);
    this.videoEndCallback = null;

    if (this.adIns) {
      if (this.adIns.offLoad) {
        this.adIns.offLoad(this.onLoad);
      }

      if (this.adIns.offClose) {
        this.adIns.offClose(this.onClose);
      }

      if (this.adIns.offError) {
        this.adIns.offError(this.onError);
      }

      if (this.adIns.destroy) {
        this.adIns.destroy();
      }

      this.adIns = null;
    }
  };

  return e;
}($baseAd.BaseAd);

exports.VIVORewardedVideo = a;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXFZJVk9SZXdhcmRlZFZpZGVvLmpzIl0sIm5hbWVzIjpbIm8iLCJleHBvcnRzIiwiVklWT1Jld2FyZGVkVmlkZW8iLCIkYmFzZUFkIiwicmVxdWlyZSIsInIiLCJ3aW5kb3ciLCJxZyIsImEiLCJ0IiwiZSIsImFwcGx5IiwiYXJndW1lbnRzIiwidmlkZW9FbmRDYWxsYmFjayIsIl9fZXh0ZW5kcyIsInByb3RvdHlwZSIsImxvYWRBZCIsImFkVW5pdElkIiwiYWRJbnMiLCJjcmVhdGVSZXdhcmRlZFZpZGVvQWQiLCJvbkxvYWQiLCJvbkNsb3NlIiwib25FcnJvciIsImxvYWQiLCJjb25zb2xlIiwiZXJyb3IiLCJzaG93UmV3YXJkZWRWaWRlbyIsImkiLCJzaG93Q2FsbGJhY2siLCJjbG9zZUNhbGxiYWNrIiwibXVzaWNWb2x1bWUiLCJjYyIsImF1ZGlvRW5naW5lIiwiZ2V0TXVzaWNWb2x1bWUiLCJlZmZlY3RzVm9sdW1lIiwiZ2V0RWZmZWN0c1ZvbHVtZSIsImlzQXV0b1Nob3ciLCJ3YXJuIiwiaXNDb25zdW1lIiwicmVDcmVhdGVBZCIsImlzTG9hZGVkIiwic2hvd2luZyIsInNob3ciLCJwYXVzZSIsIm4iLCJ0aGVuIiwicmVzdW1lIiwiY2FsbCIsImF1dG9TaG93Iiwib25BZExvYWQiLCJvbkFkRXJyb3IiLCJkZXN0cm95QWQiLCJvbkFkQ2xvc2UiLCJpc0VuZGVkIiwiaXNPcGVuUHJlTG9hZCIsIm9mZkxvYWQiLCJvZmZDbG9zZSIsIm9mZkVycm9yIiwiZGVzdHJveSIsIkJhc2VBZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxDQUFKO0FBQ0FDLE9BQU8sQ0FBQ0MsaUJBQVIsR0FBNEIsS0FBSyxDQUFqQzs7QUFDQSxJQUFJQyxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxVQUFELENBQXJCOztBQUNBLElBQUlDLENBQUMsR0FBR0MsTUFBTSxDQUFDQyxFQUFmOztBQUNBLElB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SUFBM0I7SUFDQSxLQUFLbEMsZ0JBQUwsR0FBd0IsSUFBeEI7O0lBQ0EsSUFBSSxLQUFLSyxLQUFULEVBQWdCO01BQ1osSUFBSSxLQUFLQSxLQUFMLENBQVdxQyxPQUFmLEVBQXdCO1FBQ3BCLEtBQUtyQyxLQUFMLENBQVdxQyxPQUFYLENBQW1CLEtBQUtuQyxNQUF4QjtNQUNIOztNQUNELElBQUksS0FBS0YsS0FBTCxDQUFXc0MsUUFBZixFQUF5QjtRQUNyQixLQUFLdEMsS0FBTCxDQUFXc0MsUUFBWCxDQUFvQixLQUFLbkMsT0FBekI7TUFDSDs7TUFDRCxJQUFJLEtBQUtILEtBQUwsQ0FBV3VDLFFBQWYsRUFBeUI7UUFDckIsS0FBS3ZDLEtBQUwsQ0FBV3VDLFFBQVgsQ0FBb0IsS0FBS25DLE9BQXpCO01BQ0g7O01BQ0QsSUFBSSxLQUFLSixLQUFMLENBQVd3QyxPQUFmLEVBQXdCO1FBQ3BCLEtBQUt4QyxLQUFMLENBQVd3QyxPQUFYO01BQ0g7O01BQ0QsS0FBS3hDLEtBQUwsR0FBYSxJQUFiO0lBQ0g7RUFDSixDQWxCRDs7RUFtQkEsT0FBT1IsQ0FBUDtBQUNILENBL0hPLENBK0hMUCxPQUFPLENBQUN3RCxNQS9ISCxDQUFSOztBQWdJQTFELE9BQU8sQ0FBQ0MsaUJBQVIsR0FBNEJNLENBQTVCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbztcclxuZXhwb3J0cy5WSVZPUmV3YXJkZWRWaWRlbyA9IHZvaWQgMDtcclxudmFyICRiYXNlQWQgPSByZXF1aXJlKFwiLi9CYXNlQWRcIik7XHJcbnZhciByID0gd2luZG93LnFnO1xyXG52YXIgYSA9IChmdW5jdGlvbiAodCkge1xyXG4gICAgZnVuY3Rpb24gZSgpIHtcclxuICAgICAgICB2YXIgZSA9IChudWxsICE9PSB0ICYmIHQuYXBwbHkodGhpcywgYXJndW1lbnRzKSkgfHwgdGhpcztcclxuICAgICAgICBlLnZpZGVvRW5kQ2FsbGJhY2sgPSBudWxsO1xyXG4gICAgICAgIHJldHVybiBlO1xyXG4gICAgfVxyXG4gICAgX19leHRlbmRzKGUsIHQpO1xyXG4gICAgZS5wcm90b3R5cGUubG9hZEFkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmFkVW5pdElkKSB7XHJcbiAgICAgICAgICAgIHZhciB0ID0ge1xyXG4gICAgICAgICAgICAgICAgYWRVbml0SWQ6IHRoaXMuYWRVbml0SWRcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5hZElucyA9IHIuY3JlYXRlUmV3YXJkZWRWaWRlb0FkKHQpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5hZElucy5vbkxvYWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMub25Mb2FkKHRoaXMub25Mb2FkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5hZElucy5vbkNsb3NlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkSW5zLm9uQ2xvc2UodGhpcy5vbkNsb3NlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5hZElucy5vbkVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkSW5zLm9uRXJyb3IodGhpcy5vbkVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmFkSW5zLmxvYWQoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwi5r+A5Yqx6KeG6aKRSUTkuLrnqbpcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnNob3dSZXdhcmRlZFZpZGVvID0gZnVuY3Rpb24gKHQsIGUsIGkpIHtcclxuICAgICAgICB2YXIgbyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5zaG93Q2FsbGJhY2sgPSB0O1xyXG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IGU7XHJcbiAgICAgICAgdGhpcy52aWRlb0VuZENhbGxiYWNrID0gaTtcclxuICAgICAgICB0aGlzLm11c2ljVm9sdW1lID0gY2MuYXVkaW9FbmdpbmUuZ2V0TXVzaWNWb2x1bWUoKTtcclxuICAgICAgICB0aGlzLmVmZmVjdHNWb2x1bWUgPSBjYy5hdWRpb0VuZ2luZS5nZXRFZmZlY3RzVm9sdW1lKCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLmFkSW5zKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNBdXRvU2hvdyA9ICEwO1xyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4odGhpcy5hZFVuaXRJZCwgXCI65pyq5Yib5bu677yM5omn6KGM5Yib5bu6XCIpO1xyXG4gICAgICAgICAgICB0aGlzLmxvYWRBZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5pc0NvbnN1bWUpIHtcclxuICAgICAgICAgICAgdGhpcy5yZUNyZWF0ZUFkKCEwKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNMb2FkZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQXV0b1Nob3cgPSAhMDtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCBjb25zb2xlLndhcm4odGhpcy5hZFVuaXRJZCwgXCI65pyq5Yqg6L295a6M5oiQ77yM56iN562JXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2hvd2luZykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2Fybih0aGlzLmFkVW5pdElkLCBcIuW5v+WRiuato+WcqOaYvuekuuS4rVwiKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93aW5nID0gITE7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMuc2hvdykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhdXNlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gdGhpcy5hZElucy5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG4gJiYgbi50aGVuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLmlzQ29uc3VtZSA9ICEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uc2hvd2luZyA9ICEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvLnNob3dDYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLnNob3dDYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLnNob3dDYWxsYmFjayA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKG8uYWRVbml0SWQsIFwiOnNob3fplJnor6/vvIzph43mlrDliqDovb1cIiwgdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5yZUNyZWF0ZUFkKCEwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IChjb25zb2xlLndhcm4odGhpcy5hZFVuaXRJZCwgXCI6c2hvd+aYvuekuuWksei0pe+8jOmHjeaWsOWKoOi9vVwiKSwgdGhpcy5yZUNyZWF0ZUFkKCEwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN1bWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcih0aGlzLmFkVW5pdElkLCBcIjrmnKrnn6XplJnor69cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnJlQ3JlYXRlQWQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIHQucHJvdG90eXBlLnJlQ3JlYXRlQWQuY2FsbCh0aGlzLCBlKTtcclxuICAgICAgICB0aGlzLnJlc3VtZSgpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLmF1dG9TaG93ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQXV0b1Nob3cpIHtcclxuICAgICAgICAgICAgdGhpcy5pc0F1dG9TaG93ID0gITE7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1Jld2FyZGVkVmlkZW8odGhpcy5zaG93Q2FsbGJhY2ssIHRoaXMuY2xvc2VDYWxsYmFjaywgdGhpcy52aWRlb0VuZENhbGxiYWNrKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUub25BZExvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdC5wcm90b3R5cGUub25BZExvYWQuY2FsbCh0aGlzKTtcclxuICAgICAgICB0aGlzLmlzQ29uc3VtZSA9ICExO1xyXG4gICAgICAgIHRoaXMuaXNMb2FkZWQgPSAhMDtcclxuICAgICAgICB0aGlzLnNob3dpbmcgPSAhMTtcclxuICAgICAgICB0aGlzLmF1dG9TaG93KCk7XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUub25BZEVycm9yID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICB0LnByb3RvdHlwZS5vbkFkRXJyb3IuY2FsbCh0aGlzLCBlKTtcclxuICAgICAgICB0aGlzLnNob3dpbmcgPSAhMTtcclxuICAgICAgICB0aGlzLnJlc3VtZSgpO1xyXG4gICAgICAgIHRoaXMuZGVzdHJveUFkKCk7XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUub25BZENsb3NlID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICB0LnByb3RvdHlwZS5vbkFkQ2xvc2UuY2FsbCh0aGlzLCBlKTtcclxuICAgICAgICB0aGlzLnNob3dpbmcgPSAhMTtcclxuICAgICAgICBlICYmIGUuaXNFbmRlZCA/IHRoaXMudmlkZW9FbmRDYWxsYmFjayAmJiB0aGlzLnZpZGVvRW5kQ2FsbGJhY2soKSA6IHRoaXMuY2xvc2VDYWxsYmFjayAmJiB0aGlzLmNsb3NlQ2FsbGJhY2soKTtcclxuICAgICAgICB0aGlzLmlzT3BlblByZUxvYWQgPyB0aGlzLmFkSW5zLmxvYWQoKSA6IHRoaXMuZGVzdHJveUFkKCk7XHJcbiAgICAgICAgdGhpcy5yZXN1bWUoKTtcclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5kZXN0cm95QWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdC5wcm90b3R5cGUuZGVzdHJveUFkLmNhbGwodGhpcyk7XHJcbiAgICAgICAgdGhpcy52aWRlb0VuZENhbGxiYWNrID0gbnVsbDtcclxuICAgICAgICBpZiAodGhpcy5hZElucykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5hZElucy5vZmZMb2FkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkSW5zLm9mZkxvYWQodGhpcy5vbkxvYWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFkSW5zLm9mZkNsb3NlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkSW5zLm9mZkNsb3NlKHRoaXMub25DbG9zZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMub2ZmRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMub2ZmRXJyb3IodGhpcy5vbkVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5hZElucy5kZXN0cm95KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkSW5zLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmFkSW5zID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGU7XHJcbn0pKCRiYXNlQWQuQmFzZUFkKTtcclxuZXhwb3J0cy5WSVZPUmV3YXJkZWRWaWRlbyA9IGE7XHJcbiJdfQ==