
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/OPPORewardedVideo.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '46c4dl/n7hCp56BrxF6M367', 'OPPORewardedVideo');
// game_script/scripts/OPPORewardedVideo.js

"use strict";

var o;
exports.OPPORewardedVideo = void 0;

var $baseAd = require("./BaseAd");

var r = window.qg;

var a = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.videoEndCallback = null;
    return e;
  }

  __extends(e, t);

  e.prototype.loadAd = function () {
    if (this.adUnitId) {
      var t = {
        adUnitId: this.adUnitId
      };
      this.adIns = r.createRewardedVideoAd(t);

      if (this.adIns.onLoad) {
        this.adIns.onLoad(this.onLoad);
      }

      if (this.adIns.onClose) {
        this.adIns.onClose(this.onClose);
      }

      if (this.adIns.onError) {
        this.adIns.onError(this.onError);
      }

      this.adIns.load();
    } else {
      console.error("激励视频ID为空");
    }
  };

  e.prototype.showRewardedVideo = function (t, e, i) {
    var o = this;
    this.showCallback = t;
    this.closeCallback = e;
    this.videoEndCallback = i;
    this.musicVolume = cc.audioEngine.getMusicVolume();
    this.effectsVolume = cc.audioEngine.getEffectsVolume();

    if (!this.adIns) {
      this.isAutoShow = !0;
      console.warn(this.adUnitId, ":未创建，执行创建");
      this.loadAd();
    }

    if (this.isConsume) {
      this.reCreateAd(!0);
    } else {
      {
        if (!this.isLoaded) {
          this.isAutoShow = !0;
          return void console.warn(this.adUnitId, ":未加载完成，稍等");
        }

        if (this.showing) {
          console.warn(this.adUnitId, "广告正在显示中");
        } else {
          this.showing = !1;

          if (this.adIns.show) {
            this.pause();
            var n = this.adIns.show();
            n && n.then ? n.then(function () {
              o.isConsume = !0;
              o.showing = !0;

              if (o.showCallback) {
                o.showCallback();
              }

              o.showCallback = null;
            })["catch"](function (t) {
              console.warn(o.adUnitId, ":show错误，重新加载", t);
              o.reCreateAd(!0);
            }) : (console.warn(this.adUnitId, ":show显示失败，重新加载"), this.reCreateAd(!0));
          } else {
            this.resume();
            console.error(this.adUnitId, ":未知错误");
          }
        }
      }
    }
  };

  e.prototype.reCreateAd = function (e) {
    t.prototype.reCreateAd.call(this, e);
    this.resume();
  };

  e.prototype.autoShow = function () {
    if (this.isAutoShow) {
      this.isAutoShow = !1;
      this.showRewardedVideo(this.showCallback, this.closeCallback, this.videoEndCallback);
    }
  };

  e.prototype.onAdLoad = function () {
    console.log(this.adUnitId, ":===onAdload===");
    this.isConsume = !1;
    this.isLoaded = !0;
    this.showing = !1;
    this.autoShow();
  };

  e.prototype.onAdError = function (t) {
    console.log("原生模板onAdError", this.adUnitId, t);
    this.showing = !1;
    this.resume();
    this.destroyAd();
  };

  e.prototype.onAdClose = function (t) {
    console.log(this.adUnitId, ":===onAdClose===");
    this.showing = !1;
    t && t.isEnded ? this.videoEndCallback && this.videoEndCallback() : this.closeCallback && this.closeCallback();
    this.isOpenPreLoad ? this.adIns.load() : this.destroyAd();
    this.resume();
  };

  e.prototype.destroyAd = function () {
    t.prototype.destroyAd.call(this);
    this.videoEndCallback = null;

    if (this.adIns) {
      if (this.adIns.offLoad) {
        this.adIns.offLoad(this.onLoad);
      }

      if (this.adIns.offClose) {
        this.adIns.offClose(this.onClose);
      }

      if (this.adIns.offError) {
        this.adIns.offError(this.onError);
      }

      if (this.adIns.destroy) {
        this.adIns.destroy();
      }

      this.adIns = null;
    }
  };

  return e;
}($baseAd.BaseAd);

exports.OPPORewardedVideo = a;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXE9QUE9SZXdhcmRlZFZpZGVvLmpzIl0sIm5hbWVzIjpbIm8iLCJleHBvcnRzIiwiT1BQT1Jld2FyZGVkVmlkZW8iLCIkYmFzZUFkIiwicmVxdWlyZSIsInIiLCJ3aW5kb3ciLCJxZyIsImEiLCJ0IiwiZSIsImFwcGx5IiwiYXJndW1lbnRzIiwidmlkZW9FbmRDYWxsYmFjayIsIl9fZXh0ZW5kcyIsInByb3RvdHlwZSIsImxvYWRBZCIsImFkVW5pdElkIiwiYWRJbnMiLCJjcmVhdGVSZXdhcmRlZFZpZGVvQWQiLCJvbkxvYWQiLCJvbkNsb3NlIiwib25FcnJvciIsImxvYWQiLCJjb25zb2xlIiwiZXJyb3IiLCJzaG93UmV3YXJkZWRWaWRlbyIsImkiLCJzaG93Q2FsbGJhY2siLCJjbG9zZUNhbGxiYWNrIiwibXVzaWNWb2x1bWUiLCJjYyIsImF1ZGlvRW5naW5lIiwiZ2V0TXVzaWNWb2x1bWUiLCJlZmZlY3RzVm9sdW1lIiwiZ2V0RWZmZWN0c1ZvbHVtZSIsImlzQXV0b1Nob3ciLCJ3YXJuIiwiaXNDb25zdW1lIiwicmVDcmVhdGVBZCIsImlzTG9hZGVkIiwic2hvd2luZyIsInNob3ciLCJwYXVzZSIsIm4iLCJ0aGVuIiwicmVzdW1lIiwiY2FsbCIsImF1dG9TaG93Iiwib25BZExvYWQiLCJsb2ciLCJvbkFkRXJyb3IiLCJkZXN0cm95QWQiLCJvbkFkQ2xvc2UiLCJpc0VuZGVkIiwiaXNPcGVuUHJlTG9hZCIsIm9mZkxvYWQiLCJvZmZDbG9zZSIsIm9mZkVycm9yIiwiZGVzdHJveSIsIkJhc2VBZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxDQUFKO0FBQ0FDLE9BQU8sQ0FBQ0MsaUJBQVIsR0FBNEIsS0FBSyxDQUFqQzs7QUFDQSxJQUFJQyxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxVQUFELENBQXJCOztBQUNBLElBQUlDLENBQUMsR0FBR0MsTUFBTSxDQUFDQyxFQUFmOztB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QUF3QixJQUF4Qjs7SUFDQSxJQUFJLEtBQUtLLEtBQVQsRUFBZ0I7TUFDWixJQUFJLEtBQUtBLEtBQUwsQ0FBV3NDLE9BQWYsRUFBd0I7UUFDcEIsS0FBS3RDLEtBQUwsQ0FBV3NDLE9BQVgsQ0FBbUIsS0FBS3BDLE1BQXhCO01BQ0g7O01BQ0QsSUFBSSxLQUFLRixLQUFMLENBQVd1QyxRQUFmLEVBQXlCO1FBQ3JCLEtBQUt2QyxLQUFMLENBQVd1QyxRQUFYLENBQW9CLEtBQUtwQyxPQUF6QjtNQUNIOztNQUNELElBQUksS0FBS0gsS0FBTCxDQUFXd0MsUUFBZixFQUF5QjtRQUNyQixLQUFLeEMsS0FBTCxDQUFXd0MsUUFBWCxDQUFvQixLQUFLcEMsT0FBekI7TUFDSDs7TUFDRCxJQUFJLEtBQUtKLEtBQUwsQ0FBV3lDLE9BQWYsRUFBd0I7UUFDcEIsS0FBS3pDLEtBQUwsQ0FBV3lDLE9BQVg7TUFDSDs7TUFDRCxLQUFLekMsS0FBTCxHQUFhLElBQWI7SUFDSDtFQUNKLENBbEJEOztFQW1CQSxPQUFPUixDQUFQO0FBQ0gsQ0EvSE8sQ0ErSExQLE9BQU8sQ0FBQ3lELE1BL0hILENBQVI7O0FBZ0lBM0QsT0FBTyxDQUFDQyxpQkFBUixHQUE0Qk0sQ0FBNUIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBvO1xyXG5leHBvcnRzLk9QUE9SZXdhcmRlZFZpZGVvID0gdm9pZCAwO1xyXG52YXIgJGJhc2VBZCA9IHJlcXVpcmUoXCIuL0Jhc2VBZFwiKTtcclxudmFyIHIgPSB3aW5kb3cucWc7XHJcbnZhciBhID0gKGZ1bmN0aW9uICh0KSB7XHJcbiAgICBmdW5jdGlvbiBlKCkge1xyXG4gICAgICAgIHZhciBlID0gKG51bGwgIT09IHQgJiYgdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSB8fCB0aGlzO1xyXG4gICAgICAgIGUudmlkZW9FbmRDYWxsYmFjayA9IG51bGw7XHJcbiAgICAgICAgcmV0dXJuIGU7XHJcbiAgICB9XHJcbiAgICBfX2V4dGVuZHMoZSwgdCk7XHJcbiAgICBlLnByb3RvdHlwZS5sb2FkQWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYWRVbml0SWQpIHtcclxuICAgICAgICAgICAgdmFyIHQgPSB7XHJcbiAgICAgICAgICAgICAgICBhZFVuaXRJZDogdGhpcy5hZFVuaXRJZFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmFkSW5zID0gci5jcmVhdGVSZXdhcmRlZFZpZGVvQWQodCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFkSW5zLm9uTG9hZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucy5vbkxvYWQodGhpcy5vbkxvYWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFkSW5zLm9uQ2xvc2UpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMub25DbG9zZSh0aGlzLm9uQ2xvc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFkSW5zLm9uRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMub25FcnJvcih0aGlzLm9uRXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuYWRJbnMubG9hZCgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCLmv4DlirHop4bpopFJROS4uuepulwiKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUuc2hvd1Jld2FyZGVkVmlkZW8gPSBmdW5jdGlvbiAodCwgZSwgaSkge1xyXG4gICAgICAgIHZhciBvID0gdGhpcztcclxuICAgICAgICB0aGlzLnNob3dDYWxsYmFjayA9IHQ7XHJcbiAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrID0gZTtcclxuICAgICAgICB0aGlzLnZpZGVvRW5kQ2FsbGJhY2sgPSBpO1xyXG4gICAgICAgIHRoaXMubXVzaWNWb2x1bWUgPSBjYy5hdWRpb0VuZ2luZS5nZXRNdXNpY1ZvbHVtZSgpO1xyXG4gICAgICAgIHRoaXMuZWZmZWN0c1ZvbHVtZSA9IGNjLmF1ZGlvRW5naW5lLmdldEVmZmVjdHNWb2x1bWUoKTtcclxuICAgICAgICBpZiAoIXRoaXMuYWRJbnMpIHtcclxuICAgICAgICAgICAgdGhpcy5pc0F1dG9TaG93ID0gITA7XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2Fybih0aGlzLmFkVW5pdElkLCBcIjrmnKrliJvlu7rvvIzmiafooYzliJvlu7pcIik7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZEFkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmlzQ29uc3VtZSkge1xyXG4gICAgICAgICAgICB0aGlzLnJlQ3JlYXRlQWQoITApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0xvYWRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNBdXRvU2hvdyA9ICEwO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIGNvbnNvbGUud2Fybih0aGlzLmFkVW5pdElkLCBcIjrmnKrliqDovb3lrozmiJDvvIznqI3nrYlcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zaG93aW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKHRoaXMuYWRVbml0SWQsIFwi5bm/5ZGK5q2j5Zyo5pi+56S65LitXCIpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dpbmcgPSAhMTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hZElucy5zaG93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGF1c2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSB0aGlzLmFkSW5zLnNob3coKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbiAmJiBuLnRoZW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uaXNDb25zdW1lID0gITA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5zaG93aW5nID0gITA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG8uc2hvd0NhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uc2hvd0NhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uc2hvd0NhbGxiYWNrID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oby5hZFVuaXRJZCwgXCI6c2hvd+mUmeivr++8jOmHjeaWsOWKoOi9vVwiLCB0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLnJlQ3JlYXRlQWQoITApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogKGNvbnNvbGUud2Fybih0aGlzLmFkVW5pdElkLCBcIjpzaG935pi+56S65aSx6LSl77yM6YeN5paw5Yqg6L29XCIpLCB0aGlzLnJlQ3JlYXRlQWQoITApKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3VtZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKHRoaXMuYWRVbml0SWQsIFwiOuacquefpemUmeivr1wiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUucmVDcmVhdGVBZCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgdC5wcm90b3R5cGUucmVDcmVhdGVBZC5jYWxsKHRoaXMsIGUpO1xyXG4gICAgICAgIHRoaXMucmVzdW1lKCk7XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUuYXV0b1Nob3cgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBdXRvU2hvdykge1xyXG4gICAgICAgICAgICB0aGlzLmlzQXV0b1Nob3cgPSAhMTtcclxuICAgICAgICAgICAgdGhpcy5zaG93UmV3YXJkZWRWaWRlbyh0aGlzLnNob3dDYWxsYmFjaywgdGhpcy5jbG9zZUNhbGxiYWNrLCB0aGlzLnZpZGVvRW5kQ2FsbGJhY2spO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5vbkFkTG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmFkVW5pdElkLCBcIjo9PT1vbkFkbG9hZD09PVwiKTtcclxuICAgICAgICB0aGlzLmlzQ29uc3VtZSA9ICExO1xyXG4gICAgICAgIHRoaXMuaXNMb2FkZWQgPSAhMDtcclxuICAgICAgICB0aGlzLnNob3dpbmcgPSAhMTtcclxuICAgICAgICB0aGlzLmF1dG9TaG93KCk7XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUub25BZEVycm9yID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIuWOn+eUn+aooeadv29uQWRFcnJvclwiLCB0aGlzLmFkVW5pdElkLCB0KTtcclxuICAgICAgICB0aGlzLnNob3dpbmcgPSAhMTtcclxuICAgICAgICB0aGlzLnJlc3VtZSgpO1xyXG4gICAgICAgIHRoaXMuZGVzdHJveUFkKCk7XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUub25BZENsb3NlID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmFkVW5pdElkLCBcIjo9PT1vbkFkQ2xvc2U9PT1cIik7XHJcbiAgICAgICAgdGhpcy5zaG93aW5nID0gITE7XHJcbiAgICAgICAgdCAmJiB0LmlzRW5kZWQgPyB0aGlzLnZpZGVvRW5kQ2FsbGJhY2sgJiYgdGhpcy52aWRlb0VuZENhbGxiYWNrKCkgOiB0aGlzLmNsb3NlQ2FsbGJhY2sgJiYgdGhpcy5jbG9zZUNhbGxiYWNrKCk7XHJcbiAgICAgICAgdGhpcy5pc09wZW5QcmVMb2FkID8gdGhpcy5hZElucy5sb2FkKCkgOiB0aGlzLmRlc3Ryb3lBZCgpO1xyXG4gICAgICAgIHRoaXMucmVzdW1lKCk7XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUuZGVzdHJveUFkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHQucHJvdG90eXBlLmRlc3Ryb3lBZC5jYWxsKHRoaXMpO1xyXG4gICAgICAgIHRoaXMudmlkZW9FbmRDYWxsYmFjayA9IG51bGw7XHJcbiAgICAgICAgaWYgKHRoaXMuYWRJbnMpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMub2ZmTG9hZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucy5vZmZMb2FkKHRoaXMub25Mb2FkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5hZElucy5vZmZDbG9zZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucy5vZmZDbG9zZSh0aGlzLm9uQ2xvc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFkSW5zLm9mZkVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkSW5zLm9mZkVycm9yKHRoaXMub25FcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMuZGVzdHJveSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucy5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5hZElucyA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBlO1xyXG59KSgkYmFzZUFkLkJhc2VBZCk7XHJcbmV4cG9ydHMuT1BQT1Jld2FyZGVkVmlkZW8gPSBhO1xyXG4iXX0=