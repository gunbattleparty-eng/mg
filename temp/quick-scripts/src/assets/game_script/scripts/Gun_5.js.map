{"version":3,"sources":["assets\\game_script\\scripts\\Gun_5.js"],"names":["o","$assetsLoader","require","$assetsMap","$resUtil","$eventManager","$remoteAudio","$seedUtil","$configContext","$globalParam","$localEventName","$roleContext","$baseBullet","$gameContext","$gameGemInfo","$gameSkillInfo","$baseGun","v","cc","Vec3","ZERO","b","t","e","i","call","nextXs","sendBulletLeftTime","skinAtkLeftCd","skinAtkCurrCount","skillId","skillParam","ins","skillInfo","getSkillById","__extends","prototype","updateF","isGamePuase","currSkinInfo","skin","skinAtkTargetCount","sendSkinBullet","carComboTime","createButtle","timeLeft","skillCD","Skill4Param","FINAL","send","RENDER_SKILL_CD_INFO","starGun","carComboCount","GameGemInfo","hasGem","GemType","AddSkill","probability","get1","getNearbyN2","length","getPosition","sub","pointNode","position","magSqr","skillAtkRange","push","x","getRangeRankEnemy","SEND_SKILL_ANIM","getButtlePool","BulletType","s_bullet_5","instance","getRes","BundleNames","Game","AssetsMap","GameBundles","prefabs","assetsList","SBullet_5","ResUtil","instantiate","robotFlyLayer","parent","getComponent","y","winSize","height","setPosition","clone","targetEnemy","initButtle","insert","skinAtkCd","playEffectMusic","shift","car","Bullet_13","buttleLayer","skillSpecialitys","basicSkillConfigMap","get","skill_tpye","isGem","v3","lowBulletLayer","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var o;\r\nvar $assetsLoader = require(\"./AssetsLoader\");\r\nvar $assetsMap = require(\"./AssetsMap\");\r\nvar $resUtil = require(\"./ResUtil\");\r\nvar $eventManager = require(\"./EventManager\");\r\nvar $remoteAudio = require(\"./RemoteAudio\");\r\nvar $seedUtil = require(\"./SeedUtil\");\r\nvar $configContext = require(\"./ConfigContext\");\r\nvar $globalParam = require(\"./GlobalParam\");\r\nvar $localEventName = require(\"./LocalEventName\");\r\nvar $roleContext = require(\"./RoleContext\");\r\nvar $baseBullet = require(\"./BaseBullet\");\r\nvar $gameContext = require(\"./GameContext\");\r\nvar $gameGemInfo = require(\"./GameGemInfo\");\r\nvar $gameSkillInfo = require(\"./GameSkillInfo\");\r\nvar $baseGun = require(\"./BaseGun\");\r\nvar v = cc.Vec3.ZERO;\r\nvar b = (function (t) {\r\n    function e(e) {\r\n        var i = t.call(this, e) || this;\r\n        i.nextXs = [];\r\n        i.sendBulletLeftTime = 0;\r\n        i.skinAtkLeftCd = 0;\r\n        i.skinAtkCurrCount = 0;\r\n        i.skillId = 81;\r\n        i.skillParam = $gameContext.default.ins.skillInfo.getSkillById(i.skillId);\r\n        return i;\r\n    }\r\n    __extends(e, t);\r\n    e.prototype.updateF = function (e) {\r\n        t.prototype.updateF.call(this, e);\r\n        if (!$globalParam.default.isGamePuase) {\r\n            if (\r\n                5 === $roleContext.default.ins.currSkinInfo.skin &&\r\n                this.skinAtkCurrCount >= $gameContext.default.ins.skillInfo.skinAtkTargetCount\r\n            ) {\r\n                this.skinAtkLeftCd -= e;\r\n                if (this.skinAtkLeftCd <= 0) {\r\n                    this.sendSkinBullet();\r\n                }\r\n            }\r\n            this.sendBulletLeftTime -= e;\r\n            if (this.sendBulletLeftTime <= 0) {\r\n                this.sendBulletLeftTime = this.skillParam.carComboTime;\r\n                this.createButtle();\r\n            }\r\n            this.timeLeft -= e;\r\n            this.timeLeft <= 0\r\n                ? ((this.timeLeft = this.skillParam.skillCD[$gameSkillInfo.Skill4Param.FINAL]),\r\n                  $eventManager.default.send($localEventName.default.RENDER_SKILL_CD_INFO, this.skillId, 0, -1),\r\n                  this.starGun() || (this.timeLeft = 0))\r\n                : $eventManager.default.send(\r\n                      $localEventName.default.RENDER_SKILL_CD_INFO,\r\n                      this.skillId,\r\n                      this.timeLeft / this.skillParam.skillCD[$gameSkillInfo.Skill4Param.FINAL],\r\n                      -1\r\n                  );\r\n        }\r\n    };\r\n    e.prototype.starGun = function () {\r\n        var t = this.skillParam.carComboCount;\r\n        if (\r\n            $gameGemInfo.GameGemInfo.ins.hasGem($gameGemInfo.GemType.AddSkill) &&\r\n            $seedUtil.default.probability(100 * $gameGemInfo.GameGemInfo.ins.get1($gameGemInfo.GemType.AddSkill))\r\n        ) {\r\n            t *= 2;\r\n        }\r\n        var e = $gameContext.default.ins.getNearbyN2(null, t);\r\n        if (\r\n            e.length <= 0 ||\r\n            e[0].getPosition().sub(this.pointNode.position).magSqr() >\r\n                this.skillParam.skillAtkRange[$gameSkillInfo.Skill4Param.FINAL] *\r\n                    this.skillParam.skillAtkRange[$gameSkillInfo.Skill4Param.FINAL]\r\n        ) {\r\n            return !1;\r\n        }\r\n        for (var i = 0; i < e.length; i++) {\r\n            this.nextXs.push(e[i].getPosition().x);\r\n        }\r\n        return !0;\r\n    };\r\n    e.prototype.sendSkinBullet = function () {\r\n        var t = $gameContext.default.ins.getRangeRankEnemy(\r\n            this.pointNode,\r\n            this.skillParam.skillAtkRange[$gameSkillInfo.Skill4Param.FINAL]\r\n        );\r\n        if (!t) {\r\n            this.skinAtkLeftCd = 2;\r\n            return !1;\r\n        }\r\n        $eventManager.default.send($localEventName.default.SEND_SKILL_ANIM);\r\n        var e = $gameContext.default.ins.getButtlePool($baseBullet.BulletType.s_bullet_5);\r\n        if (!e) {\r\n            var i = $assetsLoader.default.instance.getRes(\r\n                $assetsMap.BundleNames.Game,\r\n                $assetsMap.AssetsMap.GameBundles.prefabs.assetsList.SBullet_5\r\n            );\r\n            e = $resUtil.ResUtil.instantiate(i, $gameContext.default.ins.robotFlyLayer.parent).getComponent(\r\n                $baseBullet.default\r\n            );\r\n        }\r\n        v.x = 0;\r\n        v.y = -cc.winSize.height / 2 - 30;\r\n        e.setPosition(v.clone());\r\n        e.targetEnemy = t;\r\n        v.x = 0;\r\n        v.y = 1;\r\n        e.initButtle(v, this.skillId);\r\n        e.insert($gameContext.default.ins.robotFlyLayer);\r\n        this.skinAtkCurrCount = 0;\r\n        this.skinAtkLeftCd = $gameContext.default.ins.skillInfo.skinAtkCd;\r\n    };\r\n    e.prototype.createButtle = function () {\r\n        if (!(this.nextXs.length <= 0)) {\r\n            $remoteAudio.default.instance.playEffectMusic(\"firecar\");\r\n            var t = this.nextXs.shift();\r\n            var e = $gameContext.default.ins.getButtlePool($baseBullet.BulletType.car);\r\n            if (!e) {\r\n                var i = $assetsLoader.default.instance.getRes(\r\n                    $assetsMap.BundleNames.Game,\r\n                    $assetsMap.AssetsMap.GameBundles.prefabs.assetsList.Bullet_13\r\n                );\r\n                (e = $resUtil.ResUtil.instantiate(i, $gameContext.default.ins.buttleLayer.parent).getComponent(\r\n                    $baseBullet.default\r\n                )).skillSpecialitys = $configContext.default.instance.basicSkillConfigMap.get(this.skillId).skill_tpye;\r\n            }\r\n            e.isGem = !1;\r\n            e.setPosition(cc.v3(t, -350));\r\n            v.x = 0;\r\n            v.y = 1;\r\n            e.initButtle(v, this.skillId);\r\n            e.insert($gameContext.default.ins.lowBulletLayer);\r\n            this.skinAtkCurrCount++;\r\n        }\r\n    };\r\n    return e;\r\n})($baseGun.default);\r\nexports.default = b;\r\n"]}