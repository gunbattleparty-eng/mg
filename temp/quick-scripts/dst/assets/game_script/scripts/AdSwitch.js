
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/AdSwitch.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'bc9c7U1iz9IZqMjLnqSn3to', 'AdSwitch');
// game_script/scripts/AdSwitch.js

"use strict";

exports.AdSwitch = exports.AdTypeCode = void 0;
var o;
var n;

var $platform = require("./Platform");

var $aDConfig = require("./ADConfig");

(n = o = exports.AdTypeCode || (exports.AdTypeCode = {}))[n.VIDEO = 1] = "VIDEO";
n[n.BANNER = 2] = "BANNER";
n[n.INTERSTITIAL = 3] = "INTERSTITIAL";
n[n.NATIVE_CUSTOM_ICON = 19] = "NATIVE_CUSTOM_ICON";
n[n.NATIVE_CUSTOM_PATCH = 18] = "NATIVE_CUSTOM_PATCH";

var a = function () {
  function t() {
    this.path = "https://cooperation.sjyywy.com/web2/glob_ad_config/local";
    this.localPath = "https://backend.pailedi.com/index.php/getClientAddress";
    this.localInfo = null;
    this.switchParam = null;
    this.currVersion = 0;
  }

  t.prototype.initOpen = function (t, e) {
    var i = this;
    this.currVersion = e;
    var o = "/ad_" + t + ".json";
    var n = new Date().getTime();
    var s = [this.path + o + "?sign=" + n];
    this.loadNetResArray(s, null).then(function (t) {
      i.switchParam = t;

      try {
        fly.get(i.localPath, null, {
          baseURL: ""
        }).then(function (t) {
          i.localInfo = t;
          console.log(i.localInfo, "==============");
        });
      } catch (t) {
        console.error(t);
      }
    });
  };

  t.prototype.initAd = function () {
    if (this.localInfo && this.localInfo.city) {
      this.localInfo.city = this.localInfo.city.replace("å¸‚", "");

      if (this.switchParam.blacklist.includes(this.localInfo.city)) {
        this.switchParam.switchStatus = 1;
      }
    }

    var t = this.getDetailConfig(o.VIDEO);
    var e = this.getDetailConfig(o.BANNER);
    var i = this.getDetailConfig(o.INTERSTITIAL);
    var n = this.checkSwitch(t.switchStatus) ? t.adParam : "";
    var a = this.checkSwitchAll(e) ? e.adParam : "";
    var l = this.checkSwitchAll(e) ? i.adParam : "";

    if ($platform.Platform.currPlatForm === $platform.PlatformEnum.VIVO) {
      $aDConfig.ADConfig.vivo.rewarded_video_id = n;
      $aDConfig.ADConfig.vivo.banner_id = a;
      $aDConfig.ADConfig.vivo.native_ad_ids = "" === l ? [] : [l];
    }
  };

  t.prototype.checkSwitchAll = function (t) {
    if (this.switchParam.switchVersion < this.currVersion) {
      return !1;
    }

    var e = this.checkSwitch(this.switchParam.switchStatus);
    var i = this.checkSwitch(t.switchStatus);
    return !(!e || !i);
  };

  t.prototype.checkSwitch = function (t) {
    return 0 === t;
  };

  t.prototype.getDetailConfig = function (t) {
    return this.switchParam.saDetailConfigParams.find(function (e) {
      return e.saTypeId === t;
    });
  };

  t.prototype.loadNetResArray = function (t, e) {
    var i = [];

    for (var o = 0; o < t.length; o++) {
      i.push({
        url: t[o]
      });
    }

    return new Promise(function (t, o) {
      cc.assetManager.loadAny(i, function (t, i) {
        if (e) {
          e(t, i);
        }
      }, function (e, i) {
        e ? o(e) : t(i);
      });
    });
  };

  t.instance = new t();
  return t;
}();

exports.AdSwitch = a;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXEFkU3dpdGNoLmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJBZFN3aXRjaCIsIkFkVHlwZUNvZGUiLCJvIiwibiIsIiRwbGF0Zm9ybSIsInJlcXVpcmUiLCIkYURDb25maWciLCJWSURFTyIsIkJBTk5FUiIsIklOVEVSU1RJVElBTCIsIk5BVElWRV9DVVNUT01fSUNPTiIsIk5BVElWRV9DVVNUT01fUEFUQ0giLCJhIiwidCIsInBhdGgiLCJsb2NhbFBhdGgiLCJsb2NhbEluZm8iLCJzd2l0Y2hQYXJhbSIsImN1cnJWZXJzaW9uIiwicHJvdG90eXBlIiwiaW5pdE9wZW4iLCJlIiwiaSIsIkRhdGUiLCJnZXRUaW1lIiwicyIsImxvYWROZXRSZXNBcnJheSIsInRoZW4iLCJmbHkiLCJnZXQiLCJiYXNlVVJMIiwiY29uc29sZSIsImxvZyIsImVycm9yIiwiaW5pdEFkIiwiY2l0eSIsInJlcGxhY2UiLCJibGFja2xpc3QiLCJpbmNsdWRlcyIsInN3aXRjaFN0YXR1cyIsImdldERldGFpbENvbmZpZyIsImNoZWNrU3dpdGNoIiwiYWRQYXJhbSIsImNoZWNrU3dpdGNoQWxsIiwibCIsIlBsYXRmb3JtIiwiY3VyclBsYXRGb3JtIiwiUGxhdGZvcm1FbnVtIiwiVklWTyIsIkFEQ29uZmlnIiwidml2byIsInJld2FyZGVkX3ZpZGVvX2lkIiwiYmFubmVyX2lkIiwibmF0aXZlX2FkX2lkcyIsInN3aXRjaFZlcnNpb24iLCJzYURldGFpbENvbmZpZ1BhcmFtcyIsImZpbmQiLCJzYVR5cGVJZCIsImxlbmd0aCIsInB1c2giLCJ1cmwiLCJQcm9taXNlIiwiY2MiLCJhc3NldE1hbmFnZXIiLCJsb2FkQW55IiwiaW5zdGFuY2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLE9BQU8sQ0FBQ0MsUUFBUixHQUFtQkQsT0FBTyxDQUFDRSxVQUFSLEdBQXFCLEtBQUssQ0FBN0M7QUFDQSxJQUFJQyxDQUFKO0FB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QUFJRCxDQUFKLEVBQU87VUFDSEEsQ0FBQyxDQUFDUixDQUFELEVBQUlTLENBQUosQ0FBRDtRQUNIO01BQ0osQ0FOTCxFQU9JLFVBQVVELENBQVYsRUFBYUMsQ0FBYixFQUFnQjtRQUNaRCxDQUFDLEdBQUduQixDQUFDLENBQUNtQixDQUFELENBQUosR0FBVVIsQ0FBQyxDQUFDUyxDQUFELENBQVo7TUFDSCxDQVRMO0lBV0gsQ0FaTSxDQUFQO0VBYUgsQ0FwQkQ7O0VBcUJBVCxDQUFDLENBQUNvRCxRQUFGLEdBQWEsSUFBSXBELENBQUosRUFBYjtFQUNBLE9BQU9BLENBQVA7QUFDSCxDQXRGTyxFQUFSOztBQXVGQWQsT0FBTyxDQUFDQyxRQUFSLEdBQW1CWSxDQUFuQiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0cy5BZFN3aXRjaCA9IGV4cG9ydHMuQWRUeXBlQ29kZSA9IHZvaWQgMDtcclxudmFyIG87XHJcbnZhciBuO1xyXG52YXIgJHBsYXRmb3JtID0gcmVxdWlyZShcIi4vUGxhdGZvcm1cIik7XHJcbnZhciAkYURDb25maWcgPSByZXF1aXJlKFwiLi9BRENvbmZpZ1wiKTtcclxuKG4gPSBvID0gZXhwb3J0cy5BZFR5cGVDb2RlIHx8IChleHBvcnRzLkFkVHlwZUNvZGUgPSB7fSkpWyhuLlZJREVPID0gMSldID0gXCJWSURFT1wiO1xyXG5uWyhuLkJBTk5FUiA9IDIpXSA9IFwiQkFOTkVSXCI7XHJcbm5bKG4uSU5URVJTVElUSUFMID0gMyldID0gXCJJTlRFUlNUSVRJQUxcIjtcclxublsobi5OQVRJVkVfQ1VTVE9NX0lDT04gPSAxOSldID0gXCJOQVRJVkVfQ1VTVE9NX0lDT05cIjtcclxublsobi5OQVRJVkVfQ1VTVE9NX1BBVENIID0gMTgpXSA9IFwiTkFUSVZFX0NVU1RPTV9QQVRDSFwiO1xyXG52YXIgYSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiB0KCkge1xyXG4gICAgICAgIHRoaXMucGF0aCA9IFwiaHR0cHM6Ly9jb29wZXJhdGlvbi5zanl5d3kuY29tL3dlYjIvZ2xvYl9hZF9jb25maWcvbG9jYWxcIjtcclxuICAgICAgICB0aGlzLmxvY2FsUGF0aCA9IFwiaHR0cHM6Ly9iYWNrZW5kLnBhaWxlZGkuY29tL2luZGV4LnBocC9nZXRDbGllbnRBZGRyZXNzXCI7XHJcbiAgICAgICAgdGhpcy5sb2NhbEluZm8gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuc3dpdGNoUGFyYW0gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuY3VyclZlcnNpb24gPSAwO1xyXG4gICAgfVxyXG4gICAgdC5wcm90b3R5cGUuaW5pdE9wZW4gPSBmdW5jdGlvbiAodCwgZSkge1xyXG4gICAgICAgIHZhciBpID0gdGhpcztcclxuICAgICAgICB0aGlzLmN1cnJWZXJzaW9uID0gZTtcclxuICAgICAgICB2YXIgbyA9IFwiL2FkX1wiICsgdCArIFwiLmpzb25cIjtcclxuICAgICAgICB2YXIgbiA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgIHZhciBzID0gW3RoaXMucGF0aCArIG8gKyBcIj9zaWduPVwiICsgbl07XHJcbiAgICAgICAgdGhpcy5sb2FkTmV0UmVzQXJyYXkocywgbnVsbCkudGhlbihmdW5jdGlvbiAodCkge1xyXG4gICAgICAgICAgICBpLnN3aXRjaFBhcmFtID0gdDtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGZseS5nZXQoaS5sb2NhbFBhdGgsIG51bGwsIHtcclxuICAgICAgICAgICAgICAgICAgICBiYXNlVVJMOiBcIlwiXHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaS5sb2NhbEluZm8gPSB0O1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGkubG9jYWxJbmZvLCBcIj09PT09PT09PT09PT09XCIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IodCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5pbml0QWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubG9jYWxJbmZvICYmIHRoaXMubG9jYWxJbmZvLmNpdHkpIHtcclxuICAgICAgICAgICAgdGhpcy5sb2NhbEluZm8uY2l0eSA9IHRoaXMubG9jYWxJbmZvLmNpdHkucmVwbGFjZShcIuW4glwiLCBcIlwiKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc3dpdGNoUGFyYW0uYmxhY2tsaXN0LmluY2x1ZGVzKHRoaXMubG9jYWxJbmZvLmNpdHkpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaFBhcmFtLnN3aXRjaFN0YXR1cyA9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHQgPSB0aGlzLmdldERldGFpbENvbmZpZyhvLlZJREVPKTtcclxuICAgICAgICB2YXIgZSA9IHRoaXMuZ2V0RGV0YWlsQ29uZmlnKG8uQkFOTkVSKTtcclxuICAgICAgICB2YXIgaSA9IHRoaXMuZ2V0RGV0YWlsQ29uZmlnKG8uSU5URVJTVElUSUFMKTtcclxuICAgICAgICB2YXIgbiA9IHRoaXMuY2hlY2tTd2l0Y2godC5zd2l0Y2hTdGF0dXMpID8gdC5hZFBhcmFtIDogXCJcIjtcclxuICAgICAgICB2YXIgYSA9IHRoaXMuY2hlY2tTd2l0Y2hBbGwoZSkgPyBlLmFkUGFyYW0gOiBcIlwiO1xyXG4gICAgICAgIHZhciBsID0gdGhpcy5jaGVja1N3aXRjaEFsbChlKSA/IGkuYWRQYXJhbSA6IFwiXCI7XHJcbiAgICAgICAgaWYgKCRwbGF0Zm9ybS5QbGF0Zm9ybS5jdXJyUGxhdEZvcm0gPT09ICRwbGF0Zm9ybS5QbGF0Zm9ybUVudW0uVklWTykge1xyXG4gICAgICAgICAgICAkYURDb25maWcuQURDb25maWcudml2by5yZXdhcmRlZF92aWRlb19pZCA9IG47XHJcbiAgICAgICAgICAgICRhRENvbmZpZy5BRENvbmZpZy52aXZvLmJhbm5lcl9pZCA9IGE7XHJcbiAgICAgICAgICAgICRhRENvbmZpZy5BRENvbmZpZy52aXZvLm5hdGl2ZV9hZF9pZHMgPSBcIlwiID09PSBsID8gW10gOiBbbF07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHQucHJvdG90eXBlLmNoZWNrU3dpdGNoQWxsID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICBpZiAodGhpcy5zd2l0Y2hQYXJhbS5zd2l0Y2hWZXJzaW9uIDwgdGhpcy5jdXJyVmVyc2lvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gITE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBlID0gdGhpcy5jaGVja1N3aXRjaCh0aGlzLnN3aXRjaFBhcmFtLnN3aXRjaFN0YXR1cyk7XHJcbiAgICAgICAgdmFyIGkgPSB0aGlzLmNoZWNrU3dpdGNoKHQuc3dpdGNoU3RhdHVzKTtcclxuICAgICAgICByZXR1cm4gISghZSB8fCAhaSk7XHJcbiAgICB9O1xyXG4gICAgdC5wcm90b3R5cGUuY2hlY2tTd2l0Y2ggPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHJldHVybiAwID09PSB0O1xyXG4gICAgfTtcclxuICAgIHQucHJvdG90eXBlLmdldERldGFpbENvbmZpZyA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3dpdGNoUGFyYW0uc2FEZXRhaWxDb25maWdQYXJhbXMuZmluZChmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZS5zYVR5cGVJZCA9PT0gdDtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5sb2FkTmV0UmVzQXJyYXkgPSBmdW5jdGlvbiAodCwgZSkge1xyXG4gICAgICAgIHZhciBpID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgbyA9IDA7IG8gPCB0Lmxlbmd0aDsgbysrKSB7XHJcbiAgICAgICAgICAgIGkucHVzaCh7XHJcbiAgICAgICAgICAgICAgICB1cmw6IHRbb11cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAodCwgbykge1xyXG4gICAgICAgICAgICBjYy5hc3NldE1hbmFnZXIubG9hZEFueShcclxuICAgICAgICAgICAgICAgIGksXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAodCwgaSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUodCwgaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlLCBpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZSA/IG8oZSkgOiB0KGkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHQuaW5zdGFuY2UgPSBuZXcgdCgpO1xyXG4gICAgcmV0dXJuIHQ7XHJcbn0pKCk7XHJcbmV4cG9ydHMuQWRTd2l0Y2ggPSBhO1xyXG4iXX0=