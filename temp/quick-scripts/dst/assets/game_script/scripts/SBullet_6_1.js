
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/SBullet_6_1.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '4dca7b8nrlLur9d6MJ1Z9y9', 'SBullet_6_1');
// game_script/scripts/SBullet_6_1.js

"use strict";

var o;

var $object = require("./Object");

var $util = require("./Util");

var $gameContext = require("./GameContext");

var $baseBullet = require("./BaseBullet");

var u = cc._decorator;
var d = u.ccclass;
var p = (u.property, new cc.Vec3());

var f = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.buttleType = $baseBullet.BulletType.s_bullet_6_1;
    e.targetEnemy = null;
    e.leftTime = 0;
    e.findLeftTime = 0;
    e.status = 0;
    e.angleSpeed = 3;
    return e;
  }

  __extends(e, t);

  e.prototype.initButtle = function (e) {
    this.speed = $gameContext["default"].ins.skillInfo.skinParam[6];
    t.prototype.initButtle.call(this, e, null);

    if (e) {
      this.velocity.set(e).multiplyScalar(this.speed);
    }

    this.leftTime = $gameContext["default"].ins.skillInfo.skinParam[5];
    this.targetEnemy.addDieCallback(this.dieEnemy, this);
    this.isUse = !1;
    this.atk = $gameContext["default"].ins.skillInfo.skinAtk;
    this.status = 1;
  };

  e.prototype.dieEnemy = function () {
    this.changeEnemy();
  };

  e.prototype.changeEnemy = function () {
    var t = $gameContext["default"].ins.getRandomEnemy(this.targetEnemy);
    t ? (this.targetEnemy = t, this.targetEnemy.addDieCallback(this.dieEnemy, this), this.status = 1) : this.status = 0;
  };

  e.prototype.updateFrame = function (t) {
    if (!this.isUse) {
      this.leftTime -= t;

      if (this.leftTime <= 0) {
        this.isUse = !0;
        return this.removeSelf();
      }

      0 === this.status ? (this.findLeftTime -= t, this.findLeftTime <= 0 && (this.findLeftTime = 1.5, this.changeEnemy()), this.move(t)) : 1 === this.status && (this.getPosition().subtract(this.targetEnemy.getPosition()).magSqr() <= 900 ? this.move(t) : this.trace(t));
    }
  };

  e.prototype.trace = function (t) {
    var e = this.lerpAngleRes(this.targetEnemy.getPosition().subtract(this.getPosition()));
    this.setAngle(e);
    this.velocity.set($util["default"].angleConverDir(e).normalizeSelf()).mulSelf(this.speed);
    this.move(t);
  };

  e.prototype.lerpAngleRes = function (t) {
    var e = ($util["default"].dirConverAngle(t) + 360) % 360;
    var i = (this.node.angle + 360) % 360;
    return Math.abs(i - e) <= this.angleSpeed ? e : ((i - e + 360) % 360 < (e - i + 360) % 360 ? i -= this.angleSpeed : i += this.angleSpeed, i);
  };

  e.prototype.move = function (t) {
    var e = this.getPosition();
    var i = this.velocity;
    p.x = e.x + i.x * t;
    p.y = e.y + i.y * t;
    p.z = e.z + i.z * t;

    if (p.x < -335 || p.x > 335) {
      p.x = e.x;
      this.velocity.x = -this.velocity.x;
      var o = $util["default"].dirConverAngle(this.velocity);
      this.setAngle(o);
    }

    if (p.y < -365 || p.y > cc.winSize.height / 2 - 25) {
      p.y = e.y;
      this.velocity.y = -this.velocity.y;
      o = $util["default"].dirConverAngle(this.velocity);
      this.setAngle(o);
    }

    this.setPosition(p);
  };

  e.prototype.onTrigger = function (t, e) {
    if (e == $object.Trigger.enter) {
      t.object.sufferAtk({
        skillSpecialitys: this.skillSpecialitys,
        atk: this.atk
      });
    }
  };

  return __decorate([d], e);
}($baseBullet["default"]);

exports["default"] = f;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXFNCdWxsZXRfNl8xLmpzIl0sIm5hbWVzIjpbIm8iLCIkb2JqZWN0IiwicmVxdWlyZSIsIiR1dGlsIiwiJGdhbWVDb250ZXh0IiwiJGJhc2VCdWxsZXQiLCJ1IiwiY2MiLCJfZGVjb3JhdG9yIiwiZCIsImNjY2xhc3MiLCJwIiwicHJvcGVydHkiLCJWZWMzIiwiZiIsInQiLCJlIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJidXR0bGVUeXBlIiwiQnVsbGV0VHlwZSIsInNfYnVsbGV0XzZfMSIsInRhcmdldEVuZW15IiwibGVmdFRpbWUiLCJmaW5kTGVmdFRpbWUiLCJzdGF0dXMiLCJhbmdsZVNwZWVkIiwiX19leHRlbmRzIiwicHJvdG90eXBlIiwiaW5pdEJ1dHRsZSIsInNwZWVkIiwiaW5zIiwic2tpbGxJbmZvIiwic2tpblBhcmFtIiwiY2FsbCIsInZlbG9jaXR5Iiwic2V0IiwibXVsdGlwbHlTY2FsYXIiLCJhZGREaWVDYWxsYmFjayIsImRpZUVuZW15IiwiaXNVc2UiLCJhdGsiLCJza2luQXRrIiwiY2hhbmdlRW5lbXkiLCJnZXRSYW5kb21FbmVteSIsInVwZGF0ZUZyYW1lIiwicmVtb3ZlU2VsZiIsIm1vdmUiLCJnZXRQb3NpdGlvbiIsInN1YnRyYWN0IiwibWFnU3FyIiwidHJhY2UiLCJsZXJwQW5nbGVSZXMiLCJzZXRBbmdsZSIsImFuZ2xlQ29udmVyRGlyIiwibm9ybWFsaXplU2VsZiIsIm11bFNlbGYiLCJkaXJDb252ZXJBbmdsZSIsImkiLCJub2RlIiwiYW5nbGUiLCJNYXRoIiwiYWJzIiwieCIsInkiLCJ6Iiwid2luU2l6ZSIsImhlaWdodCIsInNldFBvc2l0aW9uIiwib25UcmlnZ2VyIiwiVHJpZ2dlciIsImVudGVyIiwib2JqZWN0Iiwic3VmZmVyQXRrIiwic2tpbGxTcGVjaWFsaXR5cyIsIl9fZGVjb3JhdGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFB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RWZqQyxHQUFHLEVBQUUsS0FBS0E7TUFGSyxDQUFuQjtJQUlIO0VBQ0osQ0FQRDs7RUFRQSxPQUFPa0MsVUFBVSxDQUFDLENBQUNsRSxDQUFELENBQUQsRUFBTU8sQ0FBTixDQUFqQjtBQUNILENBNUZPLENBNEZMWCxXQUFXLFdBNUZOLENBQVI7O0FBNkZBdUUsT0FBTyxXQUFQLEdBQWtCOUQsQ0FBbEIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBvO1xyXG52YXIgJG9iamVjdCA9IHJlcXVpcmUoXCIuL09iamVjdFwiKTtcclxudmFyICR1dGlsID0gcmVxdWlyZShcIi4vVXRpbFwiKTtcclxudmFyICRnYW1lQ29udGV4dCA9IHJlcXVpcmUoXCIuL0dhbWVDb250ZXh0XCIpO1xyXG52YXIgJGJhc2VCdWxsZXQgPSByZXF1aXJlKFwiLi9CYXNlQnVsbGV0XCIpO1xyXG52YXIgdSA9IGNjLl9kZWNvcmF0b3I7XHJcbnZhciBkID0gdS5jY2NsYXNzO1xyXG52YXIgcCA9ICh1LnByb3BlcnR5LCBuZXcgY2MuVmVjMygpKTtcclxudmFyIGYgPSAoZnVuY3Rpb24gKHQpIHtcclxuICAgIGZ1bmN0aW9uIGUoKSB7XHJcbiAgICAgICAgdmFyIGUgPSAobnVsbCAhPT0gdCAmJiB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIHx8IHRoaXM7XHJcbiAgICAgICAgZS5idXR0bGVUeXBlID0gJGJhc2VCdWxsZXQuQnVsbGV0VHlwZS5zX2J1bGxldF82XzE7XHJcbiAgICAgICAgZS50YXJnZXRFbmVteSA9IG51bGw7XHJcbiAgICAgICAgZS5sZWZ0VGltZSA9IDA7XHJcbiAgICAgICAgZS5maW5kTGVmdFRpbWUgPSAwO1xyXG4gICAgICAgIGUuc3RhdHVzID0gMDtcclxuICAgICAgICBlLmFuZ2xlU3BlZWQgPSAzO1xyXG4gICAgICAgIHJldHVybiBlO1xyXG4gICAgfVxyXG4gICAgX19leHRlbmRzKGUsIHQpO1xyXG4gICAgZS5wcm90b3R5cGUuaW5pdEJ1dHRsZSA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgdGhpcy5zcGVlZCA9ICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5za2lsbEluZm8uc2tpblBhcmFtWzZdO1xyXG4gICAgICAgIHQucHJvdG90eXBlLmluaXRCdXR0bGUuY2FsbCh0aGlzLCBlLCBudWxsKTtcclxuICAgICAgICBpZiAoZSkge1xyXG4gICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnNldChlKS5tdWx0aXBseVNjYWxhcih0aGlzLnNwZWVkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5sZWZ0VGltZSA9ICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5za2lsbEluZm8uc2tpblBhcmFtWzVdO1xyXG4gICAgICAgIHRoaXMudGFyZ2V0RW5lbXkuYWRkRGllQ2FsbGJhY2sodGhpcy5kaWVFbmVteSwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5pc1VzZSA9ICExO1xyXG4gICAgICAgIHRoaXMuYXRrID0gJGdhbWVDb250ZXh0LmRlZmF1bHQuaW5zLnNraWxsSW5mby5za2luQXRrO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzID0gMTtcclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5kaWVFbmVteSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmNoYW5nZUVuZW15KCk7XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUuY2hhbmdlRW5lbXkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHQgPSAkZ2FtZUNvbnRleHQuZGVmYXVsdC5pbnMuZ2V0UmFuZG9tRW5lbXkodGhpcy50YXJnZXRFbmVteSk7XHJcbiAgICAgICAgdFxyXG4gICAgICAgICAgICA/ICgodGhpcy50YXJnZXRFbmVteSA9IHQpLCB0aGlzLnRhcmdldEVuZW15LmFkZERpZUNhbGxiYWNrKHRoaXMuZGllRW5lbXksIHRoaXMpLCAodGhpcy5zdGF0dXMgPSAxKSlcclxuICAgICAgICAgICAgOiAodGhpcy5zdGF0dXMgPSAwKTtcclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS51cGRhdGVGcmFtZSA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzVXNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMubGVmdFRpbWUgLT0gdDtcclxuICAgICAgICAgICAgaWYgKHRoaXMubGVmdFRpbWUgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc1VzZSA9ICEwO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlU2VsZigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIDAgPT09IHRoaXMuc3RhdHVzXHJcbiAgICAgICAgICAgICAgICA/ICgodGhpcy5maW5kTGVmdFRpbWUgLT0gdCksXHJcbiAgICAgICAgICAgICAgICAgIHRoaXMuZmluZExlZnRUaW1lIDw9IDAgJiYgKCh0aGlzLmZpbmRMZWZ0VGltZSA9IDEuNSksIHRoaXMuY2hhbmdlRW5lbXkoKSksXHJcbiAgICAgICAgICAgICAgICAgIHRoaXMubW92ZSh0KSlcclxuICAgICAgICAgICAgICAgIDogMSA9PT0gdGhpcy5zdGF0dXMgJiZcclxuICAgICAgICAgICAgICAgICAgKHRoaXMuZ2V0UG9zaXRpb24oKS5zdWJ0cmFjdCh0aGlzLnRhcmdldEVuZW15LmdldFBvc2l0aW9uKCkpLm1hZ1NxcigpIDw9IDkwMFxyXG4gICAgICAgICAgICAgICAgICAgICAgPyB0aGlzLm1vdmUodClcclxuICAgICAgICAgICAgICAgICAgICAgIDogdGhpcy50cmFjZSh0KSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnRyYWNlID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICB2YXIgZSA9IHRoaXMubGVycEFuZ2xlUmVzKHRoaXMudGFyZ2V0RW5lbXkuZ2V0UG9zaXRpb24oKS5zdWJ0cmFjdCh0aGlzLmdldFBvc2l0aW9uKCkpKTtcclxuICAgICAgICB0aGlzLnNldEFuZ2xlKGUpO1xyXG4gICAgICAgIHRoaXMudmVsb2NpdHkuc2V0KCR1dGlsLmRlZmF1bHQuYW5nbGVDb252ZXJEaXIoZSkubm9ybWFsaXplU2VsZigpKS5tdWxTZWxmKHRoaXMuc3BlZWQpO1xyXG4gICAgICAgIHRoaXMubW92ZSh0KTtcclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5sZXJwQW5nbGVSZXMgPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciBlID0gKCR1dGlsLmRlZmF1bHQuZGlyQ29udmVyQW5nbGUodCkgKyAzNjApICUgMzYwO1xyXG4gICAgICAgIHZhciBpID0gKHRoaXMubm9kZS5hbmdsZSArIDM2MCkgJSAzNjA7XHJcbiAgICAgICAgcmV0dXJuIE1hdGguYWJzKGkgLSBlKSA8PSB0aGlzLmFuZ2xlU3BlZWRcclxuICAgICAgICAgICAgPyBlXHJcbiAgICAgICAgICAgIDogKChpIC0gZSArIDM2MCkgJSAzNjAgPCAoZSAtIGkgKyAzNjApICUgMzYwID8gKGkgLT0gdGhpcy5hbmdsZVNwZWVkKSA6IChpICs9IHRoaXMuYW5nbGVTcGVlZCksIGkpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLm1vdmUgPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciBlID0gdGhpcy5nZXRQb3NpdGlvbigpO1xyXG4gICAgICAgIHZhciBpID0gdGhpcy52ZWxvY2l0eTtcclxuICAgICAgICBwLnggPSBlLnggKyBpLnggKiB0O1xyXG4gICAgICAgIHAueSA9IGUueSArIGkueSAqIHQ7XHJcbiAgICAgICAgcC56ID0gZS56ICsgaS56ICogdDtcclxuICAgICAgICBpZiAocC54IDwgLTMzNSB8fCBwLnggPiAzMzUpIHtcclxuICAgICAgICAgICAgcC54ID0gZS54O1xyXG4gICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnggPSAtdGhpcy52ZWxvY2l0eS54O1xyXG4gICAgICAgICAgICB2YXIgbyA9ICR1dGlsLmRlZmF1bHQuZGlyQ29udmVyQW5nbGUodGhpcy52ZWxvY2l0eSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QW5nbGUobyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwLnkgPCAtMzY1IHx8IHAueSA+IGNjLndpblNpemUuaGVpZ2h0IC8gMiAtIDI1KSB7XHJcbiAgICAgICAgICAgIHAueSA9IGUueTtcclxuICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS55ID0gLXRoaXMudmVsb2NpdHkueTtcclxuICAgICAgICAgICAgbyA9ICR1dGlsLmRlZmF1bHQuZGlyQ29udmVyQW5nbGUodGhpcy52ZWxvY2l0eSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QW5nbGUobyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb24ocCk7XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUub25UcmlnZ2VyID0gZnVuY3Rpb24gKHQsIGUpIHtcclxuICAgICAgICBpZiAoZSA9PSAkb2JqZWN0LlRyaWdnZXIuZW50ZXIpIHtcclxuICAgICAgICAgICAgdC5vYmplY3Quc3VmZmVyQXRrKHtcclxuICAgICAgICAgICAgICAgIHNraWxsU3BlY2lhbGl0eXM6IHRoaXMuc2tpbGxTcGVjaWFsaXR5cyxcclxuICAgICAgICAgICAgICAgIGF0azogdGhpcy5hdGtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBfX2RlY29yYXRlKFtkXSwgZSk7XHJcbn0pKCRiYXNlQnVsbGV0LmRlZmF1bHQpO1xyXG5leHBvcnRzLmRlZmF1bHQgPSBmO1xyXG4iXX0=