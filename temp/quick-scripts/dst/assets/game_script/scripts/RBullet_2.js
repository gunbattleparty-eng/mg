
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/RBullet_2.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'f2e57gsAkREH7ly8pt6Mwlx', 'RBullet_2');
// game_script/scripts/RBullet_2.js

"use strict";

var o;

var $object = require("./Object");

var $util = require("./Util");

var $gameContext = require("./GameContext");

var $baseBullet = require("./BaseBullet");

var u = cc._decorator;
var d = u.ccclass;
var p = (u.property, function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.buttleType = $baseBullet.BulletType.r_bullet_2;
    e.atkAnim = null;
    e.bulletSpeed = 800;
    e.time = 0;
    e.targetNode = null;
    e.targetPos = null;
    e.initPos = null;
    e.status = 0;
    e.attackedEnemy = new Set();
    e.dir = null;
    return e;
  }

  __extends(e, t);

  e.prototype.initRBullet = function (e, i, o, n, s) {
    var r = this;
    this.initPos = this.node.position.clone();
    this.targetNode = e;
    this.targetPos = this.targetNode.getPosition().clone();
    this.time = s;
    t.prototype.initButtle.call(this, null, null);
    this.bulletSpeed = n;
    this.atkAnim = this.node.getComponentInChildren(cc.Animation);
    this.atk = i;
    this.setScale(cc.v3(o, o));
    this.status = 0;
    var a = this.node.position.sub(cc.v3(this.targetPos.x, -410)).mag() / this.bulletSpeed;
    cc.tween(this.node).to(a, {
      position: cc.v3(this.targetPos.x, -410)
    }).call(function () {
      r.status = 2;
    }).start();
  };

  e.prototype.onTrigger = function (t, e) {
    if (!this.isUse && e == $object.Trigger.stay) {
      var i = t.object;

      if (!this.attackedEnemy.has(i)) {
        this.attackedEnemy.add(i);
        i.sufferAtk({
          skillSpecialitys: this.skillSpecialitys,
          atk: this.atk
        });
      }
    }
  };

  e.prototype.updateFrame = function (e) {
    var i = this;
    t.prototype.updateFrame.call(this, e);

    if (this.time > 0) {
      this.time -= e;

      if (this.time <= 0 && 2 === this.status) {
        this.dir = this.initPos.sub(this.node.position).normalize();
        this.velocity.set(this.dir.normalize()).multiplyScalar(this.speed);
        this.status = 4;
      }
    }

    if (2 === this.status) {
      if (!(this.targetNode && $util["default"].isValid(this.targetNode.node) || (this.targetNode = $gameContext["default"].ins.getRangeRandomEnemyLayerByPos(this.targetPos, 900), this.targetNode))) {
        return void (this.status = 4);
      }

      this.targetPos.x = this.targetNode.node.x;
      this.targetPos.y = this.targetNode.node.y;

      if (0 === this.speed) {
        this.speed = this.bulletSpeed;
      }

      this.dir = this.targetPos.sub(this.node.position);
      this.dir.magSqr() <= 1e4 ? (this.velocity = cc.Vec3.ZERO, this.status = 3, this.trigger = !0, this.atkAnim.node.active = !0, this.atkAnim.play("rbullet_2"), this.atkAnim.once(cc.Animation.EventType.FINISHED, function () {
        i.atkAnim.node.active = !1;
        i.trigger = !1;
        i.dir = i.initPos.sub(i.node.position).normalize();
        i.velocity.set(i.dir.normalize()).multiplyScalar(i.speed);
        i.status = 4;
      }, this)) : this.velocity.set(this.dir.normalize()).multiplyScalar(this.speed);
    }

    if (4 === this.status && this.initPos.sub(this.getPosition()).magSqr() <= 2500) {
      this.status = 5;
      this.attackedEnemy.clear();
      this.removeSelf();
    }
  };

  return __decorate([d], e);
}($baseBullet["default"]));
exports["default"] = p;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXFJCdWxsZXRfMi5qcyJdLCJuYW1lcyI6WyJvIiwiJG9iamVjdCIsInJlcXVpcmUiLCIkdXRpbCIsIiRnYW1lQ29udGV4dCIsIiRiYXNlQnVsbGV0IiwidSIsImNjIiwiX2RlY29yYXRvciIsImQiLCJjY2NsYXNzIiwicCIsInByb3BlcnR5IiwidCIsImUiLCJhcHBseSIsImFyZ3VtZW50cyIsImJ1dHRsZVR5cGUiLCJCdWxsZXRUeXBlIiwicl9idWxsZXRfMiIsImF0a0FuaW0iLCJidWxsZXRTcGVlZCIsInRpbWUiLCJ0YXJnZXROb2RlIiwidGFyZ2V0UG9zIiwiaW5pdFBvcyIsInN0YXR1cyIsImF0dGFja2VkRW5lbXkiLCJTZXQiLCJkaXIiLCJfX2V4dGVuZHMiLCJwcm90b3R5cGUiLCJpbml0UkJ1bGxldCIsImkiLCJuIiwicyIsInIiLCJub2RlIiwicG9zaXRpb24iLCJjbG9uZSIsImdldFBvc2l0aW9uIiwiaW5pdEJ1dHRsZSIsImNhbGwiLCJnZXRDb21wb25lbnRJbkNoaWxkcmVuIiwiQW5pbWF0aW9uIiwiYXRrIiwic2V0U2NhbGUiLCJ2MyIsImEiLCJzdWIiLCJ4IiwibWFnIiwidHdlZW4iLCJ0byIsInN0YXJ0Iiwib25UcmlnZ2VyIiwiaXNVc2UiLCJUcmlnZ2VyIiwic3RheSIsIm9iamVjdCIsImhhcyIsImFkZCIsInN1ZmZlckF0ayIsInNraWxsU3BlY2lhbGl0eXMiLCJ1cGRhdGVGcmFtZSIsIm5vcm1hbGl6ZSIsInZlbG9jaXR5Iiwic2V0IiwibXVsdGlwbHlTY2FsYXIiLCJzcGVlZCIsImlzVmFsaWQiLCJpbnMiLCJnZXRSYW5nZVJhbmRvbUVuZW15TGF5ZXJCeVBvcyIsInkiLCJtYWdTcXIiLCJWZWMzIiwiWkVSTyIsInRyaWdnZXIiLCJhY3RpdmUiLCJwbGF5Iiwib25jZSIsIkV2ZW50VHlwZSIsIkZJTklTSEVEIiwiY2xlYXIiLCJyZW1vdmVTZWxmIiwiX19kZWNvcmF0ZSIsImV4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LEtBQUtDLFVBQUw7SUFDSDtFQUNKLENBdEREOztFQXVEQSxPQUFPQyxVQUFVLENBQUMsQ0FBQzVFLENBQUQsQ0FBRCxFQUFNSyxDQUFOLENBQWpCO0FBQ0gsQ0ExR0QsQ0EwR0dULFdBQVcsV0ExR2QsQ0FGQyxDQUFMO0FBNkdBaUYsT0FBTyxXQUFQLEdBQWtCM0UsQ0FBbEIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBvO1xyXG52YXIgJG9iamVjdCA9IHJlcXVpcmUoXCIuL09iamVjdFwiKTtcclxudmFyICR1dGlsID0gcmVxdWlyZShcIi4vVXRpbFwiKTtcclxudmFyICRnYW1lQ29udGV4dCA9IHJlcXVpcmUoXCIuL0dhbWVDb250ZXh0XCIpO1xyXG52YXIgJGJhc2VCdWxsZXQgPSByZXF1aXJlKFwiLi9CYXNlQnVsbGV0XCIpO1xyXG52YXIgdSA9IGNjLl9kZWNvcmF0b3I7XHJcbnZhciBkID0gdS5jY2NsYXNzO1xyXG52YXIgcCA9XHJcbiAgICAodS5wcm9wZXJ0eSxcclxuICAgIChmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGUoKSB7XHJcbiAgICAgICAgICAgIHZhciBlID0gKG51bGwgIT09IHQgJiYgdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSB8fCB0aGlzO1xyXG4gICAgICAgICAgICBlLmJ1dHRsZVR5cGUgPSAkYmFzZUJ1bGxldC5CdWxsZXRUeXBlLnJfYnVsbGV0XzI7XHJcbiAgICAgICAgICAgIGUuYXRrQW5pbSA9IG51bGw7XHJcbiAgICAgICAgICAgIGUuYnVsbGV0U3BlZWQgPSA4MDA7XHJcbiAgICAgICAgICAgIGUudGltZSA9IDA7XHJcbiAgICAgICAgICAgIGUudGFyZ2V0Tm9kZSA9IG51bGw7XHJcbiAgICAgICAgICAgIGUudGFyZ2V0UG9zID0gbnVsbDtcclxuICAgICAgICAgICAgZS5pbml0UG9zID0gbnVsbDtcclxuICAgICAgICAgICAgZS5zdGF0dXMgPSAwO1xyXG4gICAgICAgICAgICBlLmF0dGFja2VkRW5lbXkgPSBuZXcgU2V0KCk7XHJcbiAgICAgICAgICAgIGUuZGlyID0gbnVsbDtcclxuICAgICAgICAgICAgcmV0dXJuIGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIF9fZXh0ZW5kcyhlLCB0KTtcclxuICAgICAgICBlLnByb3RvdHlwZS5pbml0UkJ1bGxldCA9IGZ1bmN0aW9uIChlLCBpLCBvLCBuLCBzKSB7XHJcbiAgICAgICAgICAgIHZhciByID0gdGhpcztcclxuICAgICAgICAgICAgdGhpcy5pbml0UG9zID0gdGhpcy5ub2RlLnBvc2l0aW9uLmNsb25lKCk7XHJcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0Tm9kZSA9IGU7XHJcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0UG9zID0gdGhpcy50YXJnZXROb2RlLmdldFBvc2l0aW9uKCkuY2xvbmUoKTtcclxuICAgICAgICAgICAgdGhpcy50aW1lID0gcztcclxuICAgICAgICAgICAgdC5wcm90b3R5cGUuaW5pdEJ1dHRsZS5jYWxsKHRoaXMsIG51bGwsIG51bGwpO1xyXG4gICAgICAgICAgICB0aGlzLmJ1bGxldFNwZWVkID0gbjtcclxuICAgICAgICAgICAgdGhpcy5hdGtBbmltID0gdGhpcy5ub2RlLmdldENvbXBvbmVudEluQ2hpbGRyZW4oY2MuQW5pbWF0aW9uKTtcclxuICAgICAgICAgICAgdGhpcy5hdGsgPSBpO1xyXG4gICAgICAgICAgICB0aGlzLnNldFNjYWxlKGNjLnYzKG8sIG8pKTtcclxuICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSAwO1xyXG4gICAgICAgICAgICB2YXIgYSA9IHRoaXMubm9kZS5wb3NpdGlvbi5zdWIoY2MudjModGhpcy50YXJnZXRQb3MueCwgLTQxMCkpLm1hZygpIC8gdGhpcy5idWxsZXRTcGVlZDtcclxuICAgICAgICAgICAgY2MudHdlZW4odGhpcy5ub2RlKVxyXG4gICAgICAgICAgICAgICAgLnRvKGEsIHtcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogY2MudjModGhpcy50YXJnZXRQb3MueCwgLTQxMClcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2FsbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgci5zdGF0dXMgPSAyO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5zdGFydCgpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgZS5wcm90b3R5cGUub25UcmlnZ2VyID0gZnVuY3Rpb24gKHQsIGUpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzVXNlICYmIGUgPT0gJG9iamVjdC5UcmlnZ2VyLnN0YXkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpID0gdC5vYmplY3Q7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuYXR0YWNrZWRFbmVteS5oYXMoaSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmF0dGFja2VkRW5lbXkuYWRkKGkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkuc3VmZmVyQXRrKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2tpbGxTcGVjaWFsaXR5czogdGhpcy5za2lsbFNwZWNpYWxpdHlzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdGs6IHRoaXMuYXRrXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGUucHJvdG90eXBlLnVwZGF0ZUZyYW1lID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgdmFyIGkgPSB0aGlzO1xyXG4gICAgICAgICAgICB0LnByb3RvdHlwZS51cGRhdGVGcmFtZS5jYWxsKHRoaXMsIGUpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy50aW1lID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50aW1lIC09IGU7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50aW1lIDw9IDAgJiYgMiA9PT0gdGhpcy5zdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpciA9IHRoaXMuaW5pdFBvcy5zdWIodGhpcy5ub2RlLnBvc2l0aW9uKS5ub3JtYWxpemUoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnNldCh0aGlzLmRpci5ub3JtYWxpemUoKSkubXVsdGlwbHlTY2FsYXIodGhpcy5zcGVlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSA0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICgyID09PSB0aGlzLnN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgICAgICEoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLnRhcmdldE5vZGUgJiYgJHV0aWwuZGVmYXVsdC5pc1ZhbGlkKHRoaXMudGFyZ2V0Tm9kZS5ub2RlKSkgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKCh0aGlzLnRhcmdldE5vZGUgPSAkZ2FtZUNvbnRleHQuZGVmYXVsdC5pbnMuZ2V0UmFuZ2VSYW5kb21FbmVteUxheWVyQnlQb3MoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFBvcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDkwMFxyXG4gICAgICAgICAgICAgICAgICAgICAgICApKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50YXJnZXROb2RlKVxyXG4gICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkICh0aGlzLnN0YXR1cyA9IDQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy50YXJnZXRQb3MueCA9IHRoaXMudGFyZ2V0Tm9kZS5ub2RlLng7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFBvcy55ID0gdGhpcy50YXJnZXROb2RlLm5vZGUueTtcclxuICAgICAgICAgICAgICAgIGlmICgwID09PSB0aGlzLnNwZWVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcGVlZCA9IHRoaXMuYnVsbGV0U3BlZWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRpciA9IHRoaXMudGFyZ2V0UG9zLnN1Yih0aGlzLm5vZGUucG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kaXIubWFnU3FyKCkgPD0gMWU0XHJcbiAgICAgICAgICAgICAgICAgICAgPyAoKHRoaXMudmVsb2NpdHkgPSBjYy5WZWMzLlpFUk8pLFxyXG4gICAgICAgICAgICAgICAgICAgICAgKHRoaXMuc3RhdHVzID0gMyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAodGhpcy50cmlnZ2VyID0gITApLFxyXG4gICAgICAgICAgICAgICAgICAgICAgKHRoaXMuYXRrQW5pbS5ub2RlLmFjdGl2ZSA9ICEwKSxcclxuICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXRrQW5pbS5wbGF5KFwicmJ1bGxldF8yXCIpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5hdGtBbmltLm9uY2UoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2MuQW5pbWF0aW9uLkV2ZW50VHlwZS5GSU5JU0hFRCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuYXRrQW5pbS5ub2RlLmFjdGl2ZSA9ICExO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLnRyaWdnZXIgPSAhMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5kaXIgPSBpLmluaXRQb3Muc3ViKGkubm9kZS5wb3NpdGlvbikubm9ybWFsaXplKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkudmVsb2NpdHkuc2V0KGkuZGlyLm5vcm1hbGl6ZSgpKS5tdWx0aXBseVNjYWxhcihpLnNwZWVkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5zdGF0dXMgPSA0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1xyXG4gICAgICAgICAgICAgICAgICAgICAgKSlcclxuICAgICAgICAgICAgICAgICAgICA6IHRoaXMudmVsb2NpdHkuc2V0KHRoaXMuZGlyLm5vcm1hbGl6ZSgpKS5tdWx0aXBseVNjYWxhcih0aGlzLnNwZWVkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoNCA9PT0gdGhpcy5zdGF0dXMgJiYgdGhpcy5pbml0UG9zLnN1Yih0aGlzLmdldFBvc2l0aW9uKCkpLm1hZ1NxcigpIDw9IDI1MDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gNTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrZWRFbmVteS5jbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVTZWxmKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBfX2RlY29yYXRlKFtkXSwgZSk7XHJcbiAgICB9KSgkYmFzZUJ1bGxldC5kZWZhdWx0KSk7XHJcbmV4cG9ydHMuZGVmYXVsdCA9IHA7XHJcbiJdfQ==