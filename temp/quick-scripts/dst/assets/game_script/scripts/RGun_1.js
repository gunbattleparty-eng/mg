
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/RGun_1.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '586d40Qja5GgZwxWdEbgYQ6', 'RGun_1');
// game_script/scripts/RGun_1.js

"use strict";

var o;

var $assetsLoader = require("./AssetsLoader");

var $assetsMap = require("./AssetsMap");

var $resUtil = require("./ResUtil");

var $configContext = require("./ConfigContext");

var $globalParam = require("./GlobalParam");

var $baseBullet = require("./BaseBullet");

var $gameContext = require("./GameContext");

var $gameSkillInfo = require("./GameSkillInfo");

var f = function (t) {
  function e(e, i) {
    var o = t.call(this, e) || this;
    o.atk = 0;
    o.cd = 0;
    o.range = 0;
    o.bulletSpeed = 0;
    o.attackInterval = 0;
    o.bulletCount = 0;
    o.config = null;
    o.skin = null;
    o.tempPos = cc.Vec3.ZERO;
    o.lockEnemy = null;
    o.config = $configContext["default"].instance.robotConfigs.find(function (t) {
      return 2 === t.id;
    });
    o.cd = o.config.Petsskin_skill_value[1];
    o.range = o.config.Petsskin_skill_value[2];
    o.bulletSpeed = o.config.Petsskin_skill_value[3];
    o.attackInterval = o.config.Petsskin_skill_value[4];
    o.bulletCount = Math.round(o.config.Petsskin_skill_value[5] / o.attackInterval);
    o.timeLeft = o.cd;
    o.skin = i;
    o.tempPos.x = o.pointNode.position.x;
    o.tempPos.y = o.pointNode.position.y + 150;
    return o;
  }

  __extends(e, t);

  e.prototype.updateF = function (e) {
    t.prototype.updateF.call(this, e);

    if (!(this.isAttacking || $globalParam["default"].isGamePuase)) {
      this.timeLeft -= e;

      if (this.timeLeft <= 0) {
        this.startGun();
      }
    }
  };

  e.prototype.startGun = function () {
    var t = this;
    this.lockEnemy = $gameContext["default"].ins.getRangeRankEnemy(this.pointNode, this.range);

    if (!this.lockEnemy) {
      this.timeLeft = 1;
      return !1;
    }

    if (!this.skillParam) {
      this.skillParam = $gameContext["default"].ins.skillInfo.getSkillById(1);
    }

    this.lockEnemy.addDieCallback(this.dieEnemy, this);
    this.atk = Math.ceil(this.config.Petsskin_skill_value[0] * this.skillParam.skillAtk[$gameSkillInfo.Skill4Param.FINAL]);
    this.isAttacking = !0;
    var e = 0;
    this.skin.playAnimation("hit", 0);

    for (var i = 0; i < this.bulletCount; i++) {
      this.schedulesOnce(function () {
        if (t.lockEnemy && !t.lockEnemy.isDie()) {
          t.createButtle(t.lockEnemy);
        }

        if (++e >= t.bulletCount) {
          t.isAttacking = !1;
          t.timeLeft = t.cd;
          t.skin.playAnimation("stand", 0);

          if (t.lockEnemy) {
            t.lockEnemy.removeDieCallback(t);
            t.lockEnemy = null;
          }
        }
      }, this.attackInterval * i);
    }
  };

  e.prototype.dieEnemy = function (t) {
    if (this.lockEnemy === t) {
      this.lockEnemy = null;
      this.lockEnemy = $gameContext["default"].ins.getRandomEnemy(t);
    }
  };

  e.prototype.createButtle = function (t) {
    var e = $gameContext["default"].ins.getButtlePool($baseBullet.BulletType.r_bullet_1);

    if (!e) {
      var i = $assetsLoader["default"].instance.getRes($assetsMap.BundleNames.Game, $assetsMap.AssetsMap.GameBundles.prefabs.assetsList.RBullet_1);
      e = $resUtil.ResUtil.instantiate(i, $gameContext["default"].ins.buttleLayer.parent).getComponent($baseBullet["default"]);
    }

    e.setPosition(this.tempPos);
    e.initRBullet(t, this.atk, this.bulletSpeed);
    e.insert($gameContext["default"].ins.buttleLayer);
  };

  return e;
}(require("./BaseGun")["default"]);

exports["default"] = f;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXFJHdW5fMS5qcyJdLCJuYW1lcyI6WyJvIiwiJGFzc2V0c0xvYWRlciIsInJlcXVpcmUiLCIkYXNzZXRzTWFwIiwiJHJlc1V0aWwiLCIkY29uZmlnQ29udGV4dCIsIiRnbG9iYWxQYXJhbSIsIiRiYXNlQnVsbGV0IiwiJGdhbWVDb250ZXh0IiwiJGdhbWVTa2lsbEluZm8iLCJmIiwidCIsImUiLCJpIiwiY2FsbCIsImF0ayIsImNkIiwicmFuZ2UiLCJidWxsZXRTcGVlZCIsImF0dGFja0ludGVydmFsIiwiYnVsbGV0Q291bnQiLCJjb25maWciLCJza2luIiwidGVtcFBvcyIsImNjIiwiVmVjMyIsIlpFUk8iLCJsb2NrRW5lbXkiLCJpbnN0YW5jZSIsInJvYm90Q29uZmlncyIsImZpbmQiLCJpZCIsIlBldHNza2luX3NraWxsX3ZhbHVlIiwiTWF0aCIsInJvdW5kIiwidGltZUxlZnQiLCJ4IiwicG9pbnROb2RlIiwicG9zaXRpb24iLCJ5IiwiX19leHRlbmRzIiwicHJvdG90eXBlIiwidXBkYXRlRiIsImlzQXR0YWNraW5nIiwiaXNHYW1lUHVhc2UiLCJzdGFydEd1biIsImlucyIsImdldFJhbmdlUmFua0VuZW15Iiwic2tpbGxQYXJhbSIsInNraWxsSW5mbyIsImdldFNraWxsQnlJZCIsImFkZERpZUNhbGxiYWNrIiwiZGllRW5lbXkiLCJjZWlsIiwic2tpbGxBdGsiLCJTa2lsbDRQYXJhbSIsIkZJTkFMIiwicGxheUFuaW1hdGlvbiIsInNjaGVkdWxlc09uY2UiLCJpc0RpZSIsImNyZWF0ZUJ1dHRsZSIsInJlbW92ZURpZUNhbGxiYWNrIiwiZ2V0UmFuZG9tRW5lbXkiLCJnZXRCdXR0bGVQb29sIiwiQnVsbGV0VHlwZSIsInJfYnVsbGV0XzEiLCJnZXRSZXMiLCJCdW5kbGVOYW1lcyIsIkdhbWUiLCJBc3NldHNNYXAiLCJHYW1lQnVuZGxlcyIsInByZWZhYnMiLCJhc3NldHNMaXN0IiwiUkJ1bGxldF8xIiwiUmVzVXRpbCIsImluc3RhbnRpYXRlIiwiYnV0dGxlTGF5ZXIiLCJwYXJlbnQiLCJnZXRDb21wb25lbnQiLCJzZXRQb3NpdGlvbiIsImluaXRSQnVsbGV0IiwiaW5zZXJ0IiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxDQUFKOztBQUNBLElBQUlDLGFBQWEsR0FBR0MsT0FBTyxDQUFDLGdCQUFELENBQTNCOztBQUNBLElBQUlDLFVBQVUsR0FBR0QsT0FBTyxDQUFDLGFBQUQsQ0FBeEI7O0FBQ0EsSUFBSUUsUUFBUSxHQUFHRixPQUFPLENBQUMsV0FBRCxDQUF0Qjs7QUFDQSxJQUFJRyxjQUFjLEdBQUdILE9BQU8sQ0FBQyxpQkFBRCxDQUE1Qjs7QUFDQSxJQUFJSSxZQUFZLEdBQUdKLE9BQU8sQ0FBQyxlQUFELENBQTFCOztBQUNBLElBQUlLLFdBQVcsR0FBR0wsT0FBTyxDQUFDLGNBQUQsQ0FBekI7O0FBQ0EsSUFBSU0sWUFBWSxHQUFHTixPQUFPLENBQUMsZUFBRCxDQUExQjs7QUFDQSxJQUFJTyxjQUFjLEdBQUdQLE9BQU8sQ0FBQyxpQkFBRCxDQUE1Qjs7QUFDQSxJQUFJUSxDQUFDLEdBQUksVUFBVUMsQ0FBVixFQUFhO0VBQ2xCLFNBQVNDLENBQVQsQ0FBV0EsQ0FBWCxFQUFjQyxDQUFkLEVBQWlCO0lBQ2IsSUFBSWIsQ0FBQyxHQUFHVyxDQUFDLENBQUNHLElBQUYsQ0FBTyxJQUFQLEVBQWFGLENBQWIsS0FBbUIsSUFBM0I7SUFDQVosQ0FBQyxDQUFDZSxHQUFGLEdBQVEsQ0FBUjtJQUNBZixDQUFDLENBQUNnQixFQUFGLEdBQU8sQ0FBUDtJQUNBaEIsQ0FBQyxDQUFDaUIsS0FBRixHQUFVLENBQVY7SUFDQWpCLENBQUMsQ0FBQ2tCLFdBQUYsR0FBZ0IsQ0FBaEI7SUFDQWxCLENBQUMsQ0FBQ21CLGNBQUYsR0FBbUIsQ0FBbkI7SUFDQW5CLENBQUMsQ0FBQ29CLFdBQUYsR0FBZ0IsQ0FBaEI7SUFDQXBCLENBQUMsQ0FBQ3FCLE1BQUYsR0FB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QUNBTixDQUFDLENBQUNxRSxNQUFGLENBQVN6RSxZQUFZLFdBQVosQ0FBcUJzQyxHQUFyQixDQUF5QjhCLFdBQWxDO0VBQ0gsQ0FkRDs7RUFlQSxPQUFPaEUsQ0FBUDtBQUNILENBN0ZPLENBNkZMVixPQUFPLENBQUMsV0FBRCxDQUFQLFdBN0ZLLENBQVI7O0FBOEZBZ0YsT0FBTyxXQUFQLEdBQWtCeEUsQ0FBbEIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBvO1xyXG52YXIgJGFzc2V0c0xvYWRlciA9IHJlcXVpcmUoXCIuL0Fzc2V0c0xvYWRlclwiKTtcclxudmFyICRhc3NldHNNYXAgPSByZXF1aXJlKFwiLi9Bc3NldHNNYXBcIik7XHJcbnZhciAkcmVzVXRpbCA9IHJlcXVpcmUoXCIuL1Jlc1V0aWxcIik7XHJcbnZhciAkY29uZmlnQ29udGV4dCA9IHJlcXVpcmUoXCIuL0NvbmZpZ0NvbnRleHRcIik7XHJcbnZhciAkZ2xvYmFsUGFyYW0gPSByZXF1aXJlKFwiLi9HbG9iYWxQYXJhbVwiKTtcclxudmFyICRiYXNlQnVsbGV0ID0gcmVxdWlyZShcIi4vQmFzZUJ1bGxldFwiKTtcclxudmFyICRnYW1lQ29udGV4dCA9IHJlcXVpcmUoXCIuL0dhbWVDb250ZXh0XCIpO1xyXG52YXIgJGdhbWVTa2lsbEluZm8gPSByZXF1aXJlKFwiLi9HYW1lU2tpbGxJbmZvXCIpO1xyXG52YXIgZiA9IChmdW5jdGlvbiAodCkge1xyXG4gICAgZnVuY3Rpb24gZShlLCBpKSB7XHJcbiAgICAgICAgdmFyIG8gPSB0LmNhbGwodGhpcywgZSkgfHwgdGhpcztcclxuICAgICAgICBvLmF0ayA9IDA7XHJcbiAgICAgICAgby5jZCA9IDA7XHJcbiAgICAgICAgby5yYW5nZSA9IDA7XHJcbiAgICAgICAgby5idWxsZXRTcGVlZCA9IDA7XHJcbiAgICAgICAgby5hdHRhY2tJbnRlcnZhbCA9IDA7XHJcbiAgICAgICAgby5idWxsZXRDb3VudCA9IDA7XHJcbiAgICAgICAgby5jb25maWcgPSBudWxsO1xyXG4gICAgICAgIG8uc2tpbiA9IG51bGw7XHJcbiAgICAgICAgby50ZW1wUG9zID0gY2MuVmVjMy5aRVJPO1xyXG4gICAgICAgIG8ubG9ja0VuZW15ID0gbnVsbDtcclxuICAgICAgICBvLmNvbmZpZyA9ICRjb25maWdDb250ZXh0LmRlZmF1bHQuaW5zdGFuY2Uucm9ib3RDb25maWdzLmZpbmQoZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDIgPT09IHQuaWQ7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgby5jZCA9IG8uY29uZmlnLlBldHNza2luX3NraWxsX3ZhbHVlWzFdO1xyXG4gICAgICAgIG8ucmFuZ2UgPSBvLmNvbmZpZy5QZXRzc2tpbl9za2lsbF92YWx1ZVsyXTtcclxuICAgICAgICBvLmJ1bGxldFNwZWVkID0gby5jb25maWcuUGV0c3NraW5fc2tpbGxfdmFsdWVbM107XHJcbiAgICAgICAgby5hdHRhY2tJbnRlcnZhbCA9IG8uY29uZmlnLlBldHNza2luX3NraWxsX3ZhbHVlWzRdO1xyXG4gICAgICAgIG8uYnVsbGV0Q291bnQgPSBNYXRoLnJvdW5kKG8uY29uZmlnLlBldHNza2luX3NraWxsX3ZhbHVlWzVdIC8gby5hdHRhY2tJbnRlcnZhbCk7XHJcbiAgICAgICAgby50aW1lTGVmdCA9IG8uY2Q7XHJcbiAgICAgICAgby5za2luID0gaTtcclxuICAgICAgICBvLnRlbXBQb3MueCA9IG8ucG9pbnROb2RlLnBvc2l0aW9uLng7XHJcbiAgICAgICAgby50ZW1wUG9zLnkgPSBvLnBvaW50Tm9kZS5wb3NpdGlvbi55ICsgMTUwO1xyXG4gICAgICAgIHJldHVybiBvO1xyXG4gICAgfVxyXG4gICAgX19leHRlbmRzKGUsIHQpO1xyXG4gICAgZS5wcm90b3R5cGUudXBkYXRlRiA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgdC5wcm90b3R5cGUudXBkYXRlRi5jYWxsKHRoaXMsIGUpO1xyXG4gICAgICAgIGlmICghKHRoaXMuaXNBdHRhY2tpbmcgfHwgJGdsb2JhbFBhcmFtLmRlZmF1bHQuaXNHYW1lUHVhc2UpKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGltZUxlZnQgLT0gZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMudGltZUxlZnQgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydEd1bigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnN0YXJ0R3VuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciB0ID0gdGhpcztcclxuICAgICAgICB0aGlzLmxvY2tFbmVteSA9ICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5nZXRSYW5nZVJhbmtFbmVteSh0aGlzLnBvaW50Tm9kZSwgdGhpcy5yYW5nZSk7XHJcbiAgICAgICAgaWYgKCF0aGlzLmxvY2tFbmVteSkge1xyXG4gICAgICAgICAgICB0aGlzLnRpbWVMZWZ0ID0gMTtcclxuICAgICAgICAgICAgcmV0dXJuICExO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuc2tpbGxQYXJhbSkge1xyXG4gICAgICAgICAgICB0aGlzLnNraWxsUGFyYW0gPSAkZ2FtZUNvbnRleHQuZGVmYXVsdC5pbnMuc2tpbGxJbmZvLmdldFNraWxsQnlJZCgxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5sb2NrRW5lbXkuYWRkRGllQ2FsbGJhY2sodGhpcy5kaWVFbmVteSwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5hdGsgPSBNYXRoLmNlaWwoXHJcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLlBldHNza2luX3NraWxsX3ZhbHVlWzBdICogdGhpcy5za2lsbFBhcmFtLnNraWxsQXRrWyRnYW1lU2tpbGxJbmZvLlNraWxsNFBhcmFtLkZJTkFMXVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdGhpcy5pc0F0dGFja2luZyA9ICEwO1xyXG4gICAgICAgIHZhciBlID0gMDtcclxuICAgICAgICB0aGlzLnNraW4ucGxheUFuaW1hdGlvbihcImhpdFwiLCAwKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYnVsbGV0Q291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICB0aGlzLnNjaGVkdWxlc09uY2UoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHQubG9ja0VuZW15ICYmICF0LmxvY2tFbmVteS5pc0RpZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdC5jcmVhdGVCdXR0bGUodC5sb2NrRW5lbXkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCsrZSA+PSB0LmJ1bGxldENvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdC5pc0F0dGFja2luZyA9ICExO1xyXG4gICAgICAgICAgICAgICAgICAgIHQudGltZUxlZnQgPSB0LmNkO1xyXG4gICAgICAgICAgICAgICAgICAgIHQuc2tpbi5wbGF5QW5pbWF0aW9uKFwic3RhbmRcIiwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQubG9ja0VuZW15KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHQubG9ja0VuZW15LnJlbW92ZURpZUNhbGxiYWNrKHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0LmxvY2tFbmVteSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0aGlzLmF0dGFja0ludGVydmFsICogaSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLmRpZUVuZW15ID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICBpZiAodGhpcy5sb2NrRW5lbXkgPT09IHQpIHtcclxuICAgICAgICAgICAgdGhpcy5sb2NrRW5lbXkgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLmxvY2tFbmVteSA9ICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5nZXRSYW5kb21FbmVteSh0KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUuY3JlYXRlQnV0dGxlID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICB2YXIgZSA9ICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5nZXRCdXR0bGVQb29sKCRiYXNlQnVsbGV0LkJ1bGxldFR5cGUucl9idWxsZXRfMSk7XHJcbiAgICAgICAgaWYgKCFlKSB7XHJcbiAgICAgICAgICAgIHZhciBpID0gJGFzc2V0c0xvYWRlci5kZWZhdWx0Lmluc3RhbmNlLmdldFJlcyhcclxuICAgICAgICAgICAgICAgICRhc3NldHNNYXAuQnVuZGxlTmFtZXMuR2FtZSxcclxuICAgICAgICAgICAgICAgICRhc3NldHNNYXAuQXNzZXRzTWFwLkdhbWVCdW5kbGVzLnByZWZhYnMuYXNzZXRzTGlzdC5SQnVsbGV0XzFcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgZSA9ICRyZXNVdGlsLlJlc1V0aWwuaW5zdGFudGlhdGUoaSwgJGdhbWVDb250ZXh0LmRlZmF1bHQuaW5zLmJ1dHRsZUxheWVyLnBhcmVudCkuZ2V0Q29tcG9uZW50KFxyXG4gICAgICAgICAgICAgICAgJGJhc2VCdWxsZXQuZGVmYXVsdFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlLnNldFBvc2l0aW9uKHRoaXMudGVtcFBvcyk7XHJcbiAgICAgICAgZS5pbml0UkJ1bGxldCh0LCB0aGlzLmF0aywgdGhpcy5idWxsZXRTcGVlZCk7XHJcbiAgICAgICAgZS5pbnNlcnQoJGdhbWVDb250ZXh0LmRlZmF1bHQuaW5zLmJ1dHRsZUxheWVyKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gZTtcclxufSkocmVxdWlyZShcIi4vQmFzZUd1blwiKS5kZWZhdWx0KTtcclxuZXhwb3J0cy5kZWZhdWx0ID0gZjtcclxuIl19