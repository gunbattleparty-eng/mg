{"version":3,"sources":["assets\\game_script\\scripts\\RankService.js"],"names":["exports","RankTypeEnum","s","r","$login","require","$mD5","$crypto_ts","$platform","$countDownUtil","$storageUtil","$util","$battleContext","$globalParam","$localName","$switchContext","$userDataContext","Level","k","t","rankIdMap","Map","rankListMap","selfRankMap","rankCheckRecord","lastTime","level","isTestEvn","lastWeight","prototype","initData","StorageUtil","getItem","RANK_DATA","set","SwitchContext","rankId","requestRankList","requestSelfRank","requestRankID","e","i","o","n","v","gameCode","platformCode","systemCode","serverId","rankType","then","data","console","error","refreshAllRankList","__awaiter","__generator","label","has","get","start","end","sent","id","Ins","openId","testData","push","weight","extendParams","reportRankData","getLastRecord","check","log","isLocal","Platform","currPlatForm","PlatformEnum","BROWSER","nickname","indexOf","Math","floor","Date","now","objectFormat","un","l","g","gradeInfo","grade","h","headIndex","getSign","Login","instance","info","extendParam","sign","time","ifsuccess","CountDownUtil","currTime","setItem","toString","enc","Utf8","parse","AES","encrypt","rankKey","iv","rankKeyWords","mode","CBC","padding","pad","PKCS7","MD5","finalize","countLevel","getRankList","getRankSelf","rank","Object","defineProperty","urlLocal","urlOnline","enumerable","configurable","Promise","resolve"],"mappings":"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","sourceRoot":"/","sourcesContent":["exports.RankTypeEnum = void 0;\r\nvar s;\r\nvar r;\r\nvar $login = require(\"./Login\");\r\nvar $mD5 = require(\"./MD5\");\r\nvar $crypto_ts = require(\"./crypto-ts\");\r\nvar $platform = require(\"./Platform\");\r\nvar $countDownUtil = require(\"./CountDownUtil\");\r\nvar $storageUtil = require(\"./StorageUtil\");\r\nvar $util = require(\"./Util\");\r\nvar $battleContext = require(\"./BattleContext\");\r\nvar $globalParam = require(\"./GlobalParam\");\r\nvar $localName = require(\"./LocalName\");\r\nvar $switchContext = require(\"./SwitchContext\");\r\nvar $userDataContext = require(\"./UserDataContext\");\r\n(r = s = exports.RankTypeEnum || (exports.RankTypeEnum = {}))[(r.Level = 1)] = \"Level\";\r\nvar k = (function() {\r\n    function t() {\r\n        this.rankIdMap = new Map();\r\n        this.rankListMap = new Map();\r\n        this.selfRankMap = new Map();\r\n        this.rankCheckRecord = {\r\n            lastTime: 0,\r\n            level: 0\r\n        };\r\n        this.isTestEvn = !1;\r\n        this.lastWeight = 0;\r\n    }\r\n    t.prototype.initData = function() {\r\n        if (!this.isTestEvn) {\r\n            this.rankCheckRecord = $storageUtil.StorageUtil.getItem($localName.default.RANK_DATA, this.rankCheckRecord);\r\n            this.rankIdMap.set(s.Level, $switchContext.SwitchContext.rankId);\r\n            this.requestRankList(s.Level);\r\n            this.requestSelfRank(s.Level);\r\n        }\r\n    };\r\n    t.prototype.requestRankID = function(t, e, i, o, n) {\r\n        var s = this;\r\n        v.requestRankID({\r\n                gameCode: e,\r\n                platformCode: i,\r\n                systemCode: o,\r\n                serverId: n,\r\n                rankType: t\r\n            })\r\n            .then(function(e) {\r\n                s.rankIdMap.set(t, e.data);\r\n                s.requestRankList(t);\r\n                s.requestSelfRank(t);\r\n            })\r\n            .catch(function(t) {\r\n                console.error(t);\r\n            });\r\n    };\r\n    t.prototype.refreshAllRankList = function(t) {\r\n        if (!this.isTestEvn) {\r\n            var e = 0;\r\n            for (var i = 1; i <= 1; i++) {\r\n                this.requestRankList(i)\r\n                    .then(function() {\r\n                        if (++e >= 2 && t) {\r\n                            t();\r\n                        }\r\n                    })\r\n                    .catch(function(i) {\r\n                        console.error(i);\r\n                        if (++e >= 2 && t) {\r\n                            t();\r\n                        }\r\n                    });\r\n                this.requestSelfRank(i)\r\n                    .then(function() {\r\n                        if (++e >= 2 && t) {\r\n                            t();\r\n                        }\r\n                    })\r\n                    .catch(function(i) {\r\n                        console.error(i);\r\n                        if (++e >= 2 && t) {\r\n                            t();\r\n                        }\r\n                    });\r\n            }\r\n        }\r\n    };\r\n    t.prototype.requestRankList = function(t) {\r\n        return __awaiter(this, void 0, void 0, function() {\r\n            var e;\r\n            return __generator(this, function(i) {\r\n                switch (i.label) {\r\n                    case 0:\r\n                        return this.rankIdMap.has(t) ? [\r\n                            4,\r\n                            v.requestRankList({\r\n                                rankId: this.rankIdMap.get(t),\r\n                                start: 0,\r\n                                end: 100\r\n                            })\r\n                        ] : [2, null];\r\n                    case 1:\r\n                        if ((e = i.sent()) && e.data) {\r\n                            this.rankListMap.set(t, e.data);\r\n                        }\r\n                        return [2, e];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    t.prototype.requestSelfRank = function(t) {\r\n        return __awaiter(this, void 0, void 0, function() {\r\n            var e;\r\n            return __generator(this, function(i) {\r\n                switch (i.label) {\r\n                    case 0:\r\n                        return this.rankIdMap.has(t) ? [\r\n                            4,\r\n                            v.requestSelfRank({\r\n                                rankId: this.rankIdMap.get(t),\r\n                                id: $userDataContext.default.Ins.openId\r\n                            })\r\n                        ] : [2];\r\n                    case 1:\r\n                        if ((e = i.sent()) && e.data) {\r\n                            this.selfRankMap.set(t, e.data);\r\n                        }\r\n                        return [2, e];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    t.prototype.testData = function() {\r\n        var t = [];\r\n        for (var e = 0; e < 100; e++) {\r\n            t.push({\r\n                id: \"10018929397\",\r\n                weight: 1,\r\n                extendParams: \"un=用户7725208510891,l=\" + e + \",g=4,h=2\"\r\n            });\r\n        }\r\n        return t;\r\n    };\r\n    t.prototype.reportRankData = function(t) {\r\n        var e = this;\r\n        var i = $battleContext.default.Ins.getLastRecord();\r\n        if (this.check(i)) {\r\n            var o = i.level;\r\n            if (\r\n                this.lastWeight !== o &&\r\n                this.rankIdMap.has(t) &&\r\n                ((this.lastWeight = o),\r\n                    console.log(\"check success\", o),\r\n                    v.isLocal ||\r\n                    !(\r\n                        $platform.Platform.currPlatForm === $platform.PlatformEnum.BROWSER ||\r\n                        \"\" === $userDataContext.default.Ins.nickname ||\r\n                        $userDataContext.default.Ins.nickname.indexOf(\"未命名\") > -1\r\n                    ))\r\n            ) {\r\n                o = Math.floor(o);\r\n                var n = Date.now();\r\n                var s = $util.default.objectFormat({\r\n                    un: $userDataContext.default.Ins.nickname,\r\n                    l: i.level,\r\n                    g: $userDataContext.default.Ins.gradeInfo.grade,\r\n                    h: $userDataContext.default.Ins.headIndex + 1\r\n                });\r\n                var r = this.getSign(t, n, s);\r\n                var l = {\r\n                    rankId: this.rankIdMap.get(t),\r\n                    id: $login.Login.instance.info.openId,\r\n                    weight: o,\r\n                    extendParam: s,\r\n                    sign: r,\r\n                    time: n\r\n                };\r\n                v.reportRankData(l).then(function(t) {\r\n                    t.ifsuccess ?\r\n                        ((e.rankCheckRecord.lastTime = $countDownUtil.CountDownUtil.currTime),\r\n                            (e.rankCheckRecord.level = i.level),\r\n                            $storageUtil.StorageUtil.setItem($localName.default.RANK_DATA, e.rankCheckRecord)) :\r\n                        console.log(\"上传失败：\", t, n);\r\n                });\r\n            }\r\n        }\r\n    };\r\n    t.prototype.getSign = function(t, e, i) {\r\n        var o = e.toString();\r\n        if (i && \"\" !== i) {\r\n            o += i;\r\n        }\r\n        var n = $crypto_ts.enc.Utf8.parse(o);\r\n        var s = $crypto_ts.AES.encrypt(n, $crypto_ts.enc.Utf8.parse($switchContext.SwitchContext.rankKey), {\r\n            iv: $crypto_ts.enc.Utf8.parse($globalParam.default.rankKeyWords[1]),\r\n            mode: $crypto_ts.mode.CBC,\r\n            padding: $crypto_ts.pad.PKCS7\r\n        });\r\n        return new $mD5.MD5()\r\n            .finalize($login.Login.instance.info.openId + this.rankIdMap.get(t) + s.toString())\r\n            .toString();\r\n    };\r\n    t.prototype.check = function(t) {\r\n        var e = !1;\r\n        if (\r\n            $countDownUtil.CountDownUtil.currTime - this.rankCheckRecord.lastTime >= 90 &&\r\n            t.level >= this.rankCheckRecord.level\r\n        ) {\r\n            e = !0;\r\n        }\r\n        return t.level >= 10 && t.level <= $globalParam.default.countLevel && !this.isTestEvn && e;\r\n    };\r\n    t.prototype.getRankList = function(t) {\r\n        return this.isTestEvn ? this.testData() : this.rankListMap.has(t) ? this.rankListMap.get(t) : [];\r\n    };\r\n    t.prototype.getRankSelf = function(t) {\r\n        if (this.isTestEvn || !this.selfRankMap.has(t) || (this.selfRankMap.has(t) && !this.selfRankMap.get(t).rank)) {\r\n            var e = $battleContext.default.Ins.getLastRecord();\r\n            var i = e.level;\r\n            return {\r\n                rank: 999,\r\n                id: $userDataContext.default.Ins.openId,\r\n                weight: i,\r\n                extendParams: \"un=\" +\r\n                    $userDataContext.default.Ins.nickname +\r\n                    \",l=\" +\r\n                    e.level +\r\n                    \",g=\" +\r\n                    $userDataContext.default.Ins.gradeInfo.grade +\r\n                    \",h=\" +\r\n                    ($userDataContext.default.Ins.headIndex + 1)\r\n            };\r\n        }\r\n        return this.selfRankMap.get(t);\r\n    };\r\n    t.instance = new t();\r\n    return t;\r\n})();\r\nexports.default = k;\r\nvar v = (function() {\r\n    function t() {}\r\n    Object.defineProperty(t, \"url\", {\r\n        get: function() {\r\n            return t.isLocal ? t.urlLocal : t.urlOnline;\r\n        },\r\n        enumerable: !1,\r\n        configurable: !0\r\n    });\r\n    t.requestRankID = function(e) {\r\n        return Promise.resolve();\r\n        // return fly.get(t.url + \"/rank_id\", e);\r\n    };\r\n    t.requestRankList = function(e) {\r\n        return Promise.resolve();\r\n        // return fly.get(t.url + \"/rank_list\", e);\r\n    };\r\n    t.requestSelfRank = function(e) {\r\n        return Promise.resolve();\r\n        // return fly.get(t.url + \"/self_rank\", e);\r\n    };\r\n    t.reportRankData = function(e) {\r\n        return Promise.resolve();\r\n        // return fly.post(t.url + \"/new_push\", e, {\r\n        //     headers: {\r\n        //         \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n        //     }\r\n        // });\r\n    };\r\n    t.isLocal = !1;\r\n    t.urlLocal = \"http://127.0.0.1:8089/rank\";\r\n    t.urlOnline = \"https://fkxjl.shenzhendongwei.com/rank\";\r\n    return t;\r\n})();"]}