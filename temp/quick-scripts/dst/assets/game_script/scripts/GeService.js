
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/GeService.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '5c0b4xoRV1LxYHbqQGmaiF/', 'GeService');
// game_script/scripts/GeService.js

"use strict";

exports.GeService = void 0;

var $login = require("./Login");

var $platform = require("./Platform");

var $storageUtil = require("./StorageUtil");

var $switchContext = require("./SwitchContext");

var a = function () {
  function t() {
    this.isRegister = !1;
    this.isInit = !1;
    this.ge = null;
    this.param = {
      ttAccessToken: "",
      wxAccessToken: "",
      ksAccessToken: "",
      isDebug: !1
    };
  }

  t.prototype.start = function () {
    if (!($platform.Platform.currPlatForm !== $platform.PlatformEnum.TOU_TIAO && $platform.Platform.currPlatForm !== $platform.PlatformEnum.WECHAT && $platform.Platform.currPlatForm !== $platform.PlatformEnum.KS)) {
      this.param = $switchContext.SwitchContext.geParam;
      this.isRegister = $storageUtil.StorageUtil.getItem("GE_ISREGISTER", !1, !1);
      this.init();
    }
  };

  t.prototype.init = function () {
    if ($platform.Platform.currPlatForm === $platform.PlatformEnum.TOU_TIAO || $platform.Platform.currPlatForm === $platform.PlatformEnum.KS || $platform.Platform.currPlatForm === $platform.PlatformEnum.WECHAT) {
      var t = this.getOpenId();

      if ("" !== t && !this.isInit) {
        var e = "";
        $platform.Platform.currPlatForm === $platform.PlatformEnum.WECHAT ? e = this.param.wxAccessToken : $platform.Platform.currPlatForm === $platform.PlatformEnum.TOU_TIAO ? e = this.param.ttAccessToken : $platform.Platform.currPlatForm === $platform.PlatformEnum.KS && (e = this.param.ksAccessToken);

        if ("" !== e) {
          var i = {
            accessToken: e,
            clientId: t,
            autoTrack: {
              appLaunch: !0,
              appShow: !0,
              appHide: !0
            },
            name: "ge",
            debugMode: this.param.isDebug ? "debug" : "none"
          };
          this.ge = new GravityAnalyticsAPI(i);
          this.ge.setupAndStart();
          this.isInit = !0;
          console.log("=========GE 初始化完成==========");
          this.register();
        }
      }
    }
  };

  t.prototype.register = function () {
    var t = this;
    var e = "";
    $platform.Platform.currPlatForm === $platform.PlatformEnum.WECHAT ? e = this.param.wxAccessToken : $platform.Platform.currPlatForm === $platform.PlatformEnum.TOU_TIAO ? e = this.param.ttAccessToken : $platform.Platform.currPlatForm === $platform.PlatformEnum.KS && (e = this.param.ksAccessToken);

    if ("" !== e) {
      if (this.isRegister) {
        console.log("=========玩家已经注册=======");
      } else {
        {
          var i = this.getOpenId();
          "" !== i ? (console.log("参数：", {
            name: i,
            version: 1,
            openid: i,
            enable_sync_attribution: !1
          }), this.ge.initialize({
            name: i,
            version: 1,
            openid: i,
            enable_sync_attribution: !1
          }).then(function (e) {
            console.log("register success " + JSON.stringify(e));
            t.isRegister = !0;
            $storageUtil.StorageUtil.setItem("GE_ISREGISTER", !0, !1);
          })["catch"](function (t) {
            console.log("register failed, error is " + JSON.stringify(t));
          })) : console.error("openID为空");
        }
      }
    }
  };

  t.prototype.reportBytedanceAdToGravity = function (t) {
    if ($platform.Platform.currPlatForm === $platform.PlatformEnum.TOU_TIAO) {
      this.isInit && this.isRegister && "" !== t && "" !== $login.Login.instance.ttOpenId ? console.log("抖音AD上报-", t) : console.warn("条件不成立-不进行上报", this.isInit, this.isRegister, t, $login.Login.instance.ttOpenId);
    }
  };

  t.prototype.reportWxAdToGravity = function (t) {
    if ($platform.Platform.currPlatForm === $platform.PlatformEnum.WECHAT) {
      this.isInit && this.isRegister && "" !== t && "" !== $login.Login.instance.wxOpenId ? (this.ge.adShowEvent("reward", t, {
        custom_param: ""
      }), console.log("微信AD上报-", t)) : console.warn("条件不成立-不进行上报", this.isInit, this.isRegister, t, $login.Login.instance.wxOpenId);
    }
  };

  t.prototype.getOpenId = function () {
    return $platform.Platform.currPlatForm === $platform.PlatformEnum.TOU_TIAO ? $login.Login.instance.ttOpenId : $platform.Platform.currPlatForm === $platform.PlatformEnum.WECHAT ? $login.Login.instance.wxOpenId : $login.Login.instance.ksOpenId;
  };

  t.instance = new t();
  return t;
}();

exports.GeService = a;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXEdlU2VydmljZS5qcyJdLCJuYW1lcyI6WyJleHBvcnRzIiwiR2VTZXJ2aWNlIiwiJGxvZ2luIiwicmVxdWlyZSIsIiRwbGF0Zm9ybSIsIiRzdG9yYWdlVXRpbCIsIiRzd2l0Y2hDb250ZXh0IiwiYSIsInQiLCJpc1JlZ2lzdGVyIiwiaXNJbml0IiwiZ2UiLCJwYXJhbSIsInR0QWNjZXNzVG9rZW4iLCJ3eEFjY2Vzc1Rva2VuIiwia3NBY2Nlc3NUb2tlbiIsImlzRGVidWciLCJwcm90b3R5cGUiLCJzdGFydCIsIlBsYXRmb3JtIiwiY3VyclBsYXRGb3JtIiwiUGxhdGZvcm1FbnVtIiwiVE9VX1RJQU8iLCJXRUNIQVQiLCJLUyIsIlN3aXRjaENvbnRleHQiLCJnZVBhcmFtIiwiU3RvcmFnZVV0aWwiLCJnZXRJdGVtIiwiaW5pdCIsImdldE9wZW5JZCIsImUiLCJpIiwiYWNjZXNzVG9rZW4iLCJjbGllbnRJZCIsImF1dG9UcmFjayIsImFwcExhdW5jaCIsImFwcFNob3ciLCJhcHBIaWRlIiwibmFtZSIsImRlYnVnTW9kZSIsIkdyYXZpdHlBbmFseXRpY3NBUEkiLCJzZXR1cEFuZFN0YXJ0IiwiY29uc29sZSIsImxvZyIsInJlZ2lzdGVyIiwidmVyc2lvbiIsIm9wZW5pZCIsImVuYWJsZV9zeW5jX2F0dHJpYnV0aW9uIiwiaW5pdGlhbGl6ZSIsInRoZW4iLCJKU09OIiwic3RyaW5naWZ5Iiwic2V0SXRlbSIsImVycm9yIiwicmVwb3J0Qnl0ZWRhbmNlQWRUb0dyYXZpdHkiLCJMb2dpbiIsImluc3RhbmNlIiwidHRPcGVuSWQiLCJ3YXJuIiwicmVwb3J0V3hBZFRvR3Jhdml0eSIsInd4T3BlbklkIiwiYWRTaG93RXZlbnQiLCJjdXN0b21fcGFyYW0iLCJrc09wZW5JZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQUEsT0FBTyxDQUFDQyxTQUFSLEdBQW9CLEtBQUssQ0FBekI7O0FBQ0EsSUFB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QUFTLENBQUNpQixZQUFWLENBQXVCQyxRQUEzRCxHQUNEcEIsTUFBTSxDQUFDc0QsS0FBUCxDQUFhQyxRQUFiLENBQXNCQyxRQURyQixHQUVEdEQsU0FBUyxDQUFDZSxRQUFWLENBQW1CQyxZQUFuQixLQUFvQ2hCLFNBQVMsQ0FBQ2lCLFlBQVYsQ0FBdUJFLE1BQTNELEdBQ0FyQixNQUFNLENBQUNzRCxLQUFQLENBQWFDLFFBQWIsQ0FBc0JJLFFBRHRCLEdBRUEzRCxNQUFNLENBQUNzRCxLQUFQLENBQWFDLFFBQWIsQ0FBc0JPLFFBSjVCO0VBS0gsQ0FORDs7RUFPQXhELENBQUMsQ0FBQ2lELFFBQUYsR0FBYSxJQUFJakQsQ0FBSixFQUFiO0VBQ0EsT0FBT0EsQ0FBUDtBQUNILENBM0lPLEVBQVI7O0FBNElBUixPQUFPLENBQUNDLFNBQVIsR0FBb0JNLENBQXBCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnRzLkdlU2VydmljZSA9IHZvaWQgMDtcclxudmFyICRsb2dpbiA9IHJlcXVpcmUoXCIuL0xvZ2luXCIpO1xyXG52YXIgJHBsYXRmb3JtID0gcmVxdWlyZShcIi4vUGxhdGZvcm1cIik7XHJcbnZhciAkc3RvcmFnZVV0aWwgPSByZXF1aXJlKFwiLi9TdG9yYWdlVXRpbFwiKTtcclxudmFyICRzd2l0Y2hDb250ZXh0ID0gcmVxdWlyZShcIi4vU3dpdGNoQ29udGV4dFwiKTtcclxudmFyIGEgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gdCgpIHtcclxuICAgICAgICB0aGlzLmlzUmVnaXN0ZXIgPSAhMTtcclxuICAgICAgICB0aGlzLmlzSW5pdCA9ICExO1xyXG4gICAgICAgIHRoaXMuZ2UgPSBudWxsO1xyXG4gICAgICAgIHRoaXMucGFyYW0gPSB7XHJcbiAgICAgICAgICAgIHR0QWNjZXNzVG9rZW46IFwiXCIsXHJcbiAgICAgICAgICAgIHd4QWNjZXNzVG9rZW46IFwiXCIsXHJcbiAgICAgICAgICAgIGtzQWNjZXNzVG9rZW46IFwiXCIsXHJcbiAgICAgICAgICAgIGlzRGVidWc6ICExXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIHQucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgIShcclxuICAgICAgICAgICAgICAgICRwbGF0Zm9ybS5QbGF0Zm9ybS5jdXJyUGxhdEZvcm0gIT09ICRwbGF0Zm9ybS5QbGF0Zm9ybUVudW0uVE9VX1RJQU8gJiZcclxuICAgICAgICAgICAgICAgICRwbGF0Zm9ybS5QbGF0Zm9ybS5jdXJyUGxhdEZvcm0gIT09ICRwbGF0Zm9ybS5QbGF0Zm9ybUVudW0uV0VDSEFUICYmXHJcbiAgICAgICAgICAgICAgICAkcGxhdGZvcm0uUGxhdGZvcm0uY3VyclBsYXRGb3JtICE9PSAkcGxhdGZvcm0uUGxhdGZvcm1FbnVtLktTXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgdGhpcy5wYXJhbSA9ICRzd2l0Y2hDb250ZXh0LlN3aXRjaENvbnRleHQuZ2VQYXJhbTtcclxuICAgICAgICAgICAgdGhpcy5pc1JlZ2lzdGVyID0gJHN0b3JhZ2VVdGlsLlN0b3JhZ2VVdGlsLmdldEl0ZW0oXCJHRV9JU1JFR0lTVEVSXCIsICExLCAhMSk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdCgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgJHBsYXRmb3JtLlBsYXRmb3JtLmN1cnJQbGF0Rm9ybSA9PT0gJHBsYXRmb3JtLlBsYXRmb3JtRW51bS5UT1VfVElBTyB8fFxyXG4gICAgICAgICAgICAkcGxhdGZvcm0uUGxhdGZvcm0uY3VyclBsYXRGb3JtID09PSAkcGxhdGZvcm0uUGxhdGZvcm1FbnVtLktTIHx8XHJcbiAgICAgICAgICAgICRwbGF0Zm9ybS5QbGF0Zm9ybS5jdXJyUGxhdEZvcm0gPT09ICRwbGF0Zm9ybS5QbGF0Zm9ybUVudW0uV0VDSEFUXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcy5nZXRPcGVuSWQoKTtcclxuICAgICAgICAgICAgaWYgKFwiXCIgIT09IHQgJiYgIXRoaXMuaXNJbml0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAkcGxhdGZvcm0uUGxhdGZvcm0uY3VyclBsYXRGb3JtID09PSAkcGxhdGZvcm0uUGxhdGZvcm1FbnVtLldFQ0hBVFxyXG4gICAgICAgICAgICAgICAgICAgID8gKGUgPSB0aGlzLnBhcmFtLnd4QWNjZXNzVG9rZW4pXHJcbiAgICAgICAgICAgICAgICAgICAgOiAkcGxhdGZvcm0uUGxhdGZvcm0uY3VyclBsYXRGb3JtID09PSAkcGxhdGZvcm0uUGxhdGZvcm1FbnVtLlRPVV9USUFPXHJcbiAgICAgICAgICAgICAgICAgICAgPyAoZSA9IHRoaXMucGFyYW0udHRBY2Nlc3NUb2tlbilcclxuICAgICAgICAgICAgICAgICAgICA6ICRwbGF0Zm9ybS5QbGF0Zm9ybS5jdXJyUGxhdEZvcm0gPT09ICRwbGF0Zm9ybS5QbGF0Zm9ybUVudW0uS1MgJiYgKGUgPSB0aGlzLnBhcmFtLmtzQWNjZXNzVG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgaWYgKFwiXCIgIT09IGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXNzVG9rZW46IGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudElkOiB0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRvVHJhY2s6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcExhdW5jaDogITAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBTaG93OiAhMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcEhpZGU6ICEwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiZ2VcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVidWdNb2RlOiB0aGlzLnBhcmFtLmlzRGVidWcgPyBcImRlYnVnXCIgOiBcIm5vbmVcIlxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZSA9IG5ldyBHcmF2aXR5QW5hbHl0aWNzQVBJKGkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2Uuc2V0dXBBbmRTdGFydCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNJbml0ID0gITA7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCI9PT09PT09PT1HRSDliJ3lp4vljJblrozmiJA9PT09PT09PT09XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXIoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgdCA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGUgPSBcIlwiO1xyXG4gICAgICAgICRwbGF0Zm9ybS5QbGF0Zm9ybS5jdXJyUGxhdEZvcm0gPT09ICRwbGF0Zm9ybS5QbGF0Zm9ybUVudW0uV0VDSEFUXHJcbiAgICAgICAgICAgID8gKGUgPSB0aGlzLnBhcmFtLnd4QWNjZXNzVG9rZW4pXHJcbiAgICAgICAgICAgIDogJHBsYXRmb3JtLlBsYXRmb3JtLmN1cnJQbGF0Rm9ybSA9PT0gJHBsYXRmb3JtLlBsYXRmb3JtRW51bS5UT1VfVElBT1xyXG4gICAgICAgICAgICA/IChlID0gdGhpcy5wYXJhbS50dEFjY2Vzc1Rva2VuKVxyXG4gICAgICAgICAgICA6ICRwbGF0Zm9ybS5QbGF0Zm9ybS5jdXJyUGxhdEZvcm0gPT09ICRwbGF0Zm9ybS5QbGF0Zm9ybUVudW0uS1MgJiYgKGUgPSB0aGlzLnBhcmFtLmtzQWNjZXNzVG9rZW4pO1xyXG4gICAgICAgIGlmIChcIlwiICE9PSBlKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlzUmVnaXN0ZXIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiPT09PT09PT09546p5a625bey57uP5rOo5YaMPT09PT09PVwiKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMuZ2V0T3BlbklkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJcIiAhPT0gaVxyXG4gICAgICAgICAgICAgICAgICAgICAgICA/IChjb25zb2xlLmxvZyhcIuWPguaVsO+8mlwiLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb246IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5pZDogaSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlX3N5bmNfYXR0cmlidXRpb246ICExXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuaW5pdGlhbGl6ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5pZDogaSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZV9zeW5jX2F0dHJpYnV0aW9uOiAhMVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJyZWdpc3RlciBzdWNjZXNzIFwiICsgSlNPTi5zdHJpbmdpZnkoZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5pc1JlZ2lzdGVyID0gITA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RvcmFnZVV0aWwuU3RvcmFnZVV0aWwuc2V0SXRlbShcIkdFX0lTUkVHSVNURVJcIiwgITAsICExKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInJlZ2lzdGVyIGZhaWxlZCwgZXJyb3IgaXMgXCIgKyBKU09OLnN0cmluZ2lmeSh0KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICA6IGNvbnNvbGUuZXJyb3IoXCJvcGVuSUTkuLrnqbpcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgdC5wcm90b3R5cGUucmVwb3J0Qnl0ZWRhbmNlQWRUb0dyYXZpdHkgPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIGlmICgkcGxhdGZvcm0uUGxhdGZvcm0uY3VyclBsYXRGb3JtID09PSAkcGxhdGZvcm0uUGxhdGZvcm1FbnVtLlRPVV9USUFPKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNJbml0ICYmIHRoaXMuaXNSZWdpc3RlciAmJiBcIlwiICE9PSB0ICYmIFwiXCIgIT09ICRsb2dpbi5Mb2dpbi5pbnN0YW5jZS50dE9wZW5JZFxyXG4gICAgICAgICAgICAgICAgPyBjb25zb2xlLmxvZyhcIuaKlumfs0FE5LiK5oqlLVwiLCB0KVxyXG4gICAgICAgICAgICAgICAgOiBjb25zb2xlLndhcm4oXHJcbiAgICAgICAgICAgICAgICAgICAgICBcIuadoeS7tuS4jeaIkOeriy3kuI3ov5vooYzkuIrmiqVcIixcclxuICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNJbml0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc1JlZ2lzdGVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgdCxcclxuICAgICAgICAgICAgICAgICAgICAgICRsb2dpbi5Mb2dpbi5pbnN0YW5jZS50dE9wZW5JZFxyXG4gICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5yZXBvcnRXeEFkVG9HcmF2aXR5ID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICBpZiAoJHBsYXRmb3JtLlBsYXRmb3JtLmN1cnJQbGF0Rm9ybSA9PT0gJHBsYXRmb3JtLlBsYXRmb3JtRW51bS5XRUNIQVQpIHtcclxuICAgICAgICAgICAgdGhpcy5pc0luaXQgJiYgdGhpcy5pc1JlZ2lzdGVyICYmIFwiXCIgIT09IHQgJiYgXCJcIiAhPT0gJGxvZ2luLkxvZ2luLmluc3RhbmNlLnd4T3BlbklkXHJcbiAgICAgICAgICAgICAgICA/ICh0aGlzLmdlLmFkU2hvd0V2ZW50KFwicmV3YXJkXCIsIHQsIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV9wYXJhbTogXCJcIlxyXG4gICAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCLlvq7kv6FBROS4iuaKpS1cIiwgdCkpXHJcbiAgICAgICAgICAgICAgICA6IGNvbnNvbGUud2FybihcclxuICAgICAgICAgICAgICAgICAgICAgIFwi5p2h5Lu25LiN5oiQ56uLLeS4jei/m+ihjOS4iuaKpVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0luaXQsXHJcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzUmVnaXN0ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICB0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgJGxvZ2luLkxvZ2luLmluc3RhbmNlLnd4T3BlbklkXHJcbiAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHQucHJvdG90eXBlLmdldE9wZW5JZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gJHBsYXRmb3JtLlBsYXRmb3JtLmN1cnJQbGF0Rm9ybSA9PT0gJHBsYXRmb3JtLlBsYXRmb3JtRW51bS5UT1VfVElBT1xyXG4gICAgICAgICAgICA/ICRsb2dpbi5Mb2dpbi5pbnN0YW5jZS50dE9wZW5JZFxyXG4gICAgICAgICAgICA6ICRwbGF0Zm9ybS5QbGF0Zm9ybS5jdXJyUGxhdEZvcm0gPT09ICRwbGF0Zm9ybS5QbGF0Zm9ybUVudW0uV0VDSEFUXHJcbiAgICAgICAgICAgID8gJGxvZ2luLkxvZ2luLmluc3RhbmNlLnd4T3BlbklkXHJcbiAgICAgICAgICAgIDogJGxvZ2luLkxvZ2luLmluc3RhbmNlLmtzT3BlbklkO1xyXG4gICAgfTtcclxuICAgIHQuaW5zdGFuY2UgPSBuZXcgdCgpO1xyXG4gICAgcmV0dXJuIHQ7XHJcbn0pKCk7XHJcbmV4cG9ydHMuR2VTZXJ2aWNlID0gYTtcclxuIl19