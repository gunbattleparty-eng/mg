
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/Bullet_12.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '3d963WV5MNADLxJdLCzHQdD', 'Bullet_12');
// game_script/scripts/Bullet_12.js

"use strict";

var o;

var $gamePool = require("./GamePool");

var $util = require("./Util");

var $gameContext = require("./GameContext");

var $gameSkillInfo = require("./GameSkillInfo");

var $baseBullet = require("./BaseBullet");

var d = cc._decorator;
var p = d.ccclass;
var f = d.property;
var h = new cc.Size(0, 20);
var m = new cc.Vec3();

var y = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.buttleType = $baseBullet.BulletType.thunder_puncture;
    e.animPrefab = null;
    e.currAtkEnemyCount = 0;
    e.currTargetPos = null;
    e.currTarget = null;
    e.targetIsExist = !0;
    e.tailNode = [];
    return e;
  }

  __extends(e, t);

  e.prototype.initButtle = function (e, i) {
    t.prototype.initButtle.call(this, e, i);
    this.atk = this.skillParam.thunderPierceAtk[$gameSkillInfo.Skill4Param.FINAL];
  };

  e.prototype.initBullet12 = function (t, e) {
    this.skillId = e;
    this.isUse = !1;
    this.currAtkEnemyCount = 0;
    this.targetIsExist = !0;
    this.currTarget = t;
    this.currTargetPos = t.getPosition();
    this.tailNode.length = 0;
  };

  e.prototype.updateFrame = function (t) {
    if (!this.isUse) {
      if (this.targetIsExist) {
        if (!(cc.isValid(this.currTarget) && this.currTarget.node.parent)) {
          this.targetIsExist = !1;
          this.currTargetPos = this.node.position.clone();
        }
      }

      var e = this.getPosition();
      var i = this.velocity;
      m.x = e.x + i.x * t;
      m.y = e.y + i.y * t;
      m.z = e.z + i.z * t;
      this.setPosition(m);

      if (this.node.position.sub(this.currTargetPos).magSqr() < 400) {
        var o = null;
        this.targetIsExist ? (this.currTarget.sufferAtk({
          id: 61,
          skillSpecialitys: this.skillSpecialitys,
          atk: this.atk
        }), o = $gameContext["default"].ins.getRangeRandomEnemyLayer(this.currTarget.node, this.skillParam.thunderPierceRange)) : o = $gameContext["default"].ins.getRangeRandomEnemyLayerByPos(this.currTargetPos, this.skillParam.thunderPierceRange);
        this.currAtkEnemyCount++;

        if (!o || this.currAtkEnemyCount >= this.skillParam.thunderPierceCount) {
          return void this.destoryBullet();
        }

        this.targetIsExist = !0;
        this.currTarget = o;
        this.currTargetPos = o.getPosition();
      }

      if (this.tailNode.length < this.currAtkEnemyCount + 1) {
        var n = $gamePool["default"].instance.get($gamePool.PoolKey.THUNDER_PUNCTURE_ANIMS);

        if (!cc.isValid(n)) {
          n = cc.instantiate(this.animPrefab);
        }

        n.parent = $gameContext["default"].ins.buttleLayer;
        n.position = this.getPosition().clone();
        h.width = 0;
        n.setContentSize(h);
        this.tailNode[this.currAtkEnemyCount] = n;
      }

      var s = this.tailNode[this.currAtkEnemyCount];
      var c = $util["default"].dirConverAngle(this.node.position.sub(s.position).normalize());
      s.angle = c;
      h.width = s.width + this.speed * t;
      s.setContentSize(h);
      var u = this.currTargetPos.sub(this.node.position).normalize();
      this.speed = 1200;
      this.velocity.set(u).mulSelf(this.speed);
    }
  };

  e.prototype.destoryBullet = function () {
    var t = this;
    this.isUse = !0;
    this.scheduleOnce(function () {
      for (var e = 0; e < t.tailNode.length; e++) {
        $gamePool["default"].instance.put($gamePool.PoolKey.THUNDER_PUNCTURE_ANIMS, t.tailNode[e]);
      }

      t.removeSelf();
    }, 0.15);
  };

  __decorate([f(cc.Prefab)], e.prototype, "animPrefab", void 0);

  return __decorate([p], e);
}($baseBullet["default"]);

exports["default"] = y;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXEJ1bGxldF8xMi5qcyJdLCJuYW1lcyI6WyJvIiwiJGdhbWVQb29sIiwicmVxdWlyZSIsIiR1dGlsIiwiJGdhbWVDb250ZXh0IiwiJGdhbWVTa2lsbEluZm8iLCIkYmFzZUJ1bGxldCIsImQiLCJjYyIsIl9kZWNvcmF0b3IiLCJwIiwiY2NjbGFzcyIsImYiLCJwcm9wZXJ0eSIsImgiLCJTaXplIiwibSIsIlZlYzMiLCJ5IiwidCIsImUiLCJhcHBseSIsImFyZ3VtZW50cyIsImJ1dHRsZVR5cGUiLCJCdWxsZXRUeXBlIiwidGh1bmRlcl9wdW5jdHVyZSIsImFuaW1QcmVmYWIiLCJjdXJyQXRrRW5lbXlDb3VudCIsImN1cnJUYXJnZXRQb3MiLCJjdXJyVGFyZ2V0IiwidGFyZ2V0SXNFeGlzdCIsInRhaWxOb2RlIiwiX19leHRlbmRzIiwicHJvdG90eXBlIiwiaW5pdEJ1dHRsZSIsImkiLCJjYWxsIiwiYXRrIiwic2tpbGxQYXJhbSIsInRodW5kZXJQaWVyY2VBdGsiLCJTa2lsbDRQYXJhbSIsIkZJTkFMIiwiaW5pdEJ1bGxldDEyIiwic2tpbGxJZCIsImlzVXNlIiwiZ2V0UG9zaXRpb24iLCJsZW5ndGgiLCJ1cGRhdGVGcmFtZSIsImlzVmFsaWQiLCJub2RlIiwicGFyZW50IiwicG9zaXRpb24iLCJjbG9uZSIsInZlbG9jaXR5IiwieCIsInoiLCJzZXRQb3NpdGlvbiIsInN1YiIsIm1hZ1NxciIsInN1ZmZlckF0ayIsImlkIiwic2tpbGxTcGVjaWFsaXR5cyIsImlucyIsImdldFJhbmdlUmFuZG9tRW5lbXlMYXllciIsInRodW5kZXJQaWVyY2VSYW5nZSIsImdldFJhbmdlUmFuZG9tRW5lbXlMYXllckJ5UG9zIiwidGh1bmRlclBpZXJjZUNvdW50IiwiZGVzdG9yeUJ1bGxldCIsIm4iLCJpbnN0YW5jZSIsImdldCIsIlBvb2xLZXkiLCJUSFVOREVSX1BVTkNUVVJFX0FOSU1TIiwiaW5zdGFudGlhdGUiLCJidXR0bGVMYXllciIsIndpZHRoIiwic2V0Q29udGVudFNpemUiLCJzIiwiYyIsImRpckNvbnZlckFuZ2xlIiwibm9ybWFsaXplIiwiYW5nbGUiLCJzcGVlZCIsInUiLCJzZXQiLCJtdWxTZWxmIiwic2NoZWR1bGVPbmNlIiwicHV0IiwicmVtb3ZlU2VsZiIsIl9fZGVjb3JhdGUiLCJQcmVmYWIiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLENBQUo7O0FBQ0EsSUFBSUMsU0FBUyxHQUFHQyxPQUFPLENBQUMsWUFBRCxDQUF2Qjs7QUFDQSxJQUFJQyxLQUFLLEdBQUdELE9BQU8sQ0FBQyxRQUFELENBQW5COztBQUNBLElBQUlFLFlBQVksR0FBR0YsT0FBTyxDQUFDLGVBQUQsQ0FBMUI7O0FBQ0EsSUFBSUcsY0FBYyxHQUFHSCxPQUFPLENBQUMsaUJBQUQsQ0FBNUI7O0FBQ0EsSUFBSUksV0FBVyxHQUFHSixPQUFPLENBQUMsY0FBRCxDQUF6Qjs7QUFDQSxJQUFJSyxDQUFDLEdBQUdDLEVBQUUsQ0FBQ0MsVUFBWDtBQUNBLElBQUlDLENBQUMsR0FBR0gsQ0FBQyxDQUFDSSxPQUFWO0FBQ0EsSUFBSUMsQ0FBQyxHQUFHTCxDQUFDLENBQUNNLFFBQVY7QUFDQSxJQUFJQyxDQUFDLEdBQUcsSUFBSU4sRUFBRSxDQUFDTyxJQUFQLENBQVksQ0FBWixFQUFlLEVBQWYsQ0FBUjtBQUNBLElBQUlDLENBQUMsR0FBRyxJQUFJUixFQUFFLENBQUNTLElBQVAsRUFBUjs7QUFDQSxJQUFJQyxDQUFDLEdBQUksVUFBVUMsQ0FBVixFQUFhO0VBQ2xCLFNBQVNDLENBQVQsR0FBYTtJQUNULElBQUlBLENBQUMsR0FBSSxTQUFTRCxDQUFULElBQWNBLENBQUMsQ0FBQ0UsS0FBRixDQUFRLElBQVIsRUFBY0MsU0FBZCxDQUFmLElBQTRDLElBQXBEO0lBQ0FGLENBQUMsQ0FBQ0csVUFBRixHQUFlakIsV0FBVyxDQUFDa0IsVUFBWixDQUF1QkMsZ0JBQXRDO0lBQ0FMLENBQUMsQ0FB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O1FBQ3hDbkIsU0FBUyxXQUFULENBQWtCb0UsUUFBbEIsQ0FBMkJrQixHQUEzQixDQUErQnRGLFNBQVMsQ0FBQ3NFLE9BQVYsQ0FBa0JDLHNCQUFqRCxFQUF5RXJELENBQUMsQ0FBQ1ksUUFBRixDQUFXWCxDQUFYLENBQXpFO01BQ0g7O01BQ0RELENBQUMsQ0FBQ3FFLFVBQUY7SUFDSCxDQUxELEVBS0csSUFMSDtFQU1ILENBVEQ7O0VBVUFDLFVBQVUsQ0FBQyxDQUFDN0UsQ0FBQyxDQUFDSixFQUFFLENBQUNrRixNQUFKLENBQUYsQ0FBRCxFQUFpQnRFLENBQUMsQ0FBQ2EsU0FBbkIsRUFBOEIsWUFBOUIsRUFBNEMsS0FBSyxDQUFqRCxDQUFWOztFQUNBLE9BQU93RCxVQUFVLENBQUMsQ0FBQy9FLENBQUQsQ0FBRCxFQUFNVSxDQUFOLENBQWpCO0FBQ0gsQ0FqR08sQ0FpR0xkLFdBQVcsV0FqR04sQ0FBUjs7QUFrR0FxRixPQUFPLFdBQVAsR0FBa0J6RSxDQUFsQiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyIG87XHJcbnZhciAkZ2FtZVBvb2wgPSByZXF1aXJlKFwiLi9HYW1lUG9vbFwiKTtcclxudmFyICR1dGlsID0gcmVxdWlyZShcIi4vVXRpbFwiKTtcclxudmFyICRnYW1lQ29udGV4dCA9IHJlcXVpcmUoXCIuL0dhbWVDb250ZXh0XCIpO1xyXG52YXIgJGdhbWVTa2lsbEluZm8gPSByZXF1aXJlKFwiLi9HYW1lU2tpbGxJbmZvXCIpO1xyXG52YXIgJGJhc2VCdWxsZXQgPSByZXF1aXJlKFwiLi9CYXNlQnVsbGV0XCIpO1xyXG52YXIgZCA9IGNjLl9kZWNvcmF0b3I7XHJcbnZhciBwID0gZC5jY2NsYXNzO1xyXG52YXIgZiA9IGQucHJvcGVydHk7XHJcbnZhciBoID0gbmV3IGNjLlNpemUoMCwgMjApO1xyXG52YXIgbSA9IG5ldyBjYy5WZWMzKCk7XHJcbnZhciB5ID0gKGZ1bmN0aW9uICh0KSB7XHJcbiAgICBmdW5jdGlvbiBlKCkge1xyXG4gICAgICAgIHZhciBlID0gKG51bGwgIT09IHQgJiYgdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSB8fCB0aGlzO1xyXG4gICAgICAgIGUuYnV0dGxlVHlwZSA9ICRiYXNlQnVsbGV0LkJ1bGxldFR5cGUudGh1bmRlcl9wdW5jdHVyZTtcclxuICAgICAgICBlLmFuaW1QcmVmYWIgPSBudWxsO1xyXG4gICAgICAgIGUuY3VyckF0a0VuZW15Q291bnQgPSAwO1xyXG4gICAgICAgIGUuY3VyclRhcmdldFBvcyA9IG51bGw7XHJcbiAgICAgICAgZS5jdXJyVGFyZ2V0ID0gbnVsbDtcclxuICAgICAgICBlLnRhcmdldElzRXhpc3QgPSAhMDtcclxuICAgICAgICBlLnRhaWxOb2RlID0gW107XHJcbiAgICAgICAgcmV0dXJuIGU7XHJcbiAgICB9XHJcbiAgICBfX2V4dGVuZHMoZSwgdCk7XHJcbiAgICBlLnByb3RvdHlwZS5pbml0QnV0dGxlID0gZnVuY3Rpb24gKGUsIGkpIHtcclxuICAgICAgICB0LnByb3RvdHlwZS5pbml0QnV0dGxlLmNhbGwodGhpcywgZSwgaSk7XHJcbiAgICAgICAgdGhpcy5hdGsgPSB0aGlzLnNraWxsUGFyYW0udGh1bmRlclBpZXJjZUF0a1skZ2FtZVNraWxsSW5mby5Ta2lsbDRQYXJhbS5GSU5BTF07XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUuaW5pdEJ1bGxldDEyID0gZnVuY3Rpb24gKHQsIGUpIHtcclxuICAgICAgICB0aGlzLnNraWxsSWQgPSBlO1xyXG4gICAgICAgIHRoaXMuaXNVc2UgPSAhMTtcclxuICAgICAgICB0aGlzLmN1cnJBdGtFbmVteUNvdW50ID0gMDtcclxuICAgICAgICB0aGlzLnRhcmdldElzRXhpc3QgPSAhMDtcclxuICAgICAgICB0aGlzLmN1cnJUYXJnZXQgPSB0O1xyXG4gICAgICAgIHRoaXMuY3VyclRhcmdldFBvcyA9IHQuZ2V0UG9zaXRpb24oKTtcclxuICAgICAgICB0aGlzLnRhaWxOb2RlLmxlbmd0aCA9IDA7XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUudXBkYXRlRnJhbWUgPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIGlmICghdGhpcy5pc1VzZSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy50YXJnZXRJc0V4aXN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIShjYy5pc1ZhbGlkKHRoaXMuY3VyclRhcmdldCkgJiYgdGhpcy5jdXJyVGFyZ2V0Lm5vZGUucGFyZW50KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0SXNFeGlzdCA9ICExO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3VyclRhcmdldFBvcyA9IHRoaXMubm9kZS5wb3NpdGlvbi5jbG9uZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBlID0gdGhpcy5nZXRQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICB2YXIgaSA9IHRoaXMudmVsb2NpdHk7XHJcbiAgICAgICAgICAgIG0ueCA9IGUueCArIGkueCAqIHQ7XHJcbiAgICAgICAgICAgIG0ueSA9IGUueSArIGkueSAqIHQ7XHJcbiAgICAgICAgICAgIG0ueiA9IGUueiArIGkueiAqIHQ7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24obSk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm5vZGUucG9zaXRpb24uc3ViKHRoaXMuY3VyclRhcmdldFBvcykubWFnU3FyKCkgPCA0MDApIHtcclxuICAgICAgICAgICAgICAgIHZhciBvID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0SXNFeGlzdFxyXG4gICAgICAgICAgICAgICAgICAgID8gKHRoaXMuY3VyclRhcmdldC5zdWZmZXJBdGsoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiA2MSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBza2lsbFNwZWNpYWxpdHlzOiB0aGlzLnNraWxsU3BlY2lhbGl0eXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYXRrOiB0aGlzLmF0a1xyXG4gICAgICAgICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAobyA9ICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5nZXRSYW5nZVJhbmRvbUVuZW15TGF5ZXIoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyVGFyZ2V0Lm5vZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5za2lsbFBhcmFtLnRodW5kZXJQaWVyY2VSYW5nZVxyXG4gICAgICAgICAgICAgICAgICAgICAgKSkpXHJcbiAgICAgICAgICAgICAgICAgICAgOiAobyA9ICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5nZXRSYW5nZVJhbmRvbUVuZW15TGF5ZXJCeVBvcyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJUYXJnZXRQb3MsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5za2lsbFBhcmFtLnRodW5kZXJQaWVyY2VSYW5nZVxyXG4gICAgICAgICAgICAgICAgICAgICAgKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJBdGtFbmVteUNvdW50Kys7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW8gfHwgdGhpcy5jdXJyQXRrRW5lbXlDb3VudCA+PSB0aGlzLnNraWxsUGFyYW0udGh1bmRlclBpZXJjZUNvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdGhpcy5kZXN0b3J5QnVsbGV0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldElzRXhpc3QgPSAhMDtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VyclRhcmdldCA9IG87XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJUYXJnZXRQb3MgPSBvLmdldFBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMudGFpbE5vZGUubGVuZ3RoIDwgdGhpcy5jdXJyQXRrRW5lbXlDb3VudCArIDEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBuID0gJGdhbWVQb29sLmRlZmF1bHQuaW5zdGFuY2UuZ2V0KCRnYW1lUG9vbC5Qb29sS2V5LlRIVU5ERVJfUFVOQ1RVUkVfQU5JTVMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjYy5pc1ZhbGlkKG4pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbiA9IGNjLmluc3RhbnRpYXRlKHRoaXMuYW5pbVByZWZhYik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBuLnBhcmVudCA9ICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5idXR0bGVMYXllcjtcclxuICAgICAgICAgICAgICAgIG4ucG9zaXRpb24gPSB0aGlzLmdldFBvc2l0aW9uKCkuY2xvbmUoKTtcclxuICAgICAgICAgICAgICAgIGgud2lkdGggPSAwO1xyXG4gICAgICAgICAgICAgICAgbi5zZXRDb250ZW50U2l6ZShoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudGFpbE5vZGVbdGhpcy5jdXJyQXRrRW5lbXlDb3VudF0gPSBuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBzID0gdGhpcy50YWlsTm9kZVt0aGlzLmN1cnJBdGtFbmVteUNvdW50XTtcclxuICAgICAgICAgICAgdmFyIGMgPSAkdXRpbC5kZWZhdWx0LmRpckNvbnZlckFuZ2xlKHRoaXMubm9kZS5wb3NpdGlvbi5zdWIocy5wb3NpdGlvbikubm9ybWFsaXplKCkpO1xyXG4gICAgICAgICAgICBzLmFuZ2xlID0gYztcclxuICAgICAgICAgICAgaC53aWR0aCA9IHMud2lkdGggKyB0aGlzLnNwZWVkICogdDtcclxuICAgICAgICAgICAgcy5zZXRDb250ZW50U2l6ZShoKTtcclxuICAgICAgICAgICAgdmFyIHUgPSB0aGlzLmN1cnJUYXJnZXRQb3Muc3ViKHRoaXMubm9kZS5wb3NpdGlvbikubm9ybWFsaXplKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc3BlZWQgPSAxMjAwO1xyXG4gICAgICAgICAgICB0aGlzLnZlbG9jaXR5LnNldCh1KS5tdWxTZWxmKHRoaXMuc3BlZWQpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5kZXN0b3J5QnVsbGV0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciB0ID0gdGhpcztcclxuICAgICAgICB0aGlzLmlzVXNlID0gITA7XHJcbiAgICAgICAgdGhpcy5zY2hlZHVsZU9uY2UoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBlID0gMDsgZSA8IHQudGFpbE5vZGUubGVuZ3RoOyBlKyspIHtcclxuICAgICAgICAgICAgICAgICRnYW1lUG9vbC5kZWZhdWx0Lmluc3RhbmNlLnB1dCgkZ2FtZVBvb2wuUG9vbEtleS5USFVOREVSX1BVTkNUVVJFX0FOSU1TLCB0LnRhaWxOb2RlW2VdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0LnJlbW92ZVNlbGYoKTtcclxuICAgICAgICB9LCAwLjE1KTtcclxuICAgIH07XHJcbiAgICBfX2RlY29yYXRlKFtmKGNjLlByZWZhYildLCBlLnByb3RvdHlwZSwgXCJhbmltUHJlZmFiXCIsIHZvaWQgMCk7XHJcbiAgICByZXR1cm4gX19kZWNvcmF0ZShbcF0sIGUpO1xyXG59KSgkYmFzZUJ1bGxldC5kZWZhdWx0KTtcclxuZXhwb3J0cy5kZWZhdWx0ID0geTtcclxuIl19