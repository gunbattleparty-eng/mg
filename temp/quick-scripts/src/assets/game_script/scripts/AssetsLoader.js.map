{"version":3,"sources":["assets\\game_script\\scripts\\AssetsLoader.js"],"names":["exports","BundleLoader","s","t","prototype","loadBundleSync","e","i","__awaiter","Promise","__generator","o","n","cc","assetManager","getBundle","loadBundle","onFileProgress","progress","console","error","loadRes","load","warn","loadResSync","r","a","preLoadRes","preload","release","releaseAll","removeBundle","getRes","get","Asset","getResArray","Array","length","push","isBundleLoaded","isResLoaded","instance","_bundleName","_onProgCallBack","_cmpCallBack","sys","localStorage","getItem","downloader","remoteServerAddress","cacheManager","clearCache","setItem"],"mappings":"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","sourceRoot":"/","sourcesContent":["exports.BundleLoader = void 0;\r\nvar s = (function () {\r\n    function t() {}\r\n    t.prototype.loadBundleSync = function (t, e, i) {\r\n        return __awaiter(this, void 0, Promise, function () {\r\n            return __generator(this, function () {\r\n                return [\r\n                    2,\r\n                    new Promise(function (o, n) {\r\n                        var s = cc.assetManager.getBundle(t);\r\n                        if (s) {\r\n                            if (i) {\r\n                                i(null, s);\r\n                            }\r\n                            return o(s);\r\n                        }\r\n                        cc.assetManager.loadBundle(\r\n                            t,\r\n                            {\r\n                                onFileProgress: function (t) {\r\n                                    var i = t.progress;\r\n                                    if (i && e) {\r\n                                        e(i / 100);\r\n                                    }\r\n                                }\r\n                            },\r\n                            function (t, e) {\r\n                                return t ? (i && i(t, null), n(t)) : (i && i(null, e), o(e));\r\n                            }\r\n                        );\r\n                    }).catch(function (t) {\r\n                        console.error(t);\r\n                    })\r\n                ];\r\n            });\r\n        });\r\n    };\r\n    t.prototype.loadRes = function (t, e, i, o, n) {\r\n        var s = cc.assetManager.getBundle(t);\r\n        if (!s) {\r\n            console.error(\"bundle未加载或不存在 ==> \" + t);\r\n        }\r\n        s.load(\r\n            e,\r\n            i,\r\n            function (t, e) {\r\n                if (o) {\r\n                    o(t, e);\r\n                }\r\n            },\r\n            function (t, e) {\r\n                t ? (console.warn(\"不存在资源 ==> \", t), n && n(t, null)) : n && n(null, e);\r\n            }\r\n        );\r\n    };\r\n    t.prototype.loadResSync = function (t, e, i, s, r) {\r\n        return __awaiter(this, void 0, Promise, function () {\r\n            return __generator(this, function () {\r\n                return [\r\n                    2,\r\n                    new Promise(function (o, n) {\r\n                        var a = cc.assetManager.getBundle(t);\r\n                        if (!a) {\r\n                            n(\"检测bundle是否加载：\" + t);\r\n                        }\r\n                        a.load(\r\n                            e,\r\n                            i,\r\n                            function (t, e) {\r\n                                if (s) {\r\n                                    s(t, e);\r\n                                }\r\n                            },\r\n                            function (t, e) {\r\n                                t ? n(\"资源未找到： \" + t) : o(e);\r\n                                if (r) {\r\n                                    r(t, e);\r\n                                }\r\n                            }\r\n                        );\r\n                    }).catch(function (t) {\r\n                        console.warn(t);\r\n                    })\r\n                ];\r\n            });\r\n        });\r\n    };\r\n    t.prototype.preLoadRes = function (t, e, i, o, n) {\r\n        var s = cc.assetManager.getBundle(t);\r\n        if (!s) {\r\n            console.warn(\"检测bundle是否加载： \" + t);\r\n        }\r\n        s.preload(\r\n            e,\r\n            i,\r\n            function (t, e) {\r\n                if (o) {\r\n                    o(t, e);\r\n                }\r\n            },\r\n            function (t, e) {\r\n                t ? (console.warn(\"资源未找到：\" + t), n && n(t, null)) : n && n(null, e);\r\n            }\r\n        );\r\n    };\r\n    t.prototype.release = function (t, e) {\r\n        if (void 0 === e) {\r\n            e = !0;\r\n        }\r\n        if (\"string\" == typeof t) {\r\n            t = cc.assetManager.getBundle(t);\r\n        }\r\n        t ? (e && t.releaseAll(), cc.assetManager.removeBundle(t)) : console.error(\"bundle未找到\");\r\n    };\r\n    t.prototype.getBundle = function (t) {\r\n        return cc.assetManager.getBundle(t);\r\n    };\r\n    t.prototype.getRes = function (t, e, i) {\r\n        var o = this.getBundle(t);\r\n        return o\r\n            ? o.get(e, i || cc.Asset) || (console.warn(\"资源未找到, \" + t + \",\" + e), null)\r\n            : (console.error(\"bundle未加载, \" + t), null);\r\n    };\r\n    t.prototype.getResArray = function (t, e, i) {\r\n        var o = this.getBundle(t);\r\n        if (!o) {\r\n            console.error(\"bundle未加载, \" + t);\r\n            return null;\r\n        }\r\n        var n = new Array();\r\n        for (var s = 0; s < e.length; s++) {\r\n            var r = o.get(e[s], i || cc.Asset);\r\n            r ? n.push(r) : console.error(\"资源未找到, \" + t + \",\" + e[s]);\r\n        }\r\n        return n;\r\n    };\r\n    t.prototype.isBundleLoaded = function (t) {\r\n        return !!this.getBundle(t);\r\n    };\r\n    t.prototype.isResLoaded = function (t, e, i) {\r\n        var o = this.getBundle(t);\r\n        return !!o && !!o.get(e, i || cc.Asset);\r\n    };\r\n    t.instance = new t();\r\n    return t;\r\n})();\r\nexports.default = s;\r\nexports.BundleLoader = function (t, e, i) {\r\n    this._bundleName = t;\r\n    this._onProgCallBack = e;\r\n    this._cmpCallBack = i;\r\n    s.instance.loadBundleSync(t, e, i);\r\n};\r\ncc.sys.localStorage.getItem(\"LastAssetsVersion\") !== cc.assetManager.downloader.remoteServerAddress\r\n    ? cc.assetManager.cacheManager && cc.assetManager.cacheManager.clearCache\r\n        ? (cc.assetManager.cacheManager.clearCache(),\r\n          cc.sys.localStorage.setItem(\"LastAssetsVersion\", cc.assetManager.downloader.remoteServerAddress),\r\n          console.warn(\"old assets is removed\"))\r\n        : console.warn(\"cur cc.assetManager.cacheManager is null\")\r\n    : console.warn(\"old assets have no change\");\r\n"]}