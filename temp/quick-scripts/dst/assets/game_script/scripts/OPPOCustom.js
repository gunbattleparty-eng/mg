
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/OPPOCustom.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '9e53aV3lCFAjo9d7+QNmpeM', 'OPPOCustom');
// game_script/scripts/OPPOCustom.js

"use strict";

var o;

var $baseAd = require("./BaseAd");

var r = window.qg;

var a = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.style = null;
    e.isOpenPreLoad = !1;
    return e;
  }

  __extends(e, t);

  e.prototype.loadAd = function () {
    if (this.adUnitId) {
      if (r && r.createCustomAd) {
        var t = this.style || {};

        if (t.isBanner) {
          var e = r.getSystemInfoSync();
          var i = e.windowHeight;
          var o = e.windowWidth;
          t.width = o;
          t.top = Math.round(i - 5.5 * t.width / 16 - 10);
        } else {
          t.top = 400;
        }

        this.isLoaded = !0;
        var n = {
          adUnitId: this.adUnitId,
          style: {
            top: t.top || 30,
            left: t.left,
            width: t.width
          }
        };
        this.adIns = r.createCustomAd(n);

        if (this.adIns.onLoad) {
          this.adIns.onLoad(this.onLoad);
        }

        if (this.adIns.onHide) {
          this.adIns.onHide(this.onHide);
        }

        if (this.adIns.onError) {
          this.adIns.onError(this.onError);
        }
      } else {
        console.warn("当前平台不支持创建createCustomAd");
      }
    } else {
      console.error("CustomAd ID为空");
    }
  };

  e.prototype.showCustomAd = function (t, e, i, o) {
    var n = this;
    this.showCallback = e;
    this.closeCallback = i;
    this.errorCallback = o;
    this.style = t;

    if (this.isCanShow) {
      if (!this.adIns) {
        console.warn(this.adUnitId, ":未创建，执行创建");
        this.isAutoShow = !0;
        this.loadAd();
      }

      if (this.hideing || !this.isLoaded) {
        console.warn(this.adUnitId, ":正在隐藏或加载中，稍等");
        return void (this.isAutoShow = !0);
      }

      this.showing = !1;
      this.isConsume = !0;

      if (this.adIns.show) {
        var s = this.adIns.show();
        s && s.then ? s.then(function () {
          n.showing = !0;

          if (n.showCallback) {
            n.showCallback();
          }

          n.showCallback = null;
        })["catch"](function (t) {
          console.warn(n.adUnitId, ":show错误，重新加载", t);
          n.reCreateAd(!0);
        }) : (console.warn(this.adUnitId, ":show显示失败，重新加载"), this.reCreateAd(!0));
      } else {
        console.error(this.adUnitId, ":未知错误");
      }
    } else {
      console.warn(this.adUnitId, ":当前广告禁止显示");
    }
  };

  e.prototype.destroyAd = function () {
    t.prototype.destroyAd.call(this);

    if (this.adIns) {
      if (this.adIns.offLoad) {
        this.adIns.offLoad(this.onLoad);
      }

      if (this.adIns.offHide) {
        this.adIns.offHide(this.onHide);
      }

      if (this.adIns.offError) {
        this.adIns.offError(this.onError);
      }

      if (this.adIns.destroy) {
        this.adIns.destroy();
      }

      this.adIns = null;
    }
  };

  e.prototype.onAdError = function (t) {
    console.log("原生模板onAdError", this.adUnitId, t);
    this.showing = !1;

    if (this.errorCallback) {
      this.errorCallback();
    }

    this.destroyAd();
  };

  e.prototype.onAdClose = function () {
    console.log(":===onAdClose===");
    this.showing = !1;

    if (this.closeCallback) {
      this.closeCallback();
    }

    if (this.setOpenPreLoad) {
      this.reCreateAd(!1);
    }
  };

  e.prototype.onAdHide = function () {
    console.log(":===onAdHide===");
    this.showing = !1;
    this.hideing = !1;

    if (this.setOpenPreLoad) {
      this.reCreateAd(!1);
    }
  };

  return e;
}($baseAd.BaseAd);

exports["default"] = a;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXE9QUE9DdXN0b20uanMiXSwibmFtZXMiOlsibyIsIiRiYXNlQWQiLCJyZXF1aXJlIiwiciIsIndpbmRvdyIsInFnIiwiYSIsInQiLCJlIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJzdHlsZSIsImlzT3BlblByZUxvYWQiLCJfX2V4dGVuZHMiLCJwcm90b3R5cGUiLCJsb2FkQWQiLCJhZFVuaXRJZCIsImNyZWF0ZUN1c3RvbUFkIiwiaXNCYW5uZXIiLCJnZXRTeXN0ZW1JbmZvU3luYyIsImkiLCJ3aW5kb3dIZWlnaHQiLCJ3aW5kb3dXaWR0aCIsIndpZHRoIiwidG9wIiwiTWF0aCIsInJvdW5kIiwiaXNMb2FkZWQiLCJuIiwibGVmdCIsImFkSW5zIiwib25Mb2FkIiwib25IaWRlIiwib25FcnJvciIsImNvbnNvbGUiLCJ3YXJuIiwiZXJyb3IiLCJzaG93Q3VzdG9tQWQiLCJzaG93Q2FsbGJhY2siLCJjbG9zZUNhbGxiYWNrIiwiZXJyb3JDYWxsYmFjayIsImlzQ2FuU2hvdyIsImlzQXV0b1Nob3ciLCJoaWRlaW5nIiwic2hvd2luZyIsImlzQ29uc3VtZSIsInNob3ciLCJzIiwidGhlbiIsInJlQ3JlYXRlQWQiLCJkZXN0cm95QWQiLCJjYWxsIiwib2ZmTG9hZCIsIm9mZkhpZGUiLCJvZmZFcnJvciIsImRlc3Ryb3kiLCJvbkFkRXJyb3IiLCJsb2ciLCJvbkFkQ2xvc2UiLCJzZXRPcGVuUHJlTG9hZCIsIm9uQWRIaWRlIiwiQmFzZUFkIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxDQUFKOztBQUNBLElBQUlDLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFVBQUQsQ0FBckI7O0FBQ0EsSUFBSUMsQ0FBQyxHQUFHQyxNQUFNLENBQUNDLEVBQWY7O0FBQ0EsSUFBSUMsQ0FBQyxHQUFJLFVBQVVDLENBQVYsRUFBYTtFQUNsQixTQUFTQyxDQUFULEdBQWE7SUFDVCxJQUFJ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a0JBQVo7SUFDQSxLQUFLYixPQUFMLEdBQWUsQ0FBQyxDQUFoQjs7SUFDQSxJQUFJLEtBQUtMLGFBQVQsRUFBd0I7TUFDcEIsS0FBS0EsYUFBTDtJQUNIOztJQUNELElBQUksS0FBS29CLGNBQVQsRUFBeUI7TUFDckIsS0FBS1YsVUFBTCxDQUFnQixDQUFDLENBQWpCO0lBQ0g7RUFDSixDQVREOztFQVVBekMsQ0FBQyxDQUFDTSxTQUFGLENBQVk4QyxRQUFaLEdBQXVCLFlBQVk7SUFDL0IxQixPQUFPLENBQUN1QixHQUFSLENBQVksaUJBQVo7SUFDQSxLQUFLYixPQUFMLEdBQWUsQ0FBQyxDQUFoQjtJQUNBLEtBQUtELE9BQUwsR0FBZSxDQUFDLENBQWhCOztJQUNBLElBQUksS0FBS2dCLGNBQVQsRUFBeUI7TUFDckIsS0FBS1YsVUFBTCxDQUFnQixDQUFDLENBQWpCO0lBQ0g7RUFDSixDQVBEOztFQVFBLE9BQU96QyxDQUFQO0FBQ0gsQ0FySU8sQ0FxSUxQLE9BQU8sQ0FBQzRELE1BcklILENBQVI7O0FBc0lBQyxPQUFPLFdBQVAsR0FBa0J4RCxDQUFsQiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyIG87XHJcbnZhciAkYmFzZUFkID0gcmVxdWlyZShcIi4vQmFzZUFkXCIpO1xyXG52YXIgciA9IHdpbmRvdy5xZztcclxudmFyIGEgPSAoZnVuY3Rpb24gKHQpIHtcclxuICAgIGZ1bmN0aW9uIGUoKSB7XHJcbiAgICAgICAgdmFyIGUgPSAobnVsbCAhPT0gdCAmJiB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIHx8IHRoaXM7XHJcbiAgICAgICAgZS5zdHlsZSA9IG51bGw7XHJcbiAgICAgICAgZS5pc09wZW5QcmVMb2FkID0gITE7XHJcbiAgICAgICAgcmV0dXJuIGU7XHJcbiAgICB9XHJcbiAgICBfX2V4dGVuZHMoZSwgdCk7XHJcbiAgICBlLnByb3RvdHlwZS5sb2FkQWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYWRVbml0SWQpIHtcclxuICAgICAgICAgICAgaWYgKHIgJiYgci5jcmVhdGVDdXN0b21BZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLnN0eWxlIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgaWYgKHQuaXNCYW5uZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IHIuZ2V0U3lzdGVtSW5mb1N5bmMoKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IGUud2luZG93SGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvID0gZS53aW5kb3dXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICB0LndpZHRoID0gbztcclxuICAgICAgICAgICAgICAgICAgICB0LnRvcCA9IE1hdGgucm91bmQoaSAtICg1LjUgKiB0LndpZHRoKSAvIDE2IC0gMTApO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0LnRvcCA9IDQwMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuaXNMb2FkZWQgPSAhMDtcclxuICAgICAgICAgICAgICAgIHZhciBuID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGFkVW5pdElkOiB0aGlzLmFkVW5pdElkLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogdC50b3AgfHwgMzAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IHQubGVmdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHQud2lkdGhcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucyA9IHIuY3JlYXRlQ3VzdG9tQWQobik7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hZElucy5vbkxvYWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkSW5zLm9uTG9hZCh0aGlzLm9uTG9hZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hZElucy5vbkhpZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkSW5zLm9uSGlkZSh0aGlzLm9uSGlkZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hZElucy5vbkVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZElucy5vbkVycm9yKHRoaXMub25FcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCLlvZPliY3lubPlj7DkuI3mlK/mjIHliJvlu7pjcmVhdGVDdXN0b21BZFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDdXN0b21BZCBJROS4uuepulwiKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUuc2hvd0N1c3RvbUFkID0gZnVuY3Rpb24gKHQsIGUsIGksIG8pIHtcclxuICAgICAgICB2YXIgbiA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5zaG93Q2FsbGJhY2sgPSBlO1xyXG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IGk7XHJcbiAgICAgICAgdGhpcy5lcnJvckNhbGxiYWNrID0gbztcclxuICAgICAgICB0aGlzLnN0eWxlID0gdDtcclxuICAgICAgICBpZiAodGhpcy5pc0NhblNob3cpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmFkSW5zKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4odGhpcy5hZFVuaXRJZCwgXCI65pyq5Yib5bu677yM5omn6KGM5Yib5bu6XCIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc0F1dG9TaG93ID0gITA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRBZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmhpZGVpbmcgfHwgIXRoaXMuaXNMb2FkZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2Fybih0aGlzLmFkVW5pdElkLCBcIjrmraPlnKjpmpDol4/miJbliqDovb3kuK3vvIznqI3nrYlcIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAodGhpcy5pc0F1dG9TaG93ID0gITApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd2luZyA9ICExO1xyXG4gICAgICAgICAgICB0aGlzLmlzQ29uc3VtZSA9ICEwO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5hZElucy5zaG93KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcyA9IHRoaXMuYWRJbnMuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgcyAmJiBzLnRoZW5cclxuICAgICAgICAgICAgICAgICAgICA/IHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uc2hvd2luZyA9ICEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobi5zaG93Q2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uc2hvd0NhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5zaG93Q2FsbGJhY2sgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihuLmFkVW5pdElkLCBcIjpzaG936ZSZ6K+v77yM6YeN5paw5Yqg6L29XCIsIHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnJlQ3JlYXRlQWQoITApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgOiAoY29uc29sZS53YXJuKHRoaXMuYWRVbml0SWQsIFwiOnNob3fmmL7npLrlpLHotKXvvIzph43mlrDliqDovb1cIiksIHRoaXMucmVDcmVhdGVBZCghMCkpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcih0aGlzLmFkVW5pdElkLCBcIjrmnKrnn6XplJnor69cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4odGhpcy5hZFVuaXRJZCwgXCI65b2T5YmN5bm/5ZGK56aB5q2i5pi+56S6XCIpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5kZXN0cm95QWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdC5wcm90b3R5cGUuZGVzdHJveUFkLmNhbGwodGhpcyk7XHJcbiAgICAgICAgaWYgKHRoaXMuYWRJbnMpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMub2ZmTG9hZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucy5vZmZMb2FkKHRoaXMub25Mb2FkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5hZElucy5vZmZIaWRlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkSW5zLm9mZkhpZGUodGhpcy5vbkhpZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFkSW5zLm9mZkVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkSW5zLm9mZkVycm9yKHRoaXMub25FcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMuZGVzdHJveSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucy5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5hZElucyA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLm9uQWRFcnJvciA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCLljp/nlJ/mqKHmnb9vbkFkRXJyb3JcIiwgdGhpcy5hZFVuaXRJZCwgdCk7XHJcbiAgICAgICAgdGhpcy5zaG93aW5nID0gITE7XHJcbiAgICAgICAgaWYgKHRoaXMuZXJyb3JDYWxsYmFjaykge1xyXG4gICAgICAgICAgICB0aGlzLmVycm9yQ2FsbGJhY2soKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5kZXN0cm95QWQoKTtcclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5vbkFkQ2xvc2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCI6PT09b25BZENsb3NlPT09XCIpO1xyXG4gICAgICAgIHRoaXMuc2hvd2luZyA9ICExO1xyXG4gICAgICAgIGlmICh0aGlzLmNsb3NlQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZUNhbGxiYWNrKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnNldE9wZW5QcmVMb2FkKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVDcmVhdGVBZCghMSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLm9uQWRIaWRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiOj09PW9uQWRIaWRlPT09XCIpO1xyXG4gICAgICAgIHRoaXMuc2hvd2luZyA9ICExO1xyXG4gICAgICAgIHRoaXMuaGlkZWluZyA9ICExO1xyXG4gICAgICAgIGlmICh0aGlzLnNldE9wZW5QcmVMb2FkKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVDcmVhdGVBZCghMSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBlO1xyXG59KSgkYmFzZUFkLkJhc2VBZCk7XHJcbmV4cG9ydHMuZGVmYXVsdCA9IGE7XHJcbiJdfQ==