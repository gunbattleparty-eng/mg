
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/QQRewardedVideo.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '90a20D+ncJHgqCAn/20pU+M', 'QQRewardedVideo');
// game_script/scripts/QQRewardedVideo.js

"use strict";

var o;
exports.QQRewardedVideo = void 0;

var $baseAd = require("./BaseAd");

var r = window.qq;

var a = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.videoEndCallback = null;
    return e;
  }

  __extends(e, t);

  e.prototype.loadAd = function () {
    if (this.adUnitId) {
      var t = {
        adUnitId: this.adUnitId
      };
      this.adIns = r.createRewardedVideoAd(t);

      if (this.adIns.onLoad) {
        this.adIns.onLoad(this.onLoad);
      }

      if (this.adIns.onClose) {
        this.adIns.onClose(this.onClose);
      }

      if (this.adIns.onError) {
        this.adIns.onError(this.onError);
      }

      this.adIns.load();
    } else {
      console.error("激励视频ID为空");
    }
  };

  e.prototype.showRewardedVideo = function (t, e, i) {
    var o = this;
    this.showCallback = t;
    this.closeCallback = e;
    this.videoEndCallback = i;
    this.musicVolume = cc.audioEngine.getMusicVolume();
    this.effectsVolume = cc.audioEngine.getEffectsVolume();

    if (!this.adIns) {
      this.isAutoShow = !0;
      console.warn(this.adUnitId, ":未创建，执行创建");
      this.loadAd();
    }

    if (this.isConsume) {
      this.reCreateAd(!0);
    } else {
      {
        if (!this.isLoaded) {
          this.isAutoShow = !0;
          return void console.warn(this.adUnitId, ":未加载完成，稍等");
        }

        if (this.showing) {
          console.warn(this.adUnitId, "广告正在显示中");
        } else {
          this.showing = !1;

          if (this.adIns.show) {
            this.pause();
            var n = this.adIns.show();
            n && n.then ? n.then(function () {
              o.isConsume = !0;
              o.showing = !0;

              if (o.showCallback) {
                o.showCallback();
              }

              o.showCallback = null;
            })["catch"](function (t) {
              console.warn(o.adUnitId, ":show错误，重新加载", t);
              o.reCreateAd(!0);
            }) : (console.warn(this.adUnitId, ":show显示失败，重新加载"), this.reCreateAd(!0));
          } else {
            this.resume();
            console.error(this.adUnitId, ":未知错误");
          }
        }
      }
    }
  };

  e.prototype.reCreateAd = function (e) {
    t.prototype.reCreateAd.call(this, e);
    this.resume();
  };

  e.prototype.autoShow = function () {
    if (this.isAutoShow) {
      this.isAutoShow = !1;
      this.showRewardedVideo(this.showCallback, this.closeCallback, this.videoEndCallback);
    }
  };

  e.prototype.onAdLoad = function () {
    console.log(this.adUnitId, ":===onAdload===");
    this.isConsume = !1;
    this.isLoaded = !0;
    this.showing = !1;
    this.autoShow();
  };

  e.prototype.onAdError = function (t) {
    console.log("原生模板onAdError", this.adUnitId, t);
    this.showing = !1;
    this.resume();
    this.destroyAd();
  };

  e.prototype.onAdClose = function (t) {
    console.log(this.adUnitId, ":===onAdClose===");
    this.showing = !1;
    t && t.isEnded ? this.videoEndCallback && this.videoEndCallback() : this.closeCallback && this.closeCallback();
    this.isOpenPreLoad ? this.adIns.load() : this.destroyAd();
    this.resume();
  };

  e.prototype.destroyAd = function () {
    t.prototype.destroyAd.call(this);
    this.videoEndCallback = null;

    if (this.adIns) {
      if (this.adIns.offLoad) {
        this.adIns.offLoad(this.onLoad);
      }

      if (this.adIns.offClose) {
        this.adIns.offClose(this.onClose);
      }

      if (this.adIns.offError) {
        this.adIns.offError(this.onError);
      }

      if (this.adIns.destroy) {
        this.adIns.destroy();
      }

      this.adIns = null;
    }
  };

  return e;
}($baseAd.BaseAd);

exports.QQRewardedVideo = a;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXFFRUmV3YXJkZWRWaWRlby5qcyJdLCJuYW1lcyI6WyJvIiwiZXhwb3J0cyIsIlFRUmV3YXJkZWRWaWRlbyIsIiRiYXNlQWQiLCJyZXF1aXJlIiwiciIsIndpbmRvdyIsInFxIiwiYSIsInQiLCJlIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJ2aWRlb0VuZENhbGxiYWNrIiwiX19leHRlbmRzIiwicHJvdG90eXBlIiwibG9hZEFkIiwiYWRVbml0SWQiLCJhZElucyIsImNyZWF0ZVJld2FyZGVkVmlkZW9BZCIsIm9uTG9hZCIsIm9uQ2xvc2UiLCJvbkVycm9yIiwibG9hZCIsImNvbnNvbGUiLCJlcnJvciIsInNob3dSZXdhcmRlZFZpZGVvIiwiaSIsInNob3dDYWxsYmFjayIsImNsb3NlQ2FsbGJhY2siLCJtdXNpY1ZvbHVtZSIsImNjIiwiYXVkaW9FbmdpbmUiLCJnZXRNdXNpY1ZvbHVtZSIsImVmZmVjdHNWb2x1bWUiLCJnZXRFZmZlY3RzVm9sdW1lIiwiaXNBdXRvU2hvdyIsIndhcm4iLCJpc0NvbnN1bWUiLCJyZUNyZWF0ZUFkIiwiaXNMb2FkZWQiLCJzaG93aW5nIiwic2hvdyIsInBhdXNlIiwibiIsInRoZW4iLCJyZXN1bWUiLCJjYWxsIiwiYXV0b1Nob3ciLCJvbkFkTG9hZCIsImxvZyIsIm9uQWRFcnJvciIsImRlc3Ryb3lBZCIsIm9uQWRDbG9zZSIsImlzRW5kZWQiLCJpc09wZW5QcmVMb2FkIiwib2ZmTG9hZCIsIm9mZkNsb3NlIiwib2ZmRXJyb3IiLCJkZXN0cm95IiwiQmFzZUFkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLENBQUo7QUFDQUMsT0FBTyxDQUFDQyxlQUFSLEdBQTBCLEtBQUssQ0FBL0I7O0FBQ0EsSUFBSUMsT0FBTyxHQUFHQyxPQUFPLENBQUMsVUFBRCxDQUFyQjs7QUFDQSxJQUFJQyxDQUFDLEdBQUdDLE1BQU0sQ0FBQ0MsRUFBZjs7QUFDQSxJ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SUFBeEI7O0lBQ0EsSUFBSSxLQUFLSyxLQUFULEVBQWdCO01BQ1osSUFBSSxLQUFLQSxLQUFMLENBQVdzQyxPQUFmLEVBQXdCO1FBQ3BCLEtBQUt0QyxLQUFMLENBQVdzQyxPQUFYLENBQW1CLEtBQUtwQyxNQUF4QjtNQUNIOztNQUNELElBQUksS0FBS0YsS0FBTCxDQUFXdUMsUUFBZixFQUF5QjtRQUNyQixLQUFLdkMsS0FBTCxDQUFXdUMsUUFBWCxDQUFvQixLQUFLcEMsT0FBekI7TUFDSDs7TUFDRCxJQUFJLEtBQUtILEtBQUwsQ0FBV3dDLFFBQWYsRUFBeUI7UUFDckIsS0FBS3hDLEtBQUwsQ0FBV3dDLFFBQVgsQ0FBb0IsS0FBS3BDLE9BQXpCO01BQ0g7O01BQ0QsSUFBSSxLQUFLSixLQUFMLENBQVd5QyxPQUFmLEVBQXdCO1FBQ3BCLEtBQUt6QyxLQUFMLENBQVd5QyxPQUFYO01BQ0g7O01BQ0QsS0FBS3pDLEtBQUwsR0FBYSxJQUFiO0lBQ0g7RUFDSixDQWxCRDs7RUFtQkEsT0FBT1IsQ0FBUDtBQUNILENBL0hPLENBK0hMUCxPQUFPLENBQUN5RCxNQS9ISCxDQUFSOztBQWdJQTNELE9BQU8sQ0FBQ0MsZUFBUixHQUEwQk0sQ0FBMUIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBvO1xyXG5leHBvcnRzLlFRUmV3YXJkZWRWaWRlbyA9IHZvaWQgMDtcclxudmFyICRiYXNlQWQgPSByZXF1aXJlKFwiLi9CYXNlQWRcIik7XHJcbnZhciByID0gd2luZG93LnFxO1xyXG52YXIgYSA9IChmdW5jdGlvbiAodCkge1xyXG4gICAgZnVuY3Rpb24gZSgpIHtcclxuICAgICAgICB2YXIgZSA9IChudWxsICE9PSB0ICYmIHQuYXBwbHkodGhpcywgYXJndW1lbnRzKSkgfHwgdGhpcztcclxuICAgICAgICBlLnZpZGVvRW5kQ2FsbGJhY2sgPSBudWxsO1xyXG4gICAgICAgIHJldHVybiBlO1xyXG4gICAgfVxyXG4gICAgX19leHRlbmRzKGUsIHQpO1xyXG4gICAgZS5wcm90b3R5cGUubG9hZEFkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmFkVW5pdElkKSB7XHJcbiAgICAgICAgICAgIHZhciB0ID0ge1xyXG4gICAgICAgICAgICAgICAgYWRVbml0SWQ6IHRoaXMuYWRVbml0SWRcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5hZElucyA9IHIuY3JlYXRlUmV3YXJkZWRWaWRlb0FkKHQpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5hZElucy5vbkxvYWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMub25Mb2FkKHRoaXMub25Mb2FkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5hZElucy5vbkNsb3NlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkSW5zLm9uQ2xvc2UodGhpcy5vbkNsb3NlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5hZElucy5vbkVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkSW5zLm9uRXJyb3IodGhpcy5vbkVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmFkSW5zLmxvYWQoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwi5r+A5Yqx6KeG6aKRSUTkuLrnqbpcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnNob3dSZXdhcmRlZFZpZGVvID0gZnVuY3Rpb24gKHQsIGUsIGkpIHtcclxuICAgICAgICB2YXIgbyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5zaG93Q2FsbGJhY2sgPSB0O1xyXG4gICAgICAgIHRoaXMuY2xvc2VDYWxsYmFjayA9IGU7XHJcbiAgICAgICAgdGhpcy52aWRlb0VuZENhbGxiYWNrID0gaTtcclxuICAgICAgICB0aGlzLm11c2ljVm9sdW1lID0gY2MuYXVkaW9FbmdpbmUuZ2V0TXVzaWNWb2x1bWUoKTtcclxuICAgICAgICB0aGlzLmVmZmVjdHNWb2x1bWUgPSBjYy5hdWRpb0VuZ2luZS5nZXRFZmZlY3RzVm9sdW1lKCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLmFkSW5zKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNBdXRvU2hvdyA9ICEwO1xyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4odGhpcy5hZFVuaXRJZCwgXCI65pyq5Yib5bu677yM5omn6KGM5Yib5bu6XCIpO1xyXG4gICAgICAgICAgICB0aGlzLmxvYWRBZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5pc0NvbnN1bWUpIHtcclxuICAgICAgICAgICAgdGhpcy5yZUNyZWF0ZUFkKCEwKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNMb2FkZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQXV0b1Nob3cgPSAhMDtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCBjb25zb2xlLndhcm4odGhpcy5hZFVuaXRJZCwgXCI65pyq5Yqg6L295a6M5oiQ77yM56iN562JXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2hvd2luZykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2Fybih0aGlzLmFkVW5pdElkLCBcIuW5v+WRiuato+WcqOaYvuekuuS4rVwiKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93aW5nID0gITE7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMuc2hvdykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhdXNlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gdGhpcy5hZElucy5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG4gJiYgbi50aGVuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLmlzQ29uc3VtZSA9ICEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uc2hvd2luZyA9ICEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvLnNob3dDYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLnNob3dDYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLnNob3dDYWxsYmFjayA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKG8uYWRVbml0SWQsIFwiOnNob3fplJnor6/vvIzph43mlrDliqDovb1cIiwgdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5yZUNyZWF0ZUFkKCEwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IChjb25zb2xlLndhcm4odGhpcy5hZFVuaXRJZCwgXCI6c2hvd+aYvuekuuWksei0pe+8jOmHjeaWsOWKoOi9vVwiKSwgdGhpcy5yZUNyZWF0ZUFkKCEwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN1bWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcih0aGlzLmFkVW5pdElkLCBcIjrmnKrnn6XplJnor69cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnJlQ3JlYXRlQWQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIHQucHJvdG90eXBlLnJlQ3JlYXRlQWQuY2FsbCh0aGlzLCBlKTtcclxuICAgICAgICB0aGlzLnJlc3VtZSgpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLmF1dG9TaG93ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQXV0b1Nob3cpIHtcclxuICAgICAgICAgICAgdGhpcy5pc0F1dG9TaG93ID0gITE7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1Jld2FyZGVkVmlkZW8odGhpcy5zaG93Q2FsbGJhY2ssIHRoaXMuY2xvc2VDYWxsYmFjaywgdGhpcy52aWRlb0VuZENhbGxiYWNrKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUub25BZExvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5hZFVuaXRJZCwgXCI6PT09b25BZGxvYWQ9PT1cIik7XHJcbiAgICAgICAgdGhpcy5pc0NvbnN1bWUgPSAhMTtcclxuICAgICAgICB0aGlzLmlzTG9hZGVkID0gITA7XHJcbiAgICAgICAgdGhpcy5zaG93aW5nID0gITE7XHJcbiAgICAgICAgdGhpcy5hdXRvU2hvdygpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLm9uQWRFcnJvciA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCLljp/nlJ/mqKHmnb9vbkFkRXJyb3JcIiwgdGhpcy5hZFVuaXRJZCwgdCk7XHJcbiAgICAgICAgdGhpcy5zaG93aW5nID0gITE7XHJcbiAgICAgICAgdGhpcy5yZXN1bWUoKTtcclxuICAgICAgICB0aGlzLmRlc3Ryb3lBZCgpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLm9uQWRDbG9zZSA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5hZFVuaXRJZCwgXCI6PT09b25BZENsb3NlPT09XCIpO1xyXG4gICAgICAgIHRoaXMuc2hvd2luZyA9ICExO1xyXG4gICAgICAgIHQgJiYgdC5pc0VuZGVkID8gdGhpcy52aWRlb0VuZENhbGxiYWNrICYmIHRoaXMudmlkZW9FbmRDYWxsYmFjaygpIDogdGhpcy5jbG9zZUNhbGxiYWNrICYmIHRoaXMuY2xvc2VDYWxsYmFjaygpO1xyXG4gICAgICAgIHRoaXMuaXNPcGVuUHJlTG9hZCA/IHRoaXMuYWRJbnMubG9hZCgpIDogdGhpcy5kZXN0cm95QWQoKTtcclxuICAgICAgICB0aGlzLnJlc3VtZSgpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLmRlc3Ryb3lBZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0LnByb3RvdHlwZS5kZXN0cm95QWQuY2FsbCh0aGlzKTtcclxuICAgICAgICB0aGlzLnZpZGVvRW5kQ2FsbGJhY2sgPSBudWxsO1xyXG4gICAgICAgIGlmICh0aGlzLmFkSW5zKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFkSW5zLm9mZkxvYWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMub2ZmTG9hZCh0aGlzLm9uTG9hZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuYWRJbnMub2ZmQ2xvc2UpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMub2ZmQ2xvc2UodGhpcy5vbkNsb3NlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5hZElucy5vZmZFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZElucy5vZmZFcnJvcih0aGlzLm9uRXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFkSW5zLmRlc3Ryb3kpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRJbnMuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuYWRJbnMgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gZTtcclxufSkoJGJhc2VBZC5CYXNlQWQpO1xyXG5leHBvcnRzLlFRUmV3YXJkZWRWaWRlbyA9IGE7XHJcbiJdfQ==