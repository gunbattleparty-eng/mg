
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/Bullet_31.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '6d4e9TB7ehD+rd69DQegrdx', 'Bullet_31');
// game_script/scripts/Bullet_31.js

"use strict";

var o;

var $object = require("./Object");

var $assetsLoader = require("./AssetsLoader");

var $assetsMap = require("./AssetsMap");

var $resUtil = require("./ResUtil");

var $countDownUtil = require("./CountDownUtil");

var $gamePool = require("./GamePool");

var $util = require("./Util");

var $gameContext = require("./GameContext");

var $gameSkillInfo = require("./GameSkillInfo");

var $enemyStatus = require("./EnemyStatus");

var $baseBullet = require("./BaseBullet");

var g = cc._decorator;
var _ = g.ccclass;
var k = g.property;
var v = cc.Vec3.ZERO;
var b = cc.Size.ZERO;

var w = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.buttleType = $baseBullet.BulletType.thunder_chain;
    e.animPrefab = null;
    e.currAtkEnemyCount = 0;
    e.currTargetPos = null;
    e.currTarget = null;
    e.targetIsExist = !0;
    e.tailNodeArrs = [];
    e.bounceCount = 0;
    e.attackEnemy = new Map();
    return e;
  }

  __extends(e, t);

  e.prototype.initButtle = function (e, i) {
    t.prototype.initButtle.call(this, e, i);
    this.atk = this.skillParam.skillAtk[$gameSkillInfo.Skill4Param.FINAL];
    this.speed = this.skillParam.speed;
    this.bounceCount = this.skillParam.count;
    b.height = 52;

    if (this.skillParam.adsorbSize > 0) {
      var o = this.skillParam.adsorbSize;
      this.setScale(cc.v3(o, o));
      this.node.children[0].scale = 1 / o;
    }
  };

  e.prototype.initBullet31 = function (t, e) {
    this.skillId = e;
    this.isUse = !1;
    this.currAtkEnemyCount = 0;
    this.targetIsExist = !0;
    this.currTarget = t;
    this.currTargetPos = t.getPosition();
    this.tailNodeArrs.length = 0;
  };

  e.prototype.onTrigger = function (t, e) {
    if (!(this.skillParam.adsorb <= 0)) {
      var i = t.object;

      if (e == $object.Trigger.enter) {
        var o = this.getPosition().sub(i.node.position);
        i.addAdsorb(o);
        this.attackEnemy.set(i, o);
      } else {
        if (e == $object.Trigger.stay) {
          if ($countDownUtil.CountDownUtil.time - i.getLastAtkTime(4) <= 0.1 / $gameContext["default"].ins.gameRatio) {
            return;
          }

          i.setLastAtkTime(4, $countDownUtil.CountDownUtil.time);

          if (this.attackEnemy.has(i)) {
            v.x = this.getPosition().x - i.getPosition().x;
            v.y = this.getPosition().y - i.getPosition().y;
            v.magSqr() <= 900 ? (this.attackEnemy.get(i).x = 0, this.attackEnemy.get(i).y = 0) : (v.normalizeSelf().mulSelf(this.skillParam.adsorb), this.attackEnemy.get(i).x = v.x, this.attackEnemy.get(i).y = v.y);
          }
        } else {
          if (e == $object.Trigger.exit && this.attackEnemy.has(i)) {
            i.removeAdsorb(this.attackEnemy.get(i));
            this.attackEnemy["delete"](i);
          }
        }
      }
    }
  };

  e.prototype.updateFrame = function (t) {
    if (!this.isUse) {
      if (this.targetIsExist) {
        if (!(cc.isValid(this.currTarget) && this.currTarget.node.parent)) {
          this.targetIsExist = !1;
          this.currTargetPos = this.node.position.clone();
        }
      }

      var e = this.getPosition();
      var i = this.velocity;
      v.x = e.x + i.x * t;
      v.y = e.y + i.y * t;
      v.z = e.z + i.z * t;
      this.setPosition(v);

      if (this.node.position.sub(this.currTargetPos).magSqr() < 400) {
        var o = null;
        this.targetIsExist ? (this.attack(), o = $gameContext["default"].ins.getRangeRandomEnemyLayer(this.currTarget.node)) : o = $gameContext["default"].ins.getRangeRandomEnemyLayerByPos(this.currTargetPos);
        this.currAtkEnemyCount++;

        if (!o || this.currAtkEnemyCount >= this.bounceCount) {
          return void this.destoryBullet();
        }

        this.targetIsExist = !0;
        this.currTarget = o;
        this.currTargetPos = o.getPosition();
      }

      if (this.tailNodeArrs.length < this.currAtkEnemyCount + 1) {
        var n = $gamePool["default"].instance.get($gamePool.PoolKey.THUNDER_CHAIN_ANIMS);

        if (!cc.isValid(n)) {
          n = cc.instantiate(this.animPrefab);
        }

        n.parent = $gameContext["default"].ins.lowBulletLayer;
        n.position = this.getPosition().clone();
        b.width = 0;
        n.setContentSize(b);
        this.tailNodeArrs[this.currAtkEnemyCount] = n;
      }

      var s = this.tailNodeArrs[this.currAtkEnemyCount];
      var r = $util["default"].dirConverAngle(this.node.position.sub(s.position).normalize());
      s.angle = r;
      b.width = s.width + this.speed * t;
      s.setContentSize(b);
      var a = this.currTargetPos.sub(this.node.position).normalize();
      this.velocity.set(a).mulSelf(this.speed);
    }
  };

  e.prototype.attack = function () {
    this.currTarget.sufferAtk({
      id: 61,
      skillSpecialitys: this.skillSpecialitys,
      atk: this.atk
    }) ? this.skillParam.killCount > 0 && (this.bounceCount += this.skillParam.killCount) : (this.skillParam.hitStun.length > 0 && this.currTarget.hasDebuff($enemyStatus.EnemyDebuffType.STUN) && this.currTarget.sufferDebuff({
      type: $enemyStatus.EnemyDebuffType.ALL_ATK_ADD,
      timeLeft: this.skillParam.hitStun[0],
      value: this.skillParam.hitStun[1]
    }), this.skillParam.paralysisTime > 0 && this.currTarget.sufferDebuff({
      type: $enemyStatus.EnemyDebuffType.PARALYSIS,
      timeLeft: this.skillParam.paralysisTime,
      value: 0
    }), this.skillParam.bombRange > 0 && this.createBoom());
  };

  e.prototype.createBoom = function () {
    var t = $gameContext["default"].ins.getButtlePool($baseBullet.BulletType.thunder_chain_bomb);

    if (!t) {
      var e = $assetsLoader["default"].instance.getRes($assetsMap.BundleNames.Game, $assetsMap.AssetsMap.GameBundles.prefabs.assetsList.Bullet_32);
      t = $resUtil.ResUtil.instantiate(e, $gameContext["default"].ins.lowBulletLayer.parent).getComponent($baseBullet["default"]);
    }

    t.setPosition(this.currTarget.getPosition());
    t.initButtle(null, this.skillId);
    t.insert($gameContext["default"].ins.lowBulletLayer);
  };

  e.prototype.destoryBullet = function () {
    var t = this;
    this.isUse = !0;
    this.scheduleOnce(function () {
      for (var e = 0; e < t.tailNodeArrs.length; e++) {
        $gamePool["default"].instance.put($gamePool.PoolKey.THUNDER_CHAIN_ANIMS, t.tailNodeArrs[e]);
      }

      t.removeSelf();
    }, 0.15);
  };

  __decorate([k(cc.Prefab)], e.prototype, "animPrefab", void 0);

  return __decorate([_], e);
}($baseBullet["default"]);

exports["default"] = w;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXEJ1bGxldF8zMS5qcyJdLCJuYW1lcyI6WyJvIiwiJG9iamVjdCIsInJlcXVpcmUiLCIkYXNzZXRzTG9hZGVyIiwiJGFzc2V0c01hcCIsIiRyZXNVdGlsIiwiJGNvdW50RG93blV0aWwiLCIkZ2FtZVBvb2wiLCIkdXRpbCIsIiRnYW1lQ29udGV4dCIsIiRnYW1lU2tpbGxJbmZvIiwiJGVuZW15U3RhdHVzIiwiJGJhc2VCdWxsZXQiLCJnIiwiY2MiLCJfZGVjb3JhdG9yIiwiXyIsImNjY2xhc3MiLCJrIiwicHJvcGVydHkiLCJ2IiwiVmVjMyIsIlpFUk8iLCJiIiwiU2l6ZSIsInciLCJ0IiwiZSIsImFwcGx5IiwiYXJndW1lbnRzIiwiYnV0dGxlVHlwZSIsIkJ1bGxldFR5cGUiLCJ0aHVuZGVyX2NoYWluIiwiYW5pbVByZWZhYiIsImN1cnJBdGtFbmVteUNvdW50IiwiY3VyclRhcmdldFBvcyIsImN1cnJUYXJnZXQiLCJ0YXJnZXRJc0V4aXN0IiwidGFpbE5vZGVBcnJzIiwiYm91bmNlQ291bnQiLCJhdHRhY2tFbmVteSIsIk1hcCIsIl9fZXh0ZW5kcyIsInByb3RvdHlwZSIsImluaXRCdXR0bGUiLCJpIiwiY2FsbCIsImF0ayIsInNraWxsUGFyYW0iLCJza2lsbEF0ayIsIlNraWxsNFBhcmFtIiwiRklOQUwiLCJzcGVlZCIsImNvdW50IiwiaGVpZ2h0IiwiYWRzb3JiU2l6ZSIsInNldFNjYWxlIiwidjMiLCJub2RlIiwiY2hpbGRyZW4iLCJzY2FsZSIsImluaXRCdWxsZXQzMSIsInNraWxsSWQiLCJpc1VzZSIsImdldFBvc2l0aW9uIiwibGVuZ3RoIiwib25UcmlnZ2VyIiwiYWRzb3JiIiwib2JqZWN0IiwiVHJpZ2dlciIsImVudGVyIiwic3ViIiwicG9zaXRpb24iLCJhZGRBZHNvcmIiLCJzZXQiLCJzdGF5IiwiQ291bnREb3duVXRpbCIsInRpbWUiLCJnZXRMYXN0QXRrVGltZSIsImlucyIsImdhbWVSYXRpbyIsInNldExhc3RBdGtUaW1lIiwiaGFzIiwieCIsInkiLCJtYWdTcXIiLCJnZXQiLCJub3JtYWxpemVTZWxmIiwibXVsU2VsZiIsImV4aXQiLCJyZW1vdmVBZHNvcmIiLCJ1cGRhdGVGcmFtZSIsImlzVmFsaWQiLCJwYXJlbnQiLCJjbG9uZSIsInZlbG9jaXR5IiwieiIsInNldFBvc2l0aW9uIiwiYXR0YWNrIiwiZ2V0UmFuZ2VSYW5kb21FbmVteUxheWVyIiwiZ2V0UmFuZ2VSYW5kb21FbmVteUxheWVyQnlQb3MiLCJkZXN0b3J5QnVsbGV0IiwibiIsImluc3RhbmNlIiwiUG9vbEtleSIsIlRIVU5ERVJfQ0hBSU5fQU5JTVMiLCJpbnN0YW50aWF0ZSIsImxvd0J1bGxldExheWVyIiwid2lkdGgiLCJzZXRDb250ZW50U2l6ZSIsInMiLCJyIiwiZGlyQ29udmVyQW5nbGUiLCJub3JtYWxpemUiLCJhbmdsZSIsImEiLCJzdWZmZXJBdGsiLCJpZCIsInNraWxsU3BlY2lhbGl0eXMiLCJraWxsQ291bnQiLCJoaXRTdHVuIiwiaGFzRGVidWZmIiwiRW5lbXlEZWJ1ZmZUeXBlIiwiU1RVTiIsInN1ZmZlckRlYnVmZiIsInR5cGUiLCJBTExfQVRLX0FERCIsInRpbWVMZWZ0IiwidmFsdWUiLCJwYXJhbHlzaXNUaW1lIiwiUEFSQUxZU0lTIiwiYm9tYlJhbmdlIiwiY3JlYXRlQm9vbSIsImdldEJ1dHRsZVBvb2wiLCJ0aHVuZGVyX2NoYWluX2JvbWIiLCJnZXRSZXMiLCJCdW5kbGVOYW1lcyIsIkdhbWUiLCJBc3NldHNNYXAiLCJHYW1lQnVuZGxlcyIsInByZWZhYnMiLCJhc3NldHNMaXN0IiwiQnVsbGV0XzMyIiwiUmVzVXRpbCIsImdldENvbXBvbmVudCIsImluc2VydCIsInNjaGVkdWxlT25jZSIsInB1dCIsInJlbW92ZVNlbGYiLCJfX2RlY29yYXRlIiwiUHJlZmFiIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxDQUFKOztBQUNBLElBQUlDLE9BQU8s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QmdHLFFBQWxCLENBQTJCNEMsR0FBM0IsQ0FBK0I1SSxTQUFTLENBQUNpRyxPQUFWLENBQWtCQyxtQkFBakQsRUFBc0UvRSxDQUFDLENBQUNZLFlBQUYsQ0FBZVgsQ0FBZixDQUF0RTtNQUNIOztNQUNERCxDQUFDLENBQUMwSCxVQUFGO0lBQ0gsQ0FMRCxFQUtHLElBTEg7RUFNSCxDQVREOztFQVVBQyxVQUFVLENBQUMsQ0FBQ25JLENBQUMsQ0FBQ0osRUFBRSxDQUFDd0ksTUFBSixDQUFGLENBQUQsRUFBaUIzSCxDQUFDLENBQUNnQixTQUFuQixFQUE4QixZQUE5QixFQUE0QyxLQUFLLENBQWpELENBQVY7O0VBQ0EsT0FBTzBHLFVBQVUsQ0FBQyxDQUFDckksQ0FBRCxDQUFELEVBQU1XLENBQU4sQ0FBakI7QUFDSCxDQXRLTyxDQXNLTGYsV0FBVyxXQXRLTixDQUFSOztBQXVLQTJJLE9BQU8sV0FBUCxHQUFrQjlILENBQWxCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbztcclxudmFyICRvYmplY3QgPSByZXF1aXJlKFwiLi9PYmplY3RcIik7XHJcbnZhciAkYXNzZXRzTG9hZGVyID0gcmVxdWlyZShcIi4vQXNzZXRzTG9hZGVyXCIpO1xyXG52YXIgJGFzc2V0c01hcCA9IHJlcXVpcmUoXCIuL0Fzc2V0c01hcFwiKTtcclxudmFyICRyZXNVdGlsID0gcmVxdWlyZShcIi4vUmVzVXRpbFwiKTtcclxudmFyICRjb3VudERvd25VdGlsID0gcmVxdWlyZShcIi4vQ291bnREb3duVXRpbFwiKTtcclxudmFyICRnYW1lUG9vbCA9IHJlcXVpcmUoXCIuL0dhbWVQb29sXCIpO1xyXG52YXIgJHV0aWwgPSByZXF1aXJlKFwiLi9VdGlsXCIpO1xyXG52YXIgJGdhbWVDb250ZXh0ID0gcmVxdWlyZShcIi4vR2FtZUNvbnRleHRcIik7XHJcbnZhciAkZ2FtZVNraWxsSW5mbyA9IHJlcXVpcmUoXCIuL0dhbWVTa2lsbEluZm9cIik7XHJcbnZhciAkZW5lbXlTdGF0dXMgPSByZXF1aXJlKFwiLi9FbmVteVN0YXR1c1wiKTtcclxudmFyICRiYXNlQnVsbGV0ID0gcmVxdWlyZShcIi4vQmFzZUJ1bGxldFwiKTtcclxudmFyIGcgPSBjYy5fZGVjb3JhdG9yO1xyXG52YXIgXyA9IGcuY2NjbGFzcztcclxudmFyIGsgPSBnLnByb3BlcnR5O1xyXG52YXIgdiA9IGNjLlZlYzMuWkVSTztcclxudmFyIGIgPSBjYy5TaXplLlpFUk87XHJcbnZhciB3ID0gKGZ1bmN0aW9uICh0KSB7XHJcbiAgICBmdW5jdGlvbiBlKCkge1xyXG4gICAgICAgIHZhciBlID0gKG51bGwgIT09IHQgJiYgdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSB8fCB0aGlzO1xyXG4gICAgICAgIGUuYnV0dGxlVHlwZSA9ICRiYXNlQnVsbGV0LkJ1bGxldFR5cGUudGh1bmRlcl9jaGFpbjtcclxuICAgICAgICBlLmFuaW1QcmVmYWIgPSBudWxsO1xyXG4gICAgICAgIGUuY3VyckF0a0VuZW15Q291bnQgPSAwO1xyXG4gICAgICAgIGUuY3VyclRhcmdldFBvcyA9IG51bGw7XHJcbiAgICAgICAgZS5jdXJyVGFyZ2V0ID0gbnVsbDtcclxuICAgICAgICBlLnRhcmdldElzRXhpc3QgPSAhMDtcclxuICAgICAgICBlLnRhaWxOb2RlQXJycyA9IFtdO1xyXG4gICAgICAgIGUuYm91bmNlQ291bnQgPSAwO1xyXG4gICAgICAgIGUuYXR0YWNrRW5lbXkgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgcmV0dXJuIGU7XHJcbiAgICB9XHJcbiAgICBfX2V4dGVuZHMoZSwgdCk7XHJcbiAgICBlLnByb3RvdHlwZS5pbml0QnV0dGxlID0gZnVuY3Rpb24gKGUsIGkpIHtcclxuICAgICAgICB0LnByb3RvdHlwZS5pbml0QnV0dGxlLmNhbGwodGhpcywgZSwgaSk7XHJcbiAgICAgICAgdGhpcy5hdGsgPSB0aGlzLnNraWxsUGFyYW0uc2tpbGxBdGtbJGdhbWVTa2lsbEluZm8uU2tpbGw0UGFyYW0uRklOQUxdO1xyXG4gICAgICAgIHRoaXMuc3BlZWQgPSB0aGlzLnNraWxsUGFyYW0uc3BlZWQ7XHJcbiAgICAgICAgdGhpcy5ib3VuY2VDb3VudCA9IHRoaXMuc2tpbGxQYXJhbS5jb3VudDtcclxuICAgICAgICBiLmhlaWdodCA9IDUyO1xyXG4gICAgICAgIGlmICh0aGlzLnNraWxsUGFyYW0uYWRzb3JiU2l6ZSA+IDApIHtcclxuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLnNraWxsUGFyYW0uYWRzb3JiU2l6ZTtcclxuICAgICAgICAgICAgdGhpcy5zZXRTY2FsZShjYy52MyhvLCBvKSk7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5jaGlsZHJlblswXS5zY2FsZSA9IDEgLyBvO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5pbml0QnVsbGV0MzEgPSBmdW5jdGlvbiAodCwgZSkge1xyXG4gICAgICAgIHRoaXMuc2tpbGxJZCA9IGU7XHJcbiAgICAgICAgdGhpcy5pc1VzZSA9ICExO1xyXG4gICAgICAgIHRoaXMuY3VyckF0a0VuZW15Q291bnQgPSAwO1xyXG4gICAgICAgIHRoaXMudGFyZ2V0SXNFeGlzdCA9ICEwO1xyXG4gICAgICAgIHRoaXMuY3VyclRhcmdldCA9IHQ7XHJcbiAgICAgICAgdGhpcy5jdXJyVGFyZ2V0UG9zID0gdC5nZXRQb3NpdGlvbigpO1xyXG4gICAgICAgIHRoaXMudGFpbE5vZGVBcnJzLmxlbmd0aCA9IDA7XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUub25UcmlnZ2VyID0gZnVuY3Rpb24gKHQsIGUpIHtcclxuICAgICAgICBpZiAoISh0aGlzLnNraWxsUGFyYW0uYWRzb3JiIDw9IDApKSB7XHJcbiAgICAgICAgICAgIHZhciBpID0gdC5vYmplY3Q7XHJcbiAgICAgICAgICAgIGlmIChlID09ICRvYmplY3QuVHJpZ2dlci5lbnRlcikge1xyXG4gICAgICAgICAgICAgICAgdmFyIG8gPSB0aGlzLmdldFBvc2l0aW9uKCkuc3ViKGkubm9kZS5wb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICBpLmFkZEFkc29yYihvKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrRW5lbXkuc2V0KGksIG8pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUgPT0gJG9iamVjdC5UcmlnZ2VyLnN0YXkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb3VudERvd25VdGlsLkNvdW50RG93blV0aWwudGltZSAtIGkuZ2V0TGFzdEF0a1RpbWUoNCkgPD1cclxuICAgICAgICAgICAgICAgICAgICAgICAgMC4xIC8gJGdhbWVDb250ZXh0LmRlZmF1bHQuaW5zLmdhbWVSYXRpb1xyXG4gICAgICAgICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGkuc2V0TGFzdEF0a1RpbWUoNCwgJGNvdW50RG93blV0aWwuQ291bnREb3duVXRpbC50aW1lKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hdHRhY2tFbmVteS5oYXMoaSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdi54ID0gdGhpcy5nZXRQb3NpdGlvbigpLnggLSBpLmdldFBvc2l0aW9uKCkueDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdi55ID0gdGhpcy5nZXRQb3NpdGlvbigpLnkgLSBpLmdldFBvc2l0aW9uKCkueTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdi5tYWdTcXIoKSA8PSA5MDBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gKCh0aGlzLmF0dGFja0VuZW15LmdldChpKS54ID0gMCksICh0aGlzLmF0dGFja0VuZW15LmdldChpKS55ID0gMCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICh2Lm5vcm1hbGl6ZVNlbGYoKS5tdWxTZWxmKHRoaXMuc2tpbGxQYXJhbS5hZHNvcmIpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5hdHRhY2tFbmVteS5nZXQoaSkueCA9IHYueCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLmF0dGFja0VuZW15LmdldChpKS55ID0gdi55KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZSA9PSAkb2JqZWN0LlRyaWdnZXIuZXhpdCAmJiB0aGlzLmF0dGFja0VuZW15LmhhcyhpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpLnJlbW92ZUFkc29yYih0aGlzLmF0dGFja0VuZW15LmdldChpKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrRW5lbXkuZGVsZXRlKGkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS51cGRhdGVGcmFtZSA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzVXNlKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnRhcmdldElzRXhpc3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICghKGNjLmlzVmFsaWQodGhpcy5jdXJyVGFyZ2V0KSAmJiB0aGlzLmN1cnJUYXJnZXQubm9kZS5wYXJlbnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50YXJnZXRJc0V4aXN0ID0gITE7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyVGFyZ2V0UG9zID0gdGhpcy5ub2RlLnBvc2l0aW9uLmNsb25lKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGUgPSB0aGlzLmdldFBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIHZhciBpID0gdGhpcy52ZWxvY2l0eTtcclxuICAgICAgICAgICAgdi54ID0gZS54ICsgaS54ICogdDtcclxuICAgICAgICAgICAgdi55ID0gZS55ICsgaS55ICogdDtcclxuICAgICAgICAgICAgdi56ID0gZS56ICsgaS56ICogdDtcclxuICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvbih2KTtcclxuICAgICAgICAgICAgaWYgKHRoaXMubm9kZS5wb3NpdGlvbi5zdWIodGhpcy5jdXJyVGFyZ2V0UG9zKS5tYWdTcXIoKSA8IDQwMCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG8gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50YXJnZXRJc0V4aXN0XHJcbiAgICAgICAgICAgICAgICAgICAgPyAodGhpcy5hdHRhY2soKSwgKG8gPSAkZ2FtZUNvbnRleHQuZGVmYXVsdC5pbnMuZ2V0UmFuZ2VSYW5kb21FbmVteUxheWVyKHRoaXMuY3VyclRhcmdldC5ub2RlKSkpXHJcbiAgICAgICAgICAgICAgICAgICAgOiAobyA9ICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5nZXRSYW5nZVJhbmRvbUVuZW15TGF5ZXJCeVBvcyh0aGlzLmN1cnJUYXJnZXRQb3MpKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VyckF0a0VuZW15Q291bnQrKztcclxuICAgICAgICAgICAgICAgIGlmICghbyB8fCB0aGlzLmN1cnJBdGtFbmVteUNvdW50ID49IHRoaXMuYm91bmNlQ291bnQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCB0aGlzLmRlc3RvcnlCdWxsZXQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0SXNFeGlzdCA9ICEwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyVGFyZ2V0ID0gbztcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VyclRhcmdldFBvcyA9IG8uZ2V0UG9zaXRpb24oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy50YWlsTm9kZUFycnMubGVuZ3RoIDwgdGhpcy5jdXJyQXRrRW5lbXlDb3VudCArIDEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBuID0gJGdhbWVQb29sLmRlZmF1bHQuaW5zdGFuY2UuZ2V0KCRnYW1lUG9vbC5Qb29sS2V5LlRIVU5ERVJfQ0hBSU5fQU5JTVMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjYy5pc1ZhbGlkKG4pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbiA9IGNjLmluc3RhbnRpYXRlKHRoaXMuYW5pbVByZWZhYik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBuLnBhcmVudCA9ICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5sb3dCdWxsZXRMYXllcjtcclxuICAgICAgICAgICAgICAgIG4ucG9zaXRpb24gPSB0aGlzLmdldFBvc2l0aW9uKCkuY2xvbmUoKTtcclxuICAgICAgICAgICAgICAgIGIud2lkdGggPSAwO1xyXG4gICAgICAgICAgICAgICAgbi5zZXRDb250ZW50U2l6ZShiKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudGFpbE5vZGVBcnJzW3RoaXMuY3VyckF0a0VuZW15Q291bnRdID0gbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcyA9IHRoaXMudGFpbE5vZGVBcnJzW3RoaXMuY3VyckF0a0VuZW15Q291bnRdO1xyXG4gICAgICAgICAgICB2YXIgciA9ICR1dGlsLmRlZmF1bHQuZGlyQ29udmVyQW5nbGUodGhpcy5ub2RlLnBvc2l0aW9uLnN1YihzLnBvc2l0aW9uKS5ub3JtYWxpemUoKSk7XHJcbiAgICAgICAgICAgIHMuYW5nbGUgPSByO1xyXG4gICAgICAgICAgICBiLndpZHRoID0gcy53aWR0aCArIHRoaXMuc3BlZWQgKiB0O1xyXG4gICAgICAgICAgICBzLnNldENvbnRlbnRTaXplKGIpO1xyXG4gICAgICAgICAgICB2YXIgYSA9IHRoaXMuY3VyclRhcmdldFBvcy5zdWIodGhpcy5ub2RlLnBvc2l0aW9uKS5ub3JtYWxpemUoKTtcclxuICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoYSkubXVsU2VsZih0aGlzLnNwZWVkKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUuYXR0YWNrID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuY3VyclRhcmdldC5zdWZmZXJBdGsoe1xyXG4gICAgICAgICAgICBpZDogNjEsXHJcbiAgICAgICAgICAgIHNraWxsU3BlY2lhbGl0eXM6IHRoaXMuc2tpbGxTcGVjaWFsaXR5cyxcclxuICAgICAgICAgICAgYXRrOiB0aGlzLmF0a1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgID8gdGhpcy5za2lsbFBhcmFtLmtpbGxDb3VudCA+IDAgJiYgKHRoaXMuYm91bmNlQ291bnQgKz0gdGhpcy5za2lsbFBhcmFtLmtpbGxDb3VudClcclxuICAgICAgICAgICAgOiAodGhpcy5za2lsbFBhcmFtLmhpdFN0dW4ubGVuZ3RoID4gMCAmJlxyXG4gICAgICAgICAgICAgICAgICB0aGlzLmN1cnJUYXJnZXQuaGFzRGVidWZmKCRlbmVteVN0YXR1cy5FbmVteURlYnVmZlR5cGUuU1RVTikgJiZcclxuICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyVGFyZ2V0LnN1ZmZlckRlYnVmZih7XHJcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAkZW5lbXlTdGF0dXMuRW5lbXlEZWJ1ZmZUeXBlLkFMTF9BVEtfQURELFxyXG4gICAgICAgICAgICAgICAgICAgICAgdGltZUxlZnQ6IHRoaXMuc2tpbGxQYXJhbS5oaXRTdHVuWzBdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuc2tpbGxQYXJhbS5oaXRTdHVuWzFdXHJcbiAgICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgIHRoaXMuc2tpbGxQYXJhbS5wYXJhbHlzaXNUaW1lID4gMCAmJlxyXG4gICAgICAgICAgICAgICAgICB0aGlzLmN1cnJUYXJnZXQuc3VmZmVyRGVidWZmKHtcclxuICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICRlbmVteVN0YXR1cy5FbmVteURlYnVmZlR5cGUuUEFSQUxZU0lTLFxyXG4gICAgICAgICAgICAgICAgICAgICAgdGltZUxlZnQ6IHRoaXMuc2tpbGxQYXJhbS5wYXJhbHlzaXNUaW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IDBcclxuICAgICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgdGhpcy5za2lsbFBhcmFtLmJvbWJSYW5nZSA+IDAgJiYgdGhpcy5jcmVhdGVCb29tKCkpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLmNyZWF0ZUJvb20gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHQgPSAkZ2FtZUNvbnRleHQuZGVmYXVsdC5pbnMuZ2V0QnV0dGxlUG9vbCgkYmFzZUJ1bGxldC5CdWxsZXRUeXBlLnRodW5kZXJfY2hhaW5fYm9tYik7XHJcbiAgICAgICAgaWYgKCF0KSB7XHJcbiAgICAgICAgICAgIHZhciBlID0gJGFzc2V0c0xvYWRlci5kZWZhdWx0Lmluc3RhbmNlLmdldFJlcyhcclxuICAgICAgICAgICAgICAgICRhc3NldHNNYXAuQnVuZGxlTmFtZXMuR2FtZSxcclxuICAgICAgICAgICAgICAgICRhc3NldHNNYXAuQXNzZXRzTWFwLkdhbWVCdW5kbGVzLnByZWZhYnMuYXNzZXRzTGlzdC5CdWxsZXRfMzJcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgdCA9ICRyZXNVdGlsLlJlc1V0aWwuaW5zdGFudGlhdGUoZSwgJGdhbWVDb250ZXh0LmRlZmF1bHQuaW5zLmxvd0J1bGxldExheWVyLnBhcmVudCkuZ2V0Q29tcG9uZW50KFxyXG4gICAgICAgICAgICAgICAgJGJhc2VCdWxsZXQuZGVmYXVsdFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0LnNldFBvc2l0aW9uKHRoaXMuY3VyclRhcmdldC5nZXRQb3NpdGlvbigpKTtcclxuICAgICAgICB0LmluaXRCdXR0bGUobnVsbCwgdGhpcy5za2lsbElkKTtcclxuICAgICAgICB0Lmluc2VydCgkZ2FtZUNvbnRleHQuZGVmYXVsdC5pbnMubG93QnVsbGV0TGF5ZXIpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLmRlc3RvcnlCdWxsZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHQgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuaXNVc2UgPSAhMDtcclxuICAgICAgICB0aGlzLnNjaGVkdWxlT25jZShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgdC50YWlsTm9kZUFycnMubGVuZ3RoOyBlKyspIHtcclxuICAgICAgICAgICAgICAgICRnYW1lUG9vbC5kZWZhdWx0Lmluc3RhbmNlLnB1dCgkZ2FtZVBvb2wuUG9vbEtleS5USFVOREVSX0NIQUlOX0FOSU1TLCB0LnRhaWxOb2RlQXJyc1tlXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdC5yZW1vdmVTZWxmKCk7XHJcbiAgICAgICAgfSwgMC4xNSk7XHJcbiAgICB9O1xyXG4gICAgX19kZWNvcmF0ZShbayhjYy5QcmVmYWIpXSwgZS5wcm90b3R5cGUsIFwiYW5pbVByZWZhYlwiLCB2b2lkIDApO1xyXG4gICAgcmV0dXJuIF9fZGVjb3JhdGUoW19dLCBlKTtcclxufSkoJGJhc2VCdWxsZXQuZGVmYXVsdCk7XHJcbmV4cG9ydHMuZGVmYXVsdCA9IHc7XHJcbiJdfQ==