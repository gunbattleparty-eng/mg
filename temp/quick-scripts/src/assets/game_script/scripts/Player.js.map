{"version":3,"sources":["assets\\game_script\\scripts\\Player.js"],"names":["o","$eventManager","require","$componentProxy","$remoteAudio","$util","$globalParam","$localEventName","$roleContext","$playerSkin","$gameContext","$gameSkillInfo","$gun_1","g","cc","_decorator","_","ccclass","k","property","v","t","e","apply","arguments","skin","skin2","robotSkin","gun","cd","residuCD","isChangeBullet","skilling","angleBack","__extends","prototype","onLoad","node","getComponent","start","Ins","pushObj","on","CHANGE_RELOAD_ANIM","changeReloadAnim","SEND_SKILL_ANIM","playSkillAnim","ins","currSkinInfo","armatureName","robot","PlayerSkin","checkGun","onDestroy","removeObj","off","instance","playEffectMusic","playAnimation","angle","dragonBones","EventObject","COMPLETE","once","updateFrame","updateF","isAttacking","startGun","update","proccessSpeed","isGamePuase","timeScale","gameRatio","skillParam","skillInfo","getSkillById","getRangeRankEnemy","skillAtkRange","Skill4Param","FINAL","i","position","subtract","normalize","sendButtle","dirConverAngle","__decorate","ArmatureDisplay","Component","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var o;\r\nvar $eventManager = require(\"./EventManager\");\r\nvar $componentProxy = require(\"./ComponentProxy\");\r\nvar $remoteAudio = require(\"./RemoteAudio\");\r\nvar $util = require(\"./Util\");\r\nvar $globalParam = require(\"./GlobalParam\");\r\nvar $localEventName = require(\"./LocalEventName\");\r\nvar $roleContext = require(\"./RoleContext\");\r\nvar $playerSkin = require(\"./PlayerSkin\");\r\nvar $gameContext = require(\"./GameContext\");\r\nvar $gameSkillInfo = require(\"./GameSkillInfo\");\r\nvar $gun_1 = require(\"./Gun_1\");\r\nvar g = cc._decorator;\r\nvar _ = g.ccclass;\r\nvar k = g.property;\r\nvar v = (function (t) {\r\n    function e() {\r\n        var e = (null !== t && t.apply(this, arguments)) || this;\r\n        e.skin = null;\r\n        e.skin2 = null;\r\n        e.robotSkin = null;\r\n        e.gun = null;\r\n        e.cd = 0.5;\r\n        e.residuCD = 0;\r\n        e.isChangeBullet = !1;\r\n        e.skilling = !1;\r\n        e.angleBack = 0;\r\n        return e;\r\n    }\r\n    __extends(e, t);\r\n    e.prototype.onLoad = function () {\r\n        this.gun = this.node.getComponent($gun_1.default);\r\n    };\r\n    e.prototype.start = function () {\r\n        $componentProxy.default.Ins.pushObj(this);\r\n        $eventManager.default.on($localEventName.default.CHANGE_RELOAD_ANIM, this.changeReloadAnim, this);\r\n        $eventManager.default.on($localEventName.default.SEND_SKILL_ANIM, this.playSkillAnim, this);\r\n        var t = $roleContext.default.ins.currSkinInfo;\r\n        this.skin.armatureName = \"juese\" + t.skin + \"_1\";\r\n        this.skin2.armatureName = \"juese\" + t.skin + \"_2\";\r\n        this.robotSkin.armatureName = \"jqr\" + t.robot;\r\n        this.node.getComponent($playerSkin.PlayerSkin).checkGun(t.gun);\r\n    };\r\n    e.prototype.onDestroy = function () {\r\n        $componentProxy.default.Ins.removeObj(this);\r\n        $eventManager.default.off($localEventName.default.CHANGE_RELOAD_ANIM, this.changeReloadAnim, this);\r\n        $eventManager.default.off($localEventName.default.SEND_SKILL_ANIM, this.playSkillAnim, this);\r\n    };\r\n    e.prototype.changeReloadAnim = function (t) {\r\n        if (t) {\r\n            this.isChangeBullet = !0;\r\n            $remoteAudio.default.instance.playEffectMusic(\"gunexchange\");\r\n            return void (this.skilling || this.skin.playAnimation(\"huandan\", 0));\r\n        }\r\n        if (!this.skilling) {\r\n            this.skin.playAnimation(\"stand\", 0);\r\n        }\r\n        this.isChangeBullet = !1;\r\n    };\r\n    e.prototype.playSkillAnim = function () {\r\n        var t = this;\r\n        this.skilling = !0;\r\n        this.angleBack = this.node.angle;\r\n        this.node.angle = 90;\r\n        this.skin.off(dragonBones.EventObject.COMPLETE);\r\n        this.skin.playAnimation(\"skill\", 1);\r\n        this.skin.once(dragonBones.EventObject.COMPLETE, function () {\r\n            t.skilling = !1;\r\n            t.isChangeBullet\r\n                ? t.skin.playAnimation(\"huandan\", 0)\r\n                : ((t.node.angle = t.angleBack), t.skin.playAnimation(\"stand\", 0));\r\n        });\r\n    };\r\n    e.prototype.updateFrame = function (t) {\r\n        this.gun.updateF(t);\r\n        if (!this.gun.isAttacking) {\r\n            this.residuCD -= t;\r\n            if (this.residuCD <= 0) {\r\n                this.residuCD = this.cd;\r\n                this.startGun();\r\n            }\r\n        }\r\n    };\r\n    e.prototype.update = function () {\r\n        this.proccessSpeed();\r\n    };\r\n    e.prototype.proccessSpeed = function () {\r\n        $globalParam.default.isGamePuase\r\n            ? 0 !== this.skin.timeScale && (this.skin.timeScale = 0)\r\n            : this.skin.timeScale !== $gameContext.default.ins.gameRatio &&\r\n              (this.skin.timeScale = $gameContext.default.ins.gameRatio);\r\n    };\r\n    e.prototype.startGun = function () {\r\n        var t = this;\r\n        if (!this.isChangeBullet && !this.skilling) {\r\n            if (!this.skillParam) {\r\n                this.skillParam = $gameContext.default.ins.skillInfo.getSkillById(1);\r\n            }\r\n            var e = $gameContext.default.ins.getRangeRankEnemy(\r\n                this.node,\r\n                this.skillParam.skillAtkRange[$gameSkillInfo.Skill4Param.FINAL]\r\n            );\r\n            if (e) {\r\n                $remoteAudio.default.instance.playEffectMusic(\"gun\");\r\n                if (!this.skilling) {\r\n                    this.skin.playAnimation(\"sheji\", 1);\r\n                    this.skin.once(\r\n                        dragonBones.EventObject.COMPLETE,\r\n                        function () {\r\n                            t.skin.playAnimation(\"stand\", 0);\r\n                        },\r\n                        this\r\n                    );\r\n                }\r\n                var i = e.node.position.subtract(this.node.position).normalize();\r\n                this.gun.sendButtle(i);\r\n                var o = $util.default.dirConverAngle(i);\r\n                this.node.angle = o;\r\n            }\r\n        }\r\n    };\r\n    __decorate([k(dragonBones.ArmatureDisplay)], e.prototype, \"skin\", void 0);\r\n    __decorate([k(dragonBones.ArmatureDisplay)], e.prototype, \"skin2\", void 0);\r\n    __decorate([k(dragonBones.ArmatureDisplay)], e.prototype, \"robotSkin\", void 0);\r\n    return __decorate([_], e);\r\n})(cc.Component);\r\nexports.default = v;\r\n"]}