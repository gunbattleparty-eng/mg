
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/RBullet_1.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '9b45cburwdLVKZZyQzguehy', 'RBullet_1');
// game_script/scripts/RBullet_1.js

"use strict";

var o;

var $object = require("./Object");

var $motionTrail = require("./MotionTrail");

var $componentProxy = require("./ComponentProxy");

var $seedUtil = require("./SeedUtil");

var $util = require("./Util");

var $gameContext = require("./GameContext");

var $baseBullet = require("./BaseBullet");

var f = cc._decorator;
var h = f.ccclass;
var m = (f.property, cc.Vec3.ZERO);

var y = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.buttleType = $baseBullet.BulletType.r_bullet_1;
    e.angleSpeed = 100;
    e.randomeAngle = 30;
    e.targetEnemy = null;
    e.targetPos = null;
    e.tail = null;
    return e;
  }

  __extends(e, t);

  e.prototype.initRBullet = function (e, i, o) {
    this.atk = i;
    this.speed = o;
    this.targetPos = e.getPosition().clone();
    this.targetEnemy = e;
    this.targetEnemy.addDieCallback(this.dieEnemy, this);
    var n = this.targetEnemy.getPosition().subtract(this.getPosition()).normalize();
    var s = $util["default"].dirConverAngle(n);
    var r = $seedUtil["default"].randomFrom(this.randomeAngle - 10, this.randomeAngle + 10);
    s += r = $seedUtil["default"].probability(50) ? r : -r;
    n = $util["default"].angleConverDir(s);
    t.prototype.initButtle.call(this, n, null);

    if (n) {
      this.velocity.set(n).multiplyScalar(this.speed);
    }

    if (!this.tail) {
      this.tail = this.node.getComponent($motionTrail["default"]);
    }
  };

  e.prototype.dieEnemy = function (t) {
    if (t === this.targetEnemy) {
      this.targetPos = t.getPosition().clone();
      this.targetEnemy = null;
    }
  };

  e.prototype.onTrigger = function (t, e) {
    if (!this.isUse) {
      if (e == $object.Trigger.enter) {
        t.object.sufferAtk({
          skillSpecialitys: [],
          atk: this.atk
        });
        this.targetEnemy = null;
        this.removeSelf();
      }
    }
  };

  e.prototype.updateFrame = function (t) {
    if (!this.tail.isActive) {
      this.tail.isActive = !0;
    }

    if (this.targetEnemy) {
      if (this.targetEnemy.isDie() || null == this.targetEnemy.node.parent) {
        this.targetEnemy = null;
        m.x = this.targetPos.x;
        m.y = this.targetPos.y;
        return void this.trace(m, t);
      }

      this.targetPos.set(this.targetEnemy.getPosition());
      this.trace(this.targetEnemy.getPosition(), t);
    } else {
      m.x = this.targetPos.x;
      m.y = this.targetPos.y;
      this.trace(m, t);
    }
  };

  e.prototype.trace = function (t, e) {
    var i = this.lerpAngleRes(t.subtract(this.getPosition()), e);
    this.setAngle(i);
    this.velocity.set($util["default"].angleConverDir(i).normalizeSelf()).mulSelf(this.speed);
    this.move(e);
  };

  e.prototype.move = function (t) {
    var e = this.getPosition();
    var i = this.velocity;
    m.x = e.x + i.x * t;
    m.y = e.y + i.y * t;
    m.z = e.z + i.z * t;
    this.setPosition(m);
    return this.checkBoundary() ? !this.targetEnemy && m.subtract(this.targetPos).magSqr() <= 900 ? this.removeSelf() : void 0 : this.removeSelf();
  };

  e.prototype.removeSelf = function (t) {
    if (void 0 === t) {
      t = !0;
    }

    this.tail.isActive = !1;
    $componentProxy["default"].Ins.removeObj(this);

    if (t) {
      $gameContext["default"].ins.putButtlePool(this);
    }
  };

  e.prototype.lerpAngleRes = function (t, e) {
    var i = ($util["default"].dirConverAngle(t) + 360) % 360;
    var o = (this.node.angle + 360) % 360;
    return Math.abs(o - i) <= this.angleSpeed * e ? i : ((o - i + 360) % 360 < (i - o + 360) % 360 ? o -= this.angleSpeed * e : o += this.angleSpeed * e, o);
  };

  return __decorate([h], e);
}($baseBullet["default"]);

exports["default"] = y;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXFJCdWxsZXRfMS5qcyJdLCJuYW1lcyI6WyJvIiwiJG9iamVjdCIsInJlcXVpcmUiLCIkbW90aW9uVHJhaWwiLCIkY29tcG9uZW50UHJveHkiLCIkc2VlZFV0aWwiLCIkdXRpbCIsIiRnYW1lQ29udGV4dCIsIiRiYXNlQnVsbGV0IiwiZiIsImNjIiwiX2RlY29yYXRvciIsImgiLCJjY2NsYXNzIiwibSIsInByb3BlcnR5IiwiVmVjMyIsIlpFUk8iLCJ5IiwidCIsImUiLCJhcHBseSIsImFyZ3VtZW50cyIsImJ1dHRsZVR5cGUiLCJCdWxsZXRUeXBlIiwicl9idWxsZXRfMSIsImFuZ2xlU3BlZWQiLCJyYW5kb21lQW5nbGUiLCJ0YXJnZXRFbmVteSIsInRhcmdldFBvcyIsInRhaWwiLCJfX2V4dGVuZHMiLCJwcm90b3R5cGUiLCJpbml0UkJ1bGxldCIsImkiLCJhdGsiLCJzcGVlZCIsImdldFBvc2l0aW9uIiwiY2xvbmUiLCJhZGREaWVDYWxsYmFjayIsImRpZUVuZW15IiwibiIsInN1YnRyYWN0Iiwibm9ybWFsaXplIiwicyIsImRpckNvbnZlckFuZ2xlIiwiciIsInJhbmRvbUZyb20iLCJwcm9iYWJpbGl0eSIsImFuZ2xlQ29udmVyRGlyIiwiaW5pdEJ1dHRsZSIsImNhbGwiLCJ2ZWxvY2l0eSIsInNldCIsIm11bHRpcGx5U2NhbGFyIiwibm9kZSIsImdldENvbXBvbmVudCIsIm9uVHJpZ2dlciIsImlzVXNlIiwiVHJpZ2dlciIsImVudGVyIiwib2JqZWN0Iiwic3VmZmVyQXRrIiwic2tpbGxTcGVjaWFsaXR5cyIsInJlbW92ZVNlbGYiLCJ1cGRhdGVGcmFtZSIsImlzQWN0aXZlIiwiaXNEaWUiLCJwYXJlbnQiLCJ4IiwidHJhY2UiLCJsZXJwQW5nbGVSZXMiLCJzZXRBbmdsZSIsIm5vcm1hbGl6ZVNlbGYiLCJtdWxTZWxmIiwibW92ZSIsInoiLCJzZXRQb3NpdGlvbiIsImNoZWNrQm91bmRhcnkiLCJtYWdTcXIiLCJJbnMiLCJyZW1vdmVPYmoiLCJpbnMiLCJwdXRCdXR0bGVQb29sIiwiYW5nbGUiLCJNYXRoIiwiYWJzIiwiX19kZWNvcmF0ZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsQ0FBSjs7QUFDQSxJQUFJQyxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxVQUFELENBQXJCOztBQUNBLElBQUlDLFlBQVksR0FBR0QsT0FBTyxDQUFDLGVBQUQsQ0FBMUI7O0FBQ0EsSUFBSUUsZUFBZSxHQUFHRixPQUFPLENBQUMsa0JBQUQsQ0FBN0I7O0FBQ0EsSUFBSUcsU0FBUyxHQUFHSCxPQUFPLENBQUMsWUFBRCxDQUF2Qjs7QUFDQSxJQUFJSSxLQUFLLEdBQUdKLE9BQU8sQ0FBQyxRQUFELENBQW5COztBQUNBLElBQUlLLFlBQVksR0FBR0wsT0FBTyxDQUFDLGVBQUQsQ0FBMUI7O0FBQ0EsSUFBSU0sV0FBVyxHQUFHTixPQUFPLENBQUMsY0FBRCxDQUF6Qjs7QUFDQSxJQUFJTyxDQUFDLEdBQUdDLEVBQUUsQ0FBQ0MsVUFBWDtBQUNBLElBQUlDLENBQUMsR0FBR0gsQ0FBQyxDQUFDSSxPQUFWO0FBQ0EsSUFBSUMsQ0FBQyxJQUFJTCxDQUFDLENBQUNNLFFBQUYsRUFBWUwsRUFBRSxDQUFDTSxJQUFILENBQVFDLElBQXhCLENBQUw7O0FBQ0EsSUFBSUMsQ0FBQyxHQUFJLFVBQVVDLENBQVYsRUFBYTtFQUNsQixTQUFTQyxDQUFULEdBQWE7SUFDVCxJQUFJQSxDQUFDLEdBQUksU0FBU0QsQ0FBVCxJQUFjQSxDQUFDLENBQUNFLEtBQUYsQ0FBUSxJQUFSLEVBQWNDLFNBQWQsQ0FBZixJQUE0QyxJQUFwRDtJQUNBRixDQUFDLENBQUNHLFVBQUYsR0FBZWYsV0FBVyxDQUFDZ0IsVUFBWixDQUF1QkMsVUFBdEM7SUFDQUwsQ0FBQyxDQUFDTSxVQUFGLEdBQWUsR0FBZjtJQUNBTixDQUFDLENBQUNPLFlBQUYsR0FBaUIsRUFBakI7SUFDQVAsQ0FBQyxDQUFDUSxXQUFGLEdB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QWYsQ0FBd0I0RSxHQUF4QixDQUE0QkMsU0FBNUIsQ0FBc0MsSUFBdEM7O0lBQ0EsSUFBSTlELENBQUosRUFBTztNQUNIWixZQUFZLFdBQVosQ0FBcUIyRSxHQUFyQixDQUF5QkMsYUFBekIsQ0FBdUMsSUFBdkM7SUFDSDtFQUNKLENBVEQ7O0VBVUEvRCxDQUFDLENBQUNZLFNBQUYsQ0FBWXVDLFlBQVosR0FBMkIsVUFBVXBELENBQVYsRUFBYUMsQ0FBYixFQUFnQjtJQUN2QyxJQUFJYyxDQUFDLEdBQUcsQ0FBQzVCLEtBQUssV0FBTCxDQUFjdUMsY0FBZCxDQUE2QjFCLENBQTdCLElBQWtDLEdBQW5DLElBQTBDLEdBQWxEO0lBQ0EsSUFBSW5CLENBQUMsR0FBRyxDQUFDLEtBQUt1RCxJQUFMLENBQVU2QixLQUFWLEdBQWtCLEdBQW5CLElBQTBCLEdBQWxDO0lBQ0EsT0FBT0MsSUFBSSxDQUFDQyxHQUFMLENBQVN0RixDQUFDLEdBQUdrQyxDQUFiLEtBQW1CLEtBQUtSLFVBQUwsR0FBa0JOLENBQXJDLEdBQ0RjLENBREMsSUFFQSxDQUFDbEMsQ0FBQyxHQUFHa0MsQ0FBSixHQUFRLEdBQVQsSUFBZ0IsR0FBaEIsR0FBc0IsQ0FBQ0EsQ0FBQyxHQUFHbEMsQ0FBSixHQUFRLEdBQVQsSUFBZ0IsR0FBdEMsR0FBNkNBLENBQUMsSUFBSSxLQUFLMEIsVUFBTCxHQUFrQk4sQ0FBcEUsR0FBMEVwQixDQUFDLElBQUksS0FBSzBCLFVBQUwsR0FBa0JOLENBQWpHLEVBQXFHcEIsQ0FGckcsQ0FBUDtFQUdILENBTkQ7O0VBT0EsT0FBT3VGLFVBQVUsQ0FBQyxDQUFDM0UsQ0FBRCxDQUFELEVBQU1RLENBQU4sQ0FBakI7QUFDSCxDQXpHTyxDQXlHTFosV0FBVyxXQXpHTixDQUFSOztBQTBHQWdGLE9BQU8sV0FBUCxHQUFrQnRFLENBQWxCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbztcclxudmFyICRvYmplY3QgPSByZXF1aXJlKFwiLi9PYmplY3RcIik7XHJcbnZhciAkbW90aW9uVHJhaWwgPSByZXF1aXJlKFwiLi9Nb3Rpb25UcmFpbFwiKTtcclxudmFyICRjb21wb25lbnRQcm94eSA9IHJlcXVpcmUoXCIuL0NvbXBvbmVudFByb3h5XCIpO1xyXG52YXIgJHNlZWRVdGlsID0gcmVxdWlyZShcIi4vU2VlZFV0aWxcIik7XHJcbnZhciAkdXRpbCA9IHJlcXVpcmUoXCIuL1V0aWxcIik7XHJcbnZhciAkZ2FtZUNvbnRleHQgPSByZXF1aXJlKFwiLi9HYW1lQ29udGV4dFwiKTtcclxudmFyICRiYXNlQnVsbGV0ID0gcmVxdWlyZShcIi4vQmFzZUJ1bGxldFwiKTtcclxudmFyIGYgPSBjYy5fZGVjb3JhdG9yO1xyXG52YXIgaCA9IGYuY2NjbGFzcztcclxudmFyIG0gPSAoZi5wcm9wZXJ0eSwgY2MuVmVjMy5aRVJPKTtcclxudmFyIHkgPSAoZnVuY3Rpb24gKHQpIHtcclxuICAgIGZ1bmN0aW9uIGUoKSB7XHJcbiAgICAgICAgdmFyIGUgPSAobnVsbCAhPT0gdCAmJiB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIHx8IHRoaXM7XHJcbiAgICAgICAgZS5idXR0bGVUeXBlID0gJGJhc2VCdWxsZXQuQnVsbGV0VHlwZS5yX2J1bGxldF8xO1xyXG4gICAgICAgIGUuYW5nbGVTcGVlZCA9IDEwMDtcclxuICAgICAgICBlLnJhbmRvbWVBbmdsZSA9IDMwO1xyXG4gICAgICAgIGUudGFyZ2V0RW5lbXkgPSBudWxsO1xyXG4gICAgICAgIGUudGFyZ2V0UG9zID0gbnVsbDtcclxuICAgICAgICBlLnRhaWwgPSBudWxsO1xyXG4gICAgICAgIHJldHVybiBlO1xyXG4gICAgfVxyXG4gICAgX19leHRlbmRzKGUsIHQpO1xyXG4gICAgZS5wcm90b3R5cGUuaW5pdFJCdWxsZXQgPSBmdW5jdGlvbiAoZSwgaSwgbykge1xyXG4gICAgICAgIHRoaXMuYXRrID0gaTtcclxuICAgICAgICB0aGlzLnNwZWVkID0gbztcclxuICAgICAgICB0aGlzLnRhcmdldFBvcyA9IGUuZ2V0UG9zaXRpb24oKS5jbG9uZSgpO1xyXG4gICAgICAgIHRoaXMudGFyZ2V0RW5lbXkgPSBlO1xyXG4gICAgICAgIHRoaXMudGFyZ2V0RW5lbXkuYWRkRGllQ2FsbGJhY2sodGhpcy5kaWVFbmVteSwgdGhpcyk7XHJcbiAgICAgICAgdmFyIG4gPSB0aGlzLnRhcmdldEVuZW15LmdldFBvc2l0aW9uKCkuc3VidHJhY3QodGhpcy5nZXRQb3NpdGlvbigpKS5ub3JtYWxpemUoKTtcclxuICAgICAgICB2YXIgcyA9ICR1dGlsLmRlZmF1bHQuZGlyQ29udmVyQW5nbGUobik7XHJcbiAgICAgICAgdmFyIHIgPSAkc2VlZFV0aWwuZGVmYXVsdC5yYW5kb21Gcm9tKHRoaXMucmFuZG9tZUFuZ2xlIC0gMTAsIHRoaXMucmFuZG9tZUFuZ2xlICsgMTApO1xyXG4gICAgICAgIHMgKz0gciA9ICRzZWVkVXRpbC5kZWZhdWx0LnByb2JhYmlsaXR5KDUwKSA/IHIgOiAtcjtcclxuICAgICAgICBuID0gJHV0aWwuZGVmYXVsdC5hbmdsZUNvbnZlckRpcihzKTtcclxuICAgICAgICB0LnByb3RvdHlwZS5pbml0QnV0dGxlLmNhbGwodGhpcywgbiwgbnVsbCk7XHJcbiAgICAgICAgaWYgKG4pIHtcclxuICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS5zZXQobikubXVsdGlwbHlTY2FsYXIodGhpcy5zcGVlZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy50YWlsKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGFpbCA9IHRoaXMubm9kZS5nZXRDb21wb25lbnQoJG1vdGlvblRyYWlsLmRlZmF1bHQpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5kaWVFbmVteSA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgaWYgKHQgPT09IHRoaXMudGFyZ2V0RW5lbXkpIHtcclxuICAgICAgICAgICAgdGhpcy50YXJnZXRQb3MgPSB0LmdldFBvc2l0aW9uKCkuY2xvbmUoKTtcclxuICAgICAgICAgICAgdGhpcy50YXJnZXRFbmVteSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLm9uVHJpZ2dlciA9IGZ1bmN0aW9uICh0LCBlKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzVXNlKSB7XHJcbiAgICAgICAgICAgIGlmIChlID09ICRvYmplY3QuVHJpZ2dlci5lbnRlcikge1xyXG4gICAgICAgICAgICAgICAgdC5vYmplY3Quc3VmZmVyQXRrKHtcclxuICAgICAgICAgICAgICAgICAgICBza2lsbFNwZWNpYWxpdHlzOiBbXSxcclxuICAgICAgICAgICAgICAgICAgICBhdGs6IHRoaXMuYXRrXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0RW5lbXkgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVTZWxmKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUudXBkYXRlRnJhbWUgPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIGlmICghdGhpcy50YWlsLmlzQWN0aXZlKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGFpbC5pc0FjdGl2ZSA9ICEwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy50YXJnZXRFbmVteSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy50YXJnZXRFbmVteS5pc0RpZSgpIHx8IG51bGwgPT0gdGhpcy50YXJnZXRFbmVteS5ub2RlLnBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50YXJnZXRFbmVteSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBtLnggPSB0aGlzLnRhcmdldFBvcy54O1xyXG4gICAgICAgICAgICAgICAgbS55ID0gdGhpcy50YXJnZXRQb3MueTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHRoaXMudHJhY2UobSwgdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy50YXJnZXRQb3Muc2V0KHRoaXMudGFyZ2V0RW5lbXkuZ2V0UG9zaXRpb24oKSk7XHJcbiAgICAgICAgICAgIHRoaXMudHJhY2UodGhpcy50YXJnZXRFbmVteS5nZXRQb3NpdGlvbigpLCB0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBtLnggPSB0aGlzLnRhcmdldFBvcy54O1xyXG4gICAgICAgICAgICBtLnkgPSB0aGlzLnRhcmdldFBvcy55O1xyXG4gICAgICAgICAgICB0aGlzLnRyYWNlKG0sIHQpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS50cmFjZSA9IGZ1bmN0aW9uICh0LCBlKSB7XHJcbiAgICAgICAgdmFyIGkgPSB0aGlzLmxlcnBBbmdsZVJlcyh0LnN1YnRyYWN0KHRoaXMuZ2V0UG9zaXRpb24oKSksIGUpO1xyXG4gICAgICAgIHRoaXMuc2V0QW5nbGUoaSk7XHJcbiAgICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoJHV0aWwuZGVmYXVsdC5hbmdsZUNvbnZlckRpcihpKS5ub3JtYWxpemVTZWxmKCkpLm11bFNlbGYodGhpcy5zcGVlZCk7XHJcbiAgICAgICAgdGhpcy5tb3ZlKGUpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLm1vdmUgPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciBlID0gdGhpcy5nZXRQb3NpdGlvbigpO1xyXG4gICAgICAgIHZhciBpID0gdGhpcy52ZWxvY2l0eTtcclxuICAgICAgICBtLnggPSBlLnggKyBpLnggKiB0O1xyXG4gICAgICAgIG0ueSA9IGUueSArIGkueSAqIHQ7XHJcbiAgICAgICAgbS56ID0gZS56ICsgaS56ICogdDtcclxuICAgICAgICB0aGlzLnNldFBvc2l0aW9uKG0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrQm91bmRhcnkoKVxyXG4gICAgICAgICAgICA/ICF0aGlzLnRhcmdldEVuZW15ICYmIG0uc3VidHJhY3QodGhpcy50YXJnZXRQb3MpLm1hZ1NxcigpIDw9IDkwMFxyXG4gICAgICAgICAgICAgICAgPyB0aGlzLnJlbW92ZVNlbGYoKVxyXG4gICAgICAgICAgICAgICAgOiB2b2lkIDBcclxuICAgICAgICAgICAgOiB0aGlzLnJlbW92ZVNlbGYoKTtcclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5yZW1vdmVTZWxmID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICBpZiAodm9pZCAwID09PSB0KSB7XHJcbiAgICAgICAgICAgIHQgPSAhMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy50YWlsLmlzQWN0aXZlID0gITE7XHJcbiAgICAgICAgJGNvbXBvbmVudFByb3h5LmRlZmF1bHQuSW5zLnJlbW92ZU9iaih0aGlzKTtcclxuICAgICAgICBpZiAodCkge1xyXG4gICAgICAgICAgICAkZ2FtZUNvbnRleHQuZGVmYXVsdC5pbnMucHV0QnV0dGxlUG9vbCh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUubGVycEFuZ2xlUmVzID0gZnVuY3Rpb24gKHQsIGUpIHtcclxuICAgICAgICB2YXIgaSA9ICgkdXRpbC5kZWZhdWx0LmRpckNvbnZlckFuZ2xlKHQpICsgMzYwKSAlIDM2MDtcclxuICAgICAgICB2YXIgbyA9ICh0aGlzLm5vZGUuYW5nbGUgKyAzNjApICUgMzYwO1xyXG4gICAgICAgIHJldHVybiBNYXRoLmFicyhvIC0gaSkgPD0gdGhpcy5hbmdsZVNwZWVkICogZVxyXG4gICAgICAgICAgICA/IGlcclxuICAgICAgICAgICAgOiAoKG8gLSBpICsgMzYwKSAlIDM2MCA8IChpIC0gbyArIDM2MCkgJSAzNjAgPyAobyAtPSB0aGlzLmFuZ2xlU3BlZWQgKiBlKSA6IChvICs9IHRoaXMuYW5nbGVTcGVlZCAqIGUpLCBvKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gX19kZWNvcmF0ZShbaF0sIGUpO1xyXG59KSgkYmFzZUJ1bGxldC5kZWZhdWx0KTtcclxuZXhwb3J0cy5kZWZhdWx0ID0geTtcclxuIl19