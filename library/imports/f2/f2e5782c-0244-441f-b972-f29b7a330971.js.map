{"version":3,"sources":["assets\\game_script\\scripts\\RBullet_2.js"],"names":["o","$object","require","$util","$gameContext","$baseBullet","u","cc","_decorator","d","ccclass","p","property","t","e","apply","arguments","buttleType","BulletType","r_bullet_2","atkAnim","bulletSpeed","time","targetNode","targetPos","initPos","status","attackedEnemy","Set","dir","__extends","prototype","initRBullet","i","n","s","r","node","position","clone","getPosition","initButtle","call","getComponentInChildren","Animation","atk","setScale","v3","a","sub","x","mag","tween","to","start","onTrigger","isUse","Trigger","stay","object","has","add","sufferAtk","skillSpecialitys","updateFrame","normalize","velocity","set","multiplyScalar","speed","isValid","ins","getRangeRandomEnemyLayerByPos","y","magSqr","Vec3","ZERO","trigger","active","play","once","EventType","FINISHED","clear","removeSelf","__decorate","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var o;\r\nvar $object = require(\"./Object\");\r\nvar $util = require(\"./Util\");\r\nvar $gameContext = require(\"./GameContext\");\r\nvar $baseBullet = require(\"./BaseBullet\");\r\nvar u = cc._decorator;\r\nvar d = u.ccclass;\r\nvar p =\r\n    (u.property,\r\n    (function (t) {\r\n        function e() {\r\n            var e = (null !== t && t.apply(this, arguments)) || this;\r\n            e.buttleType = $baseBullet.BulletType.r_bullet_2;\r\n            e.atkAnim = null;\r\n            e.bulletSpeed = 800;\r\n            e.time = 0;\r\n            e.targetNode = null;\r\n            e.targetPos = null;\r\n            e.initPos = null;\r\n            e.status = 0;\r\n            e.attackedEnemy = new Set();\r\n            e.dir = null;\r\n            return e;\r\n        }\r\n        __extends(e, t);\r\n        e.prototype.initRBullet = function (e, i, o, n, s) {\r\n            var r = this;\r\n            this.initPos = this.node.position.clone();\r\n            this.targetNode = e;\r\n            this.targetPos = this.targetNode.getPosition().clone();\r\n            this.time = s;\r\n            t.prototype.initButtle.call(this, null, null);\r\n            this.bulletSpeed = n;\r\n            this.atkAnim = this.node.getComponentInChildren(cc.Animation);\r\n            this.atk = i;\r\n            this.setScale(cc.v3(o, o));\r\n            this.status = 0;\r\n            var a = this.node.position.sub(cc.v3(this.targetPos.x, -410)).mag() / this.bulletSpeed;\r\n            cc.tween(this.node)\r\n                .to(a, {\r\n                    position: cc.v3(this.targetPos.x, -410)\r\n                })\r\n                .call(function () {\r\n                    r.status = 2;\r\n                })\r\n                .start();\r\n        };\r\n        e.prototype.onTrigger = function (t, e) {\r\n            if (!this.isUse && e == $object.Trigger.stay) {\r\n                var i = t.object;\r\n                if (!this.attackedEnemy.has(i)) {\r\n                    this.attackedEnemy.add(i);\r\n                    i.sufferAtk({\r\n                        skillSpecialitys: this.skillSpecialitys,\r\n                        atk: this.atk\r\n                    });\r\n                }\r\n            }\r\n        };\r\n        e.prototype.updateFrame = function (e) {\r\n            var i = this;\r\n            t.prototype.updateFrame.call(this, e);\r\n            if (this.time > 0) {\r\n                this.time -= e;\r\n                if (this.time <= 0 && 2 === this.status) {\r\n                    this.dir = this.initPos.sub(this.node.position).normalize();\r\n                    this.velocity.set(this.dir.normalize()).multiplyScalar(this.speed);\r\n                    this.status = 4;\r\n                }\r\n            }\r\n            if (2 === this.status) {\r\n                if (\r\n                    !(\r\n                        (this.targetNode && $util.default.isValid(this.targetNode.node)) ||\r\n                        ((this.targetNode = $gameContext.default.ins.getRangeRandomEnemyLayerByPos(\r\n                            this.targetPos,\r\n                            900\r\n                        )),\r\n                        this.targetNode)\r\n                    )\r\n                ) {\r\n                    return void (this.status = 4);\r\n                }\r\n                this.targetPos.x = this.targetNode.node.x;\r\n                this.targetPos.y = this.targetNode.node.y;\r\n                if (0 === this.speed) {\r\n                    this.speed = this.bulletSpeed;\r\n                }\r\n                this.dir = this.targetPos.sub(this.node.position);\r\n                this.dir.magSqr() <= 1e4\r\n                    ? ((this.velocity = cc.Vec3.ZERO),\r\n                      (this.status = 3),\r\n                      (this.trigger = !0),\r\n                      (this.atkAnim.node.active = !0),\r\n                      this.atkAnim.play(\"rbullet_2\"),\r\n                      this.atkAnim.once(\r\n                          cc.Animation.EventType.FINISHED,\r\n                          function () {\r\n                              i.atkAnim.node.active = !1;\r\n                              i.trigger = !1;\r\n                              i.dir = i.initPos.sub(i.node.position).normalize();\r\n                              i.velocity.set(i.dir.normalize()).multiplyScalar(i.speed);\r\n                              i.status = 4;\r\n                          },\r\n                          this\r\n                      ))\r\n                    : this.velocity.set(this.dir.normalize()).multiplyScalar(this.speed);\r\n            }\r\n            if (4 === this.status && this.initPos.sub(this.getPosition()).magSqr() <= 2500) {\r\n                this.status = 5;\r\n                this.attackedEnemy.clear();\r\n                this.removeSelf();\r\n            }\r\n        };\r\n        return __decorate([d], e);\r\n    })($baseBullet.default));\r\nexports.default = p;\r\n"]}