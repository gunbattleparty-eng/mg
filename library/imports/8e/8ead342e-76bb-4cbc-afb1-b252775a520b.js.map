{"version":3,"sources":["assets\\game_script\\scripts\\RewardGemView.js"],"names":["o","$assetsLoader","require","$assetsMap","$resUtil","$eventManager","$list","$popupManager","$popupView","$remoteAudio","$seedUtil","$configContext","$localEventName","$roleContext","$taskContext","$startView","v","cc","_decorator","b","ccclass","w","property","A","t","e","apply","arguments","list","btnSure","gemIds","newGemConfigs","__extends","prototype","onResetView","uiParam","param","numItems","length","addEvent","on","clickSure","removeEvent","off","instance","playEffectMusic","i","ins","getPackInfo","n","grade","gemConfigs","filter","Grade","s","randomFrom","addPackItem","push","type","ext","id","num","r","l","u","indexOf","PopupManager","open","AssetsMap","PopUpBundles","prefabs","assetsList","RewardView","infos","p","delPackItem","Ins","setTaskRecord","Math","round","send","RENDER_GEM","RENDER_DOT","MenuType","Role","onClickClose","call","renderItem","loadRes","BundleNames","Public","part","SpriteFrame","children","getComponent","Sprite","isValid","spriteFrame","ResUtil","assignWith","node","__decorate","Node","PopupView","exports"],"mappings":";;;;;;AAAA,IAAIA,CAAJ;;AACA,IAAIC,aAAa,GAAGC,OAAO,CAAC,gBAAD,CAA3B;;AACA,IAAIC,UAAU,GAAGD,OAAO,CAAC,aAAD,CAAxB;;AACA,IAAIE,QAAQ,GAAGF,OAAO,CAAC,WAAD,CAAtB;;AACA,IAAIG,aAAa,GAAGH,OAAO,CAAC,gBAAD,CAA3B;;AACA,IAAII,KAAK,GAAGJ,OAAO,CAAC,QAAD,CAAnB;;AACA,IAAIK,aAAa,GAAGL,OAAO,CAAC,gBAAD,CAA3B;;AACA,IAAIM,UAAU,GAAGN,OAAO,CAAC,aAAD,CAAxB;;AACA,IAAIO,YAAY,GAAGP,OAAO,CAAC,eAAD,CAA1B;;AACA,IAAIQ,SAAS,GAAGR,OAAO,CAAC,YAAD,CAAvB;;AACA,IAAIS,cAAc,GAAGT,OAAO,CAAC,iBAAD,CAA5B;;AACA,IAAIU,eAAe,GAAGV,OAAO,CAAC,kBAAD,CAA7B;;AACA,IAAIW,YAAY,GAAGX,OAAO,CAAC,eAAD,CAA1B;;AACA,IAAIY,YAAY,GAAGZ,OAAO,CAAC,eAAD,CAA1B;;AACA,IAAIa,UAAU,GAAGb,OAAO,CAAC,aAAD,CAAxB;;AACA,IAAIc,CAAC,GAAGC,EAAE,CAACC,UAAX;AACA,IAAIC,CAAC,GAAGH,CAAC,CAACI,OAAV;AACA,IAAIC,CAAC,GAAGL,CAAC,CAACM,QAAV;;AACA,IAAIC,CAAC,GAAI,UAAUC,CAAV,EAAa;EAClB,SAASC,CAAT,GAAa;IACT,IAAIA,CAAC,GAAI,SAASD,CAAT,IAAcA,CAAC,CAACE,KAAF,CAAQ,IAAR,EAAcC,SAAd,CAAf,IAA4C,IAApD;IACAF,CAAC,CAACG,IAAF,GAAS,IAAT;IACAH,CAAC,CAACI,OAAF,GAAY,IAAZ;IACAJ,CAAC,CAACK,MAAF,GAAW,EAAX;IACAL,CAAC,CAACM,aAAF,GAAkB,EAAlB;IACA,OAAON,CAAP;EACH;;EACDO,SAAS,CAACP,CAAD,EAAID,CAAJ,CAAT;;EACAC,CAAC,CAACQ,SAAF,CAAYC,WAAZ,GAA0B,YAAY;IAClC,KAAKJ,MAAL,GAAc,KAAKK,OAAL,CAAaC,KAAb,CAAmBN,MAAjC;IACA,KAAKF,IAAL,CAAUS,QAAV,GAAqB,KAAKP,MAAL,CAAYQ,MAAjC;EACH,CAHD;;EAIAb,CAAC,CAACQ,SAAF,CAAYM,QAAZ,GAAuB,YAAY;IAC/B,KAAKV,OAAL,CAAaW,EAAb,CAAgB,OAAhB,EAAyB,KAAKC,SAA9B,EAAyC,IAAzC;EACH,CAFD;;EAGAhB,CAAC,CAACQ,SAAF,CAAYS,WAAZ,GAA0B,YAAY;IAClC,KAAKb,OAAL,CAAac,GAAb,CAAiB,OAAjB,EAA0B,KAAKF,SAA/B,EAA0C,IAA1C;EACH,CAFD;;EAGAhB,CAAC,CAACQ,SAAF,CAAYQ,SAAZ,GAAwB,YAAY;IAChChC,YAAY,WAAZ,CAAqBmC,QAArB,CAA8BC,eAA9B,CAA8C,OAA9C;IACA,IAAIpB,CAAC,GAAG,CAAR;IACA,IAAIqB,CAAC,GAAG,EAAR;;IACA,IAAI9C,CAAC,GAAG,aAAY;MAChB,IAAIwB,CAAC,GAAGX,YAAY,WAAZ,CAAqBkC,GAArB,CAAyBC,WAAzB,CAAqCC,CAAC,CAACnB,MAAF,CAASL,CAAT,CAArC,EAAkDyB,KAAlD,GAA0D,CAAlE;MACA,IAAIlD,CAAC,GAAGW,cAAc,WAAd,CAAuBiC,QAAvB,CAAgCO,UAAhC,CAA2CC,MAA3C,CAAkD,UAAU3B,CAAV,EAAa;QACnE,OAAOA,CAAC,CAAC4B,KAAF,KAAY7B,CAAnB;MACH,CAFO,CAAR;MAGA,IAAI8B,CAAC,GAAGtD,CAAC,CAACU,SAAS,WAAT,CAAkB6C,UAAlB,CAA6B,CAA7B,EAAgCvD,CAAC,CAACsC,MAAF,GAAW,CAA3C,CAAD,CAAT;MACAzB,YAAY,WAAZ,CAAqBkC,GAArB,CAAyBS,WAAzB,CAAqCF,CAArC,EAAwC,CAAxC;MACAR,CAAC,CAACW,IAAF,CAAO;QACHC,IAAI,EAAE,CADH;QAEHC,GAAG,EAAEL,CAAC,CAACM,EAFJ;QAGHC,GAAG,EAAE;MAHF,CAAP;MAKAZ,CAAC,CAAClB,aAAF,CAAgB0B,IAAhB,CAAqBH,CAArB;MACA7B,CAAC,IAAI,CAAL;IACH,CAdD;;IAeA,KAAK,IAAIwB,CAAC,GAAG,IAAb,EAAmBxB,CAAC,GAAG,KAAKK,MAAL,CAAYQ,MAAnC,GAA6C;MACzCtC,CAAC;IACJ;;IACD,IAAIsD,CAAC,GAAG,EAAR;IACA,IAAIQ,CAAC,GAAG,EAAR;;IACA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKjC,MAAL,CAAYQ,MAAhC,EAAwCyB,CAAC,EAAzC,EAA6C;MACzC,IAAIC,CAAC,GAAGV,CAAC,CAACW,OAAF,CAAU,KAAKnC,MAAL,CAAYiC,CAAZ,CAAV,CAAR;MACA,CAAC,CAAD,KAAOC,CAAP,IAAYV,CAAC,CAACG,IAAF,CAAO,KAAK3B,MAAL,CAAYiC,CAAZ,CAAP,GAAwBD,CAAC,CAACL,IAAF,CAAO,CAAP,CAApC,IAAiDK,CAAC,CAACE,CAAD,CAAD,EAAjD;IACH;;IACDzD,aAAa,CAAC2D,YAAd,CAA2BtB,QAA3B,CAAoCuB,IAApC,CAAyChE,UAAU,CAACiE,SAAX,CAAqBC,YAArB,CAAkCC,OAAlC,CAA0CC,UAA1C,CAAqDC,UAA9F,EAA0G;MACtGC,KAAK,EAAE3B;IAD+F,CAA1G;;IAGA,KAAK,IAAI4B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGpB,CAAC,CAAChB,MAAtB,EAA8BoC,CAAC,EAA/B,EAAmC;MAC/B7D,YAAY,WAAZ,CAAqBkC,GAArB,CAAyB4B,WAAzB,CAAqCrB,CAAC,CAACoB,CAAD,CAAtC,EAA2CZ,CAAC,CAACY,CAAD,CAA5C;IACH;;IACD5D,YAAY,WAAZ,CAAqB8D,GAArB,CAAyBC,aAAzB,CAAuC,CAAvC,EAA0CC,IAAI,CAACC,KAAL,CAAW,KAAKjD,MAAL,CAAYQ,MAAZ,GAAqB,CAAhC,CAA1C;IACAjC,aAAa,WAAb,CAAsB2E,IAAtB,CAA2BpE,eAAe,WAAf,CAAwBqE,UAAnD;IACA5E,aAAa,WAAb,CAAsB2E,IAAtB,CAA2BpE,eAAe,WAAf,CAAwBsE,UAAnD,EAA+DnE,UAAU,CAACoE,QAAX,CAAoBC,IAAnF;IACA5D,CAAC,CAACS,SAAF,CAAYoD,YAAZ,CAAyBC,IAAzB,CAA8B,IAA9B;EACH,CAtCD;;EAuCA7D,CAAC,CAACQ,SAAF,CAAYsD,UAAZ,GAAyB,UAAU/D,CAAV,EAAaC,CAAb,EAAgB;IACrC,IAAIqB,CAAC,GAAG,IAAR;IACA,IAAI9C,CAAC,GAAGa,YAAY,WAAZ,CAAqBkC,GAArB,CAAyBC,WAAzB,CAAqC,KAAKlB,MAAL,CAAYL,CAAZ,CAArC,CAAR;IACAxB,aAAa,WAAb,CAAsB2C,QAAtB,CAA+B4C,OAA/B,CACIrF,UAAU,CAACsF,WAAX,CAAuBC,MAD3B,EAEI,CAAC,oBAAoB1F,CAAC,CAAC2F,IAAtB,GAA6B,GAA7B,GAAmC3F,CAAC,CAACkD,KAAtC,EAA6C,oBAAoBlD,CAAC,CAACkD,KAAnE,CAFJ,EAGIjC,EAAE,CAAC2E,WAHP,EAII,IAJJ,EAKI,UAAUnE,CAAV,EAAazB,CAAb,EAAgB;MACZ,IAAIiD,CAAC,GAAGzB,CAAC,CAACqE,QAAF,CAAW,CAAX,EAAcC,YAAd,CAA2B7E,EAAE,CAAC8E,MAA9B,CAAR;MACA,IAAIzC,CAAC,GAAG9B,CAAC,CAACsE,YAAF,CAAe7E,EAAE,CAAC8E,MAAlB,CAAR;MACA,IAAIjC,CAAC,GAAG9D,CAAC,CAAC,CAAD,CAAT;;MACA,IAAI8D,CAAC,IAAI7C,EAAE,CAAC+E,OAAH,CAAW/C,CAAX,CAAT,EAAwB;QACpBA,CAAC,CAACgD,WAAF,GAAgB7F,QAAQ,CAAC8F,OAAT,CAAiBC,UAAjB,CAA4BrC,CAA5B,EAA+BhB,CAAC,CAACsD,IAAjC,CAAhB;QACA9C,CAAC,CAAC2C,WAAF,GAAgB7F,QAAQ,CAAC8F,OAAT,CAAiBC,UAAjB,CAA4BnG,CAAC,CAAC,CAAD,CAA7B,EAAkC8C,CAAC,CAACsD,IAApC,CAAhB;MACH;IACJ,CAbL;EAeH,CAlBD;;EAmBAC,UAAU,CAAC,CAAChF,CAAC,CAACf,KAAK,WAAN,CAAF,CAAD,EAAqBmB,CAAC,CAACQ,SAAvB,EAAkC,MAAlC,EAA0C,KAAK,CAA/C,CAAV;;EACAoE,UAAU,CAAC,CAAChF,CAAC,CAACJ,EAAE,CAACqF,IAAJ,CAAF,CAAD,EAAe7E,CAAC,CAACQ,SAAjB,EAA4B,SAA5B,EAAuC,KAAK,CAA5C,CAAV;;EACA,OAAOoE,UAAU,CAAC,CAAClF,CAAD,CAAD,EAAMM,CAAN,CAAjB;AACH,CAjFO,CAiFLjB,UAAU,CAAC+F,SAjFN,CAAR;;AAkFAC,OAAO,WAAP,GAAkBjF,CAAlB","sourceRoot":"/","sourcesContent":["var o;\r\nvar $assetsLoader = require(\"./AssetsLoader\");\r\nvar $assetsMap = require(\"./AssetsMap\");\r\nvar $resUtil = require(\"./ResUtil\");\r\nvar $eventManager = require(\"./EventManager\");\r\nvar $list = require(\"./List\");\r\nvar $popupManager = require(\"./PopupManager\");\r\nvar $popupView = require(\"./PopupView\");\r\nvar $remoteAudio = require(\"./RemoteAudio\");\r\nvar $seedUtil = require(\"./SeedUtil\");\r\nvar $configContext = require(\"./ConfigContext\");\r\nvar $localEventName = require(\"./LocalEventName\");\r\nvar $roleContext = require(\"./RoleContext\");\r\nvar $taskContext = require(\"./TaskContext\");\r\nvar $startView = require(\"./StartView\");\r\nvar v = cc._decorator;\r\nvar b = v.ccclass;\r\nvar w = v.property;\r\nvar A = (function (t) {\r\n    function e() {\r\n        var e = (null !== t && t.apply(this, arguments)) || this;\r\n        e.list = null;\r\n        e.btnSure = null;\r\n        e.gemIds = [];\r\n        e.newGemConfigs = [];\r\n        return e;\r\n    }\r\n    __extends(e, t);\r\n    e.prototype.onResetView = function () {\r\n        this.gemIds = this.uiParam.param.gemIds;\r\n        this.list.numItems = this.gemIds.length;\r\n    };\r\n    e.prototype.addEvent = function () {\r\n        this.btnSure.on(\"click\", this.clickSure, this);\r\n    };\r\n    e.prototype.removeEvent = function () {\r\n        this.btnSure.off(\"click\", this.clickSure, this);\r\n    };\r\n    e.prototype.clickSure = function () {\r\n        $remoteAudio.default.instance.playEffectMusic(\"Click\");\r\n        var e = 0;\r\n        var i = [];\r\n        var o = function () {\r\n            var t = $roleContext.default.ins.getPackInfo(n.gemIds[e]).grade + 1;\r\n            var o = $configContext.default.instance.gemConfigs.filter(function (e) {\r\n                return e.Grade === t;\r\n            });\r\n            var s = o[$seedUtil.default.randomFrom(0, o.length - 1)];\r\n            $roleContext.default.ins.addPackItem(s, 1);\r\n            i.push({\r\n                type: 5,\r\n                ext: s.id,\r\n                num: 1\r\n            });\r\n            n.newGemConfigs.push(s);\r\n            e += 5;\r\n        };\r\n        for (var n = this; e < this.gemIds.length; ) {\r\n            o();\r\n        }\r\n        var s = [];\r\n        var r = [];\r\n        for (var l = 0; l < this.gemIds.length; l++) {\r\n            var u = s.indexOf(this.gemIds[l]);\r\n            -1 === u ? (s.push(this.gemIds[l]), r.push(1)) : r[u]++;\r\n        }\r\n        $popupManager.PopupManager.instance.open($assetsMap.AssetsMap.PopUpBundles.prefabs.assetsList.RewardView, {\r\n            infos: i\r\n        });\r\n        for (var p = 0; p < s.length; p++) {\r\n            $roleContext.default.ins.delPackItem(s[p], r[p]);\r\n        }\r\n        $taskContext.default.Ins.setTaskRecord(2, Math.round(this.gemIds.length / 5));\r\n        $eventManager.default.send($localEventName.default.RENDER_GEM);\r\n        $eventManager.default.send($localEventName.default.RENDER_DOT, $startView.MenuType.Role);\r\n        t.prototype.onClickClose.call(this);\r\n    };\r\n    e.prototype.renderItem = function (t, e) {\r\n        var i = this;\r\n        var o = $roleContext.default.ins.getPackInfo(this.gemIds[e]);\r\n        $assetsLoader.default.instance.loadRes(\r\n            $assetsMap.BundleNames.Public,\r\n            [\"/textures/gem/g\" + o.part + \"_\" + o.grade, \"/textures/gem/k\" + o.grade],\r\n            cc.SpriteFrame,\r\n            null,\r\n            function (e, o) {\r\n                var n = t.children[0].getComponent(cc.Sprite);\r\n                var s = t.getComponent(cc.Sprite);\r\n                var r = o[0];\r\n                if (r && cc.isValid(n)) {\r\n                    n.spriteFrame = $resUtil.ResUtil.assignWith(r, i.node);\r\n                    s.spriteFrame = $resUtil.ResUtil.assignWith(o[1], i.node);\r\n                }\r\n            }\r\n        );\r\n    };\r\n    __decorate([w($list.default)], e.prototype, \"list\", void 0);\r\n    __decorate([w(cc.Node)], e.prototype, \"btnSure\", void 0);\r\n    return __decorate([b], e);\r\n})($popupView.PopupView);\r\nexports.default = A;\r\n"]}