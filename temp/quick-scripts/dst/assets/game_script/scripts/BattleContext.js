
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/BattleContext.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'afb0dEEkXhF/JWvOouKZ8K6', 'BattleContext');
// game_script/scripts/BattleContext.js

"use strict";

var $eventManager = require("./EventManager");

var $uIManager = require("./UIManager");

var $seedUtil = require("./SeedUtil");

var $storageUtil = require("./StorageUtil");

var $startView = require("./StartView");

var $configContext = require("./ConfigContext");

var $localEventName = require("./LocalEventName");

var $localName = require("./LocalName");

var $skillContext = require("./SkillContext");

var $userDataContext = require("./UserDataContext");

var f = function () {
  function t() {
    this.currLevel = 1;
    this.levelRecords = [];
    this.bs = [0, 0.5, 1];
    this.levelRecords = $storageUtil.StorageUtil.getItem($localName["default"].LEVEL_RECORD, []);

    if (this.levelRecords.length > 0) {
      this.currLevel = this.levelRecords[this.levelRecords.length - 1].level;
    }
  }

  Object.defineProperty(t, "Ins", {
    get: function get() {
      if (!t.instance) {
        t.instance = new t();
      }

      return t.instance;
    },
    enumerable: !1,
    configurable: !0
  });

  t.prototype.setRecord = function (t, e, i) {
    var o = this.levelRecords.findIndex(function (e) {
      return e.level === t;
    });
    -1 !== o ? this.levelRecords[o].resBlood < e && (this.levelRecords[o].resBlood = e) : this.levelRecords.push({
      level: t,
      resBlood: e,
      time: i,
      gainBoxIndex: -1
    });
    $storageUtil.StorageUtil.setItem($localName["default"].LEVEL_RECORD, this.levelRecords);
  };

  t.prototype.getRecord = function (t) {
    return this.levelRecords.find(function (e) {
      return e.level === t;
    }) || {
      level: t,
      resBlood: -1,
      time: 0,
      gainBoxIndex: -1
    };
  };

  t.prototype.getLastRecord = function () {
    var t = null;

    for (var e = this.levelRecords.length - 1; e >= 0; e--) {
      var i = this.levelRecords[e];

      if (i.resBlood > 0) {
        t = i;
        break;
      }
    }

    if (t) {
      if (!(Math.abs(t.level - this.levelRecords.length) > 10)) {
        return t;
      }

      $uIManager.UIManager.instance.showToast("检测到关卡数据异常");
      var o = 1;
      var s = [];

      for (e = 0; e < this.levelRecords.length; e++) {
        var r = this.levelRecords[e];

        if (r.level === o) {
          s.push({
            level: o,
            resBlood: r.resBlood,
            time: r.time,
            gainBoxIndex: r.gainBoxIndex
          });
          o++;
        }
      }

      this.levelRecords = s;
    }

    return {
      level: 0,
      resBlood: -1,
      time: 0,
      gainBoxIndex: -1
    };
  };

  t.prototype.boxStatus = function (t, e) {
    var i = this.getRecord(t);
    return i.resBlood <= 0 ? 0 : i.gainBoxIndex < e && i.resBlood > 0 && i.resBlood >= this.bs[e] ? 1 : i.gainBoxIndex >= e ? 2 : 0;
  };

  t.prototype.isGainBox = function (t, e) {
    return this.getRecord(t).gainBoxIndex >= e;
  };

  t.prototype.canPassBoxIndex = function (t) {
    var e = this.getRecord(t);
    return e.resBlood > 0 && e.gainBoxIndex < 0 ? 0 : e.resBlood >= 0.5 && e.gainBoxIndex < 1 ? 1 : e.resBlood >= 1 && e.gainBoxIndex < 2 ? 2 : -1;
  };

  t.prototype.openBox = function (t, e) {
    var i = [];
    this.getRecord(t).gainBoxIndex = e;
    $storageUtil.StorageUtil.setItem($localName["default"].LEVEL_RECORD, this.levelRecords);
    var n = $configContext["default"].instance.getConfigByLevel(t);
    var f = n.TreasureChesttype[e];
    var h = n.TreasureChest_num[e];

    for (var m = 0; m < f.length; m++) {
      if (1 === f[m]) {
        i.push({
          type: 1,
          num: h[m]
        });
        $userDataContext["default"].Ins.opearCoin(h[m]);
        $eventManager["default"].send($localEventName["default"].RENDER_DOT, $startView.MenuType.ALL);
      }

      if (3 === f[m]) {
        var y = $seedUtil["default"].randomFrom(1, 2);
        y = Math.min(y, h[m]);
        var g = $seedUtil["default"].randomCount(1, 6, y);

        var _ = $seedUtil["default"].splitNumber(h[m], y);

        for (var k = 0; k < y; k++) {
          i.push({
            type: 3,
            ext: g[k],
            num: _[k]
          });
          $userDataContext["default"].Ins.opearEquipBook(g[k], _[k]);
        }

        $eventManager["default"].send($localEventName["default"].RENDER_DOT, $startView.MenuType.Role);
      }

      if (4 === f[m]) {
        var v = $seedUtil["default"].randomFrom(1, 4);
        var b = $skillContext["default"].Ins.getUseSkillIds();
        v = Math.min(b.length, v);
        b = $seedUtil["default"].randomArr(b, v);
        var w = $seedUtil["default"].splitNumber(h[m], v);

        for (var A = 0; A < v; A++) {
          i.push({
            type: 4,
            ext: b[A],
            num: w[A]
          });
          $userDataContext["default"].Ins.opearSkillBook(b[A], w[A]);
        }

        $eventManager["default"].send($localEventName["default"].RENDER_DOT, $startView.MenuType.Skill);
      }

      if (6 === f[m]) {
        i.push({
          type: 6,
          num: h[m]
        });
        $userDataContext["default"].Ins.opearDiamond(h[m]);
      }
    }

    return i;
  };

  return t;
}();

exports["default"] = f;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXEJhdHRsZUNvbnRleHQuanMiXSwibmFtZXMiOlsiJGV2ZW50TWFuYWdlciIsInJlcXVpcmUiLCIkdUlNYW5hZ2VyIiwiJHNlZWRVdGlsIiwiJHN0b3JhZ2VVdGlsIiwiJHN0YXJ0VmlldyIsIiRjb25maWdDb250ZXh0IiwiJGxvY2FsRXZlbnROYW1lIiwiJGxvY2FsTmFtZSIsIiRza2lsbENvbnRleHQiLCIkdXNlckRhdGFDb250ZXh0IiwiZiIsInQiLCJjdXJyTGV2ZWwiLCJsZXZlbFJlY29yZHMiLCJicyIsIlN0b3JhZ2VVdGlsIiwiZ2V0SXRlbSIsIkxFVkVMX1JFQ09SRCIsImxlbmd0aCIsImxldmVsIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXQiLCJpbnN0YW5jZSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJwcm90b3R5cGUiLCJzZXRSZWNvcmQiLCJlIiwiaSIsIm8iLCJmaW5kSW5kZXgiLCJyZXNCbG9vZCIsInB1c2giLCJ0aW1lIiwiZ2FpbkJveEluZGV4Iiwic2V0SXRlbSIsImdldFJlY29yZCIsImZpbmQiLCJnZXRMYXN0UmVjb3JkIiwiTWF0aCIsImFicyIsIlVJTWFuYWdlciIsInNob3dUb2FzdCIsInMiLCJyIiwiYm94U3RhdHVzIiwiaXNHYWluQm94IiwiY2FuUGFzc0JveEluZGV4Iiwib3BlbkJveCIsIm4iLCJnZXRDb25maWdCeUxldmVsIiwiVHJlYXN1cmVDaGVzdHR5cGUiLCJoIiwiVHJlYXN1cmVDaGVzdF9udW0iLCJtIiwidHlwZSIsIm51bSIsIklucyIsIm9wZWFyQ29pbiIsInNlbmQiLCJSRU5ERVJfRE9UIiwiTWVudVR5cGUiLCJBTEwiLCJ5IiwicmFuZG9tRnJvbSIsIm1pbiIsImciLCJyYW5kb21Db3VudCIsIl8iLCJzcGxpdE51bWJlciIsImsiLCJleHQiLCJvcGVhckVxdWlwQm9vayIsIlJvbGUiLCJ2IiwiYiIsImdldFVzZVNraWxsSWRzIiwicmFuZG9tQXJyIiwidyIsIkEiLCJvcGVhclNraWxsQm9vayIsIlNraWxsIiwib3BlYXJEaWFtb25kIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxhQUFhLEdBQUdDLE9BQU8sQ0FBQyxnQkFBRCxDQUEzQjs7QUFDQSxJQUFJQyxVQUFVLEdBQUdELE9BQU8sQ0FBQyxhQUFELENBQXhCOztBQUNBLElBQUlFLFNBQVMsR0FBR0YsT0FBTyxDQUFDLFlBQUQsQ0FBdkI7O0FBQ0EsSUFBSUcsWUFBWSxHQUFHSCxPQUFPLENBQUMsZUFBRCxDQUExQjs7QUFDQSxJQUFJSSxVQUFVLEdBQUdKLE9BQU8sQ0FBQyxhQUFELENBQXhCOztBQUNBLElBQUlLLGNBQWMsR0FBR0wsT0FBTyxDQUFDLGlCQUFELENBQTVCOztBQUNBLElBQUlNLGVBQWUsR0FBR04sT0FBTyxDQUFDLGtCQUFELENBQTdCOztBQUNBLElBQUlPLFVBQVUsR0FBR1AsT0FBTyxDQUFDLGFBQUQsQ0FBeEI7O0FBQ0EsSUFBSVEsYUFBYSxHQUFHUixPQUFPLENBQUMsZ0JBQUQsQ0FBM0I7O0FBQ0EsSUFBSVMsZ0JBQWdCLEdBQUdULE9BQU8sQ0FBQyxtQkFBRCxDQUE5Qjs7QUFDQSxJQUFJVSxDQUFDLEdBQUksWUFBWTtFQUNqQixTQUFTQyxDQUFULEdBQWE7SUFDVCxLQUFLQyxTQUFMLEdBQWlCLENBQWpCO0lBQ0EsS0FBS0MsWUFBTCxHQUFvQixFQUFwQjtJQUNBLEtBQUtDLEVBQUwsR0FBVSxDQUFDLENBQUQsRUFBSSxHQUFKLEVBQVMsQ0FBVCxDQUFWO0lBQ0EsS0FBS0QsWUFBTCxHQUFvQlYsWUFBWSxDQUFDWSxXQUFiLENBQXlCQyxPQUF6QixDQUFpQ1QsVUFBVSxXQUFWLENBQW1CVSxZQUFwRCxFQUFrRSxFQUFsRSxDQUFwQjs7SUFDQSxJQUFJLEtBQUtKLFlBQUwsQ0FBa0JLLE1BQWxCLEdBQTJCLENBQS9CLEVBQWtDO01BQzlCLEtBQUtOLFNBQUwsR0FBaUIsS0FBS0MsWUFBTCxDQUFrQixL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SSxJQUFGLENBQU87WUFDSHVCLElBQUksRUFBRSxDQURIO1lBRUhnQixHQUFHLEVBQUVJLENBQUMsQ0FBQ0ksQ0FBRCxDQUZIO1lBR0h2QixHQUFHLEVBQUVzQixDQUFDLENBQUNDLENBQUQ7VUFISCxDQUFQO1VBS0F2RSxnQkFBZ0IsV0FBaEIsQ0FBeUJpRCxHQUF6QixDQUE2QnVCLGNBQTdCLENBQTRDTCxDQUFDLENBQUNJLENBQUQsQ0FBN0MsRUFBa0RELENBQUMsQ0FBQ0MsQ0FBRCxDQUFuRDtRQUNIOztRQUNEakYsYUFBYSxXQUFiLENBQXNCNkQsSUFBdEIsQ0FBMkJ0RCxlQUFlLFdBQWYsQ0FBd0J1RCxVQUFuRCxFQUErRHpELFVBQVUsQ0FBQzBELFFBQVgsQ0FBb0JvQixLQUFuRjtNQUNIOztNQUNELElBQUksTUFBTXhFLENBQUMsQ0FBQzZDLENBQUQsQ0FBWCxFQUFnQjtRQUNaMUIsQ0FBQyxDQUFDSSxJQUFGLENBQU87VUFDSHVCLElBQUksRUFBRSxDQURIO1VBRUhDLEdBQUcsRUFBRUosQ0FBQyxDQUFDRSxDQUFEO1FBRkgsQ0FBUDtRQUlBOUMsZ0JBQWdCLFdBQWhCLENBQXlCaUQsR0FBekIsQ0FBNkJ5QixZQUE3QixDQUEwQzlCLENBQUMsQ0FBQ0UsQ0FBRCxDQUEzQztNQUNIO0lBQ0o7O0lBQ0QsT0FBTzFCLENBQVA7RUFDSCxDQXhERDs7RUF5REEsT0FBT2xCLENBQVA7QUFDSCxDQXBLTyxFQUFSOztBQXFLQXlFLE9BQU8sV0FBUCxHQUFrQjFFLENBQWxCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgJGV2ZW50TWFuYWdlciA9IHJlcXVpcmUoXCIuL0V2ZW50TWFuYWdlclwiKTtcclxudmFyICR1SU1hbmFnZXIgPSByZXF1aXJlKFwiLi9VSU1hbmFnZXJcIik7XHJcbnZhciAkc2VlZFV0aWwgPSByZXF1aXJlKFwiLi9TZWVkVXRpbFwiKTtcclxudmFyICRzdG9yYWdlVXRpbCA9IHJlcXVpcmUoXCIuL1N0b3JhZ2VVdGlsXCIpO1xyXG52YXIgJHN0YXJ0VmlldyA9IHJlcXVpcmUoXCIuL1N0YXJ0Vmlld1wiKTtcclxudmFyICRjb25maWdDb250ZXh0ID0gcmVxdWlyZShcIi4vQ29uZmlnQ29udGV4dFwiKTtcclxudmFyICRsb2NhbEV2ZW50TmFtZSA9IHJlcXVpcmUoXCIuL0xvY2FsRXZlbnROYW1lXCIpO1xyXG52YXIgJGxvY2FsTmFtZSA9IHJlcXVpcmUoXCIuL0xvY2FsTmFtZVwiKTtcclxudmFyICRza2lsbENvbnRleHQgPSByZXF1aXJlKFwiLi9Ta2lsbENvbnRleHRcIik7XHJcbnZhciAkdXNlckRhdGFDb250ZXh0ID0gcmVxdWlyZShcIi4vVXNlckRhdGFDb250ZXh0XCIpO1xyXG52YXIgZiA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiB0KCkge1xyXG4gICAgICAgIHRoaXMuY3VyckxldmVsID0gMTtcclxuICAgICAgICB0aGlzLmxldmVsUmVjb3JkcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuYnMgPSBbMCwgMC41LCAxXTtcclxuICAgICAgICB0aGlzLmxldmVsUmVjb3JkcyA9ICRzdG9yYWdlVXRpbC5TdG9yYWdlVXRpbC5nZXRJdGVtKCRsb2NhbE5hbWUuZGVmYXVsdC5MRVZFTF9SRUNPUkQsIFtdKTtcclxuICAgICAgICBpZiAodGhpcy5sZXZlbFJlY29yZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJMZXZlbCA9IHRoaXMubGV2ZWxSZWNvcmRzW3RoaXMubGV2ZWxSZWNvcmRzLmxlbmd0aCAtIDFdLmxldmVsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCBcIkluc1wiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICghdC5pbnN0YW5jZSkge1xyXG4gICAgICAgICAgICAgICAgdC5pbnN0YW5jZSA9IG5ldyB0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHQuaW5zdGFuY2U7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiAhMSxcclxuICAgICAgICBjb25maWd1cmFibGU6ICEwXHJcbiAgICB9KTtcclxuICAgIHQucHJvdG90eXBlLnNldFJlY29yZCA9IGZ1bmN0aW9uICh0LCBlLCBpKSB7XHJcbiAgICAgICAgdmFyIG8gPSB0aGlzLmxldmVsUmVjb3Jkcy5maW5kSW5kZXgoZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGUubGV2ZWwgPT09IHQ7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLTEgIT09IG9cclxuICAgICAgICAgICAgPyB0aGlzLmxldmVsUmVjb3Jkc1tvXS5yZXNCbG9vZCA8IGUgJiYgKHRoaXMubGV2ZWxSZWNvcmRzW29dLnJlc0Jsb29kID0gZSlcclxuICAgICAgICAgICAgOiB0aGlzLmxldmVsUmVjb3Jkcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgbGV2ZWw6IHQsXHJcbiAgICAgICAgICAgICAgICAgIHJlc0Jsb29kOiBlLFxyXG4gICAgICAgICAgICAgICAgICB0aW1lOiBpLFxyXG4gICAgICAgICAgICAgICAgICBnYWluQm94SW5kZXg6IC0xXHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgJHN0b3JhZ2VVdGlsLlN0b3JhZ2VVdGlsLnNldEl0ZW0oJGxvY2FsTmFtZS5kZWZhdWx0LkxFVkVMX1JFQ09SRCwgdGhpcy5sZXZlbFJlY29yZHMpO1xyXG4gICAgfTtcclxuICAgIHQucHJvdG90eXBlLmdldFJlY29yZCA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgdGhpcy5sZXZlbFJlY29yZHMuZmluZChmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGUubGV2ZWwgPT09IHQ7XHJcbiAgICAgICAgICAgIH0pIHx8IHtcclxuICAgICAgICAgICAgICAgIGxldmVsOiB0LFxyXG4gICAgICAgICAgICAgICAgcmVzQmxvb2Q6IC0xLFxyXG4gICAgICAgICAgICAgICAgdGltZTogMCxcclxuICAgICAgICAgICAgICAgIGdhaW5Cb3hJbmRleDogLTFcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcbiAgICB9O1xyXG4gICAgdC5wcm90b3R5cGUuZ2V0TGFzdFJlY29yZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgdCA9IG51bGw7XHJcbiAgICAgICAgZm9yICh2YXIgZSA9IHRoaXMubGV2ZWxSZWNvcmRzLmxlbmd0aCAtIDE7IGUgPj0gMDsgZS0tKSB7XHJcbiAgICAgICAgICAgIHZhciBpID0gdGhpcy5sZXZlbFJlY29yZHNbZV07XHJcbiAgICAgICAgICAgIGlmIChpLnJlc0Jsb29kID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdCA9IGk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodCkge1xyXG4gICAgICAgICAgICBpZiAoIShNYXRoLmFicyh0LmxldmVsIC0gdGhpcy5sZXZlbFJlY29yZHMubGVuZ3RoKSA+IDEwKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJHVJTWFuYWdlci5VSU1hbmFnZXIuaW5zdGFuY2Uuc2hvd1RvYXN0KFwi5qOA5rWL5Yiw5YWz5Y2h5pWw5o2u5byC5bi4XCIpO1xyXG4gICAgICAgICAgICB2YXIgbyA9IDE7XHJcbiAgICAgICAgICAgIHZhciBzID0gW107XHJcbiAgICAgICAgICAgIGZvciAoZSA9IDA7IGUgPCB0aGlzLmxldmVsUmVjb3Jkcy5sZW5ndGg7IGUrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHIgPSB0aGlzLmxldmVsUmVjb3Jkc1tlXTtcclxuICAgICAgICAgICAgICAgIGlmIChyLmxldmVsID09PSBvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWw6IG8sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc0Jsb29kOiByLnJlc0Jsb29kLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lOiByLnRpbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhaW5Cb3hJbmRleDogci5nYWluQm94SW5kZXhcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBvKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5sZXZlbFJlY29yZHMgPSBzO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBsZXZlbDogMCxcclxuICAgICAgICAgICAgcmVzQmxvb2Q6IC0xLFxyXG4gICAgICAgICAgICB0aW1lOiAwLFxyXG4gICAgICAgICAgICBnYWluQm94SW5kZXg6IC0xXHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5ib3hTdGF0dXMgPSBmdW5jdGlvbiAodCwgZSkge1xyXG4gICAgICAgIHZhciBpID0gdGhpcy5nZXRSZWNvcmQodCk7XHJcbiAgICAgICAgcmV0dXJuIGkucmVzQmxvb2QgPD0gMFxyXG4gICAgICAgICAgICA/IDBcclxuICAgICAgICAgICAgOiBpLmdhaW5Cb3hJbmRleCA8IGUgJiYgaS5yZXNCbG9vZCA+IDAgJiYgaS5yZXNCbG9vZCA+PSB0aGlzLmJzW2VdXHJcbiAgICAgICAgICAgID8gMVxyXG4gICAgICAgICAgICA6IGkuZ2FpbkJveEluZGV4ID49IGVcclxuICAgICAgICAgICAgPyAyXHJcbiAgICAgICAgICAgIDogMDtcclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5pc0dhaW5Cb3ggPSBmdW5jdGlvbiAodCwgZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFJlY29yZCh0KS5nYWluQm94SW5kZXggPj0gZTtcclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5jYW5QYXNzQm94SW5kZXggPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciBlID0gdGhpcy5nZXRSZWNvcmQodCk7XHJcbiAgICAgICAgcmV0dXJuIGUucmVzQmxvb2QgPiAwICYmIGUuZ2FpbkJveEluZGV4IDwgMFxyXG4gICAgICAgICAgICA/IDBcclxuICAgICAgICAgICAgOiBlLnJlc0Jsb29kID49IDAuNSAmJiBlLmdhaW5Cb3hJbmRleCA8IDFcclxuICAgICAgICAgICAgPyAxXHJcbiAgICAgICAgICAgIDogZS5yZXNCbG9vZCA+PSAxICYmIGUuZ2FpbkJveEluZGV4IDwgMlxyXG4gICAgICAgICAgICA/IDJcclxuICAgICAgICAgICAgOiAtMTtcclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5vcGVuQm94ID0gZnVuY3Rpb24gKHQsIGUpIHtcclxuICAgICAgICB2YXIgaSA9IFtdO1xyXG4gICAgICAgIHRoaXMuZ2V0UmVjb3JkKHQpLmdhaW5Cb3hJbmRleCA9IGU7XHJcbiAgICAgICAgJHN0b3JhZ2VVdGlsLlN0b3JhZ2VVdGlsLnNldEl0ZW0oJGxvY2FsTmFtZS5kZWZhdWx0LkxFVkVMX1JFQ09SRCwgdGhpcy5sZXZlbFJlY29yZHMpO1xyXG4gICAgICAgIHZhciBuID0gJGNvbmZpZ0NvbnRleHQuZGVmYXVsdC5pbnN0YW5jZS5nZXRDb25maWdCeUxldmVsKHQpO1xyXG4gICAgICAgIHZhciBmID0gbi5UcmVhc3VyZUNoZXN0dHlwZVtlXTtcclxuICAgICAgICB2YXIgaCA9IG4uVHJlYXN1cmVDaGVzdF9udW1bZV07XHJcbiAgICAgICAgZm9yICh2YXIgbSA9IDA7IG0gPCBmLmxlbmd0aDsgbSsrKSB7XHJcbiAgICAgICAgICAgIGlmICgxID09PSBmW21dKSB7XHJcbiAgICAgICAgICAgICAgICBpLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgbnVtOiBoW21dXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICR1c2VyRGF0YUNvbnRleHQuZGVmYXVsdC5JbnMub3BlYXJDb2luKGhbbV0pO1xyXG4gICAgICAgICAgICAgICAgJGV2ZW50TWFuYWdlci5kZWZhdWx0LnNlbmQoJGxvY2FsRXZlbnROYW1lLmRlZmF1bHQuUkVOREVSX0RPVCwgJHN0YXJ0Vmlldy5NZW51VHlwZS5BTEwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICgzID09PSBmW21dKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgeSA9ICRzZWVkVXRpbC5kZWZhdWx0LnJhbmRvbUZyb20oMSwgMik7XHJcbiAgICAgICAgICAgICAgICB5ID0gTWF0aC5taW4oeSwgaFttXSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZyA9ICRzZWVkVXRpbC5kZWZhdWx0LnJhbmRvbUNvdW50KDEsIDYsIHkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIF8gPSAkc2VlZFV0aWwuZGVmYXVsdC5zcGxpdE51bWJlcihoW21dLCB5KTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgeTsgaysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaS5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogMyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXh0OiBnW2tdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBudW06IF9ba11cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAkdXNlckRhdGFDb250ZXh0LmRlZmF1bHQuSW5zLm9wZWFyRXF1aXBCb29rKGdba10sIF9ba10pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJGV2ZW50TWFuYWdlci5kZWZhdWx0LnNlbmQoJGxvY2FsRXZlbnROYW1lLmRlZmF1bHQuUkVOREVSX0RPVCwgJHN0YXJ0Vmlldy5NZW51VHlwZS5Sb2xlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoNCA9PT0gZlttXSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHYgPSAkc2VlZFV0aWwuZGVmYXVsdC5yYW5kb21Gcm9tKDEsIDQpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGIgPSAkc2tpbGxDb250ZXh0LmRlZmF1bHQuSW5zLmdldFVzZVNraWxsSWRzKCk7XHJcbiAgICAgICAgICAgICAgICB2ID0gTWF0aC5taW4oYi5sZW5ndGgsIHYpO1xyXG4gICAgICAgICAgICAgICAgYiA9ICRzZWVkVXRpbC5kZWZhdWx0LnJhbmRvbUFycihiLCB2KTtcclxuICAgICAgICAgICAgICAgIHZhciB3ID0gJHNlZWRVdGlsLmRlZmF1bHQuc3BsaXROdW1iZXIoaFttXSwgdik7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBBID0gMDsgQSA8IHY7IEErKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGkucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IDQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4dDogYltBXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtOiB3W0FdXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHVzZXJEYXRhQ29udGV4dC5kZWZhdWx0Lklucy5vcGVhclNraWxsQm9vayhiW0FdLCB3W0FdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRldmVudE1hbmFnZXIuZGVmYXVsdC5zZW5kKCRsb2NhbEV2ZW50TmFtZS5kZWZhdWx0LlJFTkRFUl9ET1QsICRzdGFydFZpZXcuTWVudVR5cGUuU2tpbGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICg2ID09PSBmW21dKSB7XHJcbiAgICAgICAgICAgICAgICBpLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IDYsXHJcbiAgICAgICAgICAgICAgICAgICAgbnVtOiBoW21dXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICR1c2VyRGF0YUNvbnRleHQuZGVmYXVsdC5JbnMub3BlYXJEaWFtb25kKGhbbV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiB0O1xyXG59KSgpO1xyXG5leHBvcnRzLmRlZmF1bHQgPSBmO1xyXG4iXX0=