
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/ShopView.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '0c5b1UEiiBBxIN2qARvUwM0', 'ShopView');
// game_script/scripts/ShopView.js

"use strict";

var o;

var $eventManager = require("./EventManager");

var $uIManager = require("./UIManager");

var $platform = require("./Platform");

var $remoteAudio = require("./RemoteAudio");

var $configContext = require("./ConfigContext");

var $localEventName = require("./LocalEventName");

var $shopContext = require("./ShopContext");

var $itemView = require("./ItemView");

var $startView = require("./StartView");

var m = cc._decorator;
var y = m.ccclass;
var g = m.property;

var _ = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.boxItem = null;
    e.resItem = null;
    e.diamondItem = null;
    e.btnLayer = null;
    e.redDotLayer = null;
    e.currItemIndex = 0;
    return e;
  }

  __extends(e, t);

  e.prototype.start = function () {
    $eventManager["default"].on($localEventName["default"].RENDER_DOT, this.renderDot, this);

    for (var t = 0; t < this.btnLayer.children.length; t++) {
      this.btnLayer.children[t].on("click", this.clickItem, this);
    }

    this.renderItems();
    this.renderDot($startView.MenuType.ALL);
  };

  e.prototype.reuse = function () {
    $eventManager["default"].on($localEventName["default"].RENDER_DOT, this.renderDot, this);
    this.renderItems();
    this.renderDot($startView.MenuType.ALL);
  };

  e.prototype.unuse = function () {
    $eventManager["default"].off($localEventName["default"].RENDER_DOT, this.renderDot, this);
  };

  e.prototype.onDestroy = function () {
    $eventManager["default"].off($localEventName["default"].RENDER_DOT, this.renderDot, this);
  };

  e.prototype.renderDot = function (t) {
    if (!(t !== $startView.MenuType.Battle && t !== $startView.MenuType.ALL)) {
      this.redDotLayer.children[0].active = !1;
      this.redDotLayer.children[1].active = $shopContext["default"].Ins.hasResRedDot();
      this.redDotLayer.children[2].active = $shopContext["default"].Ins.hasDiamondRedDot();
    }
  };

  e.prototype.clickItem = function (t) {
    var e = this.btnLayer.children.indexOf(t.node);
    var i = "";
    $platform.Platform.currPlatForm === $platform.PlatformEnum.TOU_TIAO ? i = "tt_open_shop_diamond" : $platform.Platform.currPlatForm === $platform.PlatformEnum.WECHAT && (i = "wx_open_shop_diamond");
    2 !== e || "" === i || $configContext["default"].instance.getAdSwitch(i) ? e !== this.currItemIndex && ($remoteAudio["default"].instance.playEffectMusic("Click"), this.currItemIndex = e, this.renderItems()) : $uIManager.UIManager.instance.showToast("敬请期待");
  };

  e.prototype.renderItems = function () {
    var t = "";
    $platform.Platform.currPlatForm === $platform.PlatformEnum.TOU_TIAO ? t = "tt_open_shop_diamond" : $platform.Platform.currPlatForm === $platform.PlatformEnum.WECHAT && (t = "wx_open_shop_diamond");

    if (2 !== this.currItemIndex || "" === t || $configContext["default"].instance.getAdSwitch(t)) {
      for (var e = 0; e < this.btnLayer.children.length; e++) {
        this.btnLayer.children[e].opacity = this.currItemIndex === e ? 255 : 0;
      }

      this.boxItem.active = 0 === this.currItemIndex;
      this.resItem.active = 1 === this.currItemIndex;
      this.diamondItem.active = 2 === this.currItemIndex;
    } else {
      $uIManager.UIManager.instance.showToast("敬请期待");
    }
  };

  __decorate([g(cc.Node)], e.prototype, "boxItem", void 0);

  __decorate([g(cc.Node)], e.prototype, "resItem", void 0);

  __decorate([g(cc.Node)], e.prototype, "diamondItem", void 0);

  __decorate([g(cc.Node)], e.prototype, "btnLayer", void 0);

  __decorate([g(cc.Node)], e.prototype, "redDotLayer", void 0);

  return __decorate([y], e);
}($itemView["default"]);

exports["default"] = _;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXFNob3BWaWV3LmpzIl0sIm5hbWVzIjpbIm8iLCIkZXZlbnRNYW5hZ2VyIiwicmVxdWlyZSIsIiR1SU1hbmFnZXIiLCIkcGxhdGZvcm0iLCIkcmVtb3RlQXVkaW8iLCIkY29uZmlnQ29udGV4dCIsIiRsb2NhbEV2ZW50TmFtZSIsIiRzaG9wQ29udGV4dCIsIiRpdGVtVmlldyIsIiRzdGFydFZpZXciLCJtIiwiY2MiLCJfZGVjb3JhdG9yIiwieSIsImNjY2xhc3MiLCJnIiwicHJvcGVydHkiLCJfIiwidCIsImUiLCJhcHBseSIsImFyZ3VtZW50cyIsImJveEl0ZW0iLCJyZXNJdGVtIiwiZGlhbW9uZEl0ZW0iLCJidG5MYXllciIsInJlZERvdExheWVyIiwiY3Vyckl0ZW1JbmRleCIsIl9fZXh0ZW5kcyIsInByb3RvdHlwZSIsInN0YXJ0Iiwib24iLCJSRU5ERVJfRE9UIiwicmVuZGVyRG90IiwiY2hpbGRyZW4iLCJsZW5ndGgiLCJjbGlja0l0ZW0iLCJyZW5kZXJJdGVtcyIsIk1lbnVUeXBlIiwiQUxMIiwicmV1c2UiLCJ1bnVzZSIsIm9mZiIsIm9uRGVzdHJveSIsIkJhdHRsZSIsImFjdGl2ZSIsIklucyIsImhhc1Jlc1JlZERvdCIsImhhc0RpYW1vbmRSZWREb3QiLCJpbmRleE9mIiwibm9kZSIsImkiLCJQbGF0Zm9ybSIsImN1cnJQbGF0Rm9ybSIsIlBsYXRmb3JtRW51bSIsIlRPVV9USUFPIiwiV0VDSEFUIiwiaW5zdGFuY2UiLCJnZXRBZFN3aXRjaCIsInBsYXlFZmZlY3RNdXNpYyIsIlVJTWFuYWdlciIsInNob3dUb2FzdCIsIm9wYWNpdHkiLCJfX2RlY29yYXRlIiwiTm9kZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsQ0FBSjs7QUFDQSxJQUFJQyxhQUFhLEdBQUdDLE9BQU8sQ0FBQyxnQkFBRCxDQUEzQjs7QUFDQSxJQUFJQyxVQUFVLEdBQUdE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QUNILENBdkVPLENBdUVMWCxTQUFTLFdBdkVKLENBQVI7O0FBd0VBeUQsT0FBTyxXQUFQLEdBQWtCaEQsQ0FBbEIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBvO1xyXG52YXIgJGV2ZW50TWFuYWdlciA9IHJlcXVpcmUoXCIuL0V2ZW50TWFuYWdlclwiKTtcclxudmFyICR1SU1hbmFnZXIgPSByZXF1aXJlKFwiLi9VSU1hbmFnZXJcIik7XHJcbnZhciAkcGxhdGZvcm0gPSByZXF1aXJlKFwiLi9QbGF0Zm9ybVwiKTtcclxudmFyICRyZW1vdGVBdWRpbyA9IHJlcXVpcmUoXCIuL1JlbW90ZUF1ZGlvXCIpO1xyXG52YXIgJGNvbmZpZ0NvbnRleHQgPSByZXF1aXJlKFwiLi9Db25maWdDb250ZXh0XCIpO1xyXG52YXIgJGxvY2FsRXZlbnROYW1lID0gcmVxdWlyZShcIi4vTG9jYWxFdmVudE5hbWVcIik7XHJcbnZhciAkc2hvcENvbnRleHQgPSByZXF1aXJlKFwiLi9TaG9wQ29udGV4dFwiKTtcclxudmFyICRpdGVtVmlldyA9IHJlcXVpcmUoXCIuL0l0ZW1WaWV3XCIpO1xyXG52YXIgJHN0YXJ0VmlldyA9IHJlcXVpcmUoXCIuL1N0YXJ0Vmlld1wiKTtcclxudmFyIG0gPSBjYy5fZGVjb3JhdG9yO1xyXG52YXIgeSA9IG0uY2NjbGFzcztcclxudmFyIGcgPSBtLnByb3BlcnR5O1xyXG52YXIgXyA9IChmdW5jdGlvbiAodCkge1xyXG4gICAgZnVuY3Rpb24gZSgpIHtcclxuICAgICAgICB2YXIgZSA9IChudWxsICE9PSB0ICYmIHQuYXBwbHkodGhpcywgYXJndW1lbnRzKSkgfHwgdGhpcztcclxuICAgICAgICBlLmJveEl0ZW0gPSBudWxsO1xyXG4gICAgICAgIGUucmVzSXRlbSA9IG51bGw7XHJcbiAgICAgICAgZS5kaWFtb25kSXRlbSA9IG51bGw7XHJcbiAgICAgICAgZS5idG5MYXllciA9IG51bGw7XHJcbiAgICAgICAgZS5yZWREb3RMYXllciA9IG51bGw7XHJcbiAgICAgICAgZS5jdXJySXRlbUluZGV4ID0gMDtcclxuICAgICAgICByZXR1cm4gZTtcclxuICAgIH1cclxuICAgIF9fZXh0ZW5kcyhlLCB0KTtcclxuICAgIGUucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICRldmVudE1hbmFnZXIuZGVmYXVsdC5vbigkbG9jYWxFdmVudE5hbWUuZGVmYXVsdC5SRU5ERVJfRE9ULCB0aGlzLnJlbmRlckRvdCwgdGhpcyk7XHJcbiAgICAgICAgZm9yICh2YXIgdCA9IDA7IHQgPCB0aGlzLmJ0bkxheWVyLmNoaWxkcmVuLmxlbmd0aDsgdCsrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYnRuTGF5ZXIuY2hpbGRyZW5bdF0ub24oXCJjbGlja1wiLCB0aGlzLmNsaWNrSXRlbSwgdGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVuZGVySXRlbXMoKTtcclxuICAgICAgICB0aGlzLnJlbmRlckRvdCgkc3RhcnRWaWV3Lk1lbnVUeXBlLkFMTCk7XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUucmV1c2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJGV2ZW50TWFuYWdlci5kZWZhdWx0Lm9uKCRsb2NhbEV2ZW50TmFtZS5kZWZhdWx0LlJFTkRFUl9ET1QsIHRoaXMucmVuZGVyRG90LCB0aGlzKTtcclxuICAgICAgICB0aGlzLnJlbmRlckl0ZW1zKCk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJEb3QoJHN0YXJ0Vmlldy5NZW51VHlwZS5BTEwpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnVudXNlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICRldmVudE1hbmFnZXIuZGVmYXVsdC5vZmYoJGxvY2FsRXZlbnROYW1lLmRlZmF1bHQuUkVOREVSX0RPVCwgdGhpcy5yZW5kZXJEb3QsIHRoaXMpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLm9uRGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkZXZlbnRNYW5hZ2VyLmRlZmF1bHQub2ZmKCRsb2NhbEV2ZW50TmFtZS5kZWZhdWx0LlJFTkRFUl9ET1QsIHRoaXMucmVuZGVyRG90LCB0aGlzKTtcclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5yZW5kZXJEb3QgPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIGlmICghKHQgIT09ICRzdGFydFZpZXcuTWVudVR5cGUuQmF0dGxlICYmIHQgIT09ICRzdGFydFZpZXcuTWVudVR5cGUuQUxMKSkge1xyXG4gICAgICAgICAgICB0aGlzLnJlZERvdExheWVyLmNoaWxkcmVuWzBdLmFjdGl2ZSA9ICExO1xyXG4gICAgICAgICAgICB0aGlzLnJlZERvdExheWVyLmNoaWxkcmVuWzFdLmFjdGl2ZSA9ICRzaG9wQ29udGV4dC5kZWZhdWx0Lklucy5oYXNSZXNSZWREb3QoKTtcclxuICAgICAgICAgICAgdGhpcy5yZWREb3RMYXllci5jaGlsZHJlblsyXS5hY3RpdmUgPSAkc2hvcENvbnRleHQuZGVmYXVsdC5JbnMuaGFzRGlhbW9uZFJlZERvdCgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5jbGlja0l0ZW0gPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciBlID0gdGhpcy5idG5MYXllci5jaGlsZHJlbi5pbmRleE9mKHQubm9kZSk7XHJcbiAgICAgICAgdmFyIGkgPSBcIlwiO1xyXG4gICAgICAgICRwbGF0Zm9ybS5QbGF0Zm9ybS5jdXJyUGxhdEZvcm0gPT09ICRwbGF0Zm9ybS5QbGF0Zm9ybUVudW0uVE9VX1RJQU9cclxuICAgICAgICAgICAgPyAoaSA9IFwidHRfb3Blbl9zaG9wX2RpYW1vbmRcIilcclxuICAgICAgICAgICAgOiAkcGxhdGZvcm0uUGxhdGZvcm0uY3VyclBsYXRGb3JtID09PSAkcGxhdGZvcm0uUGxhdGZvcm1FbnVtLldFQ0hBVCAmJiAoaSA9IFwid3hfb3Blbl9zaG9wX2RpYW1vbmRcIik7XHJcbiAgICAgICAgMiAhPT0gZSB8fCBcIlwiID09PSBpIHx8ICRjb25maWdDb250ZXh0LmRlZmF1bHQuaW5zdGFuY2UuZ2V0QWRTd2l0Y2goaSlcclxuICAgICAgICAgICAgPyBlICE9PSB0aGlzLmN1cnJJdGVtSW5kZXggJiZcclxuICAgICAgICAgICAgICAoJHJlbW90ZUF1ZGlvLmRlZmF1bHQuaW5zdGFuY2UucGxheUVmZmVjdE11c2ljKFwiQ2xpY2tcIiksICh0aGlzLmN1cnJJdGVtSW5kZXggPSBlKSwgdGhpcy5yZW5kZXJJdGVtcygpKVxyXG4gICAgICAgICAgICA6ICR1SU1hbmFnZXIuVUlNYW5hZ2VyLmluc3RhbmNlLnNob3dUb2FzdChcIuaVrOivt+acn+W+hVwiKTtcclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5yZW5kZXJJdGVtcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgdCA9IFwiXCI7XHJcbiAgICAgICAgJHBsYXRmb3JtLlBsYXRmb3JtLmN1cnJQbGF0Rm9ybSA9PT0gJHBsYXRmb3JtLlBsYXRmb3JtRW51bS5UT1VfVElBT1xyXG4gICAgICAgICAgICA/ICh0ID0gXCJ0dF9vcGVuX3Nob3BfZGlhbW9uZFwiKVxyXG4gICAgICAgICAgICA6ICRwbGF0Zm9ybS5QbGF0Zm9ybS5jdXJyUGxhdEZvcm0gPT09ICRwbGF0Zm9ybS5QbGF0Zm9ybUVudW0uV0VDSEFUICYmICh0ID0gXCJ3eF9vcGVuX3Nob3BfZGlhbW9uZFwiKTtcclxuICAgICAgICBpZiAoMiAhPT0gdGhpcy5jdXJySXRlbUluZGV4IHx8IFwiXCIgPT09IHQgfHwgJGNvbmZpZ0NvbnRleHQuZGVmYXVsdC5pbnN0YW5jZS5nZXRBZFN3aXRjaCh0KSkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBlID0gMDsgZSA8IHRoaXMuYnRuTGF5ZXIuY2hpbGRyZW4ubGVuZ3RoOyBlKyspIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYnRuTGF5ZXIuY2hpbGRyZW5bZV0ub3BhY2l0eSA9IHRoaXMuY3Vyckl0ZW1JbmRleCA9PT0gZSA/IDI1NSA6IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5ib3hJdGVtLmFjdGl2ZSA9IDAgPT09IHRoaXMuY3Vyckl0ZW1JbmRleDtcclxuICAgICAgICAgICAgdGhpcy5yZXNJdGVtLmFjdGl2ZSA9IDEgPT09IHRoaXMuY3Vyckl0ZW1JbmRleDtcclxuICAgICAgICAgICAgdGhpcy5kaWFtb25kSXRlbS5hY3RpdmUgPSAyID09PSB0aGlzLmN1cnJJdGVtSW5kZXg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJHVJTWFuYWdlci5VSU1hbmFnZXIuaW5zdGFuY2Uuc2hvd1RvYXN0KFwi5pWs6K+35pyf5b6FXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBfX2RlY29yYXRlKFtnKGNjLk5vZGUpXSwgZS5wcm90b3R5cGUsIFwiYm94SXRlbVwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbZyhjYy5Ob2RlKV0sIGUucHJvdG90eXBlLCBcInJlc0l0ZW1cIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW2coY2MuTm9kZSldLCBlLnByb3RvdHlwZSwgXCJkaWFtb25kSXRlbVwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbZyhjYy5Ob2RlKV0sIGUucHJvdG90eXBlLCBcImJ0bkxheWVyXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtnKGNjLk5vZGUpXSwgZS5wcm90b3R5cGUsIFwicmVkRG90TGF5ZXJcIiwgdm9pZCAwKTtcclxuICAgIHJldHVybiBfX2RlY29yYXRlKFt5XSwgZSk7XHJcbn0pKCRpdGVtVmlldy5kZWZhdWx0KTtcclxuZXhwb3J0cy5kZWZhdWx0ID0gXztcclxuIl19