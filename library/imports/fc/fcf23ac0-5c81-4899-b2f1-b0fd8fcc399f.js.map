{"version":3,"sources":["assets\\scripts\\auth\\LoginView.js"],"names":["Auth","require","cc","Class","Component","properties","edtEmail","EditBox","edtPass","btnLogin","Node","btnRegister","lblTips","Label","onLoad","_busy","string","on","onLogin","onRegister","_setBusy","b","_toast","msg","log","email","trim","pass","login","password","me","director","loadScene","message","register"],"mappings":"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","sourceRoot":"/","sourcesContent":["const Auth = require('./AuthService');\n\ncc.Class({\n  extends: cc.Component,\n  properties:{\n    edtEmail:    cc.EditBox,\n    edtPass:     cc.EditBox,\n    btnLogin:    cc.Node,\n    btnRegister: cc.Node,\n    lblTips:     cc.Label,\n  },\n  onLoad(){\n    this._busy = false;\n    if (this.lblTips) this.lblTips.string = '';\n    this.btnLogin    && this.btnLogin.on('click',    ()=>this.onLogin(), this);\n    this.btnRegister && this.btnRegister.on('click', ()=>this.onRegister(), this);\n  },\n  _setBusy(b){ this._busy = !!b; if(this.lblTips) this.lblTips.string = b ? '处理中...' : ''; },\n  _toast(msg){ if(this.lblTips) this.lblTips.string = msg; cc.log('[Login]', msg); },\n\n  async onLogin(){\n    if (this._busy) return;\n    const email = (this.edtEmail && this.edtEmail.string || '').trim();\n    const pass  = (this.edtPass  && this.edtPass.string  || '').trim();\n    if (!email || !pass) { this._toast('请输入邮箱与密码'); return; }\n    try{\n      this._setBusy(true);\n      await Auth.login({email, password: pass});\n      await Auth.me();\n      this._toast('登录成功，正在进入游戏...');\n      // 方案 A：LoadScriptScene 已加载资源包，直接进主场景\n      cc.director.loadScene('Main');\n      // 方案 B：如把 LoginScene 设为启动场景，请改用：\n      // cc.assetManager.loadBundle('game_script', (err, bundle)=>{\n      //   if (err){ this._toast('资源包加载失败:'+err.message); return; }\n      //   bundle.preloadScene('Main', ()=>cc.director.loadScene('Main'));\n      // });\n    }catch(e){\n      this._toast('登录失败：' + (e && e.message || ''));\n    }finally{\n      this._setBusy(false);\n    }\n  },\n\n  async onRegister(){\n    if (this._busy) return;\n    const email = (this.edtEmail && this.edtEmail.string || '').trim();\n    const pass  = (this.edtPass  && this.edtPass.string  || '').trim();\n    if (!email || !pass) { this._toast('请输入邮箱与密码'); return; }\n    try{\n      this._setBusy(true);\n      await Auth.register({email, password: pass});\n      this._toast('注册成功，请登录');\n    }catch(e){\n      this._toast('注册失败：' + (e && e.message || ''));\n    }finally{\n      this._setBusy(false);\n    }\n  },\n});\n"]}