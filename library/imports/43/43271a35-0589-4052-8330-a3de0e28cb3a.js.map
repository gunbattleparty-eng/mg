{"version":3,"sources":["assets\\game_script\\scripts\\RBullet_8.js"],"names":["o","$assetsLoader","require","$assetsMap","$resUtil","$globalParam","$gameContext","$gameSkillInfo","$baseBullet","f","cc","_decorator","h","ccclass","m","property","y","Vec3","g","t","e","apply","arguments","buttleType","BulletType","r_bullet_8","skin","status","leftTime","targetEnemy","findLeftTime","atkLeftTime","atkIntervalTime","pointNode","__extends","prototype","initButtle","speed","ins","skillInfo","robotParam","call","atk","Math","ceil","skillParam","skillAtk","Skill4Param","FINAL","node","zIndex","velocity","set","multiplyScalar","attack","off","dragonBones","EventObject","COMPLETE","playAnim","once","getPosition","removeDieCallback","createBullet","findTarget","animationName","getTarget","addDieCallback","targetDie","currEnemys","length","i","abs","position","push","sort","residueDis","findPath","x","z","normalizeSelf","setPosition","mulSelf","add","updateFrame","isGamePuase","removeSelf","updateStatus","timeScale","gameRatio","playAnimation","getButtlePool","r_bullet_8_1","instance","getRes","BundleNames","Game","AssetsMap","GameBundles","prefabs","assetsList","RBullet_8_1","ResUtil","instantiate","robotFlyLayer","parent","getComponent","clone","insert","__decorate","ArmatureDisplay","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var o;\r\nvar $assetsLoader = require(\"./AssetsLoader\");\r\nvar $assetsMap = require(\"./AssetsMap\");\r\nvar $resUtil = require(\"./ResUtil\");\r\nvar $globalParam = require(\"./GlobalParam\");\r\nvar $gameContext = require(\"./GameContext\");\r\nvar $gameSkillInfo = require(\"./GameSkillInfo\");\r\nvar $baseBullet = require(\"./BaseBullet\");\r\nvar f = cc._decorator;\r\nvar h = f.ccclass;\r\nvar m = f.property;\r\nvar y = new cc.Vec3();\r\nvar g = (function (t) {\r\n    function e() {\r\n        var e = (null !== t && t.apply(this, arguments)) || this;\r\n        e.buttleType = $baseBullet.BulletType.r_bullet_8;\r\n        e.skin = null;\r\n        e.status = 0;\r\n        e.leftTime = 0;\r\n        e.targetEnemy = null;\r\n        e.findLeftTime = 0;\r\n        e.atkLeftTime = 0;\r\n        e.atkIntervalTime = 1;\r\n        e.pointNode = null;\r\n        return e;\r\n    }\r\n    __extends(e, t);\r\n    e.prototype.initButtle = function (e) {\r\n        this.targetEnemy = null;\r\n        this.speed = $gameContext.default.ins.skillInfo.robotParam[3];\r\n        this.atkIntervalTime = $gameContext.default.ins.skillInfo.robotParam[4];\r\n        this.leftTime = $gameContext.default.ins.skillInfo.robotParam[5];\r\n        t.prototype.initButtle.call(this, e, null);\r\n        this.atk = Math.ceil(\r\n            $gameContext.default.ins.skillInfo.robotParam[0] *\r\n                this.skillParam.skillAtk[$gameSkillInfo.Skill4Param.FINAL]\r\n        );\r\n        this.status = 0;\r\n        this.node.zIndex = 10;\r\n        if (e) {\r\n            this.velocity.set(e).multiplyScalar(this.speed);\r\n        }\r\n    };\r\n    e.prototype.attack = function (t) {\r\n        var e = this;\r\n        this.atkLeftTime -= t;\r\n        if (!(this.atkLeftTime > 0)) {\r\n            this.atkLeftTime = 1;\r\n            this.skin.off(dragonBones.EventObject.COMPLETE);\r\n            this.playAnim(\"hit\", 1);\r\n            this.skin.once(\r\n                dragonBones.EventObject.COMPLETE,\r\n                function () {\r\n                    e.atkLeftTime = e.atkIntervalTime;\r\n                    e.playAnim(\"stand_2\", 0);\r\n                    e.targetEnemy.getPosition().y < -250\r\n                        ? (e.targetEnemy.removeDieCallback(e), (e.status = 0))\r\n                        : 0 !== e.status && (e.status = 1);\r\n                },\r\n                this\r\n            );\r\n            this.createBullet();\r\n        }\r\n    };\r\n    e.prototype.findTarget = function (t) {\r\n        if (\"stand_2\" !== this.skin.animationName) {\r\n            this.skin.off(dragonBones.EventObject.COMPLETE);\r\n            this.playAnim(\"stand_2\", 0);\r\n        }\r\n        this.findLeftTime -= t;\r\n        if (this.findLeftTime <= 0) {\r\n            this.findLeftTime = 1;\r\n            var e = this.getTarget();\r\n            if (e) {\r\n                this.targetEnemy = e;\r\n                this.targetEnemy.addDieCallback(this.targetDie, this);\r\n                this.status = 1;\r\n            }\r\n        }\r\n    };\r\n    e.prototype.getTarget = function () {\r\n        var t = [];\r\n        for (var e = 0; e < $gameContext.default.ins.currEnemys.length; e++) {\r\n            var i = $gameContext.default.ins.currEnemys[e];\r\n            if (\r\n                i &&\r\n                i.getPosition().y >= -250 &&\r\n                Math.abs(i.getPosition().y - this.pointNode.position.y) <\r\n                    $gameContext.default.ins.skillInfo.robotParam[2]\r\n            ) {\r\n                t.push(i);\r\n            }\r\n        }\r\n        return t.length < 0\r\n            ? null\r\n            : (t.sort(function (t, e) {\r\n                  return t.residueDis - e.residueDis;\r\n              }),\r\n              t[0]);\r\n    };\r\n    e.prototype.findPath = function (t) {\r\n        y.x = this.targetEnemy.getPosition().x - this.node.position.x;\r\n        y.y = this.targetEnemy.getPosition().y - this.node.position.y - 100;\r\n        y.z = 0;\r\n        y.normalizeSelf();\r\n        Math.abs(this.targetEnemy.getPosition().x - this.node.position.x) <= 30 &&\r\n        Math.abs(this.targetEnemy.getPosition().y - this.node.position.y - 100) <= 30\r\n            ? 0 !== this.status && (this.status = 2)\r\n            : (\"stand_2\" !== this.skin.animationName &&\r\n                  (this.skin.off(dragonBones.EventObject.COMPLETE), this.playAnim(\"stand_2\", 0)),\r\n              this.setPosition(y.mulSelf(this.speed * t).add(this.getPosition())));\r\n    };\r\n    e.prototype.targetDie = function () {\r\n        this.status = 0;\r\n    };\r\n    e.prototype.updateFrame = function (t) {\r\n        if (!($globalParam.default.isGamePuase || this.leftTime <= 0)) {\r\n            this.leftTime -= t;\r\n            this.leftTime <= 0 ? this.removeSelf() : this.updateStatus(t);\r\n        }\r\n    };\r\n    e.prototype.updateStatus = function (t) {\r\n        0 === this.status\r\n            ? this.findTarget(t)\r\n            : 1 === this.status\r\n            ? this.findPath(t)\r\n            : 2 === this.status && this.attack(t);\r\n    };\r\n    e.prototype.playAnim = function (t, e) {\r\n        this.skin.timeScale = $gameContext.default.ins.gameRatio;\r\n        this.skin.playAnimation(t, e);\r\n    };\r\n    e.prototype.createBullet = function () {\r\n        var t = $gameContext.default.ins.getButtlePool($baseBullet.BulletType.r_bullet_8_1);\r\n        if (!t) {\r\n            var e = $assetsLoader.default.instance.getRes(\r\n                $assetsMap.BundleNames.Game,\r\n                $assetsMap.AssetsMap.GameBundles.prefabs.assetsList.RBullet_8_1\r\n            );\r\n            t = $resUtil.ResUtil.instantiate(e, $gameContext.default.ins.robotFlyLayer.parent).getComponent(\r\n                $baseBullet.default\r\n            );\r\n        }\r\n        t.setPosition(this.node.position.clone());\r\n        y.x = 0;\r\n        y.y = 1;\r\n        t.initButtle(y, null);\r\n        t.insert($gameContext.default.ins.robotFlyLayer);\r\n    };\r\n    __decorate([m(dragonBones.ArmatureDisplay)], e.prototype, \"skin\", void 0);\r\n    return __decorate([h], e);\r\n})($baseBullet.default);\r\nexports.default = g;\r\n"]}