
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/GameUI.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '8dbc6fZ2/1CAoQ04x/TLhtX', 'GameUI');
// game_script/scripts/GameUI.js

"use strict";

var o;

var $assetsLoader = require("./AssetsLoader");

var $assetsMap = require("./AssetsMap");

var $resUtil = require("./ResUtil");

var $eventManager = require("./EventManager");

var $battleContext = require("./BattleContext");

var $configContext = require("./ConfigContext");

var $localEventName = require("./LocalEventName");

var $gameContext = require("./GameContext");

var $gameSkillInfo = require("./GameSkillInfo");

var m = cc._decorator;
var y = m.ccclass;
var g = m.property;

var _ = cc.size(0, 0);

var k = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.progressBar = null;
    e.progressLable = null;
    e.gradeLable = null;
    e.braAnims = null;
    e.completedNode = null;
    e.cdLayer = null;
    e.levelLabel = null;
    e.showRangeLayer = null;
    e.currLevel = 1;
    e.upgradeAniming = !1;
    e.currIndex = 1;
    e.cdRecord = new Map();
    e.graphics = null;
    return e;
  }

  __extends(e, t);

  e.prototype.start = function () {
    this.graphics = this.showRangeLayer.getComponent(cc.Graphics);
    this.levelLabel.string = "第" + $battleContext["default"].Ins.currLevel + "关";
    this.cdRecord.set(1, 0);
    $eventManager["default"].on($localEventName["default"].ADD_SKILL_CD, this.renderSkillInfo, this);
    $eventManager["default"].on($localEventName["default"].RENDER_SKILL_CD_INFO, this.renderSkillCDInfo, this);

    for (var t = 0; t < this.cdLayer.children.length; t++) {
      this.cdLayer.children[t].on(cc.Node.EventType.TOUCH_START, this.touchCD, this);
      this.cdLayer.children[t].on(cc.Node.EventType.TOUCH_END, this.endCD, this);
    }
  };

  e.prototype.onDestroy = function () {
    $eventManager["default"].off($localEventName["default"].ADD_SKILL_CD, this.renderSkillInfo, this);
    $eventManager["default"].off($localEventName["default"].RENDER_SKILL_CD_INFO, this.renderSkillCDInfo, this);
  };

  e.prototype.touchCD = function (t) {
    var e = this.cdLayer.children.indexOf(t.target);
    var i = -1;
    this.cdRecord.forEach(function (t, o) {
      if (t === e) {
        i = o;
      }
    });

    if (-1 !== i) {
      _.height = $gameContext["default"].ins.skillInfo.getSkillById(i).skillAtkRange[$gameSkillInfo.Skill4Param.FINAL];
      this.graphics.clear();
      this.graphics.circle(0, 0, _.height);
      this.graphics.stroke();
      this.graphics.fill();
      this.showRangeLayer.active = !0;
      this.showRangeLayer.setContentSize(_);
    }
  };

  e.prototype.endCD = function () {
    this.showRangeLayer.active = !1;
  };

  e.prototype.renderSkillCDInfo = function (t, e, i) {
    if (this.cdRecord.has(t)) {
      if (!this.skillParam) {
        this.skillParam = $gameContext["default"].ins.skillInfo.getSkillById(1);
      }

      var o = this.cdRecord.get(t);
      var n = this.cdLayer.children[o];
      1 === t ? (-1 !== i && (n.children[2].getComponent(cc.Label).string = i + "/" + this.skillParam.bulletCount), -1 !== e && (n.children[3].getComponent(cc.Sprite).fillRange = e)) : n.children[2].getComponent(cc.Sprite).fillRange = e;
    }
  };

  e.prototype.renderSkillInfo = function (t) {
    this.cdRecord.has(t) ? this.renderSkillCount(t) : this.addSkillInfo(t);
  };

  e.prototype.renderSkillCount = function (t) {
    var e = $gameContext["default"].ins.skillInfo.getChooseParendCount(t);
    var i = this.cdRecord.get(t);
    this.cdLayer.children[i].children[1].getComponent(cc.Label).string = e.toString();
  };

  e.prototype.addSkillInfo = function (t) {
    var e = this;

    if (!(1 === t || this.cdRecord.size > 5 || this.currIndex >= this.cdLayer.children.length)) {
      var i = $configContext["default"].instance.skillConfigsMap.get(t);
      var o = this.cdLayer.children[this.currIndex];
      var n = o.children[0].getComponent(cc.Sprite);
      $assetsLoader["default"].instance.loadRes($assetsMap.BundleNames.Public_Res, ["/cd_icon/" + i.icon], cc.SpriteFrame, null, function (t, i) {
        var o = i[0];

        if (o && cc.isValid(n)) {
          n.spriteFrame = $resUtil.ResUtil.assignWith(o, e.node);
        }
      });
      o.children[1].getComponent(cc.Label).string = "1";
      this.cdRecord.set(t, this.currIndex);
      this.currIndex++;
    }
  };

  e.prototype.update = function () {
    var t = this;

    if (!this.upgradeAniming) {
      if (this.currLevel !== $gameContext["default"].ins.currPlayerLevel) {
        this.upgradeAniming = !0;
        this.currLevel = $gameContext["default"].ins.currPlayerLevel;
        this.gradeLable.string = this.currLevel.toString();
        this.progressBar.fillRange = 1;
        var e = this.completedNode.getComponent(cc.Animation);
        e.node.active = !0;
        e.play("exp_anim");
        return void e.once(cc.Animation.EventType.FINISHED, function () {
          e.node.active = !1;
          t.upgradeAniming = !1;
        }, this);
      }

      var i = $gameContext["default"].ins.currExp / $gameContext["default"].ins.needExp();
      this.progressBar.fillRange = i;
      this.progressLable.string = $gameContext["default"].ins.currExp + " /" + $gameContext["default"].ins.needExp();
      _.width = 364 * i;
      this.braAnims.setContentSize(_);
    }
  };

  __decorate([g(cc.Sprite)], e.prototype, "progressBar", void 0);

  __decorate([g(cc.Label)], e.prototype, "progressLable", void 0);

  __decorate([g(cc.Label)], e.prototype, "gradeLable", void 0);

  __decorate([g(cc.Node)], e.prototype, "braAnims", void 0);

  __decorate([g(cc.Node)], e.prototype, "completedNode", void 0);

  __decorate([g(cc.Node)], e.prototype, "cdLayer", void 0);

  __decorate([g(cc.Label)], e.prototype, "levelLabel", void 0);

  __decorate([g(cc.Node)], e.prototype, "showRangeLayer", void 0);

  return __decorate([y], e);
}(cc.Component);

exports["default"] = k;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXEdhbWVVSS5qcyJdLCJuYW1lcyI6WyJvIiwiJGFzc2V0c0xvYWRlciIsInJlcXVpcmUiLCIkYXNzZXRzTWFwIiwiJHJlc1V0aWwiLCIkZXZlbnRNYW5hZ2VyIiwiJGJhdHRsZUNvbnRleHQiLCIkY29uZmlnQ29udGV4dCIsIiRsb2NhbEV2ZW50TmFtZSIsIiRnYW1lQ29udGV4dCIsIiRnYW1lU2tpbGxJbmZvIiwibSIsImNjIiwiX2RlY29yYXRvciIsInkiLCJjY2NsYXNzIiwiZyIsInByb3BlcnR5IiwiXyIsInNpemUiLCJrIiwidCIsImUiLCJhcHBseSIsImFyZ3VtZW50cyIsInByb2dyZXNzQmFyIiwicHJvZ3Jlc3NMYWJsZSIsImdyYWRlTGFibGUiLCJicmFBbmltcyIsImNvbXBsZXRlZE5vZGUiLCJjZExheWVyIiwibGV2ZWxMYWJlbCIsInNob3dSYW5nZUxheWVyIiwiY3VyckxldmVsIiwidXBncmFkZUFuaW1pbmciLCJjdXJySW5kZXgiLCJjZFJlY29yZCIsIk1hcCIsImdyYXBoaWNzIiwiX19leHRlbmRzIiwicHJvdG90eXBlIiwic3RhcnQiLCJnZXRDb21wb25lbnQiLCJHcmFwaGljcyIsInN0cmluZyIsIklucyIsInNldCIsIm9uIiwiQUREX1NLSUxMX0NEIiwicmVuZGVyU2tpbGxJbmZvIiwiUkVOREVSX1NLSUxMX0NEX0lORk8iLCJyZW5kZXJTa2lsbENESW5mbyIsImNoaWxkcmVuIiwibGVuZ3RoIiwiTm9kZSIsIkV2ZW50VHlwZSIsIlRPVUNIX1NUQVJUIiwidG91Y2hDRCIsIlRPVUNIX0VORCIsImVuZENEIiwib25EZXN0cm95Iiwib2ZmIiwiaW5kZXhPZiIsInRhcmdldCIsImkiLCJmb3JFYWNoIiwiaGVpZ2h0IiwiaW5zIiwic2tpbGxJbmZvIiwiZ2V0U2tpbGxCeUlkIiwic2tpbGxBdGtSYW5nZSIsIlNraWxsNFBhcmFtIiwiRklOQUwiLCJjbGVhciIsImNpcmNsZSIsInN0cm9rZSIsImZpbGwiLCJhY3RpdmUiLCJzZXRDb250ZW50U2l6ZSIsImhhcyIsInNraWxsUGFyYW0iLCJnZXQiLCJuIiwiTGFiZWwiLCJidWxsZXRDb3VudCIsIlNwcml0ZSIsImZpbGxSYW5nZSIsInJlbmRlclNraWxsQ291bnQiLCJhZGRTa2lsbEluZm8iLCJnZXRDaG9vc2VQYXJlbmRDb3VudCIsInRvU3RyaW5nIiwiaW5zdGFuY2UiLCJza2lsbENvbmZpZ3NNYXAiLCJsb2FkUmVzIiwiQnVuZGxlTmFtZXMiLCJQdWJsaWNfUmVzIiwiaWNvbiIsIlNwcml0ZUZyYW1lIiwiaXNWYWxpZCIsInNwcml0ZUZyYW1lIiwiUmVzVXRpbCIsImFzc2lnbldpdGgiLCJub2RlIiwidXBkYXRlIiwiY3VyclBsYXllckxldmVsIiwiQW5pbWF0aW9uIiwicGxheSIsIm9uY2UiLCJGSU5JU0hFRCIsImN1cnJFeHAiLCJuZWVkRXhwIiwid2lkdGgiLCJfX2RlY29yYXRlIiwiQ29tcG9uZW50IiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxDQUFKOztBQUNBLElBQUlDLGFBQWEsR0FBR0MsT0FBTyxDQUFDLGdCQUFELENBQTNCOztBQUNBLElBQUlDLFVBQVUsR0FBR0QsT0FBTyxDQUFDLGFBQUQsQ0FBeEI7O0FBQ0EsSUFBSUUsUUFBUSxHQUFHRixPQUFPLENBQUMsV0FBRCxDQUF0Qjs7QUFDQSxJQUFJRyxhQUFhLEdBQUdILE9BQU8sQ0FBQyxnQkFBRCxDQUEzQjs7QUFDQSxJQUFJSSxjQUFjLEdBQUdKLE9BQU8sQ0FBQyxpQkFBRCxDQUE1Qjs7QUFDQSxJQUFJSyxjQUFjLEdBQUdMLE9BQU8sQ0FBQyxpQkFBRCxDQUE1Qjs7QUFDQSxJQUFJTSxlQUFlLEdBQUdOLE9BQU8sQ0FBQyxrQkFBRCxDQUE3Qjs7QUFDQSxJQUFJTyxZQUFZLEdBQUdQLE9BQU8sQ0FBQyxlQUFELENBQTFCOztBQUNBLElBQUlRLGNBQWMsR0FBR1IsT0FBTyxDQUFDLGlCQUFELENBQTVCOztBQUNBLElB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QUFLLENBQTVDLENBQVY7O0VBQ0F3RSxVQUFVLENBQUMsQ0FBQ2hHLENBQUMsQ0FBQ0osRUFBRSxDQUFDdUUsS0FBSixDQUFGLENBQUQsRUFBZ0I3RCxDQUFDLENBQUNrQixTQUFsQixFQUE2QixZQUE3QixFQUEyQyxLQUFLLENBQWhELENBQVY7O0VBQ0F3RSxVQUFVLENBQUMsQ0FBQ2hHLENBQUMsQ0FBQ0osRUFBRSxDQUFDMEMsSUFBSixDQUFGLENBQUQsRUFBZWhDLENBQUMsQ0FBQ2tCLFNBQWpCLEVBQTRCLGdCQUE1QixFQUE4QyxLQUFLLENBQW5ELENBQVY7O0VBQ0EsT0FBT3dFLFVBQVUsQ0FBQyxDQUFDbEcsQ0FBRCxDQUFELEVBQU1RLENBQU4sQ0FBakI7QUFDSCxDQXhJTyxDQXdJTFYsRUFBRSxDQUFDcUcsU0F4SUUsQ0FBUjs7QUF5SUFDLE9BQU8sV0FBUCxHQUFrQjlGLENBQWxCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbztcclxudmFyICRhc3NldHNMb2FkZXIgPSByZXF1aXJlKFwiLi9Bc3NldHNMb2FkZXJcIik7XHJcbnZhciAkYXNzZXRzTWFwID0gcmVxdWlyZShcIi4vQXNzZXRzTWFwXCIpO1xyXG52YXIgJHJlc1V0aWwgPSByZXF1aXJlKFwiLi9SZXNVdGlsXCIpO1xyXG52YXIgJGV2ZW50TWFuYWdlciA9IHJlcXVpcmUoXCIuL0V2ZW50TWFuYWdlclwiKTtcclxudmFyICRiYXR0bGVDb250ZXh0ID0gcmVxdWlyZShcIi4vQmF0dGxlQ29udGV4dFwiKTtcclxudmFyICRjb25maWdDb250ZXh0ID0gcmVxdWlyZShcIi4vQ29uZmlnQ29udGV4dFwiKTtcclxudmFyICRsb2NhbEV2ZW50TmFtZSA9IHJlcXVpcmUoXCIuL0xvY2FsRXZlbnROYW1lXCIpO1xyXG52YXIgJGdhbWVDb250ZXh0ID0gcmVxdWlyZShcIi4vR2FtZUNvbnRleHRcIik7XHJcbnZhciAkZ2FtZVNraWxsSW5mbyA9IHJlcXVpcmUoXCIuL0dhbWVTa2lsbEluZm9cIik7XHJcbnZhciBtID0gY2MuX2RlY29yYXRvcjtcclxudmFyIHkgPSBtLmNjY2xhc3M7XHJcbnZhciBnID0gbS5wcm9wZXJ0eTtcclxudmFyIF8gPSBjYy5zaXplKDAsIDApO1xyXG52YXIgayA9IChmdW5jdGlvbiAodCkge1xyXG4gICAgZnVuY3Rpb24gZSgpIHtcclxuICAgICAgICB2YXIgZSA9IChudWxsICE9PSB0ICYmIHQuYXBwbHkodGhpcywgYXJndW1lbnRzKSkgfHwgdGhpcztcclxuICAgICAgICBlLnByb2dyZXNzQmFyID0gbnVsbDtcclxuICAgICAgICBlLnByb2dyZXNzTGFibGUgPSBudWxsO1xyXG4gICAgICAgIGUuZ3JhZGVMYWJsZSA9IG51bGw7XHJcbiAgICAgICAgZS5icmFBbmltcyA9IG51bGw7XHJcbiAgICAgICAgZS5jb21wbGV0ZWROb2RlID0gbnVsbDtcclxuICAgICAgICBlLmNkTGF5ZXIgPSBudWxsO1xyXG4gICAgICAgIGUubGV2ZWxMYWJlbCA9IG51bGw7XHJcbiAgICAgICAgZS5zaG93UmFuZ2VMYXllciA9IG51bGw7XHJcbiAgICAgICAgZS5jdXJyTGV2ZWwgPSAxO1xyXG4gICAgICAgIGUudXBncmFkZUFuaW1pbmcgPSAhMTtcclxuICAgICAgICBlLmN1cnJJbmRleCA9IDE7XHJcbiAgICAgICAgZS5jZFJlY29yZCA9IG5ldyBNYXAoKTtcclxuICAgICAgICBlLmdyYXBoaWNzID0gbnVsbDtcclxuICAgICAgICByZXR1cm4gZTtcclxuICAgIH1cclxuICAgIF9fZXh0ZW5kcyhlLCB0KTtcclxuICAgIGUucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuZ3JhcGhpY3MgPSB0aGlzLnNob3dSYW5nZUxheWVyLmdldENvbXBvbmVudChjYy5HcmFwaGljcyk7XHJcbiAgICAgICAgdGhpcy5sZXZlbExhYmVsLnN0cmluZyA9IFwi56ysXCIgKyAkYmF0dGxlQ29udGV4dC5kZWZhdWx0Lklucy5jdXJyTGV2ZWwgKyBcIuWFs1wiO1xyXG4gICAgICAgIHRoaXMuY2RSZWNvcmQuc2V0KDEsIDApO1xyXG4gICAgICAgICRldmVudE1hbmFnZXIuZGVmYXVsdC5vbigkbG9jYWxFdmVudE5hbWUuZGVmYXVsdC5BRERfU0tJTExfQ0QsIHRoaXMucmVuZGVyU2tpbGxJbmZvLCB0aGlzKTtcclxuICAgICAgICAkZXZlbnRNYW5hZ2VyLmRlZmF1bHQub24oJGxvY2FsRXZlbnROYW1lLmRlZmF1bHQuUkVOREVSX1NLSUxMX0NEX0lORk8sIHRoaXMucmVuZGVyU2tpbGxDREluZm8sIHRoaXMpO1xyXG4gICAgICAgIGZvciAodmFyIHQgPSAwOyB0IDwgdGhpcy5jZExheWVyLmNoaWxkcmVuLmxlbmd0aDsgdCsrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2RMYXllci5jaGlsZHJlblt0XS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9TVEFSVCwgdGhpcy50b3VjaENELCB0aGlzKTtcclxuICAgICAgICAgICAgdGhpcy5jZExheWVyLmNoaWxkcmVuW3RdLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0VORCwgdGhpcy5lbmRDRCwgdGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLm9uRGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkZXZlbnRNYW5hZ2VyLmRlZmF1bHQub2ZmKCRsb2NhbEV2ZW50TmFtZS5kZWZhdWx0LkFERF9TS0lMTF9DRCwgdGhpcy5yZW5kZXJTa2lsbEluZm8sIHRoaXMpO1xyXG4gICAgICAgICRldmVudE1hbmFnZXIuZGVmYXVsdC5vZmYoJGxvY2FsRXZlbnROYW1lLmRlZmF1bHQuUkVOREVSX1NLSUxMX0NEX0lORk8sIHRoaXMucmVuZGVyU2tpbGxDREluZm8sIHRoaXMpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnRvdWNoQ0QgPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciBlID0gdGhpcy5jZExheWVyLmNoaWxkcmVuLmluZGV4T2YodC50YXJnZXQpO1xyXG4gICAgICAgIHZhciBpID0gLTE7XHJcbiAgICAgICAgdGhpcy5jZFJlY29yZC5mb3JFYWNoKGZ1bmN0aW9uICh0LCBvKSB7XHJcbiAgICAgICAgICAgIGlmICh0ID09PSBlKSB7XHJcbiAgICAgICAgICAgICAgICBpID0gbztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmICgtMSAhPT0gaSkge1xyXG4gICAgICAgICAgICBfLmhlaWdodCA9XHJcbiAgICAgICAgICAgICAgICAkZ2FtZUNvbnRleHQuZGVmYXVsdC5pbnMuc2tpbGxJbmZvLmdldFNraWxsQnlJZChpKS5za2lsbEF0a1JhbmdlWyRnYW1lU2tpbGxJbmZvLlNraWxsNFBhcmFtLkZJTkFMXTtcclxuICAgICAgICAgICAgdGhpcy5ncmFwaGljcy5jbGVhcigpO1xyXG4gICAgICAgICAgICB0aGlzLmdyYXBoaWNzLmNpcmNsZSgwLCAwLCBfLmhlaWdodCk7XHJcbiAgICAgICAgICAgIHRoaXMuZ3JhcGhpY3Muc3Ryb2tlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZ3JhcGhpY3MuZmlsbCgpO1xyXG4gICAgICAgICAgICB0aGlzLnNob3dSYW5nZUxheWVyLmFjdGl2ZSA9ICEwO1xyXG4gICAgICAgICAgICB0aGlzLnNob3dSYW5nZUxheWVyLnNldENvbnRlbnRTaXplKF8pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5lbmRDRCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLnNob3dSYW5nZUxheWVyLmFjdGl2ZSA9ICExO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnJlbmRlclNraWxsQ0RJbmZvID0gZnVuY3Rpb24gKHQsIGUsIGkpIHtcclxuICAgICAgICBpZiAodGhpcy5jZFJlY29yZC5oYXModCkpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnNraWxsUGFyYW0pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2tpbGxQYXJhbSA9ICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5za2lsbEluZm8uZ2V0U2tpbGxCeUlkKDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5jZFJlY29yZC5nZXQodCk7XHJcbiAgICAgICAgICAgIHZhciBuID0gdGhpcy5jZExheWVyLmNoaWxkcmVuW29dO1xyXG4gICAgICAgICAgICAxID09PSB0XHJcbiAgICAgICAgICAgICAgICA/ICgtMSAhPT0gaSAmJiAobi5jaGlsZHJlblsyXS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IGkgKyBcIi9cIiArIHRoaXMuc2tpbGxQYXJhbS5idWxsZXRDb3VudCksXHJcbiAgICAgICAgICAgICAgICAgIC0xICE9PSBlICYmIChuLmNoaWxkcmVuWzNdLmdldENvbXBvbmVudChjYy5TcHJpdGUpLmZpbGxSYW5nZSA9IGUpKVxyXG4gICAgICAgICAgICAgICAgOiAobi5jaGlsZHJlblsyXS5nZXRDb21wb25lbnQoY2MuU3ByaXRlKS5maWxsUmFuZ2UgPSBlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUucmVuZGVyU2tpbGxJbmZvID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICB0aGlzLmNkUmVjb3JkLmhhcyh0KSA/IHRoaXMucmVuZGVyU2tpbGxDb3VudCh0KSA6IHRoaXMuYWRkU2tpbGxJbmZvKHQpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnJlbmRlclNraWxsQ291bnQgPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciBlID0gJGdhbWVDb250ZXh0LmRlZmF1bHQuaW5zLnNraWxsSW5mby5nZXRDaG9vc2VQYXJlbmRDb3VudCh0KTtcclxuICAgICAgICB2YXIgaSA9IHRoaXMuY2RSZWNvcmQuZ2V0KHQpO1xyXG4gICAgICAgIHRoaXMuY2RMYXllci5jaGlsZHJlbltpXS5jaGlsZHJlblsxXS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IGUudG9TdHJpbmcoKTtcclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5hZGRTa2lsbEluZm8gPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciBlID0gdGhpcztcclxuICAgICAgICBpZiAoISgxID09PSB0IHx8IHRoaXMuY2RSZWNvcmQuc2l6ZSA+IDUgfHwgdGhpcy5jdXJySW5kZXggPj0gdGhpcy5jZExheWVyLmNoaWxkcmVuLmxlbmd0aCkpIHtcclxuICAgICAgICAgICAgdmFyIGkgPSAkY29uZmlnQ29udGV4dC5kZWZhdWx0Lmluc3RhbmNlLnNraWxsQ29uZmlnc01hcC5nZXQodCk7XHJcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5jZExheWVyLmNoaWxkcmVuW3RoaXMuY3VyckluZGV4XTtcclxuICAgICAgICAgICAgdmFyIG4gPSBvLmNoaWxkcmVuWzBdLmdldENvbXBvbmVudChjYy5TcHJpdGUpO1xyXG4gICAgICAgICAgICAkYXNzZXRzTG9hZGVyLmRlZmF1bHQuaW5zdGFuY2UubG9hZFJlcyhcclxuICAgICAgICAgICAgICAgICRhc3NldHNNYXAuQnVuZGxlTmFtZXMuUHVibGljX1JlcyxcclxuICAgICAgICAgICAgICAgIFtcIi9jZF9pY29uL1wiICsgaS5pY29uXSxcclxuICAgICAgICAgICAgICAgIGNjLlNwcml0ZUZyYW1lLFxyXG4gICAgICAgICAgICAgICAgbnVsbCxcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uICh0LCBpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG8gPSBpWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvICYmIGNjLmlzVmFsaWQobikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbi5zcHJpdGVGcmFtZSA9ICRyZXNVdGlsLlJlc1V0aWwuYXNzaWduV2l0aChvLCBlLm5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgby5jaGlsZHJlblsxXS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IFwiMVwiO1xyXG4gICAgICAgICAgICB0aGlzLmNkUmVjb3JkLnNldCh0LCB0aGlzLmN1cnJJbmRleCk7XHJcbiAgICAgICAgICAgIHRoaXMuY3VyckluZGV4Kys7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgdCA9IHRoaXM7XHJcbiAgICAgICAgaWYgKCF0aGlzLnVwZ3JhZGVBbmltaW5nKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJMZXZlbCAhPT0gJGdhbWVDb250ZXh0LmRlZmF1bHQuaW5zLmN1cnJQbGF5ZXJMZXZlbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGdyYWRlQW5pbWluZyA9ICEwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyTGV2ZWwgPSAkZ2FtZUNvbnRleHQuZGVmYXVsdC5pbnMuY3VyclBsYXllckxldmVsO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ncmFkZUxhYmxlLnN0cmluZyA9IHRoaXMuY3VyckxldmVsLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnByb2dyZXNzQmFyLmZpbGxSYW5nZSA9IDE7XHJcbiAgICAgICAgICAgICAgICB2YXIgZSA9IHRoaXMuY29tcGxldGVkTm9kZS5nZXRDb21wb25lbnQoY2MuQW5pbWF0aW9uKTtcclxuICAgICAgICAgICAgICAgIGUubm9kZS5hY3RpdmUgPSAhMDtcclxuICAgICAgICAgICAgICAgIGUucGxheShcImV4cF9hbmltXCIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgZS5vbmNlKFxyXG4gICAgICAgICAgICAgICAgICAgIGNjLkFuaW1hdGlvbi5FdmVudFR5cGUuRklOSVNIRUQsXHJcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlLm5vZGUuYWN0aXZlID0gITE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHQudXBncmFkZUFuaW1pbmcgPSAhMTtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXNcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGkgPSAkZ2FtZUNvbnRleHQuZGVmYXVsdC5pbnMuY3VyckV4cCAvICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5uZWVkRXhwKCk7XHJcbiAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3NCYXIuZmlsbFJhbmdlID0gaTtcclxuICAgICAgICAgICAgdGhpcy5wcm9ncmVzc0xhYmxlLnN0cmluZyA9ICRnYW1lQ29udGV4dC5kZWZhdWx0Lmlucy5jdXJyRXhwICsgXCIgL1wiICsgJGdhbWVDb250ZXh0LmRlZmF1bHQuaW5zLm5lZWRFeHAoKTtcclxuICAgICAgICAgICAgXy53aWR0aCA9IDM2NCAqIGk7XHJcbiAgICAgICAgICAgIHRoaXMuYnJhQW5pbXMuc2V0Q29udGVudFNpemUoXyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIF9fZGVjb3JhdGUoW2coY2MuU3ByaXRlKV0sIGUucHJvdG90eXBlLCBcInByb2dyZXNzQmFyXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtnKGNjLkxhYmVsKV0sIGUucHJvdG90eXBlLCBcInByb2dyZXNzTGFibGVcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW2coY2MuTGFiZWwpXSwgZS5wcm90b3R5cGUsIFwiZ3JhZGVMYWJsZVwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbZyhjYy5Ob2RlKV0sIGUucHJvdG90eXBlLCBcImJyYUFuaW1zXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtnKGNjLk5vZGUpXSwgZS5wcm90b3R5cGUsIFwiY29tcGxldGVkTm9kZVwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbZyhjYy5Ob2RlKV0sIGUucHJvdG90eXBlLCBcImNkTGF5ZXJcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW2coY2MuTGFiZWwpXSwgZS5wcm90b3R5cGUsIFwibGV2ZWxMYWJlbFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbZyhjYy5Ob2RlKV0sIGUucHJvdG90eXBlLCBcInNob3dSYW5nZUxheWVyXCIsIHZvaWQgMCk7XHJcbiAgICByZXR1cm4gX19kZWNvcmF0ZShbeV0sIGUpO1xyXG59KShjYy5Db21wb25lbnQpO1xyXG5leHBvcnRzLmRlZmF1bHQgPSBrO1xyXG4iXX0=