
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/Login.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'ca970xMfbBFAo0EuENROfKk', 'Login');
// game_script/scripts/Login.js

"use strict";

exports.Login = void 0;

var $eventManager = require("./EventManager");

var $seedUtil = require("./SeedUtil");

var $storageUtil = require("./StorageUtil");

var $platform = require("./Platform");

var $geService = require("./GeService");

var $switchContext = require("./SwitchContext");

var $userDataContext = require("./UserDataContext");

var u = function () {
  function t() {
    this.info = null;
    this.ttOpenId = "";
    this.wxOpenId = "";
    this.ksOpenId = "";
    this.param = {
      ttAppid: "",
      ttSecret: "",
      wxAuthUid: "",
      ksAuthUid: ""
    };
  }

  t.prototype.start = function () {
    console.log("=========login-param=======", this.param);
    this.param = $switchContext.SwitchContext.loginParam;
    this.info = {
      openId: this.getLocalOpenID(),
      nickname: "",
      headImg: "https://cooperation.pailedi.com/web2/wuff/bhrhj/config/default_img2.png"
    };
    $userDataContext["default"].Ins.openId = this.info.openId;
    $platform.Platform.currPlatForm === $platform.PlatformEnum.TOU_TIAO ? this.ttOpenId = $storageUtil.StorageUtil.getItem("TT_OPENID", "", !1) : $platform.Platform.currPlatForm === $platform.PlatformEnum.WECHAT ? this.wxOpenId = $storageUtil.StorageUtil.getItem("WX_OPENID", "", !1) : $platform.Platform.currPlatForm === $platform.PlatformEnum.KS && (this.ksOpenId = $storageUtil.StorageUtil.getItem("KS_OPENID", "", !1));
  };

  t.prototype.qqGetUserInfo = function () {
    var t = this;
    window.qq.getSetting({
      success: function success(e) {
        if (e.authSetting["scope.userInfo"]) {
          window.qq.getUserInfo({
            success: function success(e) {
              var i = e.userInfo;
              t.onGetUserInfo(i);
            }
          });
        } else {
          {
            var i = window.qq.createUserInfoButton({
              type: "text",
              text: "",
              style: {
                left: 0,
                top: 0,
                width: 3e3,
                height: 3e3,
                lineHeight: 40,
                textAlign: "center",
                fontSize: 16,
                borderRadius: 4
              }
            });
            i.onTap(function (e) {
              console.log("button res:", e);

              if (e && "getUserInfo:ok" === e.errMsg) {
                var o = e.userInfo;
                t.onGetUserInfo(o);
              }

              i.destroy();
            });
            i.show();
          }
        }
      }
    });
  };

  t.prototype.wxGetUserInfo = function (t) {
    var e = this;
    t && "" === this.wxOpenId ? window.wx.login({
      success: function success(t) {
        t.code ? e.getWxOpenId(t.code) : console.log("登录失败！" + t.errMsg);
      }
    }) : t && "" != this.wxOpenId && $geService.GeService.instance.init();
    console.log("==========wxGetUserInfo==========");
    window.wx.getSetting({
      success: function success(t) {
        if (t.authSetting["scope.userInfo"]) {
          console.log("===++++===", t);
          window.wx.getUserInfo({
            success: function success(t) {
              var i = t.userInfo;
              console.log("======", t);
              e.onGetUserInfo(i);
            }
          });
        } else {
          {
            var i = window.wx.createUserInfoButton({
              type: "text",
              text: "",
              style: {
                left: 0,
                top: 0,
                width: 3e3,
                height: 3e3,
                lineHeight: 40,
                textAlign: "center",
                fontSize: 16,
                borderRadius: 4
              }
            });
            i.onTap(function (t) {
              console.log("button res:", t);

              if (t && "getUserInfo:ok" === t.errMsg) {
                var o = t.userInfo;
                e.onGetUserInfo(o);
              }

              i.destroy();
            });
            i.show();
          }
        }
      },
      fail: function fail(t) {
        console.error(t);
      }
    });
  };

  t.prototype.getWxOpenId = function (e) {
    var i = this;
    fly.post("https://fkxjl.shenzhendongwei.com/auth/login", {
      authUid: this.param.wxAuthUid,
      code: e
    }, {
      headers: {
        "Content-Type": "application/x-www-form-urlencoded"
      }
    }).then(function (e) {
      console.log("getOpenId", e.data);
      i.wxOpenId = e.data.openId;
      console.log("getOpenId", i.wxOpenId);
      $storageUtil.StorageUtil.setItem("WX_OPENID", i.wxOpenId, !1);
      $eventManager["default"].send(t.LOGIN_SUCCESS);
      $geService.GeService.instance.init();
    });
  };

  t.prototype.ttGetUserInfo = function (t) {
    var e = this;
    window.tt.login({
      force: !1,
      success: function success(i) {
        t && "" === e.ttOpenId ? e.getTTOpenId(i.code) : t && "" != e.ttOpenId && $geService.GeService.instance.init();
        console.log("login 调用成功" + i.code + " " + i.anonymousCode);
        window.tt.getUserInfo({
          withCredentials: !0,
          success: function success(t) {
            console.log("getUserInfo 调用成功 ", t);
            e.onGetUserInfo(t.userInfo);
          },
          fail: function fail(t) {
            console.log("getUserInfo 调用失败", t);
          }
        });
      }
    });
  };

  t.prototype.getTTOpenId = function (e) {
    var i = this;

    if ("" !== this.param.ttSecret) {
      fly.post("https://developer.toutiao.com/api/apps/v2/jscode2session", {
        appid: this.param.ttAppid,
        secret: this.param.ttSecret,
        code: e
      }).then(function (e) {
        console.log("getOpenId", e);
        i.ttOpenId = e.data.openid;
        $storageUtil.StorageUtil.setItem("TT_OPENID", i.ttOpenId, !1);
        $eventManager["default"].send(t.LOGIN_SUCCESS);
        $geService.GeService.instance.init();
      });
    }
  };

  t.prototype.ksGetUserInfo = function (t) {
    var e = this;
    window.ks.login({
      success: function success(i) {
        t && "" === e.ksOpenId ? e.getKSOpenId(i.code) : t && "" != e.ttOpenId && $geService.GeService.instance.init();
        console.log("login 调用成功" + i.code + " " + i.anonymousCode);
      }
    });
    console.log("============================================");
    window.ks.getSetting({
      success: function success(t) {
        t["scope.userInfo"] ? window.ks.getUserInfo({
          success: function success(t) {
            console.log("已授权");
            var i = t.userInfo;
            e.onGetUserInfo(i);
          }
        }) : window.ks.authorize({
          scope: "scope.userInfo",
          success: function success() {
            console.log("授权获取用户信息成功");
            window.ks.getUserInfo({
              success: function success(t) {
                var i = t.userInfo;
                e.onGetUserInfo(i);
              }
            });
          }
        });
      },
      fail: function fail(t) {
        console.error(t);
      }
    });
  };

  t.prototype.getKSOpenId = function (e) {
    var i = this;
    fly.post("https://fkxjl.shenzhendongwei.com/auth/login", {
      authUid: this.param.ksAuthUid,
      code: e
    }, {
      headers: {
        "Content-Type": "application/x-www-form-urlencoded"
      }
    }).then(function (e) {
      console.log("getOpenId1", e);
      i.ksOpenId = e.data.openId;
      console.log("getOpenId2", i.ksOpenId);
      $storageUtil.StorageUtil.setItem("KS_OPENID", i.ksOpenId, !1);
      $eventManager["default"].send(t.LOGIN_SUCCESS);
      $geService.GeService.instance.init();
    });
  };

  t.prototype.onGetUserInfo = function (e) {
    $userDataContext["default"].Ins.nickname = e.nickName;
    $eventManager["default"].send(t.LOGIN_SUCCESS);
  };

  t.prototype.getLocalOpenID = function () {
    var t = $storageUtil.StorageUtil.getItem("user_open_id", "1020" + $seedUtil["default"].randomFrom(0, 99999999), !1);
    $storageUtil.StorageUtil.setItem("user_open_id", t, !1);
    return t;
  };

  t.LOGIN_SUCCESS = "LOGIN_SUCCESS";
  t.instance = new t();
  return t;
}();

exports.Login = u;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXExvZ2luLmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJMb2dpbiIsIiRldmVudE1hbmFnZXIiLCJyZXF1aXJlIiwiJHNlZWRVdGlsIiwiJHN0b3JhZ2VVdGlsIiwiJHBsYXRmb3JtIiwiJGdlU2VydmljZSIsIiRzd2l0Y2hDb250ZXh0IiwiJHVzZXJEYXRhQ29udGV4dCIsInUiLCJ0IiwiaW5mbyIsInR0T3BlbklkIiwid3hPcGVuSWQiLCJrc09wZW5JZCIsInBhcmFtIiwidHRBcHBpZCIsInR0U2VjcmV0Iiwid3hBdXRoVWlkIiwia3NBdXRoVWlkIiwicHJvdG90eXBlIiwic3RhcnQiLCJjb25zb2xlIiwibG9nIiwiU3dpdGNoQ29udGV4dCIsImxvZ2luUGFyYW0iLCJvcGVuSWQiLCJnZXRMb2NhbE9wZW5JRCIsIm5pY2tuYW1lIiwiaGVhZEltZyIsIklucyIsIlBsYXRmb3JtIiwiY3VyclBsYXRGb3JtIiwiUGxhdGZvcm1FbnVtIiwiVE9VX1RJQU8iLCJTdG9yYWdlVXRpbCIsImdldEl0ZW0iLCJXRUNIQVQiLCJLUyIsInFxR2V0VXNlckluZm8iLCJ3aW5kb3ciLCJxcSIsImdldFNldHRpbmciLCJzdWNjZXNzIiwiZSIsImF1dGhTZXR0aW5nIiwiZ2V0VXNlckluZm8iLCJpIiwidXNlckluZm8iLCJvbkdldFVzZXJJbmZvIiwiY3JlYXRlVXNlckluZm9CdXR0b24iLCJ0eXBlIiwidGV4dCIsInN0eWxlIiwibGVmdCIsInRvcCIsIndpZHRoIiwiaGVpZ2h0IiwibGluZUhlaWdodCIsInRleHRBbGlnbiIsImZvbnRTaXplIiwiYm9yZGVyUmFkaXVzIiwib25UYXAiLCJlcnJNc2ciLCJvIiwiZGVzdHJveSIsInNob3ciLCJ3eEdldFVzZXJJbmZvIiwid3giLCJsb2dpbiIsImNvZGUiLCJnZXRXeE9wZW5JZCIsIkdlU2VydmljZSIsImluc3RhbmNlIiwiaW5pdCIsImZhaWwiLCJlcnJvciIsImZseSIsInBvc3QiLCJhdXRoVWlkIiwiaGVhZGVycyIsInRoZW4iLCJkYXRhIiwic2V0SXRlbSIsInNlbmQiLCJMT0dJTl9TVUNDRVNTIiwidHRHZXRVc2VySW5mbyIsInR0IiwiZm9yY2UiLCJnZXRUVE9wZW5JZCIsImFub255bW91c0NvZGUiLCJ3aXRoQ3JlZGVudGlhbHMiLCJhcHBpZCIsInNlY3JldCIsIm9wZW5pZCIsImtzR2V0VXNlckluZm8iLCJrcyIsImdldEtTT3BlbklkIiwiYXV0aG9yaXplIiwic2NvcGUiLCJuaWNrTmFtZSIsInJhbmRvbUZyb20iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLE9BQU8sQ0FBQ0MsS0FBUixHQUFnQixLQUFLLENBQXJCOztBQUNBLElBQUlDLGFBQWEsR0FBR0MsT0FBTyxDQUFDLGdCQUFELENBQTNCOztBQUNBLElBQUlDLFNBQVMsR0FBR0QsT0FBTyxDQUFDLFlBQUQsQ0FBdkI7O0FBQ0EsSUFBSUUsWUFBWSxHQUFHRixPQUFPLENBQUMsZUFBRCxDQUExQjs7QUFDQSxJQUFJRyxTQUFTLEdBQUdILE9BQU8sQ0FBQyxZQUFELENBQXZCOztBQUNBLElBQUlJLFVBQVUsR0FBR0osT0FBTyxDQUFDLGFBQUQsQ0FBeEI7O0FBQ0EsSUFBSUssY0FBYyxHQUFHTCxPQUFPLENBQUMsaUJBQUQsQ0FBNUI7O0FBQ0EsSUFBSU0sZ0JBQWdCLEdBQUdOLE9BQU8sQ0FBQyxtQkFBRCxDQUE5Qjs7QUFDQSxJQUFJTyxDQUFDLEdBQUksWUFBWTtFQUNqQixTQUFTQyxDQUFULEdBQWE7SUFDVCxLQUFLQyxJQUFMLEdBQVksSUFBWjtJQUNBLEtBQUtDLFFBQUwsR0FBZ0IsRUFBaEI7SUFDQSxLQUFLQyxRQUFMLEdBQWdCLEVBQWhCO0lBQ0EsS0FBS0MsUUFBTCxHQUFnQixFQUFoQjtJQUNBLEtBQUtDLEtBQUwsR0FBYTtNQUNUQyxPQUFPLEVBQUUsRUFEQTtNQUVUQyxRQUFRLEVBQUUsRUFGRDtNQUdUQyxTQUFTLEVBQUUsRUFIRjtNQUlUQyxTQUFTLEVBQUU7SUFKRixD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bEI7RUFDQTNFLENBQUMsQ0FBQytELFFBQUYsR0FBYSxJQUFJL0QsQ0FBSixFQUFiO0VBQ0EsT0FBT0EsQ0FBUDtBQUNILENBdFFPLEVBQVI7O0FBdVFBWCxPQUFPLENBQUNDLEtBQVIsR0FBZ0JTLENBQWhCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnRzLkxvZ2luID0gdm9pZCAwO1xyXG52YXIgJGV2ZW50TWFuYWdlciA9IHJlcXVpcmUoXCIuL0V2ZW50TWFuYWdlclwiKTtcclxudmFyICRzZWVkVXRpbCA9IHJlcXVpcmUoXCIuL1NlZWRVdGlsXCIpO1xyXG52YXIgJHN0b3JhZ2VVdGlsID0gcmVxdWlyZShcIi4vU3RvcmFnZVV0aWxcIik7XHJcbnZhciAkcGxhdGZvcm0gPSByZXF1aXJlKFwiLi9QbGF0Zm9ybVwiKTtcclxudmFyICRnZVNlcnZpY2UgPSByZXF1aXJlKFwiLi9HZVNlcnZpY2VcIik7XHJcbnZhciAkc3dpdGNoQ29udGV4dCA9IHJlcXVpcmUoXCIuL1N3aXRjaENvbnRleHRcIik7XHJcbnZhciAkdXNlckRhdGFDb250ZXh0ID0gcmVxdWlyZShcIi4vVXNlckRhdGFDb250ZXh0XCIpO1xyXG52YXIgdSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiB0KCkge1xyXG4gICAgICAgIHRoaXMuaW5mbyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy50dE9wZW5JZCA9IFwiXCI7XHJcbiAgICAgICAgdGhpcy53eE9wZW5JZCA9IFwiXCI7XHJcbiAgICAgICAgdGhpcy5rc09wZW5JZCA9IFwiXCI7XHJcbiAgICAgICAgdGhpcy5wYXJhbSA9IHtcclxuICAgICAgICAgICAgdHRBcHBpZDogXCJcIixcclxuICAgICAgICAgICAgdHRTZWNyZXQ6IFwiXCIsXHJcbiAgICAgICAgICAgIHd4QXV0aFVpZDogXCJcIixcclxuICAgICAgICAgICAga3NBdXRoVWlkOiBcIlwiXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgdC5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCI9PT09PT09PT1sb2dpbi1wYXJhbT09PT09PT1cIiwgdGhpcy5wYXJhbSk7XHJcbiAgICAgICAgdGhpcy5wYXJhbSA9ICRzd2l0Y2hDb250ZXh0LlN3aXRjaENvbnRleHQubG9naW5QYXJhbTtcclxuICAgICAgICB0aGlzLmluZm8gPSB7XHJcbiAgICAgICAgICAgIG9wZW5JZDogdGhpcy5nZXRMb2NhbE9wZW5JRCgpLFxyXG4gICAgICAgICAgICBuaWNrbmFtZTogXCJcIixcclxuICAgICAgICAgICAgaGVhZEltZzogXCJodHRwczovL2Nvb3BlcmF0aW9uLnBhaWxlZGkuY29tL3dlYjIvd3VmZi9iaHJoai9jb25maWcvZGVmYXVsdF9pbWcyLnBuZ1wiXHJcbiAgICAgICAgfTtcclxuICAgICAgICAkdXNlckRhdGFDb250ZXh0LmRlZmF1bHQuSW5zLm9wZW5JZCA9IHRoaXMuaW5mby5vcGVuSWQ7XHJcbiAgICAgICAgJHBsYXRmb3JtLlBsYXRmb3JtLmN1cnJQbGF0Rm9ybSA9PT0gJHBsYXRmb3JtLlBsYXRmb3JtRW51bS5UT1VfVElBT1xyXG4gICAgICAgICAgICA/ICh0aGlzLnR0T3BlbklkID0gJHN0b3JhZ2VVdGlsLlN0b3JhZ2VVdGlsLmdldEl0ZW0oXCJUVF9PUEVOSURcIiwgXCJcIiwgITEpKVxyXG4gICAgICAgICAgICA6ICRwbGF0Zm9ybS5QbGF0Zm9ybS5jdXJyUGxhdEZvcm0gPT09ICRwbGF0Zm9ybS5QbGF0Zm9ybUVudW0uV0VDSEFUXHJcbiAgICAgICAgICAgID8gKHRoaXMud3hPcGVuSWQgPSAkc3RvcmFnZVV0aWwuU3RvcmFnZVV0aWwuZ2V0SXRlbShcIldYX09QRU5JRFwiLCBcIlwiLCAhMSkpXHJcbiAgICAgICAgICAgIDogJHBsYXRmb3JtLlBsYXRmb3JtLmN1cnJQbGF0Rm9ybSA9PT0gJHBsYXRmb3JtLlBsYXRmb3JtRW51bS5LUyAmJlxyXG4gICAgICAgICAgICAgICh0aGlzLmtzT3BlbklkID0gJHN0b3JhZ2VVdGlsLlN0b3JhZ2VVdGlsLmdldEl0ZW0oXCJLU19PUEVOSURcIiwgXCJcIiwgITEpKTtcclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5xcUdldFVzZXJJbmZvID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciB0ID0gdGhpcztcclxuICAgICAgICB3aW5kb3cucXEuZ2V0U2V0dGluZyh7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZS5hdXRoU2V0dGluZ1tcInNjb3BlLnVzZXJJbmZvXCJdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnFxLmdldFVzZXJJbmZvKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gZS51c2VySW5mbztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQub25HZXRVc2VySW5mbyhpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gd2luZG93LnFxLmNyZWF0ZVVzZXJJbmZvQnV0dG9uKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwidGV4dFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDNlMyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDNlMyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiA0MCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0QWxpZ246IFwiY2VudGVyXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemU6IDE2LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogNFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaS5vblRhcChmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJidXR0b24gcmVzOlwiLCBlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlICYmIFwiZ2V0VXNlckluZm86b2tcIiA9PT0gZS5lcnJNc2cpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IGUudXNlckluZm87XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5vbkdldFVzZXJJbmZvKG8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpLnNob3coKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS53eEdldFVzZXJJbmZvID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICB2YXIgZSA9IHRoaXM7XHJcbiAgICAgICAgdCAmJiBcIlwiID09PSB0aGlzLnd4T3BlbklkXHJcbiAgICAgICAgICAgID8gd2luZG93Lnd4LmxvZ2luKHtcclxuICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIHQuY29kZSA/IGUuZ2V0V3hPcGVuSWQodC5jb2RlKSA6IGNvbnNvbGUubG9nKFwi55m75b2V5aSx6LSl77yBXCIgKyB0LmVyck1zZyk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICA6IHQgJiYgXCJcIiAhPSB0aGlzLnd4T3BlbklkICYmICRnZVNlcnZpY2UuR2VTZXJ2aWNlLmluc3RhbmNlLmluaXQoKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIj09PT09PT09PT13eEdldFVzZXJJbmZvPT09PT09PT09PVwiKTtcclxuICAgICAgICB3aW5kb3cud3guZ2V0U2V0dGluZyh7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodC5hdXRoU2V0dGluZ1tcInNjb3BlLnVzZXJJbmZvXCJdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCI9PT0rKysrPT09XCIsIHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy53eC5nZXRVc2VySW5mbyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHQudXNlckluZm87XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIj09PT09PVwiLCB0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUub25HZXRVc2VySW5mbyhpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gd2luZG93Lnd4LmNyZWF0ZVVzZXJJbmZvQnV0dG9uKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwidGV4dFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDNlMyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDNlMyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiA0MCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0QWxpZ246IFwiY2VudGVyXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemU6IDE2LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogNFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaS5vblRhcChmdW5jdGlvbiAodCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJidXR0b24gcmVzOlwiLCB0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIFwiZ2V0VXNlckluZm86b2tcIiA9PT0gdC5lcnJNc2cpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IHQudXNlckluZm87XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5vbkdldFVzZXJJbmZvKG8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpLnNob3coKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGZhaWw6IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgdC5wcm90b3R5cGUuZ2V0V3hPcGVuSWQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIHZhciBpID0gdGhpcztcclxuICAgICAgICBmbHkucG9zdChcclxuICAgICAgICAgICAgXCJodHRwczovL2ZreGpsLnNoZW56aGVuZG9uZ3dlaS5jb20vYXV0aC9sb2dpblwiLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBhdXRoVWlkOiB0aGlzLnBhcmFtLnd4QXV0aFVpZCxcclxuICAgICAgICAgICAgICAgIGNvZGU6IGVcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCJcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICkudGhlbihmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImdldE9wZW5JZFwiLCBlLmRhdGEpO1xyXG4gICAgICAgICAgICBpLnd4T3BlbklkID0gZS5kYXRhLm9wZW5JZDtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJnZXRPcGVuSWRcIiwgaS53eE9wZW5JZCk7XHJcbiAgICAgICAgICAgICRzdG9yYWdlVXRpbC5TdG9yYWdlVXRpbC5zZXRJdGVtKFwiV1hfT1BFTklEXCIsIGkud3hPcGVuSWQsICExKTtcclxuICAgICAgICAgICAgJGV2ZW50TWFuYWdlci5kZWZhdWx0LnNlbmQodC5MT0dJTl9TVUNDRVNTKTtcclxuICAgICAgICAgICAgJGdlU2VydmljZS5HZVNlcnZpY2UuaW5zdGFuY2UuaW5pdCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHQucHJvdG90eXBlLnR0R2V0VXNlckluZm8gPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciBlID0gdGhpcztcclxuICAgICAgICB3aW5kb3cudHQubG9naW4oe1xyXG4gICAgICAgICAgICBmb3JjZTogITEsXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChpKSB7XHJcbiAgICAgICAgICAgICAgICB0ICYmIFwiXCIgPT09IGUudHRPcGVuSWRcclxuICAgICAgICAgICAgICAgICAgICA/IGUuZ2V0VFRPcGVuSWQoaS5jb2RlKVxyXG4gICAgICAgICAgICAgICAgICAgIDogdCAmJiBcIlwiICE9IGUudHRPcGVuSWQgJiYgJGdlU2VydmljZS5HZVNlcnZpY2UuaW5zdGFuY2UuaW5pdCgpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJsb2dpbiDosIPnlKjmiJDlip9cIiArIGkuY29kZSArIFwiIFwiICsgaS5hbm9ueW1vdXNDb2RlKTtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy50dC5nZXRVc2VySW5mbyh7XHJcbiAgICAgICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiAhMCxcclxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImdldFVzZXJJbmZvIOiwg+eUqOaIkOWKnyBcIiwgdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUub25HZXRVc2VySW5mbyh0LnVzZXJJbmZvKTtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGZhaWw6IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZ2V0VXNlckluZm8g6LCD55So5aSx6LSlXCIsIHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgdC5wcm90b3R5cGUuZ2V0VFRPcGVuSWQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIHZhciBpID0gdGhpcztcclxuICAgICAgICBpZiAoXCJcIiAhPT0gdGhpcy5wYXJhbS50dFNlY3JldCkge1xyXG4gICAgICAgICAgICBmbHkucG9zdChcImh0dHBzOi8vZGV2ZWxvcGVyLnRvdXRpYW8uY29tL2FwaS9hcHBzL3YyL2pzY29kZTJzZXNzaW9uXCIsIHtcclxuICAgICAgICAgICAgICAgIGFwcGlkOiB0aGlzLnBhcmFtLnR0QXBwaWQsXHJcbiAgICAgICAgICAgICAgICBzZWNyZXQ6IHRoaXMucGFyYW0udHRTZWNyZXQsXHJcbiAgICAgICAgICAgICAgICBjb2RlOiBlXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZ2V0T3BlbklkXCIsIGUpO1xyXG4gICAgICAgICAgICAgICAgaS50dE9wZW5JZCA9IGUuZGF0YS5vcGVuaWQ7XHJcbiAgICAgICAgICAgICAgICAkc3RvcmFnZVV0aWwuU3RvcmFnZVV0aWwuc2V0SXRlbShcIlRUX09QRU5JRFwiLCBpLnR0T3BlbklkLCAhMSk7XHJcbiAgICAgICAgICAgICAgICAkZXZlbnRNYW5hZ2VyLmRlZmF1bHQuc2VuZCh0LkxPR0lOX1NVQ0NFU1MpO1xyXG4gICAgICAgICAgICAgICAgJGdlU2VydmljZS5HZVNlcnZpY2UuaW5zdGFuY2UuaW5pdCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgdC5wcm90b3R5cGUua3NHZXRVc2VySW5mbyA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgdmFyIGUgPSB0aGlzO1xyXG4gICAgICAgIHdpbmRvdy5rcy5sb2dpbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChpKSB7XHJcbiAgICAgICAgICAgICAgICB0ICYmIFwiXCIgPT09IGUua3NPcGVuSWRcclxuICAgICAgICAgICAgICAgICAgICA/IGUuZ2V0S1NPcGVuSWQoaS5jb2RlKVxyXG4gICAgICAgICAgICAgICAgICAgIDogdCAmJiBcIlwiICE9IGUudHRPcGVuSWQgJiYgJGdlU2VydmljZS5HZVNlcnZpY2UuaW5zdGFuY2UuaW5pdCgpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJsb2dpbiDosIPnlKjmiJDlip9cIiArIGkuY29kZSArIFwiIFwiICsgaS5hbm9ueW1vdXNDb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cIik7XHJcbiAgICAgICAgd2luZG93LmtzLmdldFNldHRpbmcoe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgICAgICAgICAgdFtcInNjb3BlLnVzZXJJbmZvXCJdXHJcbiAgICAgICAgICAgICAgICAgICAgPyB3aW5kb3cua3MuZ2V0VXNlckluZm8oe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi5bey5o6I5p2DXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHQudXNlckluZm87XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUub25HZXRVc2VySW5mbyhpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIDogd2luZG93LmtzLmF1dGhvcml6ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGU6IFwic2NvcGUudXNlckluZm9cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi5o6I5p2D6I635Y+W55So5oi35L+h5oGv5oiQ5YqfXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cua3MuZ2V0VXNlckluZm8oe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHQudXNlckluZm87XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5vbkdldFVzZXJJbmZvKGkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZmFpbDogZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IodCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5nZXRLU09wZW5JZCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgdmFyIGkgPSB0aGlzO1xyXG4gICAgICAgIGZseS5wb3N0KFxyXG4gICAgICAgICAgICBcImh0dHBzOi8vZmt4amwuc2hlbnpoZW5kb25nd2VpLmNvbS9hdXRoL2xvZ2luXCIsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGF1dGhVaWQ6IHRoaXMucGFyYW0ua3NBdXRoVWlkLFxyXG4gICAgICAgICAgICAgICAgY29kZTogZVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKS50aGVuKGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZ2V0T3BlbklkMVwiLCBlKTtcclxuICAgICAgICAgICAgaS5rc09wZW5JZCA9IGUuZGF0YS5vcGVuSWQ7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZ2V0T3BlbklkMlwiLCBpLmtzT3BlbklkKTtcclxuICAgICAgICAgICAgJHN0b3JhZ2VVdGlsLlN0b3JhZ2VVdGlsLnNldEl0ZW0oXCJLU19PUEVOSURcIiwgaS5rc09wZW5JZCwgITEpO1xyXG4gICAgICAgICAgICAkZXZlbnRNYW5hZ2VyLmRlZmF1bHQuc2VuZCh0LkxPR0lOX1NVQ0NFU1MpO1xyXG4gICAgICAgICAgICAkZ2VTZXJ2aWNlLkdlU2VydmljZS5pbnN0YW5jZS5pbml0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgdC5wcm90b3R5cGUub25HZXRVc2VySW5mbyA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgJHVzZXJEYXRhQ29udGV4dC5kZWZhdWx0Lklucy5uaWNrbmFtZSA9IGUubmlja05hbWU7XHJcbiAgICAgICAgJGV2ZW50TWFuYWdlci5kZWZhdWx0LnNlbmQodC5MT0dJTl9TVUNDRVNTKTtcclxuICAgIH07XHJcbiAgICB0LnByb3RvdHlwZS5nZXRMb2NhbE9wZW5JRCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgdCA9ICRzdG9yYWdlVXRpbC5TdG9yYWdlVXRpbC5nZXRJdGVtKFxyXG4gICAgICAgICAgICBcInVzZXJfb3Blbl9pZFwiLFxyXG4gICAgICAgICAgICBcIjEwMjBcIiArICRzZWVkVXRpbC5kZWZhdWx0LnJhbmRvbUZyb20oMCwgOTk5OTk5OTkpLFxyXG4gICAgICAgICAgICAhMVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgJHN0b3JhZ2VVdGlsLlN0b3JhZ2VVdGlsLnNldEl0ZW0oXCJ1c2VyX29wZW5faWRcIiwgdCwgITEpO1xyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfTtcclxuICAgIHQuTE9HSU5fU1VDQ0VTUyA9IFwiTE9HSU5fU1VDQ0VTU1wiO1xyXG4gICAgdC5pbnN0YW5jZSA9IG5ldyB0KCk7XHJcbiAgICByZXR1cm4gdDtcclxufSkoKTtcclxuZXhwb3J0cy5Mb2dpbiA9IHU7XHJcbiJdfQ==