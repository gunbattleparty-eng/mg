
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game_script/scripts/BossSkillView.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '1cec1WiW1FK5ZZbIbd8coWx', 'BossSkillView');
// game_script/scripts/BossSkillView.js

"use strict";

var o;

var $assetsLoader = require("./AssetsLoader");

var $assetsMap = require("./AssetsMap");

var $resUtil = require("./ResUtil");

var $eventManager = require("./EventManager");

var $popupView = require("./PopupView");

var $seedUtil = require("./SeedUtil");

var $configContext = require("./ConfigContext");

var $localEventName = require("./LocalEventName");

var h = cc._decorator;
var m = h.ccclass;
var y = h.property;

var g = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.chooseSkillLayer = null;
    e.chooseAnimLayer = null;
    e.boxLayer = null;
    e.closeContent = null;
    e.skills = [];
    e.currSkills = [];
    e.currIndexs = [];
    e.poss = [];
    e.animStatus = 0;
    return e;
  }

  __extends(e, t);

  e.prototype.onResetView = function () {
    var t = this;
    this.skills = this.uiParam.param.skillIds;
    var e = this.uiParam.param.randomCount;

    for (var i = 0; i < this.chooseAnimLayer.children.length; i++) {
      this.poss[i] = this.chooseAnimLayer.children[i].position.clone();
    }

    var o = Math.min(e, this.skills.length);
    this.currSkills = $seedUtil["default"].randomArr(this.skills, o);
    this.currSkills.forEach(function (e) {
      t.currIndexs.push(t.skills.indexOf(e));
    });

    if (this.skills.length < 12) {
      var n = 12 - this.skills.length;

      for (i = 0; i < n; i++) {
        this.skills.push(this.skills[$seedUtil["default"].randomFrom(0, this.skills.length - 1)]);
      }
    }

    console.log("技能池:", this.skills);
    console.log("选中:", this.currIndexs, this.currSkills);
    this.render();
    this.startAnim();
  };

  e.prototype.addEvent = function () {
    this.closeContent.on(cc.Node.EventType.TOUCH_START, this.touchEnd, this);
  };

  e.prototype.removeEvent = function () {
    this.closeContent.off(cc.Node.EventType.TOUCH_START, this.touchEnd, this);
  };

  e.prototype.render = function () {
    var t = this;

    var e = function e(_e) {
      var o = i.chooseSkillLayer.children[_e];
      o.active = !0;

      if (i.currIndexs.length <= _e) {
        o.active = !1;
        return "continue";
      }

      var n = $configContext["default"].instance.skillConfigsMap.get(i.currSkills[_e]);
      var s = o.children[0].getComponent(cc.Sprite);
      $assetsLoader["default"].instance.loadRes($assetsMap.BundleNames.Public_Res, ["/skills/" + n.icon], cc.SpriteFrame, null, function (e, i) {
        var o = i[0];

        if (o && cc.isValid(s)) {
          s.spriteFrame = $resUtil.ResUtil.assignWith(o, t.node);
        }
      });
      o.children[1].getComponent(cc.Label).string = n.name;
      o.children[2].getComponent(cc.Label).string = n.skill_text;
      o.active = !1;
    };

    var i = this;

    for (var o = 0; o < this.chooseSkillLayer.children.length; o++) {
      e(o);
    }

    var n = function n(e) {
      var i = $configContext["default"].instance.skillConfigsMap.get(s.skills[e]);
      var o = s.chooseAnimLayer.children[e].children[1].getComponent(cc.Sprite);
      $assetsLoader["default"].instance.loadRes($assetsMap.BundleNames.Public_Res, ["/skills/" + i.icon], cc.SpriteFrame, null, function (e, i) {
        var n = i[0];

        if (n && cc.isValid(o)) {
          o.spriteFrame = $resUtil.ResUtil.assignWith(n, t.node);
        }
      });
    };

    var s = this;

    for (o = 0; o < this.skills.length; o++) {
      n(o);
    }
  };

  e.prototype.startAnim = function () {
    var t = this;
    this.animStatus = 1;
    var e = 0;
    var i = $seedUtil["default"].randomCount(0, 11, this.currIndexs.length);

    for (var o = 0; o < this.currIndexs.length; o++) {
      var n = this.boxLayer.children[o];
      n.active = !0;
      this.animItem(n, i[o], o, function () {
        if (++e >= t.currIndexs.length) {
          t.animStatus = 2;
        }
      });
    }
  };

  e.prototype.animItem = function (t, e, i, o) {
    var n = this;
    t.position = this.poss[e].clone();
    var s;
    var r = this.currIndexs[i];
    var a = 5 / (60 + (s = r < e ? 11 - e + r + 1 : r - e) + r);
    var l = 60 + s + this.currIndexs[i];
    var c = e;
    var u = cc.tween(t);

    for (var d = 0; d < l; d++) {
      ++c >= 12 && (c = 0);
      u.to(a, {
        position: this.poss[c]
      });
    }

    u.call(function () {
      n.chooseSkillLayer.children[i].active = !0;

      if (o) {
        o();
      }
    });
    u.repeat(2, cc.tween().to(0.3, {
      opacity: 0
    }).to(0.3, {
      opacity: 255
    }));
    u.start();
  };

  e.prototype.touchEnd = function () {
    if (1 === this.animStatus) {
      this.animStatus = 3;

      for (var e = 0; e < this.currIndexs.length; e++) {
        cc.Tween.stopAllByTarget(this.boxLayer.children[e]);
        this.boxLayer.children[e].active = !0;
        this.boxLayer.children[e].opacity = 255;
        this.boxLayer.children[e].position = this.poss[this.currIndexs[e]];
        this.chooseSkillLayer.children[e].active = !0;
      }
    } else {
      if (2 === this.animStatus || 3 === this.animStatus) {
        this.animStatus = 4;

        for (e = 0; e < this.currSkills.length; e++) {
          $eventManager["default"].send($localEventName["default"].CHOOSE_SKILL, this.currSkills[e]);
        }

        t.prototype.onClickClose.call(this);
      }
    }
  };

  __decorate([y(cc.Node)], e.prototype, "chooseSkillLayer", void 0);

  __decorate([y(cc.Node)], e.prototype, "chooseAnimLayer", void 0);

  __decorate([y(cc.Node)], e.prototype, "boxLayer", void 0);

  __decorate([y(cc.Node)], e.prototype, "closeContent", void 0);

  return __decorate([m], e);
}($popupView.PopupView);

exports["default"] = g;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcZ2FtZV9zY3JpcHRcXHNjcmlwdHNcXEJvc3NTa2lsbFZpZXcuanMiXSwibmFtZXMiOlsibyIsIiRhc3NldHNMb2FkZXIiLCJyZXF1aXJlIiwiJGFzc2V0c01hcCIsIiRyZXNVdGlsIiwiJGV2ZW50TWFuYWdlciIsIiRwb3B1cFZpZXciLCIkc2VlZFV0aWwiLCIkY29uZmlnQ29udGV4dCIsIiRsb2NhbEV2ZW50TmFtZSIsImgiLCJjYyIsIl9kZWNvcmF0b3IiLCJtIiwiY2NjbGFzcyIsInkiLCJwcm9wZXJ0eSIsImciLCJ0IiwiZSIsImFwcGx5IiwiYXJndW1lbnRzIiwiY2hvb3NlU2tpbGxMYXllciIsImNob29zZUFuaW1MYXllciIsImJveExheWVyIiwiY2xvc2VDb250ZW50Iiwic2tpbGxzIiwiY3VyclNraWxscyIsImN1cnJJbmRleHMiLCJwb3NzIiwiYW5pbVN0YXR1cyIsIl9fZXh0ZW5kcyIsInByb3RvdHlwZSIsIm9uUmVzZXRWaWV3IiwidWlQYXJhbSIsInBhcmFtIiwic2tpbGxJZHMiLCJyYW5kb21Db3VudCIsImkiLCJjaGlsZHJlbiIsImxlbmd0aCIsInBvc2l0aW9uIiwiY2xvbmUiLCJNYXRoIiwibWluIiwicmFuZG9tQXJyIiwiZm9yRWFjaCIsInB1c2giLCJpbmRleE9mIiwibiIsInJhbmRvbUZyb20iLCJjb25zb2xlIiwibG9nIiwicmVuZGVyIiwic3RhcnRBbmltIiwiYWRkRXZlbnQiLCJvbiIsIk5vZGUiLCJFdmVudFR5cGUiLCJUT1VDSF9TVEFSVCIsInRvdWNoRW5kIiwicmVtb3ZlRXZlbnQiLCJvZmYiLCJhY3RpdmUiLCJpbnN0YW5jZSIsInNraWxsQ29uZmlnc01hcCIsImdldCIsInMiLCJnZXRDb21wb25lbnQiLCJTcHJpdGUiLCJsb2FkUmVzIiwiQnVuZGxlTmFtZXMiLCJQdWJsaWNfUmVzIiwiaWNvbiIsIlNwcml0ZUZyYW1lIiwiaXNWYWxpZCIsInNwcml0ZUZyYW1lIiwiUmVzVXRpbCIsImFzc2lnbldpdGgiLCJub2RlIiwiTGFiZWwiLCJzdHJpbmciLCJuYW1lIiwic2tpbGxfdGV4dCIsImFuaW1JdGVtIiwiciIsImEiLCJsIiwiYyIsInUiLCJ0d2VlbiIsImQiLCJ0byIsImNhbGwiLCJyZXBlYXQiLCJvcGFjaXR5Iiwic3RhcnQiLCJUd2VlbiIsInN0b3BBbGxCeVRhcmdldCIsInNlbmQiLCJDSE9PU0VfU0tJTEwiLCJvbkNsaWNrQ2xvc2UiLCJfX2RlY29yYXRlIiwiUG9wdXBWaWV3IiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxDQUFKOztBQUNBLElBQUlDLGFBQWEsR0FBR0MsT0FBTyxDQUFDLGdCQUFELENBQTNCOztBQUNBLElBQUlDLFVBQVUsR0FBR0QsT0FBTyxDQUFDLGFBQUQsQ0FBeEI7O0FBQ0EsSUFBSUUsUUFBUSxHQUFHRixPQUFPLENBQUMsV0FBRCxDQUF0Qjs7QUFDQSxJQUFJRyxhQUFhLEdBQUdILE9BQU8sQ0FBQyxnQkFBRCxDQUEzQjs7QUFDQSxJQUFJSSxVQUFVLEdBQUdKLE9BQU8sQ0FBQyxhQUFELENBQXhCOztBQUNBLElBQUlLLFNBQVMsR0FBR0wsT0FBTyxDQUFDLFlBQUQsQ0FBdkI7O0FBQ0EsSUFBSU0sY0FBYyxHQUFHTixPQUFPLENBQUMsaUJBQUQsQ0FBNUI7O0FBQ0EsSUFBSU8sZUFBZSxHQUFHUCxPQUFPLENBQUMsa0JBQUQsQ0FBN0I7O0FBQ0EsSUFBSVEsQ0FBQyxHQUFHQyxFQUFFLENBQUNDLFVBQVg7QUFDQSxJQUFJQyxDQUFDLEdBQUdILENBQUMsQ0FBQ0ksT0FBVjtBQUNBLElBQUlDLENBQUMsR0FBR0wsQ0FBQyxDQUFDTSxRQUFWOztBQUNBLElBQUlDLENBQUMsR0FBSSxVQUFVQyxDQUFWLEVBQWE7RUFDbEIsU0FBU0MsQ0FBVCxHQUFhO0lBQ1QsSUFBSUEsQ0FBQyxHQUFJLFNBQVNELENBQVQsSUFBY0EsQ0FBQyxDQUFDRSxLQUFGLENBQVEsSUFBUixFQUFjQyxTQUFkLENBQWYsSUFBNEMsSUFBcEQ7SUFDQUYsQ0FBQyxDQUFDRyxnQkFBRixHQUFxQixJQUFyQjtJQUNBSCxDQUFDLENBQUNJLGVBQUYsR0FBb0IsSUFBcEI7SUFDQUosQ0FBQyxDQUFDSyxRQUFGLEdBQWEsSUFBYjtJQUNBTCxDQUFDLENBQUNNLFlBQUYsR0FBaUIsSUFBakI7SUFDQU4sQ0FBQyxDQUFDTyxNQUFGLEdBQVcsRUFBWDtJQUNBUCxDQUFDLENBQUNRLFVBQUYsR0FBZSxFQUFmO0lBQ0FSLENBQUMsQ0FBQ1MsVUFBRixHQUFlLEVBQWY7SUFDQVQsQ0FBQyxDQUFDVSxJQUFGLEdBQVMsRUFBVDtJQUNBVixDQUFDLENBQUNXLFVBQUYsR0FBZSxDQUFmO0lBQ0EsT0FBT1gsQ0FBUDtFQUNIOztFQUNEWSxTQUFTLENBQUNaLENBQUQsRUFBSUQsQ0FBSixDQUFUOztFQUNBQyxDQUFDLENBQUNhLFNBQUYsQ0FBWUMsV0FBWixHQUEwQixZQUFZO0lBQ2xDLElBQUlmLENBQUMsR0FBRyxJQUFSO0lBQ0EsS0FBS1EsTUFBTCxHQUFjLEtBQUtRLE9BQUwsQ0FBYUMsS0FBYixDQUFtQkMsUUFBakM7SUFDQSxJQUFJakIsQ0FBQyxHQUFHLEtBQUtlLE9BQUwsQ0FBYUMsS0FBYixDQUFtQkUsV0FBM0I7O0lBQ0EsS0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHLEtBQUtmLGVBQUwsQ0FBcUJnQixRQUFyQixDQUE4QkMsTUFBbEQsRUFBMERGLENBQUMsRUFBM0QsRUFBK0Q7TUFDM0QsS0FBS1QsSUFBTCxDQUFVUyxDQUFWLElBQWUsS0FBS2YsZUFBTCxDQUFxQmdCLFFBQXJCLENBQThCRCxDQUE5QixFQUFpQ0csUUFBakMsQ0FBMENDLEtBQTFDLEVBQWY7SUFDSDs7SUFDRCxJQUFJMUMsQ0FBQyxHQUFHMkMsSUFBSSxDQUFDQyxHQUFMLENBQVN6QixDQUFULEVBQVksS0FBS08sTUFBTCxDQUFZYyxNQUF4QixDQUFSO0lBQ0EsS0FBS2IsVUFBTCxHQUFrQnBCLFNBQVMsV0FBVCxDQUFrQnNDLFNBQWxCLENBQTRCLEtBQUtuQixNQUFqQyxFQUF5QzFCLENBQXpDLENBQWxCO0lBQ0EsS0FBSzJCLFVBQUwsQ0FBZ0JtQixPQUFoQixDQUF3QixVQUFVM0IsQ0FBVixFQUFhO01BQ2pDRCxDQUFDLENBQUNVLFVBQUYsQ0FBYW1CLElBQWIsQ0FBa0I3QixDQUFDLENBQUNRLE1BQUYsQ0FBU3NCLE9BQVQsQ0FBaUI3QixDQUFqQixDQUFsQjtJQUNILENBRkQ7O0lBR0EsSUFBSSxLQUFLTyxNQUFMLENBQVljLE1BQVosR0FBcUIsRUFBekIsRUFBNkI7TUFDekIsSUFBSVMsQ0FBQyxHQUFHLEtBQUssS0FBS3ZCLE1BQUwsQ0FBWWMsTUFBekI7O01BQ0EsS0FBS0YsQ0FBQyxHQUFHLENBQVQsRUFBWUEsQ0FBQyxHQUFHVyxDQUFoQixFQUFtQlgsQ0FBQyxFQUFwQixFQUF3QjtRQUNwQixLQUFLWixNQUFMLENBQVlxQixJQUFaLENBQWlCLEtBQUtyQixNQUFMLENBQVluQixTQUFTLFdBQVQsQ0FBa0IyQyxVQUFsQixDQUE2QixDQUE3QixFQUFnQyxLQUFLeEIsTUFBTCxDQUFZYyxNQUFaLEdBQXFCLENBQXJELENBQVosQ0FBakI7TUFDSDtJQUNKOztJQUNEVyxPQUFPLENBQUNDLEdBQVIsQ0FBWSxNQUFaLEVBQW9CLEtBQUsxQixNQUF6QjtJQUNBeUIsT0FBTyxDQUFDQyxHQUFSLENBQVksS0FBWixFQUFtQixLQUFLeEIsVUFBeEIsRUFBb0MsS0FBS0QsVUFBekM7SUFDQSxLQUFLMEIsTUFBTDtJQUNBLEtBQUtDLFNBQUw7RUFDSCxDQXRCRDs7RUF1QkFuQyxDQUFDLENBQUNhLFNBQUYsQ0FBWXVCLFFBQVosR0FBdUIsWUFBWTtJQUMvQixLQUFLOUIsWUFBTCxDQUFrQitCLEVBQWxCLENBQXFCN0MsRUFBRSxDQUFDOEMsSUFBSCxDQUFRQyxTQUFSLENBQWtCQyxXQUF2QyxFQUFvRCxLQUFLQyxRQUF6RCxFQUFtRSxJQUFuRTtFQUNILENBRkQ7O0VBR0F6QyxDQUFDLENBQUNhLFNBQUYsQ0FBWTZCLFdBQVosR0FBMEIsWUFBWTtJQUNsQyxLQUFLcEMsWUFBTCxDQUFrQnFDLEdBQWxCLENBQXNCbkQsRUFBRSxDQUFDOEMsSUFBSCxDQUFRQyxTQUFSLENBQWtCQyxXQUF4QyxFQUFxRCxLQUFLQyxRQUExRCxFQUFvRSxJQUFwRTtFQUNILENBRkQ7O0VBR0F6QyxDQUFDLENBQUNhLFNBQUYsQ0FBWXFCLE1BQVosR0FBcUIsWUFBWTtJQUM3QixJQUFJbkMsQ0FBQyxHQUFHLElBQVI7O0lBQ0EsSUFBSUMsQ0FBQyxHQUFHLFdBQVVBLEVBQVYsRUFBYTtNQUNqQixJQUFJbkIsQ0FBQyxHQUFHc0MsQ0FBQyxDQUFDaEIsZ0JBQUYsQ0FBbUJpQixRQUFuQixDQUE0QnBCLEVBQTVCLENBQVI7TUFDQW5CLENBQUMsQ0FBQytELE1BQUYsR0FBVyxDQUFDLENBQVo7O01BQ0EsSUFBSXpCLENBQUMsQ0FBQ1YsVUFBRixDQUFhWSxNQUFiLElBQXVCckIsRUFBM0IsRUFBOEI7UUFDMUJuQixDQUFDLENBQUMrRCxNQUFGLEdBQVcsQ0FBQyxDQUFaO1FBQ0EsT0FBTyxVQUFQO01BQ0g7O01BQ0QsSUFBSWQsQ0FBQyxHQUFHekMsY0FBYyxXQUFkLENBQXVCd0QsUUFBdkIsQ0FBZ0NDLGVBQWhDLENBQWdEQyxHQUFoRCxDQUFvRDVCLENBQUMsQ0FBQ1gsVUFBRixDQUFhUixFQUFiLENBQXBELENBQVI7TUFDQSxJQUFJZ0QsQ0FBQyxHQUFHbkUsQ0FBQyxDQUFDdUMsUUFBRixDQUFXLENBQVgsRUFBYzZCLFlBQWQsQ0FBMkJ6RCxFQUFFLENBQUMwRCxNQUE5QixDQUFSO01BQ0FwRSxhQUFhLFdBQWIsQ0FBc0IrRCxRQUF0QixDQUErQk0sT0FBL0IsQ0FDSW5FLFVBQVUsQ0FBQ29FLFdBQVgsQ0FBdUJDLFVBRDNCLEVBRUksQ0FBQyxhQUFhdkIsQ0FBQyxDQUFDd0IsSUFBaEIsQ0FGSixFQUdJOUQsRUFBRSxDQUFDK0QsV0FIUCxFQUlJLElBSkosRUFLSSxVQUFVdkQsQ0FBVixFQUFhbUIsQ0FBYixFQUFnQjtRQUNaLElBQUl0QyxDQUFDLEdBQUdzQyxDQUFDLENBQUMsQ0FBRCxDQUFUOztRQUNBLElBQUl0QyxDQUFDLElBQUlXLEVBQUUsQ0FBQ2dFLE9BQUgsQ0FBV1IsQ0FBWCxDQUFULEVBQXdCO1VBQ3BCQSxDQUFDLENBQUNTLFdBQUYsR0FBZ0J4RSxRQUFRLENBQUN5RSxPQUFULENBQWlCQyxVQUFqQixDQUE0QjlFLENBQTVCLEVBQStCa0IsQ0FBQyxDQUFDNkQsSUFBakMsQ0FBaEI7UUFDSDtNQUNKLENBVkw7TUFZQS9FLENBQUMsQ0FBQ3VDLFFBQUYsQ0FBVyxDQUFYLEVBQWM2QixZQUFkLENBQTJCekQsRUFBRSxDQUFDcUUsS0FBOUIsRUFBcUNDLE1BQXJDLEdBQThDaEMsQ0FBQyxDQUFDaUMsSUFBaEQ7TUFDQWxGLENBQUMsQ0FBQ3VDLFFBQUYsQ0FBVyxDQUFYLEVBQWM2QixZQUFkLENBQTJCekQsRUFBRSxDQUFDcUUsS0FBOUIsRUFBcUNDLE1BQXJDLEdBQThDaEMsQ0FBQyxDQUFDa0MsVUFBaEQ7TUFDQW5GLENBQUMsQ0FBQytELE1BQUYsR0FBVyxDQUFDLENBQVo7SUFDSCxDQXhCRDs7SUF5QkEsSUFBSXpCLENBQUMsR0FBRyxJQUFSOztJQUNBLEtBQUssSUFBSXRDLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUcsS0FBS3NCLGdCQUFMLENBQXNCaUIsUUFBdEIsQ0FBK0JDLE1BQW5ELEVBQTJEeEMsQ0FBQyxFQUE1RCxFQUFnRTtNQUM1RG1CLENBQUMsQ0FBQ25CLENBQUQsQ0FBRDtJQUNIOztJQUNELElBQUlpRCxDQUFDLEdBQUcsU0FBSkEsQ0FBSSxDQUFVOUIsQ0FBVixFQUFhO01BQ2pCLElBQUltQixDQUFDLEdBQUc5QixjQUFjLFdBQWQsQ0FBdUJ3RCxRQUF2QixDQUFnQ0MsZUFBaEMsQ0FBZ0RDLEdBQWhELENBQW9EQyxDQUFDLENBQUN6QyxNQUFGLENBQVNQLENBQVQsQ0FBcEQsQ0FBUjtNQUNBLElBQUluQixDQUFDLEdBQUdtRSxDQUFDLENBQUM1QyxlQUFGLENBQWtCZ0IsUUFBbEIsQ0FBMkJwQixDQUEzQixFQUE4Qm9CLFFBQTlCLENBQXVDLENBQXZDLEVBQTBDNkIsWUFBMUMsQ0FBdUR6RCxFQUFFLENBQUMwRCxNQUExRCxDQUFSO01BQ0FwRSxhQUFhLFdBQWIsQ0FBc0IrRCxRQUF0QixDQUErQk0sT0FBL0IsQ0FDSW5FLFVBQVUsQ0FBQ29FLFdBQVgsQ0FBdUJDLFVBRDNCLEVBRUksQ0FBQyxhQUFhbEMsQ0FBQyxDQUFDbUMsSUFBaEIsQ0FGSixFQUdJOUQsRUFBRSxDQUFDK0QsV0FIUCxFQUlJLElBSkosRUFLSSxVQUFVdkQsQ0FBVixFQUFhbUIsQ0FBYixFQUFnQjtRQUNaLElBQUlXLENBQUMsR0FBR1gsQ0FBQyxDQUFDLENBQUQsQ0FBVDs7UUFDQSxJQUFJVyxDQUFDLElBQUl0QyxFQUFFLENBQUNnRSxPQUFILENBQVczRSxDQUFYLENBQVQsRUFBd0I7VUFDcEJBLENBQUMsQ0FBQzRFLFdBQUYsR0FBZ0J4RSxRQUFRLENBQUN5RSxPQUFULENBQWlCQyxVQUFqQixDQUE0QjdCLENBQTVCLEVBQStCL0IsQ0FBQyxDQUFDNkQsSUFBakMsQ0FBaEI7UUFDSDtNQUNKLENBVkw7SUFZSCxDQWZEOztJQWdCQSxJQUFJWixDQUFDLEdBQUcsSUFBUjs7SUFDQSxLQUFLbkUsQ0FBQyxHQUFHLENBQVQsRUFBWUEsQ0FBQyxHQUFHLEtBQUswQixNQUFMLENBQVljLE1BQTVCLEVBQW9DeEMsQ0FBQyxFQUFyQyxFQUF5QztNQUNyQ2lELENBQUMsQ0FBQ2pELENBQUQsQ0FBRDtJQUNIO0VBQ0osQ0FuREQ7O0VBb0RBbUIsQ0FBQyxDQUFDYSxTQUFGLENBQVlzQixTQUFaLEdBQXdCLFlBQVk7SUFDaEMsSUFBSXBDLENBQUMsR0FBRyxJQUFSO0lBQ0EsS0FBS1ksVUFBTCxHQUFrQixDQUFsQjtJQUNBLElBQUlYLENBQUMsR0FBRyxDQUFSO0lBQ0EsSUFBSW1CLENBQUMsR0FBRy9CLFNBQVMsV0FBVCxDQUFrQjhCLFdBQWxCLENBQThCLENBQTlCLEVBQWlDLEVBQWpDLEVBQXFDLEtBQUtULFVBQUwsQ0FBZ0JZLE1BQXJELENBQVI7O0lBQ0EsS0FBSyxJQUFJeEMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBRyxLQUFLNEIsVUFBTCxDQUFnQlksTUFBcEMsRUFBNEN4QyxDQUFDLEVBQTdDLEVBQWlEO01BQzdDLElBQUlpRCxDQUFDLEdBQUcsS0FBS3pCLFFBQUwsQ0FBY2UsUUFBZCxDQUF1QnZDLENBQXZCLENBQVI7TUFDQWlELENBQUMsQ0FBQ2MsTUFBRixHQUFXLENBQUMsQ0FBWjtNQUNBLEtBQUtxQixRQUFMLENBQWNuQyxDQUFkLEVBQWlCWCxDQUFDLENBQUN0QyxDQUFELENBQWxCLEVBQXVCQSxDQUF2QixFQUEwQixZQUFZO1FBQ2xDLElBQUksRUFBRW1CLENBQUYsSUFBT0QsQ0FBQyxDQUFDVSxVQUFGLENBQWFZLE1BQXhCLEVBQWdDO1VBQzVCdEIsQ0FBQyxDQUFDWSxVQUFGLEdBQWUsQ0FBZjtRQUNIO01BQ0osQ0FKRDtJQUtIO0VBQ0osQ0FkRDs7RUFlQVgsQ0FBQyxDQUFDYSxTQUFGLENBQVlvRCxRQUFaLEdBQXVCLFVBQVVsRSxDQUFWLEVBQWFDLENBQWIsRUFBZ0JtQixDQUFoQixFQUFtQnRDLENBQW5CLEVBQXNCO0lBQ3pDLElBQUlpRCxDQUFDLEdBQUcsSUFBUjtJQUNBL0IsQ0FBQyxDQUFDdUIsUUFBRixHQUFhLEtBQUtaLElBQUwsQ0FBVVYsQ0FBVixFQUFhdUIsS0FBYixFQUFiO0lBQ0EsSUFBSXlCLENBQUo7SUFDQSxJQUFJa0IsQ0FBQyxHQUFHLEtBQUt6RCxVQUFMLENBQWdCVSxDQUFoQixDQUFSO0lBQ0EsSUFBSWdELENBQUMsR0FBRyxLQUFLLE1BQU1uQixDQUFDLEdBQUdrQixDQUFDLEdBQUdsRSxDQUFKLEdBQVEsS0FBS0EsQ0FBTCxHQUFTa0UsQ0FBVCxHQUFhLENBQXJCLEdBQXlCQSxDQUFDLEdBQUdsRSxDQUF2QyxJQUE0Q2tFLENBQWpELENBQVI7SUFDQSxJQUFJRSxDQUFDLEdBQUcsS0FBS3BCLENBQUwsR0FBUyxLQUFLdkMsVUFBTCxDQUFnQlUsQ0FBaEIsQ0FBakI7SUFDQSxJQUFJa0QsQ0FBQyxHQUFHckUsQ0FBUjtJQUNBLElBQUlzRSxDQUFDLEdBQUc5RSxFQUFFLENBQUMrRSxLQUFILENBQVN4RSxDQUFULENBQVI7O0lBQ0EsS0FBSyxJQUFJeUUsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0osQ0FBcEIsRUFBdUJJLENBQUMsRUFBeEIsRUFBNEI7TUFDeEIsRUFBRUgsQ0FBRixJQUFPLEVBQVAsS0FBY0EsQ0FBQyxHQUFHLENBQWxCO01BQ0FDLENBQUMsQ0FBQ0csRUFBRixDQUFLTixDQUFMLEVBQVE7UUFDSjdDLFFBQVEsRUFBRSxLQUFLWixJQUFMLENBQVUyRCxDQUFWO01BRE4sQ0FBUjtJQUdIOztJQUNEQyxDQUFDLENBQUNJLElBQUYsQ0FBTyxZQUFZO01BQ2Y1QyxDQUFDLENBQUMzQixnQkFBRixDQUFtQmlCLFFBQW5CLENBQTRCRCxDQUE1QixFQUErQnlCLE1BQS9CLEdBQXdDLENBQUMsQ0FBekM7O01BQ0EsSUFBSS9ELENBQUosRUFBTztRQUNIQSxDQUFDO01BQ0o7SUFDSixDQUxEO0lBTUF5RixDQUFDLENBQUNLLE1BQUYsQ0FDSSxDQURKLEVBRUluRixFQUFFLENBQ0crRSxLQURMLEdBRUtFLEVBRkwsQ0FFUSxHQUZSLEVBRWE7TUFDTEcsT0FBTyxFQUFFO0lBREosQ0FGYixFQUtLSCxFQUxMLENBS1EsR0FMUixFQUthO01BQ0xHLE9BQU8sRUFBRTtJQURKLENBTGIsQ0FGSjtJQVdBTixDQUFDLENBQUNPLEtBQUY7RUFDSCxDQWpDRDs7RUFrQ0E3RSxDQUFDLENBQUNhLFNBQUYsQ0FBWTRCLFFBQVosR0FBdUIsWUFBWTtJQUMvQixJQUFJLE1BQU0sS0FBSzlCLFVBQWYsRUFBMkI7TUFDdkIsS0FBS0EsVUFBTCxHQUFrQixDQUFsQjs7TUFDQSxLQUFLLElBQUlYLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUcsS0FBS1MsVUFBTCxDQUFnQlksTUFBcEMsRUFBNENyQixDQUFDLEVBQTdDLEVBQWlEO1FBQzdDUixFQUFFLENBQUNzRixLQUFILENBQVNDLGVBQVQsQ0FBeUIsS0FBSzFFLFFBQUwsQ0FBY2UsUUFBZCxDQUF1QnBCLENBQXZCLENBQXpCO1FBQ0EsS0FBS0ssUUFBTCxDQUFjZSxRQUFkLENBQXVCcEIsQ0FBdkIsRUFBMEI0QyxNQUExQixHQUFtQyxDQUFDLENBQXBDO1FBQ0EsS0FBS3ZDLFFBQUwsQ0FBY2UsUUFBZCxDQUF1QnBCLENBQXZCLEVBQTBCNEUsT0FBMUIsR0FBb0MsR0FBcEM7UUFDQSxLQUFLdkUsUUFBTCxDQUFjZSxRQUFkLENBQXVCcEIsQ0FBdkIsRUFBMEJzQixRQUExQixHQUFxQyxLQUFLWixJQUFMLENBQVUsS0FBS0QsVUFBTCxDQUFnQlQsQ0FBaEIsQ0FBVixDQUFyQztRQUNBLEtBQUtHLGdCQUFMLENBQXNCaUIsUUFBdEIsQ0FBK0JwQixDQUEvQixFQUFrQzRDLE1BQWxDLEdBQTJDLENBQUMsQ0FBNUM7TUFDSDtJQUNKLENBVEQsTUFTTztNQUNILElBQUksTUFBTSxLQUFLakMsVUFBWCxJQUF5QixNQUFNLEtBQUtBLFVBQXhDLEVBQW9EO1FBQ2hELEtBQUtBLFVBQUwsR0FBa0IsQ0FBbEI7O1FBQ0EsS0FBS1gsQ0FBQyxHQUFHLENBQVQsRUFBWUEsQ0FBQyxHQUFHLEtBQUtRLFVBQUwsQ0FBZ0JhLE1BQWhDLEVBQXdDckIsQ0FBQyxFQUF6QyxFQUE2QztVQUN6Q2QsYUFBYSxXQUFiLENBQXNCOEYsSUFBdEIsQ0FBMkIxRixlQUFlLFdBQWYsQ0FBd0IyRixZQUFuRCxFQUFpRSxLQUFLekUsVUFBTCxDQUFnQlIsQ0FBaEIsQ0FBakU7UUFDSDs7UUFDREQsQ0FBQyxDQUFDYyxTQUFGLENBQVlxRSxZQUFaLENBQXlCUixJQUF6QixDQUE4QixJQUE5QjtNQUNIO0lBQ0o7RUFDSixDQW5CRDs7RUFvQkFTLFVBQVUsQ0FBQyxDQUFDdkYsQ0FBQyxDQUFDSixFQUFFLENBQUM4QyxJQUFKLENBQUYsQ0FBRCxFQUFldEMsQ0FBQyxDQUFDYSxTQUFqQixFQUE0QixrQkFBNUIsRUFBZ0QsS0FBSyxDQUFyRCxDQUFWOztFQUNBc0UsVUFBVSxDQUFDLENBQUN2RixDQUFDLENBQUNKLEVBQUUsQ0FBQzhDLElBQUosQ0FBRixDQUFELEVBQWV0QyxDQUFDLENBQUNhLFNBQWpCLEVBQTRCLGlCQUE1QixFQUErQyxLQUFLLENBQXBELENBQVY7O0VBQ0FzRSxVQUFVLENBQUMsQ0FBQ3ZGLENBQUMsQ0FBQ0osRUFBRSxDQUFDOEMsSUFBSixDQUFGLENBQUQsRUFBZXRDLENBQUMsQ0FBQ2EsU0FBakIsRUFBNEIsVUFBNUIsRUFBd0MsS0FBSyxDQUE3QyxDQUFWOztFQUNBc0UsVUFBVSxDQUFDLENBQUN2RixDQUFDLENBQUNKLEVBQUUsQ0FBQzhDLElBQUosQ0FBRixDQUFELEVBQWV0QyxDQUFDLENBQUNhLFNBQWpCLEVBQTRCLGNBQTVCLEVBQTRDLEtBQUssQ0FBakQsQ0FBVjs7RUFDQSxPQUFPc0UsVUFBVSxDQUFDLENBQUN6RixDQUFELENBQUQsRUFBTU0sQ0FBTixDQUFqQjtBQUNILENBMUtPLENBMEtMYixVQUFVLENBQUNpRyxTQTFLTixDQUFSOztBQTJLQUMsT0FBTyxXQUFQLEdBQWtCdkYsQ0FBbEIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBvO1xyXG52YXIgJGFzc2V0c0xvYWRlciA9IHJlcXVpcmUoXCIuL0Fzc2V0c0xvYWRlclwiKTtcclxudmFyICRhc3NldHNNYXAgPSByZXF1aXJlKFwiLi9Bc3NldHNNYXBcIik7XHJcbnZhciAkcmVzVXRpbCA9IHJlcXVpcmUoXCIuL1Jlc1V0aWxcIik7XHJcbnZhciAkZXZlbnRNYW5hZ2VyID0gcmVxdWlyZShcIi4vRXZlbnRNYW5hZ2VyXCIpO1xyXG52YXIgJHBvcHVwVmlldyA9IHJlcXVpcmUoXCIuL1BvcHVwVmlld1wiKTtcclxudmFyICRzZWVkVXRpbCA9IHJlcXVpcmUoXCIuL1NlZWRVdGlsXCIpO1xyXG52YXIgJGNvbmZpZ0NvbnRleHQgPSByZXF1aXJlKFwiLi9Db25maWdDb250ZXh0XCIpO1xyXG52YXIgJGxvY2FsRXZlbnROYW1lID0gcmVxdWlyZShcIi4vTG9jYWxFdmVudE5hbWVcIik7XHJcbnZhciBoID0gY2MuX2RlY29yYXRvcjtcclxudmFyIG0gPSBoLmNjY2xhc3M7XHJcbnZhciB5ID0gaC5wcm9wZXJ0eTtcclxudmFyIGcgPSAoZnVuY3Rpb24gKHQpIHtcclxuICAgIGZ1bmN0aW9uIGUoKSB7XHJcbiAgICAgICAgdmFyIGUgPSAobnVsbCAhPT0gdCAmJiB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIHx8IHRoaXM7XHJcbiAgICAgICAgZS5jaG9vc2VTa2lsbExheWVyID0gbnVsbDtcclxuICAgICAgICBlLmNob29zZUFuaW1MYXllciA9IG51bGw7XHJcbiAgICAgICAgZS5ib3hMYXllciA9IG51bGw7XHJcbiAgICAgICAgZS5jbG9zZUNvbnRlbnQgPSBudWxsO1xyXG4gICAgICAgIGUuc2tpbGxzID0gW107XHJcbiAgICAgICAgZS5jdXJyU2tpbGxzID0gW107XHJcbiAgICAgICAgZS5jdXJySW5kZXhzID0gW107XHJcbiAgICAgICAgZS5wb3NzID0gW107XHJcbiAgICAgICAgZS5hbmltU3RhdHVzID0gMDtcclxuICAgICAgICByZXR1cm4gZTtcclxuICAgIH1cclxuICAgIF9fZXh0ZW5kcyhlLCB0KTtcclxuICAgIGUucHJvdG90eXBlLm9uUmVzZXRWaWV3ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciB0ID0gdGhpcztcclxuICAgICAgICB0aGlzLnNraWxscyA9IHRoaXMudWlQYXJhbS5wYXJhbS5za2lsbElkcztcclxuICAgICAgICB2YXIgZSA9IHRoaXMudWlQYXJhbS5wYXJhbS5yYW5kb21Db3VudDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY2hvb3NlQW5pbUxheWVyLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRoaXMucG9zc1tpXSA9IHRoaXMuY2hvb3NlQW5pbUxheWVyLmNoaWxkcmVuW2ldLnBvc2l0aW9uLmNsb25lKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBvID0gTWF0aC5taW4oZSwgdGhpcy5za2lsbHMubGVuZ3RoKTtcclxuICAgICAgICB0aGlzLmN1cnJTa2lsbHMgPSAkc2VlZFV0aWwuZGVmYXVsdC5yYW5kb21BcnIodGhpcy5za2lsbHMsIG8pO1xyXG4gICAgICAgIHRoaXMuY3VyclNraWxscy5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIHQuY3VyckluZGV4cy5wdXNoKHQuc2tpbGxzLmluZGV4T2YoZSkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmICh0aGlzLnNraWxscy5sZW5ndGggPCAxMikge1xyXG4gICAgICAgICAgICB2YXIgbiA9IDEyIC0gdGhpcy5za2lsbHMubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNraWxscy5wdXNoKHRoaXMuc2tpbGxzWyRzZWVkVXRpbC5kZWZhdWx0LnJhbmRvbUZyb20oMCwgdGhpcy5za2lsbHMubGVuZ3RoIC0gMSldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLmxvZyhcIuaKgOiDveaxoDpcIiwgdGhpcy5za2lsbHMpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwi6YCJ5LitOlwiLCB0aGlzLmN1cnJJbmRleHMsIHRoaXMuY3VyclNraWxscyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIoKTtcclxuICAgICAgICB0aGlzLnN0YXJ0QW5pbSgpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLmFkZEV2ZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuY2xvc2VDb250ZW50Lm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX1NUQVJULCB0aGlzLnRvdWNoRW5kLCB0aGlzKTtcclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5yZW1vdmVFdmVudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmNsb3NlQ29udGVudC5vZmYoY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfU1RBUlQsIHRoaXMudG91Y2hFbmQsIHRoaXMpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgdCA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGUgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICB2YXIgbyA9IGkuY2hvb3NlU2tpbGxMYXllci5jaGlsZHJlbltlXTtcclxuICAgICAgICAgICAgby5hY3RpdmUgPSAhMDtcclxuICAgICAgICAgICAgaWYgKGkuY3VyckluZGV4cy5sZW5ndGggPD0gZSkge1xyXG4gICAgICAgICAgICAgICAgby5hY3RpdmUgPSAhMTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBcImNvbnRpbnVlXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIG4gPSAkY29uZmlnQ29udGV4dC5kZWZhdWx0Lmluc3RhbmNlLnNraWxsQ29uZmlnc01hcC5nZXQoaS5jdXJyU2tpbGxzW2VdKTtcclxuICAgICAgICAgICAgdmFyIHMgPSBvLmNoaWxkcmVuWzBdLmdldENvbXBvbmVudChjYy5TcHJpdGUpO1xyXG4gICAgICAgICAgICAkYXNzZXRzTG9hZGVyLmRlZmF1bHQuaW5zdGFuY2UubG9hZFJlcyhcclxuICAgICAgICAgICAgICAgICRhc3NldHNNYXAuQnVuZGxlTmFtZXMuUHVibGljX1JlcyxcclxuICAgICAgICAgICAgICAgIFtcIi9za2lsbHMvXCIgKyBuLmljb25dLFxyXG4gICAgICAgICAgICAgICAgY2MuU3ByaXRlRnJhbWUsXHJcbiAgICAgICAgICAgICAgICBudWxsLFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKGUsIGkpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IGlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG8gJiYgY2MuaXNWYWxpZChzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzLnNwcml0ZUZyYW1lID0gJHJlc1V0aWwuUmVzVXRpbC5hc3NpZ25XaXRoKG8sIHQubm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBvLmNoaWxkcmVuWzFdLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gbi5uYW1lO1xyXG4gICAgICAgICAgICBvLmNoaWxkcmVuWzJdLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gbi5za2lsbF90ZXh0O1xyXG4gICAgICAgICAgICBvLmFjdGl2ZSA9ICExO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIGkgPSB0aGlzO1xyXG4gICAgICAgIGZvciAodmFyIG8gPSAwOyBvIDwgdGhpcy5jaG9vc2VTa2lsbExheWVyLmNoaWxkcmVuLmxlbmd0aDsgbysrKSB7XHJcbiAgICAgICAgICAgIGUobyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBuID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgdmFyIGkgPSAkY29uZmlnQ29udGV4dC5kZWZhdWx0Lmluc3RhbmNlLnNraWxsQ29uZmlnc01hcC5nZXQocy5za2lsbHNbZV0pO1xyXG4gICAgICAgICAgICB2YXIgbyA9IHMuY2hvb3NlQW5pbUxheWVyLmNoaWxkcmVuW2VdLmNoaWxkcmVuWzFdLmdldENvbXBvbmVudChjYy5TcHJpdGUpO1xyXG4gICAgICAgICAgICAkYXNzZXRzTG9hZGVyLmRlZmF1bHQuaW5zdGFuY2UubG9hZFJlcyhcclxuICAgICAgICAgICAgICAgICRhc3NldHNNYXAuQnVuZGxlTmFtZXMuUHVibGljX1JlcyxcclxuICAgICAgICAgICAgICAgIFtcIi9za2lsbHMvXCIgKyBpLmljb25dLFxyXG4gICAgICAgICAgICAgICAgY2MuU3ByaXRlRnJhbWUsXHJcbiAgICAgICAgICAgICAgICBudWxsLFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKGUsIGkpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IGlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG4gJiYgY2MuaXNWYWxpZChvKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvLnNwcml0ZUZyYW1lID0gJHJlc1V0aWwuUmVzVXRpbC5hc3NpZ25XaXRoKG4sIHQubm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIHMgPSB0aGlzO1xyXG4gICAgICAgIGZvciAobyA9IDA7IG8gPCB0aGlzLnNraWxscy5sZW5ndGg7IG8rKykge1xyXG4gICAgICAgICAgICBuKG8pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBlLnByb3RvdHlwZS5zdGFydEFuaW0gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHQgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuYW5pbVN0YXR1cyA9IDE7XHJcbiAgICAgICAgdmFyIGUgPSAwO1xyXG4gICAgICAgIHZhciBpID0gJHNlZWRVdGlsLmRlZmF1bHQucmFuZG9tQ291bnQoMCwgMTEsIHRoaXMuY3VyckluZGV4cy5sZW5ndGgpO1xyXG4gICAgICAgIGZvciAodmFyIG8gPSAwOyBvIDwgdGhpcy5jdXJySW5kZXhzLmxlbmd0aDsgbysrKSB7XHJcbiAgICAgICAgICAgIHZhciBuID0gdGhpcy5ib3hMYXllci5jaGlsZHJlbltvXTtcclxuICAgICAgICAgICAgbi5hY3RpdmUgPSAhMDtcclxuICAgICAgICAgICAgdGhpcy5hbmltSXRlbShuLCBpW29dLCBvLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoKytlID49IHQuY3VyckluZGV4cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0LmFuaW1TdGF0dXMgPSAyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgZS5wcm90b3R5cGUuYW5pbUl0ZW0gPSBmdW5jdGlvbiAodCwgZSwgaSwgbykge1xyXG4gICAgICAgIHZhciBuID0gdGhpcztcclxuICAgICAgICB0LnBvc2l0aW9uID0gdGhpcy5wb3NzW2VdLmNsb25lKCk7XHJcbiAgICAgICAgdmFyIHM7XHJcbiAgICAgICAgdmFyIHIgPSB0aGlzLmN1cnJJbmRleHNbaV07XHJcbiAgICAgICAgdmFyIGEgPSA1IC8gKDYwICsgKHMgPSByIDwgZSA/IDExIC0gZSArIHIgKyAxIDogciAtIGUpICsgcik7XHJcbiAgICAgICAgdmFyIGwgPSA2MCArIHMgKyB0aGlzLmN1cnJJbmRleHNbaV07XHJcbiAgICAgICAgdmFyIGMgPSBlO1xyXG4gICAgICAgIHZhciB1ID0gY2MudHdlZW4odCk7XHJcbiAgICAgICAgZm9yICh2YXIgZCA9IDA7IGQgPCBsOyBkKyspIHtcclxuICAgICAgICAgICAgKytjID49IDEyICYmIChjID0gMCk7XHJcbiAgICAgICAgICAgIHUudG8oYSwge1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHRoaXMucG9zc1tjXVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdS5jYWxsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgbi5jaG9vc2VTa2lsbExheWVyLmNoaWxkcmVuW2ldLmFjdGl2ZSA9ICEwO1xyXG4gICAgICAgICAgICBpZiAobykge1xyXG4gICAgICAgICAgICAgICAgbygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdS5yZXBlYXQoXHJcbiAgICAgICAgICAgIDIsXHJcbiAgICAgICAgICAgIGNjXHJcbiAgICAgICAgICAgICAgICAudHdlZW4oKVxyXG4gICAgICAgICAgICAgICAgLnRvKDAuMywge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDBcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAudG8oMC4zLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMjU1XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdS5zdGFydCgpO1xyXG4gICAgfTtcclxuICAgIGUucHJvdG90eXBlLnRvdWNoRW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICgxID09PSB0aGlzLmFuaW1TdGF0dXMpIHtcclxuICAgICAgICAgICAgdGhpcy5hbmltU3RhdHVzID0gMztcclxuICAgICAgICAgICAgZm9yICh2YXIgZSA9IDA7IGUgPCB0aGlzLmN1cnJJbmRleHMubGVuZ3RoOyBlKyspIHtcclxuICAgICAgICAgICAgICAgIGNjLlR3ZWVuLnN0b3BBbGxCeVRhcmdldCh0aGlzLmJveExheWVyLmNoaWxkcmVuW2VdKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYm94TGF5ZXIuY2hpbGRyZW5bZV0uYWN0aXZlID0gITA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJveExheWVyLmNoaWxkcmVuW2VdLm9wYWNpdHkgPSAyNTU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJveExheWVyLmNoaWxkcmVuW2VdLnBvc2l0aW9uID0gdGhpcy5wb3NzW3RoaXMuY3VyckluZGV4c1tlXV07XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNob29zZVNraWxsTGF5ZXIuY2hpbGRyZW5bZV0uYWN0aXZlID0gITA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoMiA9PT0gdGhpcy5hbmltU3RhdHVzIHx8IDMgPT09IHRoaXMuYW5pbVN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hbmltU3RhdHVzID0gNDtcclxuICAgICAgICAgICAgICAgIGZvciAoZSA9IDA7IGUgPCB0aGlzLmN1cnJTa2lsbHMubGVuZ3RoOyBlKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAkZXZlbnRNYW5hZ2VyLmRlZmF1bHQuc2VuZCgkbG9jYWxFdmVudE5hbWUuZGVmYXVsdC5DSE9PU0VfU0tJTEwsIHRoaXMuY3VyclNraWxsc1tlXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0LnByb3RvdHlwZS5vbkNsaWNrQ2xvc2UuY2FsbCh0aGlzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBfX2RlY29yYXRlKFt5KGNjLk5vZGUpXSwgZS5wcm90b3R5cGUsIFwiY2hvb3NlU2tpbGxMYXllclwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbeShjYy5Ob2RlKV0sIGUucHJvdG90eXBlLCBcImNob29zZUFuaW1MYXllclwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbeShjYy5Ob2RlKV0sIGUucHJvdG90eXBlLCBcImJveExheWVyXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFt5KGNjLk5vZGUpXSwgZS5wcm90b3R5cGUsIFwiY2xvc2VDb250ZW50XCIsIHZvaWQgMCk7XHJcbiAgICByZXR1cm4gX19kZWNvcmF0ZShbbV0sIGUpO1xyXG59KSgkcG9wdXBWaWV3LlBvcHVwVmlldyk7XHJcbmV4cG9ydHMuZGVmYXVsdCA9IGc7XHJcbiJdfQ==