{"version":3,"sources":["assets\\game_script\\scripts\\CacheContext.js"],"names":["exports","CacheContext","$assetsLoader","require","$assetsMap","$resManager","r","t","bundleNames","cacheMaxBundleCount","cacheMusicPath","Map","cacheAudio","prototype","cacheBundle","includes","e","indexOf","i","splice","push","length","o","shift","ResManager","instance","releaseBundle","playMusic","s","has","set","Set","get","add","loadRes","BundleNames","Public_Res","cc","AudioClip","console","log","n","clearMusic","forEach","assetManager","getBundle","release"],"mappings":"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","sourceRoot":"/","sourcesContent":["exports.CacheContext = void 0;\r\nvar $assetsLoader = require(\"./AssetsLoader\");\r\nvar $assetsMap = require(\"./AssetsMap\");\r\nvar $resManager = require(\"./ResManager\");\r\nvar r = (function () {\r\n    function t() {\r\n        this.bundleNames = [];\r\n        this.cacheMaxBundleCount = 5;\r\n        this.cacheMusicPath = new Map();\r\n        this.cacheAudio = new Map();\r\n    }\r\n    t.prototype.cacheBundle = function (t) {\r\n        if (this.bundleNames.includes(t)) {\r\n            var e = this.bundleNames.indexOf(t);\r\n            var i = this.bundleNames.splice(e, 1)[0];\r\n            this.bundleNames.push(i);\r\n        } else {\r\n            this.bundleNames.push(t);\r\n            if (this.bundleNames.length > this.cacheMaxBundleCount) {\r\n                var o = this.bundleNames.shift();\r\n                $resManager.ResManager.instance.releaseBundle(o);\r\n            }\r\n        }\r\n    };\r\n    t.prototype.playMusic = function (t, e, i) {\r\n        var s = this;\r\n        if (!this.cacheMusicPath.has(t)) {\r\n            this.cacheMusicPath.set(t, new Set());\r\n        }\r\n        this.cacheMusicPath.get(t).add(e);\r\n        this.cacheAudio.has(e)\r\n            ? i && i(this.cacheAudio.get(e))\r\n            : $assetsLoader.default.instance.loadRes(\r\n                  $assetsMap.BundleNames.Public_Res,\r\n                  [\"/sounds/\" + e],\r\n                  cc.AudioClip,\r\n                  null,\r\n                  function (t, o) {\r\n                      console.log(\"加载音频\", e);\r\n                      var n = o[0];\r\n                      s.cacheAudio.set(e, n);\r\n                      if (n && i) {\r\n                          i(n);\r\n                      }\r\n                  }\r\n              );\r\n    };\r\n    t.prototype.clearMusic = function (t) {\r\n        var e = this;\r\n        if (this.cacheMusicPath.has(t)) {\r\n            console.log(\"释放音频资源\");\r\n            this.cacheMusicPath.get(t).forEach(function (t) {\r\n                e.cacheAudio.delete(t);\r\n                cc.assetManager.getBundle(\"public_other\").release(\"/sounds/\" + t);\r\n            });\r\n        }\r\n    };\r\n    t.instance = new t();\r\n    return t;\r\n})();\r\nexports.CacheContext = r;\r\n"]}