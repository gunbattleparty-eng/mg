{"version":3,"sources":["assets\\game_script\\scripts\\TTRewardedVideo.js"],"names":["o","exports","TTRewardedVideo","$audioPlayer","require","$baseAd","a","window","tt","l","t","e","apply","arguments","videoEndCallback","lastTime","tryCount","__extends","prototype","loadAd","adUnitId","createRewardedVideoAd","console","log","adIns","onLoad","onClose","onError","load","warn","error","showRewardedVideo","i","show","showCallback","closeCallback","musicVolume","effectsVolume","effectVolume","isCanShow","isAutoShow","isConsume","reCreateAd","isLoaded","showing","n","then","pause","resume","destroyAd","autoShow","onAdLoad","onAdError","onAdClose","isEnded","isOpenPreLoad","offLoad","offClose","offError","destroy","BaseAd"],"mappings":"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","sourceRoot":"/","sourcesContent":["var o;\r\nexports.TTRewardedVideo = void 0;\r\nvar $audioPlayer = require(\"./AudioPlayer\");\r\nvar $baseAd = require(\"./BaseAd\");\r\nvar a = window.tt;\r\nvar l = (function (t) {\r\n    function e() {\r\n        var e = (null !== t && t.apply(this, arguments)) || this;\r\n        e.videoEndCallback = null;\r\n        e.lastTime = 0;\r\n        e.tryCount = 0;\r\n        return e;\r\n    }\r\n    __extends(e, t);\r\n    e.prototype.loadAd = function () {\r\n        if (this.adUnitId) {\r\n            if (a && a.createRewardedVideoAd) {\r\n                var t = {\r\n                    adUnitId: this.adUnitId\r\n                };\r\n                console.log(\"创建激励视频\", t);\r\n                this.adIns = a.createRewardedVideoAd(t);\r\n                if (this.adIns.onLoad) {\r\n                    this.adIns.onLoad(this.onLoad);\r\n                }\r\n                if (this.adIns.onClose) {\r\n                    this.adIns.onClose(this.onClose);\r\n                }\r\n                if (this.adIns.onError) {\r\n                    this.adIns.onError(this.onError);\r\n                }\r\n                this.adIns.load();\r\n            } else {\r\n                console.warn(\"当前平台不支持创建激励视频\");\r\n            }\r\n        } else {\r\n            console.error(\"头条激励视频ID为空\");\r\n        }\r\n    };\r\n    e.prototype.showRewardedVideo = function (t, e, i) {\r\n        this.tryCount = 0;\r\n        this.show(t, e, i);\r\n    };\r\n    e.prototype.show = function (t, e, i) {\r\n        var o = this;\r\n        this.showCallback = t;\r\n        this.closeCallback = e;\r\n        this.videoEndCallback = i;\r\n        this.musicVolume = $audioPlayer.default.musicVolume;\r\n        this.effectsVolume = $audioPlayer.default.effectVolume;\r\n        if (this.isCanShow) {\r\n            if (!this.adIns) {\r\n                console.warn(this.adUnitId, \":未创建，执行创建\");\r\n                this.isAutoShow = !0;\r\n                return this.loadAd();\r\n            }\r\n            if (this.isConsume) {\r\n                this.reCreateAd(!0);\r\n            } else {\r\n                {\r\n                    if (!this.isLoaded) {\r\n                        console.warn(this.adUnitId, \":未加载完成，稍等\");\r\n                        return void (this.isAutoShow = !0);\r\n                    }\r\n                    if (this.showing) {\r\n                        console.warn(this.adUnitId, \"广告正在显示中\");\r\n                    } else {\r\n                        this.showing = !1;\r\n                        if (this.adIns.show) {\r\n                            var n = this.adIns.show();\r\n                            n && n.then\r\n                                ? n\r\n                                      .then(function () {\r\n                                          o.tryCount = 0;\r\n                                          o.isConsume = !0;\r\n                                          o.showing = !0;\r\n                                          if (o.showCallback) {\r\n                                              o.showCallback();\r\n                                          }\r\n                                          o.showCallback = null;\r\n                                          o.pause();\r\n                                      })\r\n                                      .catch(function (t) {\r\n                                          console.warn(o.adUnitId, \":show错误，重新加载\", t);\r\n                                          o.reCreateAd(!0);\r\n                                          o.resume();\r\n                                      })\r\n                                : (console.warn(this.adUnitId, \":show显示失败，重新加载\"),\r\n                                  this.reCreateAd(!0),\r\n                                  this.resume());\r\n                        } else {\r\n                            this.resume();\r\n                            console.error(this.adUnitId, \":未知错误\");\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            console.warn(this.adUnitId, \":当前广告禁止显示\");\r\n        }\r\n    };\r\n    e.prototype.reCreateAd = function (t) {\r\n        this.tryCount++;\r\n        this.tryCount >= 4 ? (this.isAutoShow = !1) : (this.destroyAd(), (this.isAutoShow = t), this.loadAd());\r\n    };\r\n    e.prototype.autoShow = function () {\r\n        if (this.isAutoShow) {\r\n            this.isAutoShow = !1;\r\n            this.showRewardedVideo(this.showCallback, this.closeCallback, this.videoEndCallback);\r\n        }\r\n    };\r\n    e.prototype.onAdLoad = function () {\r\n        console.log(this.adUnitId, \":===onAdload===\");\r\n        this.isConsume = !1;\r\n        this.isLoaded = !0;\r\n        this.autoShow();\r\n    };\r\n    e.prototype.onAdError = function (t) {\r\n        console.log(\"激励视频onAdError\", this.adUnitId, t);\r\n        this.showing = !1;\r\n        this.resume();\r\n        this.destroyAd();\r\n    };\r\n    e.prototype.onAdClose = function (t) {\r\n        console.log(\":===onAdClose===\");\r\n        this.showing = !1;\r\n        t && t.isEnded ? this.videoEndCallback && this.videoEndCallback() : this.closeCallback && this.closeCallback();\r\n        this.isOpenPreLoad ? this.adIns.load() : this.destroyAd();\r\n        this.resume();\r\n    };\r\n    e.prototype.destroyAd = function () {\r\n        this.isLoaded = !1;\r\n        this.isAutoShow = !1;\r\n        this.isConsume = !1;\r\n        this.showCallback = null;\r\n        this.closeCallback = null;\r\n        this.videoEndCallback = null;\r\n        this.showing = !1;\r\n        if (this.adIns) {\r\n            if (this.adIns.offLoad) {\r\n                this.adIns.offLoad(this.onLoad);\r\n            }\r\n            if (this.adIns.offClose) {\r\n                this.adIns.offClose(this.onClose);\r\n            }\r\n            if (this.adIns.offError) {\r\n                this.adIns.offError(this.onError);\r\n            }\r\n            if (this.adIns.destroy) {\r\n                this.adIns.destroy();\r\n            }\r\n            this.adIns = null;\r\n        }\r\n    };\r\n    return e;\r\n})($baseAd.BaseAd);\r\nexports.TTRewardedVideo = l;\r\n"]}