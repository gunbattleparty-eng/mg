{"version":3,"sources":["assets\\game_script\\scripts\\ShopDiamondListItem.js"],"names":["o","$assetsLoader","require","$assetsMap","$resUtil","$eventManager","$popupManager","$platform","$remoteAudio","$util","$aD","$adService","$localEventName","$shopContext","$userDataContext","$startView","v","cc","_decorator","b","ccclass","w","property","A","t","e","apply","arguments","icon","firstLable","countLable","btnBuy","proccessLable","limitLable","config","buyType","__extends","prototype","start","on","clickBuy","init","i","id","is_video","instance","loadRes","BundleNames","Start","SpriteFrame","isValid","spriteFrame","ResUtil","assignWith","node","render","renderLimit","string","reward_num","Ins","getDiamondRecordById","active","isFrist","video_count","vido_num","parent","children","isDiamondBuyDay","playEffectMusic","showRewardedVideo","Platform","currPlatForm","PlatformEnum","TOU_TIAO","toutiao","report","buy","send","RENDER_DOT","MenuType","Shop","addDiamondRecord","count","isReward","isFirst","opearDiamond","push","type","num","PopupManager","open","AssetsMap","PopUpBundles","prefabs","assetsList","RewardView","infos","dayBuyCount","buy_num","updateMaterialState","getComponent","Button","interactable","__decorate","Sprite","Label","Node","Component","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var o;\r\nvar $assetsLoader = require(\"./AssetsLoader\");\r\nvar $assetsMap = require(\"./AssetsMap\");\r\nvar $resUtil = require(\"./ResUtil\");\r\nvar $eventManager = require(\"./EventManager\");\r\nvar $popupManager = require(\"./PopupManager\");\r\nvar $platform = require(\"./Platform\");\r\nvar $remoteAudio = require(\"./RemoteAudio\");\r\nvar $util = require(\"./Util\");\r\nvar $aD = require(\"./AD\");\r\nvar $adService = require(\"./AdService\");\r\nvar $localEventName = require(\"./LocalEventName\");\r\nvar $shopContext = require(\"./ShopContext\");\r\nvar $userDataContext = require(\"./UserDataContext\");\r\nvar $startView = require(\"./StartView\");\r\nvar v = cc._decorator;\r\nvar b = v.ccclass;\r\nvar w = v.property;\r\nvar A = (function (t) {\r\n    function e() {\r\n        var e = (null !== t && t.apply(this, arguments)) || this;\r\n        e.icon = null;\r\n        e.firstLable = null;\r\n        e.countLable = null;\r\n        e.btnBuy = null;\r\n        e.proccessLable = null;\r\n        e.limitLable = null;\r\n        e.config = null;\r\n        e.buyType = 0;\r\n        return e;\r\n    }\r\n    __extends(e, t);\r\n    e.prototype.start = function () {\r\n        this.btnBuy.on(\"click\", this.clickBuy, this);\r\n    };\r\n    e.prototype.init = function (t) {\r\n        var e = this;\r\n        this.buyType = 0;\r\n        this.config = t;\r\n        var i = this.config.id;\r\n        if (0 === this.config.is_video) {\r\n            i = 1;\r\n        }\r\n        $assetsLoader.default.instance.loadRes(\r\n            $assetsMap.BundleNames.Start,\r\n            [\"/textures/shop/diamond_\" + i],\r\n            cc.SpriteFrame,\r\n            null,\r\n            function (t, i) {\r\n                var o = i[0];\r\n                if (o && cc.isValid(e.icon)) {\r\n                    e.icon.spriteFrame = $resUtil.ResUtil.assignWith(o, e.node);\r\n                }\r\n            }\r\n        );\r\n        this.render();\r\n        this.renderLimit();\r\n    };\r\n    e.prototype.render = function () {\r\n        this.firstLable.string = \"首次礼包额外获得*\" + this.config.reward_num;\r\n        this.countLable.string = \"x\" + this.config.reward_num;\r\n        var t = $shopContext.default.Ins.getDiamondRecordById(this.config.id);\r\n        this.firstLable.node.active = t.isFrist;\r\n        this.proccessLable.string = \"购买(\" + t.video_count + \"/\" + this.config.vido_num + \")\";\r\n        this.proccessLable.node.parent.children[0].active = !0;\r\n        this.btnBuy.children[1].active = !1;\r\n        this.buyType = 0;\r\n        0 !== this.config.is_video || $shopContext.default.Ins.isDiamondBuyDay(this.config.id)\r\n            ? 0 === this.config.is_video && (this.proccessLable.string = \"购买\")\r\n            : ((this.buyType = 1),\r\n              (this.proccessLable.node.parent.children[0].active = !1),\r\n              (this.proccessLable.string = \"免费\"),\r\n              (this.btnBuy.children[1].active = !0));\r\n    };\r\n    e.prototype.clickBuy = function () {\r\n        var t = this;\r\n        $remoteAudio.default.instance.playEffectMusic(\"Click\");\r\n        0 === this.buyType\r\n            ? $adService.default.Ins.showRewardedVideo(function () {\r\n                  if ($platform.Platform.currPlatForm === $platform.PlatformEnum.TOU_TIAO) {\r\n                      $aD.default.toutiao.report(\"Diamond_Shop\");\r\n                  }\r\n                  t.buy(!0);\r\n                  t.renderLimit();\r\n              })\r\n            : (this.buy(!1),\r\n              $eventManager.default.send($localEventName.default.RENDER_DOT, $startView.MenuType.Shop),\r\n              this.renderLimit());\r\n    };\r\n    e.prototype.buy = function (t) {\r\n        var e = $shopContext.default.Ins.addDiamondRecord(this.config.id, this.config.vido_num);\r\n        if (t && $platform.Platform.currPlatForm === $platform.PlatformEnum.TOU_TIAO) {\r\n            $aD.default.toutiao.report(\"Diamond_Shop_\" + this.config.id, {\r\n                count: e.count\r\n            });\r\n        }\r\n        if (e.isReward) {\r\n            var i = e.isFirst ? 2 * this.config.reward_num : this.config.reward_num;\r\n            $userDataContext.default.Ins.opearDiamond(i);\r\n            this.render();\r\n            var o = [];\r\n            o.push({\r\n                type: 6,\r\n                num: i\r\n            });\r\n            $popupManager.PopupManager.instance.open($assetsMap.AssetsMap.PopUpBundles.prefabs.assetsList.RewardView, {\r\n                infos: o\r\n            });\r\n        } else {\r\n            this.render();\r\n        }\r\n    };\r\n    e.prototype.renderLimit = function () {\r\n        var t = $shopContext.default.Ins.getDiamondRecordById(this.config.id).dayBuyCount;\r\n        this.limitLable.string = \"每日限购(\" + t + \"/\" + this.config.buy_num + \")\";\r\n        $util.default.updateMaterialState(this.btnBuy, t >= this.config.buy_num);\r\n        this.btnBuy.getComponent(cc.Button).interactable = t < this.config.buy_num;\r\n    };\r\n    __decorate([w(cc.Sprite)], e.prototype, \"icon\", void 0);\r\n    __decorate([w(cc.Label)], e.prototype, \"firstLable\", void 0);\r\n    __decorate([w(cc.Label)], e.prototype, \"countLable\", void 0);\r\n    __decorate([w(cc.Node)], e.prototype, \"btnBuy\", void 0);\r\n    __decorate([w(cc.Label)], e.prototype, \"proccessLable\", void 0);\r\n    __decorate([w(cc.Label)], e.prototype, \"limitLable\", void 0);\r\n    return __decorate([b], e);\r\n})(cc.Component);\r\nexports.default = A;\r\n"]}