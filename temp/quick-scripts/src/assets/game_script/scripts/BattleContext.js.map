{"version":3,"sources":["assets\\game_script\\scripts\\BattleContext.js"],"names":["$eventManager","require","$uIManager","$seedUtil","$storageUtil","$startView","$configContext","$localEventName","$localName","$skillContext","$userDataContext","f","t","currLevel","levelRecords","bs","StorageUtil","getItem","LEVEL_RECORD","length","level","Object","defineProperty","get","instance","enumerable","configurable","prototype","setRecord","e","i","o","findIndex","resBlood","push","time","gainBoxIndex","setItem","getRecord","find","getLastRecord","Math","abs","UIManager","showToast","s","r","boxStatus","isGainBox","canPassBoxIndex","openBox","n","getConfigByLevel","TreasureChesttype","h","TreasureChest_num","m","type","num","Ins","opearCoin","send","RENDER_DOT","MenuType","ALL","y","randomFrom","min","g","randomCount","_","splitNumber","k","ext","opearEquipBook","Role","v","b","getUseSkillIds","randomArr","w","A","opearSkillBook","Skill","opearDiamond","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var $eventManager = require(\"./EventManager\");\r\nvar $uIManager = require(\"./UIManager\");\r\nvar $seedUtil = require(\"./SeedUtil\");\r\nvar $storageUtil = require(\"./StorageUtil\");\r\nvar $startView = require(\"./StartView\");\r\nvar $configContext = require(\"./ConfigContext\");\r\nvar $localEventName = require(\"./LocalEventName\");\r\nvar $localName = require(\"./LocalName\");\r\nvar $skillContext = require(\"./SkillContext\");\r\nvar $userDataContext = require(\"./UserDataContext\");\r\nvar f = (function () {\r\n    function t() {\r\n        this.currLevel = 1;\r\n        this.levelRecords = [];\r\n        this.bs = [0, 0.5, 1];\r\n        this.levelRecords = $storageUtil.StorageUtil.getItem($localName.default.LEVEL_RECORD, []);\r\n        if (this.levelRecords.length > 0) {\r\n            this.currLevel = this.levelRecords[this.levelRecords.length - 1].level;\r\n        }\r\n    }\r\n    Object.defineProperty(t, \"Ins\", {\r\n        get: function () {\r\n            if (!t.instance) {\r\n                t.instance = new t();\r\n            }\r\n            return t.instance;\r\n        },\r\n        enumerable: !1,\r\n        configurable: !0\r\n    });\r\n    t.prototype.setRecord = function (t, e, i) {\r\n        var o = this.levelRecords.findIndex(function (e) {\r\n            return e.level === t;\r\n        });\r\n        -1 !== o\r\n            ? this.levelRecords[o].resBlood < e && (this.levelRecords[o].resBlood = e)\r\n            : this.levelRecords.push({\r\n                  level: t,\r\n                  resBlood: e,\r\n                  time: i,\r\n                  gainBoxIndex: -1\r\n              });\r\n        $storageUtil.StorageUtil.setItem($localName.default.LEVEL_RECORD, this.levelRecords);\r\n    };\r\n    t.prototype.getRecord = function (t) {\r\n        return (\r\n            this.levelRecords.find(function (e) {\r\n                return e.level === t;\r\n            }) || {\r\n                level: t,\r\n                resBlood: -1,\r\n                time: 0,\r\n                gainBoxIndex: -1\r\n            }\r\n        );\r\n    };\r\n    t.prototype.getLastRecord = function () {\r\n        var t = null;\r\n        for (var e = this.levelRecords.length - 1; e >= 0; e--) {\r\n            var i = this.levelRecords[e];\r\n            if (i.resBlood > 0) {\r\n                t = i;\r\n                break;\r\n            }\r\n        }\r\n        if (t) {\r\n            if (!(Math.abs(t.level - this.levelRecords.length) > 10)) {\r\n                return t;\r\n            }\r\n            $uIManager.UIManager.instance.showToast(\"检测到关卡数据异常\");\r\n            var o = 1;\r\n            var s = [];\r\n            for (e = 0; e < this.levelRecords.length; e++) {\r\n                var r = this.levelRecords[e];\r\n                if (r.level === o) {\r\n                    s.push({\r\n                        level: o,\r\n                        resBlood: r.resBlood,\r\n                        time: r.time,\r\n                        gainBoxIndex: r.gainBoxIndex\r\n                    });\r\n                    o++;\r\n                }\r\n            }\r\n            this.levelRecords = s;\r\n        }\r\n        return {\r\n            level: 0,\r\n            resBlood: -1,\r\n            time: 0,\r\n            gainBoxIndex: -1\r\n        };\r\n    };\r\n    t.prototype.boxStatus = function (t, e) {\r\n        var i = this.getRecord(t);\r\n        return i.resBlood <= 0\r\n            ? 0\r\n            : i.gainBoxIndex < e && i.resBlood > 0 && i.resBlood >= this.bs[e]\r\n            ? 1\r\n            : i.gainBoxIndex >= e\r\n            ? 2\r\n            : 0;\r\n    };\r\n    t.prototype.isGainBox = function (t, e) {\r\n        return this.getRecord(t).gainBoxIndex >= e;\r\n    };\r\n    t.prototype.canPassBoxIndex = function (t) {\r\n        var e = this.getRecord(t);\r\n        return e.resBlood > 0 && e.gainBoxIndex < 0\r\n            ? 0\r\n            : e.resBlood >= 0.5 && e.gainBoxIndex < 1\r\n            ? 1\r\n            : e.resBlood >= 1 && e.gainBoxIndex < 2\r\n            ? 2\r\n            : -1;\r\n    };\r\n    t.prototype.openBox = function (t, e) {\r\n        var i = [];\r\n        this.getRecord(t).gainBoxIndex = e;\r\n        $storageUtil.StorageUtil.setItem($localName.default.LEVEL_RECORD, this.levelRecords);\r\n        var n = $configContext.default.instance.getConfigByLevel(t);\r\n        var f = n.TreasureChesttype[e];\r\n        var h = n.TreasureChest_num[e];\r\n        for (var m = 0; m < f.length; m++) {\r\n            if (1 === f[m]) {\r\n                i.push({\r\n                    type: 1,\r\n                    num: h[m]\r\n                });\r\n                $userDataContext.default.Ins.opearCoin(h[m]);\r\n                $eventManager.default.send($localEventName.default.RENDER_DOT, $startView.MenuType.ALL);\r\n            }\r\n            if (3 === f[m]) {\r\n                var y = $seedUtil.default.randomFrom(1, 2);\r\n                y = Math.min(y, h[m]);\r\n                var g = $seedUtil.default.randomCount(1, 6, y);\r\n                var _ = $seedUtil.default.splitNumber(h[m], y);\r\n                for (var k = 0; k < y; k++) {\r\n                    i.push({\r\n                        type: 3,\r\n                        ext: g[k],\r\n                        num: _[k]\r\n                    });\r\n                    $userDataContext.default.Ins.opearEquipBook(g[k], _[k]);\r\n                }\r\n                $eventManager.default.send($localEventName.default.RENDER_DOT, $startView.MenuType.Role);\r\n            }\r\n            if (4 === f[m]) {\r\n                var v = $seedUtil.default.randomFrom(1, 4);\r\n                var b = $skillContext.default.Ins.getUseSkillIds();\r\n                v = Math.min(b.length, v);\r\n                b = $seedUtil.default.randomArr(b, v);\r\n                var w = $seedUtil.default.splitNumber(h[m], v);\r\n                for (var A = 0; A < v; A++) {\r\n                    i.push({\r\n                        type: 4,\r\n                        ext: b[A],\r\n                        num: w[A]\r\n                    });\r\n                    $userDataContext.default.Ins.opearSkillBook(b[A], w[A]);\r\n                }\r\n                $eventManager.default.send($localEventName.default.RENDER_DOT, $startView.MenuType.Skill);\r\n            }\r\n            if (6 === f[m]) {\r\n                i.push({\r\n                    type: 6,\r\n                    num: h[m]\r\n                });\r\n                $userDataContext.default.Ins.opearDiamond(h[m]);\r\n            }\r\n        }\r\n        return i;\r\n    };\r\n    return t;\r\n})();\r\nexports.default = f;\r\n"]}